<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í—¥ì‚¬ë³´ë“œ AI ëŒ€ì‹œë³´ë“œ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667eea',
                        secondary: '#764ba2',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-primary to-secondary min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <!-- í—¤ë” -->
        <div class="text-center text-white mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">
                ğŸ¤– í—¥ì‚¬ë³´ë“œ AI ëŒ€ì‹œë³´ë“œ
            </h1>
            <div id="status" class="inline-block px-4 py-2 rounded-full text-sm font-bold bg-red-500 text-white">
                ì—°ê²° ëŒ€ê¸° ì¤‘...
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- ì„¼ì„œ ëª¨ë‹ˆí„° -->
            <div class="bg-white rounded-2xl shadow-2xl p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š ì„¼ì„œ</h2>
                <div class="space-y-3">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 text-center">
                        <div class="text-3xl mb-1">ğŸŒ¡ï¸</div>
                        <div class="text-xs text-gray-600">ì˜¨ë„</div>
                        <div class="text-xl font-bold text-gray-800">
                            <span id="temp">--</span><span class="text-sm text-gray-500">Â°C</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-lg p-4 text-center">
                        <div class="text-3xl mb-1">ğŸ’§</div>
                        <div class="text-xs text-gray-600">ìŠµë„</div>
                        <div class="text-xl font-bold text-gray-800">
                            <span id="humid">--</span><span class="text-sm text-gray-500">%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI ì œì–´ -->
            <div class="lg:col-span-2 bg-white rounded-2xl shadow-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ¤– AI ìì—°ì–´ ì œì–´</h2>
                
                <!-- ëª…ë ¹ ì…ë ¥ -->
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">ëª…ë ¹ ì…ë ¥</label>
                    <div class="flex gap-3">
                        <input type="text" id="aiCommand" 
                               placeholder="ì˜ˆ: LEDë¥¼ íŒŒë€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì¤˜" 
                               onkeypress="if(event.key==='Enter') sendAICommand()"
                               class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                        <button onclick="sendAICommand()" 
                                class="px-8 py-3 bg-primary hover:bg-opacity-90 text-white font-bold rounded-lg transition-all hover:-translate-y-0.5 whitespace-nowrap">
                            âœ¨ ì‹¤í–‰
                        </button>
                    </div>
                </div>
                
                <!-- ì˜ˆì‹œ ëª…ë ¹ -->
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">ì˜ˆì‹œ ëª…ë ¹</label>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="setAIExample('LEDë¥¼ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì¤˜')" 
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all">
                            ë¹¨ê°„ìƒ‰
                        </button>
                        <button onclick="setAIExample('LEDë¥¼ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ì¼œì¤˜')" 
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all">
                            ì´ˆë¡ìƒ‰
                        </button>
                        <button onclick="setAIExample('LEDë¥¼ ê¹œë¹¡ì´ê²Œ í•´ì¤˜')" 
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all">
                            ê¹œë¹¡ì„
                        </button>
                        <button onclick="setAIExample('ë°ê¸°ë¥¼ 50%ë¡œ ë‚®ì¶°ì¤˜')" 
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all">
                            ë°ê¸° 50%
                        </button>
                        <button onclick="setAIExample('LEDë¥¼ êº¼ì¤˜')" 
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all">
                            ë„ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- AI ì‘ë‹µ -->
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">AI ì‘ë‹µ</label>
                    <div id="aiResponse" class="bg-gray-50 border-l-4 border-primary rounded-lg p-4 text-sm leading-relaxed text-gray-700">
                        ëª…ë ¹ì„ ì…ë ¥í•˜ê³  ì‹¤í–‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ë¡œê·¸ -->
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ ë¡œê·¸</h2>
            <div id="log" class="bg-gray-50 rounded-lg p-4 max-h-48 overflow-y-auto font-mono text-sm space-y-2"></div>
        </div>
    </div>

    <!-- MQTT.js -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    
    <script>
        // MQTT ì„¤ì •
        const MQTT_BROKER = "wss://abc123.s1.eu.hivemq.cloud:8884/mqtt";
        const MQTT_USER = "hexaboard";
        const MQTT_PASSWORD = "your_password";
        const BOARD_ID = "A";
        
        // OpenAI API (ë³´ì•ˆ ì£¼ì˜! ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ ì„œë²„ ì‚¬ìš©)
        const OPENAI_API_KEY = "sk-proj-YOUR_API_KEY_HERE";
        
        const TOPIC_SENSOR = `hexaboard/${BOARD_ID}/sensor/data`;
        const TOPIC_CONTROL = `hexaboard/${BOARD_ID}/control/led`;
        
        const client = mqtt.connect(MQTT_BROKER, {
            username: MQTT_USER,
            password: MQTT_PASSWORD,
            clientId: 'web_ai_' + Math.random().toString(16).substr(2, 8)
        });
        
        client.on('connect', function() {
            updateStatus(true);
            addLog('MQTT ì—°ê²° ì„±ê³µ');
            client.subscribe(TOPIC_SENSOR);
        });
        
        client.on('message', function(topic, message) {
            try {
                const data = JSON.parse(message.toString());
                updateSensorData(data);
            } catch (e) {}
        });
        
        client.on('close', function() {
            updateStatus(false);
        });
        
        async function sendAICommand() {
            const inputEl = document.getElementById('aiCommand');
            const userCommand = inputEl.value.trim();
            
            if (!userCommand) {
                alert('ëª…ë ¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const responseEl = document.getElementById('aiResponse');
            responseEl.textContent = 'ğŸ¤” AIê°€ ëª…ë ¹ì„ ë¶„ì„ ì¤‘...';
            responseEl.className = 'bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-4 text-sm leading-relaxed';
            
            addLog(`AI ëª…ë ¹: ${userCommand}`);
            
            try {
                const ledCommand = await analyzeLEDCommand(userCommand);
                
                if (ledCommand) {
                    sendLEDCommandFromAI(ledCommand);
                    
                    responseEl.innerHTML = `
                        âœ… <strong>ëª…ë ¹ ì´í•´:</strong> ${ledCommand.description}<br>
                        ğŸ“¤ <strong>ì‹¤í–‰:</strong> ${ledCommand.action}
                    `;
                    responseEl.className = 'bg-green-50 border-l-4 border-green-400 rounded-lg p-4 text-sm leading-relaxed';
                } else {
                    responseEl.textContent = 'âŒ ëª…ë ¹ì„ ì´í•´í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
                    responseEl.className = 'bg-red-50 border-l-4 border-red-400 rounded-lg p-4 text-sm leading-relaxed';
                }
            } catch (error) {
                responseEl.textContent = 'âŒ AI ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message;
                responseEl.className = 'bg-red-50 border-l-4 border-red-400 rounded-lg p-4 text-sm leading-relaxed';
            }
            
            inputEl.value = '';
        }
        
        async function analyzeLEDCommand(userCommand) {
            const prompt = `
ë‹¤ìŒ ì‚¬ìš©ì ëª…ë ¹ì„ LED ì œì–´ ëª…ë ¹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”.

ì‚¬ìš©ì ëª…ë ¹: "${userCommand}"

LED ì œì–´ ì˜µì…˜:
- ìƒ‰ìƒ: red(255,0,0), green(0,255,0), blue(0,0,255), yellow(255,255,0), purple(255,0,255), cyan(0,255,255), white(255,255,255)
- íŒ¨í„´: solid(ë‹¨ìƒ‰), blink(ê¹œë¹¡ì„), pulse(í„ìŠ¤)
- ë°ê¸°: 10-100%

JSON í˜•ì‹ë§Œ ì¶œë ¥:
{"action": "led_color", "color": [R,G,B], "pattern": "solid", "brightness": 80, "description": "ì„¤ëª…"}
`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {role: 'system', content: 'LED ì œì–´ ëª…ë ¹ ë³€í™˜ ì „ë¬¸ê°€. JSONë§Œ ì¶œë ¥.'},
                            {role: 'user', content: prompt}
                        ],
                        max_tokens: 200,
                        temperature: 0.3
                    })
                });
                
                if (!response.ok) throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                
                const data = await response.json();
                let content = data.choices[0].message.content.trim();
                
                if (content.includes('```')) {
                    content = content.split('```')[1].replace('json', '').trim();
                }
                
                return JSON.parse(content);
            } catch (error) {
                console.error('AI ì˜¤ë¥˜:', error);
                throw error;
            }
        }
        
        function sendLEDCommandFromAI(aiCommand) {
            if (aiCommand.action === 'led_off') {
                client.publish(TOPIC_CONTROL, JSON.stringify({action: "led_off"}));
            } else {
                client.publish(TOPIC_CONTROL, JSON.stringify(aiCommand));
            }
        }
        
        function setAIExample(example) {
            document.getElementById('aiCommand').value = example;
        }
        
        function updateStatus(connected) {
            const statusEl = document.getElementById('status');
            if (connected) {
                statusEl.textContent = 'ì—°ê²°ë¨';
                statusEl.className = 'inline-block px-4 py-2 rounded-full text-sm font-bold bg-green-400 text-green-900';
            } else {
                statusEl.textContent = 'ì—°ê²° ëŠê¹€';
                statusEl.className = 'inline-block px-4 py-2 rounded-full text-sm font-bold bg-red-500 text-white';
            }
        }
        
        function updateSensorData(data) {
            document.getElementById('temp').textContent = data.temperature;
            document.getElementById('humid').textContent = data.humidity;
        }
        
        function addLog(message) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString('ko-KR');
            
            const logItem = document.createElement('div');
            logItem.className = 'border-b border-gray-200 pb-2';
            logItem.innerHTML = `<span class="text-gray-400">${time}</span><span class="ml-3">${message}</span>`;
            
            logEl.insertBefore(logItem, logEl.firstChild);
            
            while (logEl.children.length > 20) {
                logEl.removeChild(logEl.lastChild);
            }
        }
    </script>
</body>
</html>


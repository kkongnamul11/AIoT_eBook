# Chapter 5. 네오픽셀 기초 – 빛의 마법 시작하기

> **PART 2**: 헥사보드 기본 제어 – 버튼과 네오픽셀

---

## 빛으로 말하기

인간은 시각적 동물입니다. 우리가 받아들이는 정보의 80% 이상이 시각을 통해 들어옵니다. 그래서 LED는 IoT 장치에서 가장 강력한 출력 수단입니다.

신호등의 빨간불, 스마트폰 충전 중의 작은 LED, 게이밍 키보드의 화려한 RGB 조명... 모두 LED로 상태와 정보를 전달합니다.

헥사보드에는 특별한 LED가 있습니다: **네오픽셀(NeoPixel)**. 정식 명칭은 WS2812B이지만, Adafruit사가 만든 "NeoPixel"이라는 이름이 더 유명해졌죠.

네오픽셀의 마법:

- **1,677만 가지 색상**: RGB 각각 256단계 (256 × 256 × 256)
- **개별 제어**: 25개 LED를 각각 다른 색으로
- **간단한 연결**: 단 하나의 GPIO 핀으로 모든 LED 제어
- **체인 연결**: 수백 개를 연결해도 제어 가능

이 챕터에서는 네오픽셀의 기초를 배우고, 색상을 자유자재로 다루며, 간단한 애니메이션까지 만들어봅니다!

**예상 소요 시간**: 40분

---

## RGB: 빛의 3원색

### 가산 혼합의 원리

초등학교 미술 시간에 배운 것을 기억하시나요? 물감을 섞으면:

- 빨강 + 노랑 = 주황
- 빨강 + 파랑 = 보라
- 모든 색을 섞으면 = 검은색 (또는 갈색)

이것은 **감산 혼합**입니다. 물감은 빛을 흡수하기 때문이죠.

하지만 LED는 **빛**을 만듭니다. 빛의 혼합은 정반대입니다:

- 빨강 + 초록 = 노랑 (놀랍죠!)
- 빨강 + 파랑 = 마젠타(자홍)
- 초록 + 파랑 = 시안(청록)
- **모든 색을 섞으면 = 흰색!**

이것이 **가산 혼합**입니다.

### RGB 모델

컴퓨터 화면, TV, 스마트폰, 그리고 네오픽셀은 모두 RGB 모델을 사용합니다:

- **R (Red)**: 빨강, 0~255
- **G (Green)**: 초록, 0~255
- **B (Blue)**: 파랑, 0~255

각 색상을 0(꺼짐)부터 255(최대 밝기)까지 조절할 수 있습니다.

**예시**:

```python
(255, 0, 0)    # 순수한 빨강
(0, 255, 0)    # 순수한 초록
(0, 0, 255)    # 순수한 파랑
(255, 255, 0)  # 빨강 + 초록 = 노랑
(255, 0, 255)  # 빨강 + 파랑 = 마젠타
(0, 255, 255)  # 초록 + 파랑 = 시안
(255, 255, 255)# 모두 = 흰색
(128, 128, 128)# 모두 50% = 회색
(0, 0, 0)      # 모두 꺼짐 = 검정
```

### 왜 255일까?

컴퓨터는 2진수를 사용합니다. 8비트(1바이트)로 표현할 수 있는 숫자의 범위는:

- 0부터 255까지 (총 256개)

RGB 각각 1바이트 = 총 3바이트 = 24비트 컬러 = 16,777,216가지 색상!

---

## 네오픽셀의 작동 원리

### WS2812B 칩

각 네오픽셀 LED 안에는 작은 칩이 들어있습니다. 이 칩이:

- 데이터를 받아서 해석
- 자신의 색상을 설정
- 나머지 데이터를 다음 LED로 전달

### 체인 연결 (Daisy Chain)

헥사보드의 25개 LED는 다음과 같이 연결됩니다:

```
GPIO 23 → LED 0 → LED 1 → LED 2 → ... → LED 24
```

데이터가 한 방향으로 흐릅니다. 첫 번째 LED가 자신의 데이터를 받으면, 나머지를 다음 LED로 전달합니다.

이 방식의 장점:

- **단순함**: 하나의 GPIO 핀으로 수백 개 제어 가능
- **확장성**: LED를 추가하기 쉬움
- **개별 제어**: 각 LED를 독립적으로 제어

### 헥사보드의 네오픽셀 배치

헥사보드에는 **25개**(5×5)의 네오픽셀이 있습니다:

```
네오픽셀 인덱스 (5×5 그리드)
┌─────────────────────┐
│  0   1   2   3   4  │
│  5   6   7   8   9  │
│ 10  11  12  13  14  │
│ 15  16  17  18  19  │
│ 20  21  22  23  24  │
└─────────────────────┘
```

- **GPIO 핀**: 23번
- **인덱스**: 0번부터 24번까지 (프로그래밍은 0부터 시작!)
- **순서**: 왼쪽 위(0)에서 시작, 오른쪽으로, 다음 줄로

---

## 실습 준비

### 필요한 것

- 헥사보드 × 1
- USB 케이블 × 1
- Thonny IDE

### 안전 주의사항

네오픽셀은 밝습니다. 특히 흰색(255, 255, 255)은 **매우 밝습니다**!

- 처음에는 낮은 밝기(50~100)로 시작하세요
- 직접 쳐다보지 마세요
- 어두운 곳에서는 더욱 조심하세요

---

## 실습 1: 첫 번째 네오픽셀 켜기

### 목표

0번 LED를 빨간색으로 켭니다.

### 코드

```python
# 파일명: ch05_neopixel_one.py
from machine import Pin
import neopixel

# 네오픽셀 설정
NUM_LEDS = 25  # 총 LED 개수
PIN = 23       # GPIO 핀 번호

# 네오픽셀 객체 생성
np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)

# 0번 LED를 빨간색으로 설정
np[0] = (255, 0, 0)  # (R, G, B)

# 실제로 LED에 전송!
np.write()

print("0번 LED가 빨간색으로 켜졌습니다!")
print("프로그램을 종료해도 LED는 계속 켜져 있습니다.")
```

### 코드 설명

```python
import neopixel
```

→ MicroPython의 네오픽셀 라이브러리를 가져옵니다.

```python
np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)
```

→ 네오픽셀 객체를 생성합니다. `np`라는 변수로 모든 LED를 제어할 수 있습니다.

```python
np[0] = (255, 0, 0)
```

→ 0번 LED의 색상을 설정합니다. 리스트처럼 인덱스로 접근!
→ `(255, 0, 0)` = 빨강 최대, 초록 0, 파랑 0 = 순수한 빨강

```python
np.write()
```

→ **매우 중요!** 설정한 색상을 실제 LED에 전송합니다.
→ 이 명령이 없으면 LED가 켜지지 않습니다!

### 실행하기

1. 코드를 Thonny에 입력
2. F5 또는 ▶️ 실행
3. 헥사보드의 왼쪽 위 LED(0번)가 빨간색으로 켜집니다!

### 실험해보기

색상을 바꿔보세요:

```python
np[0] = (0, 255, 0)  # 초록
np.write()
```

```python
np[0] = (0, 0, 255)  # 파랑
np.write()
```

```python
np[0] = (255, 255, 0)  # 노랑 (빨강 + 초록)
np.write()
```

---

## 실습 2: 색상 변화 애니메이션

### 목표

0번 LED가 여러 색상으로 순환합니다.

### 코드

```python
# 파일명: ch05_neopixel_colors.py
from machine import Pin
import neopixel
import time

NUM_LEDS = 25
PIN = 23

np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)

# 색상 목록 정의
colors = [
    (255, 0, 0),      # 빨강
    (255, 128, 0),    # 주황
    (255, 255, 0),    # 노랑
    (0, 255, 0),      # 초록
    (0, 255, 255),    # 시안
    (0, 0, 255),      # 파랑
    (128, 0, 255),    # 보라
    (255, 0, 255),    # 마젠타
    (255, 255, 255),  # 흰색
]

color_names = [
    "빨강", "주황", "노랑", "초록",
    "시안", "파랑", "보라", "마젠타", "흰색"
]

print("색상 변화 시작!")
print("Ctrl+C로 종료하세요")
print()

# 색상 순환
for i, color in enumerate(colors):
    np[0] = color
    np.write()
    print(f"{color_names[i]}: {color}")
    time.sleep(1)

# 끄기
np[0] = (0, 0, 0)
np.write()
print("\n완료!")
```

### 실행 결과

0번 LED가 1초마다 색상이 바뀌며, Shell 창에 색상 이름이 출력됩니다:

```
색상 변화 시작!
Ctrl+C로 종료하세요

빨강: (255, 0, 0)
주황: (255, 128, 0)
노랑: (255, 255, 0)
...
```

**아름답죠?** 이것이 RGB의 힘입니다!

---

## 실습 3: 여러 LED 동시에 켜기

### 목표

첫 줄의 5개 LED를 서로 다른 색으로 켭니다.

### 코드

```python
# 파일명: ch05_neopixel_multiple.py
from machine import Pin
import neopixel
import time

NUM_LEDS = 25
PIN = 23

np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)

# 첫 줄 5개 LED를 무지개 색으로
np[0] = (255, 0, 0)      # 빨강
np[1] = (255, 128, 0)    # 주황
np[2] = (255, 255, 0)    # 노랑
np[3] = (0, 255, 0)      # 초록
np[4] = (0, 0, 255)      # 파랑

# 한 번에 전송!
np.write()

print("무지개 첫 줄 완성!")
print("🔴 🟠 🟡 🟢 🔵")
print()
print("프로그램을 종료해도 LED는 계속 켜져 있습니다.")
```

### 결과

```
헥사보드 화면:
┌──────────────────────┐
│ 🔴 🟠 🟡 🟢 🔵 │  ← 무지개!
│ ░  ░  ░  ░  ░  │
│ ░  ░  ░  ░  ░  │
│ ░  ░  ░  ░  ░  │
│ ░  ░  ░  ░  ░  │
└──────────────────────┘
```

**핵심**: 여러 LED를 설정한 후, `np.write()`를 **한 번만** 호출하면 모두 동시에 업데이트됩니다!

---

## 실습 4: 전체 LED 제어하기

### 목표

25개 LED를 모두 같은 색으로 채웁니다.

### 코드

```python
# 파일명: ch05_neopixel_fill.py
from machine import Pin
import neopixel
import time

NUM_LEDS = 25
PIN = 23

np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)

def fill(color):
    """모든 LED를 같은 색으로 채우는 함수"""
    for i in range(NUM_LEDS):
        np[i] = color
    np.write()

def clear():
    """모든 LED를 끄는 함수"""
    fill((0, 0, 0))

# 빨간색으로 채우기
print("빨간색 채우기...")
fill((100, 0, 0))  # 밝기 낮춤 (눈 보호)
time.sleep(2)

# 초록색으로 채우기
print("초록색 채우기...")
fill((0, 100, 0))
time.sleep(2)

# 파란색으로 채우기
print("파란색 채우기...")
fill((0, 0, 100))
time.sleep(2)

# 끄기
print("끄기...")
clear()
print("완료!")
```

### 코드 설명

```python
def fill(color):
    for i in range(NUM_LEDS):
        np[i] = color
    np.write()
```

→ 함수로 만들면 재사용하기 쉽습니다!
→ `range(NUM_LEDS)`는 0부터 24까지 반복

**주의**: 밝기를 100으로 낮췄습니다 (255 대신). 전체 LED를 최대 밝기로 켜면 눈이 부실 수 있고, 전력 소모도 큽니다!

---

## 실습 5: 웨이브 애니메이션

### 목표

LED가 순서대로 켜지면서 이동하는 효과를 만듭니다.

### 코드

```python
# 파일명: ch05_neopixel_wave.py
from machine import Pin
import neopixel
import time

NUM_LEDS = 25
PIN = 23

np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)

# 모두 끄기
for i in range(NUM_LEDS):
    np[i] = (0, 0, 0)
np.write()

print("웨이브 애니메이션 시작!")
print("Ctrl+C로 종료하세요")
print()

# 무한 반복
while True:
    # 앞으로 이동
    for i in range(NUM_LEDS):
        # 이전 LED 끄기
        if i > 0:
            np[i-1] = (0, 0, 0)

        # 현재 LED 켜기
        np[i] = (0, 100, 0)  # 초록색
        np.write()

        time.sleep(0.05)  # 50ms 대기

    # 마지막 LED 끄기
    np[NUM_LEDS-1] = (0, 0, 0)
    np.write()

    time.sleep(0.3)  # 잠시 대기 후 반복
```

### 실행 결과

초록색 LED가 0번부터 24번까지 순서대로 이동합니다. 마치 물결처럼!

**응용**: `time.sleep(0.05)`를 `0.01`로 바꾸면 더 빠르게, `0.1`로 바꾸면 더 느리게 움직입니다.

---

## 실습 6: 밝기 조절 (페이드 효과)

### 목표

LED가 서서히 밝아졌다가 어두워지는 효과를 만듭니다.

### 코드

```python
# 파일명: ch05_neopixel_fade.py
from machine import Pin
import neopixel
import time

NUM_LEDS = 25
PIN = 23

np = neopixel.NeoPixel(Pin(PIN), NUM_LEDS)

def set_all(color):
    """모든 LED를 같은 색으로"""
    for i in range(NUM_LEDS):
        np[i] = color
    np.write()

print("페이드 효과 시작!")
print("Ctrl+C로 종료하세요")
print()

while True:
    # 서서히 밝아지기 (0 → 100)
    for brightness in range(0, 101, 5):
        set_all((brightness, 0, brightness))  # 보라색
        time.sleep(0.05)

    # 서서히 어두워지기 (100 → 0)
    for brightness in range(100, -1, -5):
        set_all((brightness, 0, brightness))  # 보라색
        time.sleep(0.05)
```

### 실행 결과

모든 LED가 보라색으로 서서히 밝아졌다가 어두워지는 것을 반복합니다. 마치 숨쉬는 것처럼!

**핵심**: RGB 값을 점진적으로 변경하면 부드러운 애니메이션을 만들 수 있습니다.

---

## 문제 해결

### 문제 1: LED가 전혀 안 켜져요

**체크리스트**:

- [ ] `np.write()`를 호출했나요? (가장 흔한 실수!)
- [ ] 핀 번호가 23번이 맞나요?
- [ ] USB 케이블이 연결되어 있나요?
- [ ] 헥사보드가 MicroPython으로 설정되어 있나요?

**테스트 코드**:

```python
from machine import Pin
import neopixel

np = neopixel.NeoPixel(Pin(23), 25)
np[0] = (100, 0, 0)
np.write()  # 이 줄이 꼭 필요!
```

### 문제 2: 색이 이상해요 (원하는 색이 안 나와요)

**원인**: RGB 순서를 잘못 입력했을 수 있습니다.

**해결**:

- 순서는 항상 **(R, G, B)**
- 각 값은 **0~255** 범위

```python
# 올바른 예
np[0] = (255, 0, 0)    # 빨강 ✅
np[0] = (0, 255, 0)    # 초록 ✅
np[0] = (0, 0, 255)    # 파랑 ✅

# 잘못된 예
np[0] = (0, 0, 255, 0)  # 4개 값 ❌
np[0] = (300, 0, 0)     # 255 초과 ❌
np[0] = 255             # 튜플이 아님 ❌
```

### 문제 3: 너무 밝아서 눈이 아파요

**해결**: 밝기를 낮추세요!

```python
# 최대 밝기 (눈 아픔!)
np[0] = (255, 255, 255)

# 50% 밝기 (적당함)
np[0] = (128, 128, 128)

# 20% 밝기 (편안함)
np[0] = (50, 50, 50)
```

**팁**: 개발할 때는 50~100 정도로 시작하세요. 나중에 필요하면 밝기를 높이면 됩니다.

### 문제 4: 일부 LED만 이상하게 동작해요

**원인**: 이전 코드의 설정이 남아있을 수 있습니다.

**해결**: 프로그램 시작 시 모든 LED를 끄세요.

```python
# 프로그램 시작 시
for i in range(NUM_LEDS):
    np[i] = (0, 0, 0)
np.write()
```

---

## 핵심 요약

### 오늘 배운 개념

1. **RGB 색상 모델**: (R, G, B) 튜플로 1,677만 가지 색상 표현
2. **네오픽셀 초기화**: `neopixel.NeoPixel(Pin(핀번호), LED개수)`
3. **색상 설정**: `np[인덱스] = (R, G, B)`
4. **전송**: `np.write()` - 반드시 호출해야 LED가 켜짐!
5. **밝기 조절**: RGB 값을 낮추면 어두워짐
6. **애니메이션**: 반복문 + 시간 지연으로 움직이는 효과

### 핵심 코드 패턴

**기본 설정**:

```python
from machine import Pin
import neopixel

np = neopixel.NeoPixel(Pin(23), 25)
```

**LED 켜기**:

```python
np[0] = (255, 0, 0)  # 빨간색
np.write()           # 전송!
```

**모두 채우기**:

```python
for i in range(25):
    np[i] = (0, 100, 0)  # 초록색
np.write()
```

**모두 끄기**:

```python
for i in range(25):
    np[i] = (0, 0, 0)
np.write()
```

---

## 색상 참고표

실전에서 자주 사용하는 색상들:

```python
# 기본 색상 (밝기 100)
RED     = (100, 0, 0)
GREEN   = (0, 100, 0)
BLUE    = (0, 0, 100)
YELLOW  = (100, 100, 0)
CYAN    = (0, 100, 100)
MAGENTA = (100, 0, 100)
WHITE   = (100, 100, 100)
OFF     = (0, 0, 0)

# 파스텔 톤
PINK    = (100, 50, 50)
MINT    = (50, 100, 50)
LAVENDER= (50, 50, 100)
PEACH   = (100, 70, 50)

# 어두운 톤 (상태 표시용)
DIM_RED = (20, 0, 0)
DIM_GREEN = (0, 20, 0)
DIM_BLUE = (0, 0, 20)
```

---

## 도전 과제

### 과제 1: 신호등 만들기 ⭐️

0번, 1번, 2번 LED를 사용하여 신호등을 만드세요:

- 0번: 빨강 (2초)
- 1번: 노랑 (1초)
- 2번: 초록 (2초)
- 반복

### 과제 2: 십자가 패턴 ⭐️⭐️

5×5 그리드에서 가운데 십자(+) 모양만 켜세요:

```
░ ░ 🔴 ░ ░
░ ░ 🔴 ░ ░
🔴🔴🔴🔴🔴
░ ░ 🔴 ░ ░
░ ░ 🔴 ░ ░
```

**힌트**:

- 세로 줄: 2, 7, 12, 17, 22번
- 가로 줄: 10, 11, 12, 13, 14번

### 과제 3: 무지개 회전 ⭐️⭐️⭐️

첫 줄 5개 LED에 무지개 색을 표시하고, 1초마다 오른쪽으로 회전시키세요.

```
시작: 🔴 🟠 🟡 🟢 🔵
1초 후: 🔵 🔴 🟠 🟡 🟢
2초 후: 🟢 🔵 🔴 🟠 🟡
...
```

**힌트**: 리스트의 마지막 요소를 맨 앞으로 이동

---

## 다음 단계

네오픽셀 기초를 마스터했습니다! 🎉

이제 여러분은:

- RGB 색상 모델을 이해합니다
- 개별 LED를 제어할 수 있습니다
- 전체 LED를 한 번에 제어할 수 있습니다
- 간단한 애니메이션을 만들 수 있습니다
- 밝기를 조절할 수 있습니다

다음 챕터에서는 **버튼과 네오픽셀을 결합**합니다!

버튼을 누르면 LED 패턴이 바뀌고, 상태에 따라 다른 색상을 표시하는 **상태 머신(State Machine)**을 만들어봅니다. 진짜 인터랙티브 시스템의 시작입니다!

**준비되셨나요? Let's create!** 🚀

---

**다음 챕터 예고**  
Chapter 6 - 상태 머신: 버튼과 LED로 만드는 인터랙티브 시스템

버튼을 누르면 모드가 바뀌고, 각 모드마다 다른 LED 패턴이 표시됩니다. 신호등, 게임, 메뉴 시스템... 모든 것의 기초가 되는 상태 머신을 배웁니다!

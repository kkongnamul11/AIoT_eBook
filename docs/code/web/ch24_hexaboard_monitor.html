<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í—¥ì‚¬ë³´ë“œ ì„¼ì„œ ëª¨ë‹ˆí„°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .status {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: bold;
      }

      .status.connected {
        background: #00ff00;
        color: #004400;
      }

      .status.disconnected {
        background: #ff0000;
        color: white;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .sensor-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .sensor-item {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 10px;
      }

      .sensor-icon {
        font-size: 3em;
        margin-bottom: 10px;
      }

      .sensor-label {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 5px;
      }

      .sensor-value {
        font-size: 2em;
        font-weight: bold;
        color: #333;
      }

      .sensor-unit {
        font-size: 0.6em;
        color: #999;
      }

      .log {
        max-height: 200px;
        overflow-y: auto;
        background: #f5f5f5;
        padding: 15px;
        border-radius: 10px;
        font-family: "Courier New", monospace;
        font-size: 0.85em;
      }

      .log-item {
        padding: 5px 0;
        border-bottom: 1px solid #ddd;
      }

      .log-time {
        color: #999;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ›ï¸ í—¥ì‚¬ë³´ë“œ ì„¼ì„œ ëª¨ë‹ˆí„°</h1>
        <div class="status disconnected" id="status">ì—°ê²° ëŒ€ê¸° ì¤‘...</div>
      </div>

      <div class="card">
        <h2>ğŸ“Š ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„°</h2>
        <div class="sensor-grid">
          <div class="sensor-item">
            <div class="sensor-icon">ğŸŒ¡ï¸</div>
            <div class="sensor-label">ì˜¨ë„</div>
            <div class="sensor-value" id="temp">
              --<span class="sensor-unit">Â°C</span>
            </div>
          </div>

          <div class="sensor-item">
            <div class="sensor-icon">ğŸ’§</div>
            <div class="sensor-label">ìŠµë„</div>
            <div class="sensor-value" id="humid">
              --<span class="sensor-unit">%</span>
            </div>
          </div>

          <div class="sensor-item">
            <div class="sensor-icon">ğŸ’¡</div>
            <div class="sensor-label">ì¡°ë„</div>
            <div class="sensor-value" id="light">--</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ“ ë°ì´í„° ë¡œê·¸</h2>
        <div class="log" id="log">
          <div class="log-item">
            <span class="log-time">--:--:--</span>
            ì—°ê²° ëŒ€ê¸° ì¤‘...
          </div>
        </div>
      </div>
    </div>

    <!-- MQTT.js -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <script>
      // MQTT ì„¤ì • (ë³¸ì¸ì˜ ì •ë³´ë¡œ ë³€ê²½)
      const MQTT_BROKER = "wss://abc123.s1.eu.hivemq.cloud:8884/mqtt";
      const MQTT_USER = "hexaboard";
      const MQTT_PASSWORD = "your_password";
      const TOPIC_SENSOR = "hexaboard/+/sensor/data";

      // MQTT í´ë¼ì´ì–¸íŠ¸
      const client = mqtt.connect(MQTT_BROKER, {
        username: MQTT_USER,
        password: MQTT_PASSWORD,
        clientId: "web_monitor_" + Math.random().toString(16).substr(2, 8),
      });

      // ì—°ê²° ì„±ê³µ
      client.on("connect", function () {
        console.log("âœ… MQTT ì—°ê²° ì„±ê³µ!");
        updateStatus(true);
        addLog("MQTT Brokerì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");

        client.subscribe(TOPIC_SENSOR, function (err) {
          if (!err) {
            addLog(`êµ¬ë… ì‹œì‘: ${TOPIC_SENSOR}`);
          }
        });
      });

      // ë©”ì‹œì§€ ìˆ˜ì‹ 
      client.on("message", function (topic, message) {
        try {
          const data = JSON.parse(message.toString());
          updateSensorData(data);
          addLog(`ì„¼ì„œ ë°ì´í„°: ${data.temperature}Â°C, ${data.humidity}%`);
        } catch (e) {
          console.error("íŒŒì‹± ì˜¤ë¥˜:", e);
        }
      });

      // ì—°ê²° ëŠê¹€
      client.on("close", function () {
        console.log("âŒ MQTT ì—°ê²° ëŠê¹€");
        updateStatus(false);
        addLog("ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.");
      });

      // UI ì—…ë°ì´íŠ¸
      function updateStatus(connected) {
        const statusEl = document.getElementById("status");
        if (connected) {
          statusEl.textContent = "ì—°ê²°ë¨";
          statusEl.className = "status connected";
        } else {
          statusEl.textContent = "ì—°ê²° ëŠê¹€";
          statusEl.className = "status disconnected";
        }
      }

      function updateSensorData(data) {
        document.getElementById(
          "temp"
        ).innerHTML = `${data.temperature}<span class="sensor-unit">Â°C</span>`;
        document.getElementById(
          "humid"
        ).innerHTML = `${data.humidity}<span class="sensor-unit">%</span>`;
        document.getElementById("light").textContent = data.light || "--";
      }

      function addLog(message) {
        const logEl = document.getElementById("log");
        const time = new Date().toLocaleTimeString("ko-KR");

        const logItem = document.createElement("div");
        logItem.className = "log-item";
        logItem.innerHTML = `<span class="log-time">${time}</span>${message}`;

        logEl.insertBefore(logItem, logEl.firstChild);

        while (logEl.children.length > 20) {
          logEl.removeChild(logEl.lastChild);
        }
      }
    </script>
  </body>
</html>

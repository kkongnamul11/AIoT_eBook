<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>HexaBoard_AI_SensorLab_Complete_eBook</title>
  <style>

html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
border: none;
border-top: 1px solid #1a1a1a;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#헥사보드-ai-센서랩" id="toc-헥사보드-ai-센서랩">📘
헥사보드 AI 센서랩</a>
<ul>
<li><a href="#openai와-함께하는-스마트-환경-실험실" id="toc-openai와-함께하는-스마트-환경-실험실">OpenAI와 함께하는 스마트
환경 실험실</a></li>
<li><a href="#이-책에-대하여" id="toc-이-책에-대하여">📚 이 책에
대하여</a>
<ul>
<li><a href="#이-책의-특징" id="toc-이-책의-특징">이 책의 특징</a></li>
<li><a href="#대상-독자" id="toc-대상-독자">대상 독자</a></li>
<li><a href="#필요한-준비물" id="toc-필요한-준비물">필요한
준비물</a></li>
</ul></li>
<li><a href="#목차" id="toc-목차">📑 목차</a>
<ul>
<li><a href="#part-1.-ai-센서랩과-헥사보드-이해하기" id="toc-part-1.-ai-센서랩과-헥사보드-이해하기">PART 1. AI 센서랩과
헥사보드 이해하기</a></li>
<li><a href="#part-2.-헥사보드-기본-제어-버튼과-네오픽셀" id="toc-part-2.-헥사보드-기본-제어-버튼과-네오픽셀">PART 2. 헥사보드
기본 제어 – 버튼과 네오픽셀</a></li>
<li><a href="#part-3.-온습도-센서-조도-센서-연결하기" id="toc-part-3.-온습도-센서-조도-센서-연결하기">PART 3. 온습도 센서
&amp; 조도 센서 연결하기</a></li>
<li><a href="#part-4.-mqtt를-통한-센서-데이터-전송" id="toc-part-4.-mqtt를-통한-센서-데이터-전송">PART 4. MQTT를 통한 센서
데이터 전송</a></li>
<li><a href="#part-5.-python-openai로-ai-명령-엔진-만들기" id="toc-part-5.-python-openai로-ai-명령-엔진-만들기">PART 5. Python +
OpenAI로 AI 명령 엔진 만들기</a></li>
<li><a href="#part-6.-종합-프로젝트-ai-환경-무드-컨트롤러" id="toc-part-6.-종합-프로젝트-ai-환경-무드-컨트롤러">PART 6. 종합
프로젝트 – AI 환경 무드 컨트롤러</a></li>
<li><a href="#part-7.-웹-기반-ai-제어-대시보드" id="toc-part-7.-웹-기반-ai-제어-대시보드">PART 7. 웹 기반 AI 제어
대시보드</a></li>
<li><a href="#part-8.-수업-설계와-확장-아이디어" id="toc-part-8.-수업-설계와-확장-아이디어">PART 8. 수업 설계와 확장
아이디어</a></li>
</ul></li>
<li><a href="#학습-가이드" id="toc-학습-가이드">📖 학습 가이드</a>
<ul>
<li><a href="#추천-학습-순서" id="toc-추천-학습-순서">추천 학습
순서</a></li>
<li><a href="#난이도" id="toc-난이도">난이도</a></li>
</ul></li>
<li><a href="#빠른-시작" id="toc-빠른-시작">🚀 빠른 시작</a>
<ul>
<li><a href="#하드웨어-준비" id="toc-하드웨어-준비">1. 하드웨어
준비</a></li>
<li><a href="#첫-번째-프로그램" id="toc-첫-번째-프로그램">2. 첫 번째
프로그램</a></li>
<li><a href="#챕터별-학습" id="toc-챕터별-학습">3. 챕터별 학습</a></li>
</ul></li>
<li><a href="#학습-팁" id="toc-학습-팁">💡 학습 팁</a>
<ul>
<li><a href="#성공적인-학습을-위해" id="toc-성공적인-학습을-위해">성공적인 학습을 위해</a></li>
</ul></li>
<li><a href="#주의사항" id="toc-주의사항">⚠️ 주의사항</a>
<ul>
<li><a href="#안전하게-사용하기" id="toc-안전하게-사용하기">안전하게
사용하기</a></li>
<li><a href="#api-키-보안" id="toc-api-키-보안">API 키 보안</a></li>
</ul></li>
<li><a href="#지원-및-문의" id="toc-지원-및-문의">📞 지원 및 문의</a>
<ul>
<li><a href="#문제가-발생하면" id="toc-문제가-발생하면">문제가
발생하면</a></li>
</ul></li>
<li><a href="#라이선스" id="toc-라이선스">📄 라이선스</a></li>
<li><a href="#이제-시작합니다" id="toc-이제-시작합니다">🎓 이제
시작합니다!</a></li>
</ul></li>
<li><a href="#chapter-1.-ai-센서랩이란-무엇인가" id="toc-chapter-1.-ai-센서랩이란-무엇인가">Chapter 1. AI 센서랩이란
무엇인가</a>
<ul>
<li><a href="#이-챕터에서-배울-내용" id="toc-이-챕터에서-배울-내용">📚
이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표" id="toc-학습-목표">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념" id="toc-핵심-개념">핵심 개념</a></li>
</ul></li>
<li><a href="#ai-센서랩이란" id="toc-ai-센서랩이란">📖 AI
센서랩이란?</a>
<ul>
<li><a href="#iot에서-aiot로" id="toc-iot에서-aiot로">IoT에서
AIoT로</a></li>
<li><a href="#ai-센서랩이란-1" id="toc-ai-센서랩이란-1">AI
센서랩이란?</a></li>
</ul></li>
<li><a href="#무엇을-만들게-되나요" id="toc-무엇을-만들게-되나요">🚀
무엇을 만들게 되나요?</a>
<ul>
<li><a href="#최종-프로젝트-ai-환경-무드-컨트롤러" id="toc-최종-프로젝트-ai-환경-무드-컨트롤러">최종 프로젝트: AI 환경 무드
컨트롤러</a></li>
<li><a href="#단계별-학습-과정" id="toc-단계별-학습-과정">단계별 학습
과정</a></li>
</ul></li>
<li><a href="#이-책의-특징-1" id="toc-이-책의-특징-1">🎓 이 책의
특징</a>
<ul>
<li><a href="#초보자-친화적" id="toc-초보자-친화적">1. 초보자
친화적</a></li>
<li><a href="#실습-중심" id="toc-실습-중심">2. 실습 중심</a></li>
<li><a href="#완성된-프로젝트" id="toc-완성된-프로젝트">3. 완성된
프로젝트</a></li>
</ul></li>
<li><a href="#준비물" id="toc-준비물">📋 준비물</a>
<ul>
<li><a href="#필수-하드웨어" id="toc-필수-하드웨어">필수
하드웨어</a></li>
<li><a href="#필수-소프트웨어" id="toc-필수-소프트웨어">필수
소프트웨어</a></li>
<li><a href="#선택-사항" id="toc-선택-사항">선택 사항</a></li>
</ul></li>
<li><a href="#학습-로드맵" id="toc-학습-로드맵">🗺️ 학습 로드맵</a></li>
<li><a href="#핵심-요약" id="toc-핵심-요약">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것" id="toc-오늘-배운-것">오늘 배운 것</a></li>
<li><a href="#우리가-만들-것" id="toc-우리가-만들-것">우리가 만들
것</a></li>
</ul></li>
<li><a href="#자주-묻는-질문" id="toc-자주-묻는-질문">🤔 자주 묻는
질문</a></li>
<li><a href="#준비되셨나요" id="toc-준비되셨나요">🚀
준비되셨나요?</a></li>
<li><a href="#학습-체크" id="toc-학습-체크">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-2.-헥사보드-구조-한눈에-보기" id="toc-chapter-2.-헥사보드-구조-한눈에-보기">Chapter 2. 헥사보드 구조
한눈에 보기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-1" id="toc-이-챕터에서-배울-내용-1">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-1" id="toc-학습-목표-1">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-1" id="toc-핵심-개념-1">핵심 개념</a></li>
</ul></li>
<li><a href="#헥사보드란" id="toc-헥사보드란">📖 헥사보드란?</a>
<ul>
<li><a href="#esp32-기반-학습-보드" id="toc-esp32-기반-학습-보드">ESP32
기반 학습 보드</a></li>
</ul></li>
<li><a href="#헥사보드-주요-부품" id="toc-헥사보드-주요-부품">🔧
헥사보드 주요 부품</a>
<ul>
<li><a href="#네오픽셀-led-55" id="toc-네오픽셀-led-55">1. 네오픽셀 LED
(5×5)</a></li>
<li><a href="#버튼-2개" id="toc-버튼-2개">2. 버튼 2개</a></li>
<li><a href="#자이로-센서-i2c" id="toc-자이로-센서-i2c">3. 자이로 센서
(I2C)</a></li>
<li><a href="#컬러-센서-i2c" id="toc-컬러-센서-i2c">4. 컬러 센서
(I2C)</a></li>
<li><a href="#외부-연결-핀" id="toc-외부-연결-핀">5. 외부 연결
핀</a></li>
</ul></li>
<li><a href="#헥사보드-핀맵" id="toc-헥사보드-핀맵">📌 헥사보드 핀맵</a>
<ul>
<li><a href="#주요-gpio-핀-정리" id="toc-주요-gpio-핀-정리">주요 GPIO 핀
정리</a></li>
<li><a href="#중요-사항" id="toc-중요-사항">중요 사항</a></li>
</ul></li>
<li><a href="#헥사보드-연결하기" id="toc-헥사보드-연결하기">💻 헥사보드
연결하기</a>
<ul>
<li><a href="#usb-연결" id="toc-usb-연결">USB 연결</a></li>
<li><a href="#포트-확인" id="toc-포트-확인">포트 확인</a></li>
</ul></li>
<li><a href="#핵심-요약-1" id="toc-핵심-요약-1">🎓 핵심 요약</a>
<ul>
<li><a href="#헥사보드의-구성" id="toc-헥사보드의-구성">헥사보드의
구성</a></li>
<li><a href="#기억할-핀-번호" id="toc-기억할-핀-번호">기억할 핀
번호</a></li>
</ul></li>
<li><a href="#실습-헥사보드-확인하기" id="toc-실습-헥사보드-확인하기">🔍
실습: 헥사보드 확인하기</a>
<ul>
<li><a href="#준비물-1" id="toc-준비물-1">준비물</a></li>
<li><a href="#확인-항목" id="toc-확인-항목">확인 항목</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-1" id="toc-자주-묻는-질문-1">🤔 자주 묻는
질문</a></li>
<li><a href="#헥사보드로-할-수-있는-것" id="toc-헥사보드로-할-수-있는-것">🎨 헥사보드로 할 수 있는 것</a>
<ul>
<li><a href="#기본-프로젝트" id="toc-기본-프로젝트">기본
프로젝트</a></li>
<li><a href="#중급-프로젝트" id="toc-중급-프로젝트">중급
프로젝트</a></li>
<li><a href="#고급-프로젝트" id="toc-고급-프로젝트">고급
프로젝트</a></li>
</ul></li>
<li><a href="#학습-체크-1" id="toc-학습-체크-1">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-3.-개발-환경-준비하기" id="toc-chapter-3.-개발-환경-준비하기">Chapter 3. 개발 환경 준비하기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-2" id="toc-이-챕터에서-배울-내용-2">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-2" id="toc-학습-목표-2">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-2" id="toc-핵심-개념-2">핵심 개념</a></li>
</ul></li>
<li><a href="#필요한-소프트웨어" id="toc-필요한-소프트웨어">📖 필요한
소프트웨어</a>
<ul>
<li><a href="#thonny-ide" id="toc-thonny-ide">1. Thonny IDE</a></li>
</ul></li>
<li><a href="#thonny-설치하기" id="toc-thonny-설치하기">💻 Thonny
설치하기</a>
<ul>
<li><a href="#windows" id="toc-windows">Windows</a></li>
<li><a href="#mac" id="toc-mac">Mac</a></li>
<li><a href="#linux-ubuntudebian" id="toc-linux-ubuntudebian">Linux
(Ubuntu/Debian)</a></li>
</ul></li>
<li><a href="#thonny-설정하기" id="toc-thonny-설정하기">🔧 Thonny
설정하기</a>
<ul>
<li><a href="#헥사보드-연결" id="toc-헥사보드-연결">1. 헥사보드
연결</a></li>
<li><a href="#연결-확인" id="toc-연결-확인">2. 연결 확인</a></li>
</ul></li>
<li><a href="#첫-번째-코드-실행" id="toc-첫-번째-코드-실행">✅ 첫 번째
코드 실행</a>
<ul>
<li><a href="#hello-world" id="toc-hello-world">Hello World!</a></li>
</ul></li>
<li><a href="#led-깜빡이기-선택" id="toc-led-깜빡이기-선택">💡 LED
깜빡이기 (선택)</a>
<ul>
<li><a href="#내장-led-테스트" id="toc-내장-led-테스트">내장 LED
테스트</a></li>
</ul></li>
<li><a href="#thonny-화면-구성" id="toc-thonny-화면-구성">🎓 Thonny 화면
구성</a></li>
<li><a href="#핵심-요약-2" id="toc-핵심-요약-2">🎓 핵심 요약</a>
<ul>
<li><a href="#설치한-것" id="toc-설치한-것">설치한 것</a></li>
<li><a href="#확인한-것" id="toc-확인한-것">확인한 것</a></li>
<li><a href="#다음-챕터-준비" id="toc-다음-챕터-준비">다음 챕터
준비</a></li>
</ul></li>
<li><a href="#문제-해결" id="toc-문제-해결">🐛 문제 해결</a>
<ul>
<li><a href="#문제-1-포트가-안-보여요" id="toc-문제-1-포트가-안-보여요">문제 1: 포트가 안 보여요</a></li>
<li><a href="#문제-2-device-is-busy-에러" id="toc-문제-2-device-is-busy-에러">문제 2: “Device is busy”
에러</a></li>
<li><a href="#문제-3-코드가-실행되지-않아요" id="toc-문제-3-코드가-실행되지-않아요">문제 3: 코드가 실행되지
않아요</a></li>
</ul></li>
<li><a href="#실습-repl-사용해보기" id="toc-실습-repl-사용해보기">📝
실습: REPL 사용해보기</a>
<ul>
<li><a href="#shell에서-직접-입력" id="toc-shell에서-직접-입력">Shell에서 직접 입력</a></li>
</ul></li>
<li><a href="#다음-단계" id="toc-다음-단계">🚀 다음 단계</a></li>
<li><a href="#학습-체크-2" id="toc-학습-체크-2">📝 학습 체크</a></li>
<li><a href="#part-1-완료" id="toc-part-1-완료">🎉 PART 1 완료!</a></li>
</ul></li>
<li><a href="#chapter-4.-디지털-입력의-기본-버튼-2개-다루기" id="toc-chapter-4.-디지털-입력의-기본-버튼-2개-다루기">Chapter 4. 디지털
입력의 기본 – 버튼 2개 다루기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-3" id="toc-이-챕터에서-배울-내용-3">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-3" id="toc-학습-목표-3">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-3" id="toc-핵심-개념-3">핵심 개념</a></li>
<li><a href="#실습-목표" id="toc-실습-목표">실습 목표</a></li>
</ul></li>
<li><a href="#이론-설명" id="toc-이론-설명">📖 이론 설명</a>
<ul>
<li><a href="#버튼은-어떻게-동작할까요" id="toc-버튼은-어떻게-동작할까요">버튼은 어떻게 동작할까요?</a></li>
</ul></li>
<li><a href="#실습-준비" id="toc-실습-준비">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것" id="toc-필요한-것">필요한 것</a></li>
</ul></li>
<li><a href="#실습-1-버튼-a-눌러보기" id="toc-실습-1-버튼-a-눌러보기">💻
실습 1: 버튼 A 눌러보기</a>
<ul>
<li><a href="#가장-간단한-버튼-읽기" id="toc-가장-간단한-버튼-읽기">가장
간단한 버튼 읽기</a></li>
<li><a href="#실행하기" id="toc-실행하기">실행하기</a></li>
</ul></li>
<li><a href="#실습-2-버튼-눌림만-감지하기" id="toc-실습-2-버튼-눌림만-감지하기">💻 실습 2: 버튼 눌림만
감지하기</a></li>
<li><a href="#실습-3-두-개의-버튼-사용하기" id="toc-실습-3-두-개의-버튼-사용하기">💻 실습 3: 두 개의 버튼
사용하기</a></li>
<li><a href="#동작-확인" id="toc-동작-확인">✅ 동작 확인</a></li>
<li><a href="#문제가-생겼나요" id="toc-문제가-생겼나요">🐛 문제가
생겼나요?</a>
<ul>
<li><a href="#문제-1-버튼을-눌러도-반응이-없어요" id="toc-문제-1-버튼을-눌러도-반응이-없어요">문제 1: 버튼을 눌러도 반응이
없어요</a></li>
<li><a href="#문제-2-한-번-눌렀는데-여러-번-감지돼요" id="toc-문제-2-한-번-눌렀는데-여러-번-감지돼요">문제 2: 한 번 눌렀는데
여러 번 감지돼요</a></li>
<li><a href="#문제-3-에러-메시지가-나와요" id="toc-문제-3-에러-메시지가-나와요">문제 3: 에러 메시지가
나와요</a></li>
</ul></li>
<li><a href="#핵심-요약-3" id="toc-핵심-요약-3">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-1" id="toc-오늘-배운-것-1">오늘 배운
것</a></li>
<li><a href="#핵심-코드" id="toc-핵심-코드">핵심 코드</a></li>
</ul></li>
<li><a href="#도전-과제" id="toc-도전-과제">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-버튼-카운터" id="toc-과제-1-버튼-카운터">과제 1:
버튼 카운터 ⭐️</a></li>
<li><a href="#과제-2-리셋-버튼" id="toc-과제-2-리셋-버튼">과제 2: 리셋
버튼 ⭐️⭐️</a></li>
</ul></li>
<li><a href="#참고-자료" id="toc-참고-자료">🔗 참고 자료</a></li>
<li><a href="#학습-체크-3" id="toc-학습-체크-3">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-5.-네오픽셀-기초-한-칸에서-5x5까지" id="toc-chapter-5.-네오픽셀-기초-한-칸에서-5x5까지">Chapter 5. 네오픽셀
기초 – 한 칸에서 5x5까지</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-4" id="toc-이-챕터에서-배울-내용-4">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-4" id="toc-학습-목표-4">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-4" id="toc-핵심-개념-4">핵심 개념</a></li>
</ul></li>
<li><a href="#네오픽셀이란" id="toc-네오픽셀이란">📖 네오픽셀이란?</a>
<ul>
<li><a href="#rgb-led의-마법" id="toc-rgb-led의-마법">RGB LED의
마법</a></li>
<li><a href="#헥사보드의-네오픽셀" id="toc-헥사보드의-네오픽셀">헥사보드의 네오픽셀</a></li>
</ul></li>
<li><a href="#실습-준비-1" id="toc-실습-준비-1">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-1" id="toc-필요한-것-1">필요한 것</a></li>
</ul></li>
<li><a href="#실습-1-첫-번째-led-켜기" id="toc-실습-1-첫-번째-led-켜기">💻 실습 1: 첫 번째 LED 켜기</a>
<ul>
<li><a href="#led-1개-켜기" id="toc-led-1개-켜기">LED 1개 켜기</a></li>
<li><a href="#실행하기-1" id="toc-실행하기-1">실행하기</a></li>
</ul></li>
<li><a href="#실습-2-색상-바꾸기" id="toc-실습-2-색상-바꾸기">💻 실습 2:
색상 바꾸기</a>
<ul>
<li><a href="#여러-색상-표현하기" id="toc-여러-색상-표현하기">여러 색상
표현하기</a></li>
</ul></li>
<li><a href="#실습-3-여러-led-켜기" id="toc-실습-3-여러-led-켜기">💻
실습 3: 여러 LED 켜기</a>
<ul>
<li><a href="#개-led-켜기" id="toc-개-led-켜기">5개 LED 켜기</a></li>
</ul></li>
<li><a href="#실습-4-전체-led-제어" id="toc-실습-4-전체-led-제어">💻
실습 4: 전체 LED 제어</a>
<ul>
<li><a href="#모든-led를-같은-색으로" id="toc-모든-led를-같은-색으로">모든 LED를 같은 색으로</a></li>
</ul></li>
<li><a href="#실습-5-간단한-애니메이션" id="toc-실습-5-간단한-애니메이션">💻 실습 5: 간단한 애니메이션</a>
<ul>
<li><a href="#led가-하나씩-켜지는-효과" id="toc-led가-하나씩-켜지는-효과">LED가 하나씩 켜지는 효과</a></li>
</ul></li>
<li><a href="#동작-확인-1" id="toc-동작-확인-1">✅ 동작 확인</a></li>
<li><a href="#문제-해결-1" id="toc-문제-해결-1">🐛 문제 해결</a>
<ul>
<li><a href="#문제-1-led가-안-켜져요" id="toc-문제-1-led가-안-켜져요">문제 1: LED가 안 켜져요</a></li>
<li><a href="#문제-2-색이-이상해요" id="toc-문제-2-색이-이상해요">문제
2: 색이 이상해요</a></li>
<li><a href="#문제-3-너무-밝아요" id="toc-문제-3-너무-밝아요">문제 3:
너무 밝아요!</a></li>
</ul></li>
<li><a href="#핵심-요약-4" id="toc-핵심-요약-4">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-2" id="toc-오늘-배운-것-2">오늘 배운
것</a></li>
<li><a href="#핵심-코드-1" id="toc-핵심-코드-1">핵심 코드</a></li>
</ul></li>
<li><a href="#도전-과제-1" id="toc-도전-과제-1">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-무지개-만들기" id="toc-과제-1-무지개-만들기">과제
1: 무지개 만들기 ⭐️</a></li>
<li><a href="#과제-2-깜빡이는-led" id="toc-과제-2-깜빡이는-led">과제 2:
깜빡이는 LED ⭐️⭐️</a></li>
<li><a href="#과제-3-십자가-패턴" id="toc-과제-3-십자가-패턴">과제 3:
십자가 패턴 ⭐️⭐️</a></li>
</ul></li>
<li><a href="#색상-참고표" id="toc-색상-참고표">🎨 색상 참고표</a></li>
<li><a href="#학습-체크-4" id="toc-학습-체크-4">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-6.-버튼-네오픽셀로-만드는-상태-머신" id="toc-chapter-6.-버튼-네오픽셀로-만드는-상태-머신">Chapter 6. 버튼 +
네오픽셀로 만드는 상태 머신</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-5" id="toc-이-챕터에서-배울-내용-5">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-5" id="toc-학습-목표-5">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-5" id="toc-핵심-개념-5">핵심 개념</a></li>
</ul></li>
<li><a href="#상태-머신이란" id="toc-상태-머신이란">📖 상태
머신이란?</a>
<ul>
<li><a href="#간단한-예시" id="toc-간단한-예시">간단한 예시</a></li>
<li><a href="#프로그램에서의-상태-머신" id="toc-프로그램에서의-상태-머신">프로그램에서의 상태 머신</a></li>
</ul></li>
<li><a href="#실습-준비-2" id="toc-실습-준비-2">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-2" id="toc-필요한-것-2">필요한 것</a></li>
</ul></li>
<li><a href="#실습-1-버튼으로-led-켜기끄기" id="toc-실습-1-버튼으로-led-켜기끄기">💻 실습 1: 버튼으로 LED
켜기/끄기</a>
<ul>
<li><a href="#토글-스위치-만들기" id="toc-토글-스위치-만들기">토글
스위치 만들기</a></li>
</ul></li>
<li><a href="#실습-2-버튼으로-색상-바꾸기" id="toc-실습-2-버튼으로-색상-바꾸기">💻 실습 2: 버튼으로 색상 바꾸기</a>
<ul>
<li><a href="#가지-색상-순환" id="toc-가지-색상-순환">3가지 색상
순환</a></li>
</ul></li>
<li><a href="#실습-3-두-버튼으로-제어하기" id="toc-실습-3-두-버튼으로-제어하기">💻 실습 3: 두 버튼으로 제어하기</a>
<ul>
<li><a href="#버튼-a-색상-변경-버튼-b-끄기" id="toc-버튼-a-색상-변경-버튼-b-끄기">버튼 A: 색상 변경, 버튼 B:
끄기</a></li>
</ul></li>
<li><a href="#실습-4-간단한-게임-빠르게-누르기" id="toc-실습-4-간단한-게임-빠르게-누르기">💻 실습 4: 간단한 게임 –
빠르게 누르기</a>
<ul>
<li><a href="#반응-속도-게임" id="toc-반응-속도-게임">반응 속도
게임</a></li>
</ul></li>
<li><a href="#동작-확인-2" id="toc-동작-확인-2">✅ 동작 확인</a></li>
<li><a href="#핵심-요약-5" id="toc-핵심-요약-5">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-3" id="toc-오늘-배운-것-3">오늘 배운
것</a></li>
<li><a href="#핵심-코드-패턴" id="toc-핵심-코드-패턴">핵심 코드
패턴</a></li>
</ul></li>
<li><a href="#도전-과제-2" id="toc-도전-과제-2">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-밝기-조절" id="toc-과제-1-밝기-조절">과제 1: 밝기
조절 ⭐️</a></li>
<li><a href="#과제-2-패턴-선택" id="toc-과제-2-패턴-선택">과제 2: 패턴
선택 ⭐️⭐️</a></li>
<li><a href="#과제-3-타이머" id="toc-과제-3-타이머">과제 3: 타이머
⭐️⭐️⭐️</a></li>
</ul></li>
<li><a href="#학습-체크-5" id="toc-학습-체크-5">📝 학습 체크</a></li>
<li><a href="#part-2-완료" id="toc-part-2-완료">🎉 PART 2 완료!</a></li>
</ul></li>
<li><a href="#chapter-7.-온습도-센서-이해와-연결" id="toc-chapter-7.-온습도-센서-이해와-연결">Chapter 7. 온습도 센서
이해와 연결</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-6" id="toc-이-챕터에서-배울-내용-6">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-6" id="toc-학습-목표-6">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-6" id="toc-핵심-개념-6">핵심 개념</a></li>
</ul></li>
<li><a href="#온습도-센서란" id="toc-온습도-센서란">📖 온습도
센서란?</a>
<ul>
<li><a href="#dht11-vs-dht22" id="toc-dht11-vs-dht22">DHT11 vs
DHT22</a></li>
<li><a href="#dht11-핀-구성" id="toc-dht11-핀-구성">DHT11 핀
구성</a></li>
</ul></li>
<li><a href="#실습-준비-3" id="toc-실습-준비-3">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-3" id="toc-필요한-것-3">필요한 것</a></li>
<li><a href="#센서-연결하기" id="toc-센서-연결하기">센서
연결하기</a></li>
</ul></li>
<li><a href="#실습-1-dht11-라이브러리-설치" id="toc-실습-1-dht11-라이브러리-설치">💻 실습 1: DHT11 라이브러리
설치</a>
<ul>
<li><a href="#dht-모듈-확인" id="toc-dht-모듈-확인">dht 모듈
확인</a></li>
</ul></li>
<li><a href="#실습-2-첫-번째-온습도-측정" id="toc-실습-2-첫-번째-온습도-측정">💻 실습 2: 첫 번째 온습도 측정</a>
<ul>
<li><a href="#온도와-습도-읽기" id="toc-온도와-습도-읽기">온도와 습도
읽기</a></li>
<li><a href="#실행-결과-예시" id="toc-실행-결과-예시">실행 결과
예시</a></li>
</ul></li>
<li><a href="#실습-3-실시간-모니터링" id="toc-실습-3-실시간-모니터링">💻
실습 3: 실시간 모니터링</a>
<ul>
<li><a href="#초마다-측정하기" id="toc-초마다-측정하기">1초마다
측정하기</a></li>
</ul></li>
<li><a href="#실습-4-led로-온도-표시" id="toc-실습-4-led로-온도-표시">💻
실습 4: LED로 온도 표시</a>
<ul>
<li><a href="#온도에-따라-색상-변경" id="toc-온도에-따라-색상-변경">온도에 따라 색상 변경</a></li>
</ul></li>
<li><a href="#동작-확인-3" id="toc-동작-확인-3">✅ 동작 확인</a></li>
<li><a href="#문제-해결-2" id="toc-문제-해결-2">🐛 문제 해결</a>
<ul>
<li><a href="#문제-1-oserror-에러" id="toc-문제-1-oserror-에러">문제 1:
“OSError” 에러</a></li>
<li><a href="#문제-2-값이-이상해요" id="toc-문제-2-값이-이상해요">문제
2: 값이 이상해요</a></li>
<li><a href="#문제-3-측정값이-안-변해요" id="toc-문제-3-측정값이-안-변해요">문제 3: 측정값이 안 변해요</a></li>
</ul></li>
<li><a href="#핵심-요약-6" id="toc-핵심-요약-6">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-4" id="toc-오늘-배운-것-4">오늘 배운
것</a></li>
<li><a href="#핵심-코드-2" id="toc-핵심-코드-2">핵심 코드</a></li>
</ul></li>
<li><a href="#도전-과제-3" id="toc-도전-과제-3">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-경고-시스템" id="toc-과제-1-경고-시스템">과제 1:
경고 시스템 ⭐️</a></li>
<li><a href="#과제-2-최고최저-온도" id="toc-과제-2-최고최저-온도">과제
2: 최고/최저 온도 ⭐️⭐️</a></li>
<li><a href="#과제-3-쾌적도-표시" id="toc-과제-3-쾌적도-표시">과제 3:
쾌적도 표시 ⭐️⭐️</a></li>
</ul></li>
<li><a href="#학습-체크-6" id="toc-학습-체크-6">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-8.-조도-센서-이해와-연결" id="toc-chapter-8.-조도-센서-이해와-연결">Chapter 8. 조도 센서 이해와
연결</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-7" id="toc-이-챕터에서-배울-내용-7">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-7" id="toc-학습-목표-7">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-7" id="toc-핵심-개념-7">핵심 개념</a></li>
</ul></li>
<li><a href="#조도-센서란" id="toc-조도-센서란">📖 조도 센서란?</a>
<ul>
<li><a href="#포토레지스터-cds-센서" id="toc-포토레지스터-cds-센서">포토레지스터 (CdS 센서)</a></li>
<li><a href="#adc란" id="toc-adc란">ADC란?</a></li>
</ul></li>
<li><a href="#실습-준비-4" id="toc-실습-준비-4">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-4" id="toc-필요한-것-4">필요한 것</a></li>
<li><a href="#센서-연결하기-1" id="toc-센서-연결하기-1">센서
연결하기</a></li>
</ul></li>
<li><a href="#실습-1-adc-기본-사용" id="toc-실습-1-adc-기본-사용">💻
실습 1: ADC 기본 사용</a>
<ul>
<li><a href="#빛의-밝기-읽기" id="toc-빛의-밝기-읽기">빛의 밝기
읽기</a></li>
<li><a href="#실행-결과-예시-1" id="toc-실행-결과-예시-1">실행 결과
예시</a></li>
</ul></li>
<li><a href="#실습-2-실시간-밝기-모니터링" id="toc-실습-2-실시간-밝기-모니터링">💻 실습 2: 실시간 밝기 모니터링</a>
<ul>
<li><a href="#초마다-측정하기-1" id="toc-초마다-측정하기-1">0.5초마다
측정하기</a></li>
</ul></li>
<li><a href="#실습-3-자동-조명-시스템" id="toc-실습-3-자동-조명-시스템">💻 실습 3: 자동 조명 시스템</a>
<ul>
<li><a href="#어두우면-led-켜기" id="toc-어두우면-led-켜기">어두우면 LED
켜기</a></li>
</ul></li>
<li><a href="#실습-4-밝기에-따른-led-색상" id="toc-실습-4-밝기에-따른-led-색상">💻 실습 4: 밝기에 따른 LED 색상</a>
<ul>
<li><a href="#밝기를-색상으로-표현" id="toc-밝기를-색상으로-표현">밝기를
색상으로 표현</a></li>
</ul></li>
<li><a href="#동작-확인-4" id="toc-동작-확인-4">✅ 동작 확인</a></li>
<li><a href="#문제-해결-3" id="toc-문제-해결-3">🐛 문제 해결</a>
<ul>
<li><a href="#문제-1-값이-항상-0-또는-4095" id="toc-문제-1-값이-항상-0-또는-4095">문제 1: 값이 항상 0 또는
4095</a></li>
<li><a href="#문제-2-값이-너무-작거나-큼" id="toc-문제-2-값이-너무-작거나-큼">문제 2: 값이 너무 작거나 큼</a></li>
<li><a href="#문제-3-값이-너무-빠르게-변해요" id="toc-문제-3-값이-너무-빠르게-변해요">문제 3: 값이 너무 빠르게
변해요</a></li>
</ul></li>
<li><a href="#핵심-요약-7" id="toc-핵심-요약-7">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-5" id="toc-오늘-배운-것-5">오늘 배운
것</a></li>
<li><a href="#핵심-코드-3" id="toc-핵심-코드-3">핵심 코드</a></li>
</ul></li>
<li><a href="#도전-과제-4" id="toc-도전-과제-4">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-자동-밝기-조절" id="toc-과제-1-자동-밝기-조절">과제
1: 자동 밝기 조절 ⭐️</a></li>
<li><a href="#과제-2-야간-모드" id="toc-과제-2-야간-모드">과제 2: 야간
모드 ⭐️⭐️</a></li>
<li><a href="#과제-3-온도밝기-복합" id="toc-과제-3-온도밝기-복합">과제
3: 온도+밝기 복합 ⭐️⭐️⭐️</a></li>
</ul></li>
<li><a href="#학습-체크-7" id="toc-학습-체크-7">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-9.-센서-데이터-정리-및-단위-변환" id="toc-chapter-9.-센서-데이터-정리-및-단위-변환">Chapter 9. 센서 데이터
정리 및 단위 변환</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-8" id="toc-이-챕터에서-배울-내용-8">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-8" id="toc-학습-목표-8">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-8" id="toc-핵심-개념-8">핵심 개념</a></li>
</ul></li>
<li><a href="#왜-데이터-정리가-필요한가" id="toc-왜-데이터-정리가-필요한가">📖 왜 데이터 정리가 필요한가?</a>
<ul>
<li><a href="#센서의-문제점" id="toc-센서의-문제점">센서의
문제점</a></li>
</ul></li>
<li><a href="#실습-1-값-반올림하기" id="toc-실습-1-값-반올림하기">💻
실습 1: 값 반올림하기</a>
<ul>
<li><a href="#소수점-정리" id="toc-소수점-정리">소수점 정리</a></li>
</ul></li>
<li><a href="#실습-2-단위-변환" id="toc-실습-2-단위-변환">💻 실습 2:
단위 변환</a>
<ul>
<li><a href="#c-f-변환" id="toc-c-f-변환">°C → °F 변환</a></li>
</ul></li>
<li><a href="#실습-3-adc를-퍼센트로" id="toc-실습-3-adc를-퍼센트로">💻
실습 3: ADC를 퍼센트로</a>
<ul>
<li><a href="#section" id="toc-section">0~4095 → 0~100%</a></li>
</ul></li>
<li><a href="#실습-4-평균값-계산" id="toc-실습-4-평균값-계산">💻 실습 4:
평균값 계산</a>
<ul>
<li><a href="#안정적인-측정" id="toc-안정적인-측정">안정적인
측정</a></li>
</ul></li>
<li><a href="#실습-5-종합-데이터-클래스" id="toc-실습-5-종합-데이터-클래스">💻 실습 5: 종합 데이터 클래스</a>
<ul>
<li><a href="#모든-센서-데이터-정리" id="toc-모든-센서-데이터-정리">모든
센서 데이터 정리</a></li>
</ul></li>
<li><a href="#동작-확인-5" id="toc-동작-확인-5">✅ 동작 확인</a></li>
<li><a href="#핵심-요약-8" id="toc-핵심-요약-8">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-6" id="toc-오늘-배운-것-6">오늘 배운
것</a></li>
<li><a href="#핵심-코드-4" id="toc-핵심-코드-4">핵심 코드</a></li>
</ul></li>
<li><a href="#도전-과제-5" id="toc-도전-과제-5">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-불쾌지수-계산" id="toc-과제-1-불쾌지수-계산">과제
1: 불쾌지수 계산 ⭐️</a></li>
<li><a href="#과제-2-이동-평균" id="toc-과제-2-이동-평균">과제 2: 이동
평균 ⭐️⭐️</a></li>
<li><a href="#과제-3-json-형식" id="toc-과제-3-json-형식">과제 3: JSON
형식 ⭐️⭐️</a></li>
</ul></li>
<li><a href="#학습-체크-8" id="toc-학습-체크-8">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-10.-센서-데이터를-시각적으로-표현하기" id="toc-chapter-10.-센서-데이터를-시각적으로-표현하기">Chapter 10. 센서
데이터를 시각적으로 표현하기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-9" id="toc-이-챕터에서-배울-내용-9">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-9" id="toc-학습-목표-9">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-9" id="toc-핵심-개념-9">핵심 개념</a></li>
</ul></li>
<li><a href="#왜-시각화가-중요한가" id="toc-왜-시각화가-중요한가">📖 왜
시각화가 중요한가?</a></li>
<li><a href="#실습-1-온도-바-그래프" id="toc-실습-1-온도-바-그래프">💻
실습 1: 온도 바 그래프</a>
<ul>
<li><a href="#온도를-막대로-표시" id="toc-온도를-막대로-표시">온도를
막대로 표시</a></li>
</ul></li>
<li><a href="#실습-2-습도-게이지" id="toc-실습-2-습도-게이지">💻 실습 2:
습도 게이지</a>
<ul>
<li><a href="#습도를-원형으로-표시" id="toc-습도를-원형으로-표시">습도를
원형으로 표시</a></li>
</ul></li>
<li><a href="#실습-3-밝기-히트맵" id="toc-실습-3-밝기-히트맵">💻 실습 3:
밝기 히트맵</a>
<ul>
<li><a href="#밝기를-색상-그라데이션으로" id="toc-밝기를-색상-그라데이션으로">밝기를 색상 그라데이션으로</a></li>
</ul></li>
<li><a href="#실습-4-종합-대시보드" id="toc-실습-4-종합-대시보드">💻
실습 4: 종합 대시보드</a>
<ul>
<li><a href="#모든-센서를-한-화면에" id="toc-모든-센서를-한-화면에">모든
센서를 한 화면에</a></li>
</ul></li>
<li><a href="#동작-확인-6" id="toc-동작-확인-6">✅ 동작 확인</a></li>
<li><a href="#핵심-요약-9" id="toc-핵심-요약-9">🎓 핵심 요약</a>
<ul>
<li><a href="#오늘-배운-것-7" id="toc-오늘-배운-것-7">오늘 배운
것</a></li>
<li><a href="#핵심-패턴" id="toc-핵심-패턴">핵심 패턴</a></li>
</ul></li>
<li><a href="#도전-과제-6" id="toc-도전-과제-6">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-그래프-애니메이션" id="toc-과제-1-그래프-애니메이션">과제 1: 그래프 애니메이션 ⭐️</a></li>
<li><a href="#과제-2-경고-표시" id="toc-과제-2-경고-표시">과제 2: 경고
표시 ⭐️⭐️</a></li>
<li><a href="#과제-3-데이터-히스토리" id="toc-과제-3-데이터-히스토리">과제 3: 데이터 히스토리 ⭐️⭐️⭐️</a></li>
</ul></li>
<li><a href="#part-3-완료" id="toc-part-3-완료">🎉 PART 3 완료!</a></li>
<li><a href="#학습-체크-9" id="toc-학습-체크-9">📝 학습 체크</a></li>
</ul></li>
<li><a href="#chapter-11.-mqtt-개념과-데이터-흐름-이해" id="toc-chapter-11.-mqtt-개념과-데이터-흐름-이해">Chapter 11. MQTT
개념과 데이터 흐름 이해</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-10" id="toc-이-챕터에서-배울-내용-10">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-10" id="toc-학습-목표-10">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-10" id="toc-핵심-개념-10">핵심 개념</a></li>
</ul></li>
<li><a href="#mqtt란-무엇인가" id="toc-mqtt란-무엇인가">📖 MQTT란
무엇인가?</a>
<ul>
<li><a href="#iot를-위한-통신-방식" id="toc-iot를-위한-통신-방식">IoT를
위한 통신 방식</a></li>
</ul></li>
<li><a href="#mqtt의-기본-구조" id="toc-mqtt의-기본-구조">🏗️ MQTT의 기본
구조</a>
<ul>
<li><a href="#publish-subscribe-모델" id="toc-publish-subscribe-모델">Publish / Subscribe 모델</a></li>
<li><a href="#주요-개념" id="toc-주요-개념">주요 개념</a></li>
</ul></li>
<li><a href="#topic의-개념" id="toc-topic의-개념">🏷️ Topic의 개념</a>
<ul>
<li><a href="#topic은-메시지의-주소입니다" id="toc-topic은-메시지의-주소입니다">Topic은 메시지의
주소입니다</a></li>
<li><a href="#topic-설계-예제" id="toc-topic-설계-예제">Topic 설계
예제</a></li>
</ul></li>
<li><a href="#message의-개념" id="toc-message의-개념">💬 Message의
개념</a>
<ul>
<li><a href="#message는-실제-데이터입니다" id="toc-message는-실제-데이터입니다">Message는 실제
데이터입니다</a></li>
</ul></li>
<li><a href="#mqtt-통신-흐름" id="toc-mqtt-통신-흐름">🔄 MQTT 통신
흐름</a>
<ul>
<li><a href="#실제-동작-예시" id="toc-실제-동작-예시">실제 동작
예시</a></li>
</ul></li>
<li><a href="#mqtt의-장점" id="toc-mqtt의-장점">📊 MQTT의 장점</a>
<ul>
<li><a href="#http-vs-mqtt" id="toc-http-vs-mqtt">HTTP vs MQTT</a></li>
<li><a href="#mqtt가-유리한-경우" id="toc-mqtt가-유리한-경우">MQTT가
유리한 경우</a></li>
</ul></li>
<li><a href="#mqtt-broker의-역할" id="toc-mqtt-broker의-역할">🌐 MQTT
Broker의 역할</a>
<ul>
<li><a href="#broker는-우체국입니다" id="toc-broker는-우체국입니다">Broker는 우체국입니다</a></li>
</ul></li>
<li><a href="#mqtt의-보안" id="toc-mqtt의-보안">🔐 MQTT의 보안</a>
<ul>
<li><a href="#qos-quality-of-service" id="toc-qos-quality-of-service">QoS (Quality of Service)</a></li>
<li><a href="#tls-암호화" id="toc-tls-암호화">TLS 암호화</a></li>
</ul></li>
<li><a href="#헥사보드-ai-센서랩에서의-mqtt-활용" id="toc-헥사보드-ai-센서랩에서의-mqtt-활용">🎯 헥사보드 AI 센서랩에서의
MQTT 활용</a>
<ul>
<li><a href="#우리-프로젝트의-mqtt-구조" id="toc-우리-프로젝트의-mqtt-구조">우리 프로젝트의 MQTT 구조</a></li>
<li><a href="#topic-설계" id="toc-topic-설계">Topic 설계</a></li>
</ul></li>
<li><a href="#핵심-정리" id="toc-핵심-정리">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요" id="toc-꼭-기억하세요">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-2" id="toc-자주-묻는-질문-2">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-mqtt와-http의-차이는" id="toc-q1.-mqtt와-http의-차이는">Q1. MQTT와 HTTP의 차이는?</a></li>
<li><a href="#q2.-broker가-없으면-통신이-안-되나요" id="toc-q2.-broker가-없으면-통신이-안-되나요">Q2. Broker가 없으면 통신이
안 되나요?</a></li>
<li><a href="#q3.-topic을-어떻게-설계해야-하나요" id="toc-q3.-topic을-어떻게-설계해야-하나요">Q3. Topic을 어떻게 설계해야
하나요?</a></li>
</ul></li>
<li><a href="#다음-단계-1" id="toc-다음-단계-1">🚀 다음 단계</a></li>
<li><a href="#더-알아보기" id="toc-더-알아보기">💡 더 알아보기</a>
<ul>
<li><a href="#mqtt-테스트-도구" id="toc-mqtt-테스트-도구">MQTT 테스트
도구</a></li>
</ul></li>
</ul></li>
<li><a href="#chapter-12.-mqtt-브로커-준비-hivemq-cloud" id="toc-chapter-12.-mqtt-브로커-준비-hivemq-cloud">Chapter 12. MQTT
브로커 준비 (HiveMQ Cloud)</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-11" id="toc-이-챕터에서-배울-내용-11">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-11" id="toc-학습-목표-11">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-11" id="toc-핵심-개념-11">핵심 개념</a></li>
</ul></li>
<li><a href="#hivemq-cloud란" id="toc-hivemq-cloud란">📖 HiveMQ
Cloud란?</a>
<ul>
<li><a href="#클라우드-mqtt-브로커" id="toc-클라우드-mqtt-브로커">클라우드 MQTT 브로커</a></li>
</ul></li>
<li><a href="#실습-1-hivemq-cloud-계정-생성" id="toc-실습-1-hivemq-cloud-계정-생성">🔧 실습 1: HiveMQ Cloud 계정
생성</a>
<ul>
<li><a href="#step-1-회원가입" id="toc-step-1-회원가입">Step 1:
회원가입</a></li>
</ul></li>
<li><a href="#실습-2-cluster-생성" id="toc-실습-2-cluster-생성">🔧 실습
2: Cluster 생성</a>
<ul>
<li><a href="#step-1-클러스터-만들기" id="toc-step-1-클러스터-만들기">Step 1: 클러스터 만들기</a></li>
<li><a href="#step-2-클러스터-상태-확인" id="toc-step-2-클러스터-상태-확인">Step 2: 클러스터 상태 확인</a></li>
</ul></li>
<li><a href="#실습-3-접속-정보-설정" id="toc-실습-3-접속-정보-설정">🔧
실습 3: 접속 정보 설정</a>
<ul>
<li><a href="#step-1-credentials-생성" id="toc-step-1-credentials-생성">Step 1: Credentials 생성</a></li>
<li><a href="#step-2-연결-정보-확인" id="toc-step-2-연결-정보-확인">Step
2: 연결 정보 확인</a></li>
</ul></li>
<li><a href="#연결-정보-기록하기" id="toc-연결-정보-기록하기">📝 연결
정보 기록하기</a>
<ul>
<li><a href="#정보-저장-방법" id="toc-정보-저장-방법">정보 저장
방법</a></li>
</ul></li>
<li><a href="#실습-4-온라인-테스트" id="toc-실습-4-온라인-테스트">🔧
실습 4: 온라인 테스트</a>
<ul>
<li><a href="#hivemq-websocket-client로-테스트" id="toc-hivemq-websocket-client로-테스트">HiveMQ WebSocket Client로
테스트</a></li>
<li><a href="#step-1-websocket-client-접속" id="toc-step-1-websocket-client-접속">Step 1: WebSocket Client
접속</a></li>
<li><a href="#step-2-subscribe-테스트" id="toc-step-2-subscribe-테스트">Step 2: Subscribe 테스트</a></li>
<li><a href="#step-3-publish-테스트" id="toc-step-3-publish-테스트">Step
3: Publish 테스트</a></li>
<li><a href="#step-4-메시지-확인" id="toc-step-4-메시지-확인">Step 4:
메시지 확인</a></li>
</ul></li>
<li><a href="#hivemq-cloud-대시보드" id="toc-hivemq-cloud-대시보드">📊
HiveMQ Cloud 대시보드</a>
<ul>
<li><a href="#모니터링-기능" id="toc-모니터링-기능">모니터링
기능</a></li>
</ul></li>
<li><a href="#보안-설정" id="toc-보안-설정">🔐 보안 설정</a>
<ul>
<li><a href="#tls-인증서" id="toc-tls-인증서">TLS 인증서</a></li>
<li><a href="#권한-관리" id="toc-권한-관리">권한 관리</a></li>
</ul></li>
<li><a href="#문제-해결-4" id="toc-문제-해결-4">🛠️ 문제 해결</a>
<ul>
<li><a href="#연결이-안-될-때" id="toc-연결이-안-될-때">연결이 안 될
때</a></li>
<li><a href="#무료-플랜-제한" id="toc-무료-플랜-제한">무료 플랜
제한</a></li>
</ul></li>
<li><a href="#다음-챕터-준비-1" id="toc-다음-챕터-준비-1">🚀 다음 챕터
준비</a>
<ul>
<li><a href="#저장해야-할-정보" id="toc-저장해야-할-정보">저장해야 할
정보</a></li>
</ul></li>
<li><a href="#핵심-정리-1" id="toc-핵심-정리-1">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-1" id="toc-꼭-기억하세요-1">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-3" id="toc-자주-묻는-질문-3">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-무료-플랜으로-충분한가요" id="toc-q1.-무료-플랜으로-충분한가요">Q1. 무료 플랜으로
충분한가요?</a></li>
<li><a href="#q2.-tls-인증서를-따로-설정해야-하나요" id="toc-q2.-tls-인증서를-따로-설정해야-하나요">Q2. TLS 인증서를 따로
설정해야 하나요?</a></li>
<li><a href="#q3.-로컬-mosquitto와-어떻게-다른가요" id="toc-q3.-로컬-mosquitto와-어떻게-다른가요">Q3. 로컬 Mosquitto와
어떻게 다른가요?</a></li>
<li><a href="#q4.-여러-개의-cluster를-만들-수-있나요" id="toc-q4.-여러-개의-cluster를-만들-수-있나요">Q4. 여러 개의 Cluster를
만들 수 있나요?</a></li>
</ul></li>
<li><a href="#다음-단계-2" id="toc-다음-단계-2">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-13.-헥사보드에서-mqtt-publish-subscribe-구현" id="toc-chapter-13.-헥사보드에서-mqtt-publish-subscribe-구현">Chapter
13. 헥사보드에서 MQTT Publish / Subscribe 구현</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-12" id="toc-이-챕터에서-배울-내용-12">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-12" id="toc-학습-목표-12">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-12" id="toc-핵심-개념-12">핵심 개념</a></li>
</ul></li>
<li><a href="#실습-준비-5" id="toc-실습-준비-5">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-5" id="toc-필요한-것-5">필요한 것</a></li>
<li><a href="#연결-정보-준비" id="toc-연결-정보-준비">연결 정보
준비</a></li>
</ul></li>
<li><a href="#실습-1-wi-fi-연결" id="toc-실습-1-wi-fi-연결">💻 실습 1:
Wi-Fi 연결</a>
<ul>
<li><a href="#wi-fi-기본-연결" id="toc-wi-fi-기본-연결">Wi-Fi 기본
연결</a></li>
</ul></li>
<li><a href="#실습-2-mqtt-기본-연결" id="toc-실습-2-mqtt-기본-연결">💻
실습 2: MQTT 기본 연결</a>
<ul>
<li><a href="#broker에-연결하기" id="toc-broker에-연결하기">Broker에
연결하기</a></li>
</ul></li>
<li><a href="#실습-3-publish-데이터-전송" id="toc-실습-3-publish-데이터-전송">💻 실습 3: Publish (데이터 전송)</a>
<ul>
<li><a href="#센서-데이터-보내기" id="toc-센서-데이터-보내기">센서
데이터 보내기</a></li>
</ul></li>
<li><a href="#실습-4-subscribe-명령-수신" id="toc-실습-4-subscribe-명령-수신">💻 실습 4: Subscribe (명령 수신)</a>
<ul>
<li><a href="#led-제어-명령-받기" id="toc-led-제어-명령-받기">LED 제어
명령 받기</a></li>
</ul></li>
<li><a href="#실습-5-publish-subscribe-통합" id="toc-실습-5-publish-subscribe-통합">💻 실습 5: Publish + Subscribe
통합</a>
<ul>
<li><a href="#센서-데이터-전송-제어-명령-수신" id="toc-센서-데이터-전송-제어-명령-수신">센서 데이터 전송 + 제어 명령
수신</a></li>
</ul></li>
<li><a href="#문제-해결-5" id="toc-문제-해결-5">🛠️ 문제 해결</a>
<ul>
<li><a href="#wi-fi-연결-실패" id="toc-wi-fi-연결-실패">Wi-Fi 연결
실패</a></li>
<li><a href="#mqtt-연결-실패" id="toc-mqtt-연결-실패">MQTT 연결
실패</a></li>
<li><a href="#메시지가-안-보일-때" id="toc-메시지가-안-보일-때">메시지가
안 보일 때</a></li>
</ul></li>
<li><a href="#도전-과제-7" id="toc-도전-과제-7">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-버튼으로-메시지-전송" id="toc-과제-1-버튼으로-메시지-전송">과제 1: 버튼으로 메시지
전송</a></li>
<li><a href="#과제-2-온도에-따라-led-색상-변경" id="toc-과제-2-온도에-따라-led-색상-변경">과제 2: 온도에 따라 LED 색상
변경</a></li>
</ul></li>
<li><a href="#핵심-정리-2" id="toc-핵심-정리-2">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-2" id="toc-꼭-기억하세요-2">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-4" id="toc-자주-묻는-질문-4">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-esp32가-5ghz-wi-fi를-지원하나요" id="toc-q1.-esp32가-5ghz-wi-fi를-지원하나요">Q1. ESP32가 5GHz Wi-Fi를
지원하나요?</a></li>
<li><a href="#q2.-tls-인증서를-따로-설정해야-하나요-1" id="toc-q2.-tls-인증서를-따로-설정해야-하나요-1">Q2. TLS 인증서를 따로
설정해야 하나요?</a></li>
<li><a href="#q3.-메시지가-전송되는지-어떻게-확인하나요" id="toc-q3.-메시지가-전송되는지-어떻게-확인하나요">Q3. 메시지가
전송되는지 어떻게 확인하나요?</a></li>
</ul></li>
<li><a href="#다음-단계-3" id="toc-다음-단계-3">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-14.-멀티-헥사보드-확장-실험" id="toc-chapter-14.-멀티-헥사보드-확장-실험">Chapter 14. 멀티 헥사보드
확장 실험</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-13" id="toc-이-챕터에서-배울-내용-13">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-13" id="toc-학습-목표-13">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-13" id="toc-핵심-개념-13">핵심 개념</a></li>
</ul></li>
<li><a href="#왜-멀티-보드가-필요한가" id="toc-왜-멀티-보드가-필요한가">📖 왜 멀티 보드가 필요한가?</a>
<ul>
<li><a href="#실제-iot-시스템" id="toc-실제-iot-시스템">실제 IoT
시스템</a></li>
</ul></li>
<li><a href="#멀티-보드-시스템-구조" id="toc-멀티-보드-시스템-구조">🏗️
멀티 보드 시스템 구조</a>
<ul>
<li><a href="#시스템-아키텍처" id="toc-시스템-아키텍처">시스템
아키텍처</a></li>
</ul></li>
<li><a href="#topic-설계-전략" id="toc-topic-설계-전략">🏷️ Topic 설계
전략</a>
<ul>
<li><a href="#보드별-topic-구조" id="toc-보드별-topic-구조">보드별 Topic
구조</a></li>
</ul></li>
<li><a href="#실습-준비-6" id="toc-실습-준비-6">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-6" id="toc-필요한-것-6">필요한 것</a></li>
</ul></li>
<li><a href="#실습-1-헥사보드-a-센서-전송" id="toc-실습-1-헥사보드-a-센서-전송">💻 실습 1: 헥사보드 A (센서
전송)</a>
<ul>
<li><a href="#보드-a-코드" id="toc-보드-a-코드">보드 A 코드</a></li>
</ul></li>
<li><a href="#실습-2-헥사보드-b-제어-수신" id="toc-실습-2-헥사보드-b-제어-수신">💻 실습 2: 헥사보드 B (제어
수신)</a>
<ul>
<li><a href="#보드-b-코드" id="toc-보드-b-코드">보드 B 코드</a></li>
</ul></li>
<li><a href="#실습-3-보드-간-통신" id="toc-실습-3-보드-간-통신">💻 실습
3: 보드 간 통신</a>
<ul>
<li><a href="#보드-a-보드-b-메시지-전송" id="toc-보드-a-보드-b-메시지-전송">보드 A → 보드 B 메시지 전송</a></li>
</ul></li>
<li><a href="#실습-4-통합-모니터링" id="toc-실습-4-통합-모니터링">💻
실습 4: 통합 모니터링</a>
<ul>
<li><a href="#모든-보드의-데이터-수신" id="toc-모든-보드의-데이터-수신">모든 보드의 데이터 수신</a></li>
</ul></li>
<li><a href="#topic-와일드카드" id="toc-topic-와일드카드">🎯 Topic
와일드카드</a>
<ul>
<li><a href="#wildcard-사용법" id="toc-wildcard-사용법">Wildcard
사용법</a></li>
</ul></li>
<li><a href="#client-id-관리" id="toc-client-id-관리">🔐 Client ID
관리</a>
<ul>
<li><a href="#고유한-client-id" id="toc-고유한-client-id">고유한 Client
ID</a></li>
</ul></li>
<li><a href="#시스템-확장" id="toc-시스템-확장">📊 시스템 확장</a>
<ul>
<li><a href="#많은-보드-관리" id="toc-많은-보드-관리">많은 보드
관리</a></li>
</ul></li>
<li><a href="#문제-해결-6" id="toc-문제-해결-6">🛠️ 문제 해결</a>
<ul>
<li><a href="#client-id-중복" id="toc-client-id-중복">Client ID
중복</a></li>
<li><a href="#topic-메시지가-안-보임" id="toc-topic-메시지가-안-보임">Topic 메시지가 안 보임</a></li>
<li><a href="#연결-수-제한" id="toc-연결-수-제한">연결 수 제한</a></li>
</ul></li>
<li><a href="#도전-과제-8" id="toc-도전-과제-8">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-3개-보드-체인-통신" id="toc-과제-1-3개-보드-체인-통신">과제 1: 3개 보드 체인 통신</a></li>
<li><a href="#과제-2-브로드캐스트-메시지" id="toc-과제-2-브로드캐스트-메시지">과제 2: 브로드캐스트 메시지</a></li>
</ul></li>
<li><a href="#핵심-정리-3" id="toc-핵심-정리-3">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-3" id="toc-꼭-기억하세요-3">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-5" id="toc-자주-묻는-질문-5">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-헥사보드를-몇-개까지-연결할-수-있나요" id="toc-q1.-헥사보드를-몇-개까지-연결할-수-있나요">Q1. 헥사보드를 몇
개까지 연결할 수 있나요?</a></li>
<li><a href="#q2.-client-id를-동일하게-해도-되나요" id="toc-q2.-client-id를-동일하게-해도-되나요">Q2. Client ID를 동일하게
해도 되나요?</a></li>
<li><a href="#q3.-보드-간-직접-통신이-가능한가요" id="toc-q3.-보드-간-직접-통신이-가능한가요">Q3. 보드 간 직접 통신이
가능한가요?</a></li>
<li><a href="#q4.-와일드카드는-publish에도-사용할-수-있나요" id="toc-q4.-와일드카드는-publish에도-사용할-수-있나요">Q4. 와일드카드는
Publish에도 사용할 수 있나요?</a></li>
</ul></li>
<li><a href="#다음-단계-4" id="toc-다음-단계-4">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-15.-python에서-mqtt-데이터-수신" id="toc-chapter-15.-python에서-mqtt-데이터-수신">Chapter 15. Python에서
MQTT 데이터 수신</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-14" id="toc-이-챕터에서-배울-내용-14">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-14" id="toc-학습-목표-14">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-14" id="toc-핵심-개념-14">핵심 개념</a></li>
</ul></li>
<li><a href="#왜-python-서버가-필요한가" id="toc-왜-python-서버가-필요한가">📖 왜 Python 서버가 필요한가?</a>
<ul>
<li><a href="#python의-역할" id="toc-python의-역할">Python의
역할</a></li>
</ul></li>
<li><a href="#실습-준비-7" id="toc-실습-준비-7">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-7" id="toc-필요한-것-7">필요한 것</a></li>
<li><a href="#python-라이브러리-설치" id="toc-python-라이브러리-설치">Python 라이브러리 설치</a></li>
</ul></li>
<li><a href="#실습-1-기본-mqtt-수신" id="toc-실습-1-기본-mqtt-수신">💻
실습 1: 기본 MQTT 수신</a>
<ul>
<li><a href="#python-mqtt-클라이언트-기본" id="toc-python-mqtt-클라이언트-기본">Python MQTT 클라이언트
기본</a></li>
</ul></li>
<li><a href="#실습-2-json-데이터-파싱" id="toc-실습-2-json-데이터-파싱">💻 실습 2: JSON 데이터 파싱</a>
<ul>
<li><a href="#센서-데이터-처리" id="toc-센서-데이터-처리">센서 데이터
처리</a></li>
</ul></li>
<li><a href="#실습-3-데이터-저장" id="toc-실습-3-데이터-저장">💻 실습 3:
데이터 저장</a>
<ul>
<li><a href="#csv-파일에-저장" id="toc-csv-파일에-저장">CSV 파일에
저장</a></li>
</ul></li>
<li><a href="#실습-4-환경-변수-사용" id="toc-실습-4-환경-변수-사용">💻
실습 4: 환경 변수 사용</a>
<ul>
<li><a href="#env-파일로-설정-관리" id="toc-env-파일로-설정-관리">.env
파일로 설정 관리</a></li>
</ul></li>
<li><a href="#실습-5-여러-topic-구독" id="toc-실습-5-여러-topic-구독">💻
실습 5: 여러 Topic 구독</a>
<ul>
<li><a href="#와일드카드-사용" id="toc-와일드카드-사용">와일드카드
사용</a></li>
</ul></li>
<li><a href="#문제-해결-7" id="toc-문제-해결-7">🛠️ 문제 해결</a>
<ul>
<li><a href="#연결-실패" id="toc-연결-실패">연결 실패</a></li>
<li><a href="#tls-오류" id="toc-tls-오류">TLS 오류</a></li>
<li><a href="#메시지가-안-올-때" id="toc-메시지가-안-올-때">메시지가 안
올 때</a></li>
</ul></li>
<li><a href="#도전-과제-9" id="toc-도전-과제-9">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-데이터-필터링" id="toc-과제-1-데이터-필터링">과제
1: 데이터 필터링</a></li>
<li><a href="#과제-2-실시간-통계" id="toc-과제-2-실시간-통계">과제 2:
실시간 통계</a></li>
</ul></li>
<li><a href="#핵심-정리-4" id="toc-핵심-정리-4">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-4" id="toc-꼭-기억하세요-4">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-6" id="toc-자주-묻는-질문-6">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-loop_forever는-무엇인가요" id="toc-q1.-loop_forever는-무엇인가요">Q1. loop_forever()는
무엇인가요?</a></li>
<li><a href="#q2.-여러-topic을-구독하려면" id="toc-q2.-여러-topic을-구독하려면">Q2. 여러 Topic을
구독하려면?</a></li>
<li><a href="#q3.-.env-파일을-git에-올려도-되나요" id="toc-q3.-.env-파일을-git에-올려도-되나요">Q3. .env 파일을 Git에
올려도 되나요?</a></li>
</ul></li>
<li><a href="#다음-단계-5" id="toc-다음-단계-5">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-16.-센서-데이터-요약과-상태-해석" id="toc-chapter-16.-센서-데이터-요약과-상태-해석">Chapter 16. 센서
데이터 요약과 상태 해석</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-15" id="toc-이-챕터에서-배울-내용-15">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-15" id="toc-학습-목표-15">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-15" id="toc-핵심-개념-15">핵심 개념</a></li>
</ul></li>
<li><a href="#왜-데이터-요약이-필요한가" id="toc-왜-데이터-요약이-필요한가">📖 왜 데이터 요약이 필요한가?</a>
<ul>
<li><a href="#ai에게-전달할-정보" id="toc-ai에게-전달할-정보">AI에게
전달할 정보</a></li>
</ul></li>
<li><a href="#실습-1-데이터-수집-및-저장" id="toc-실습-1-데이터-수집-및-저장">💻 실습 1: 데이터 수집 및 저장</a>
<ul>
<li><a href="#최근-데이터-관리" id="toc-최근-데이터-관리">최근 데이터
관리</a></li>
</ul></li>
<li><a href="#실습-2-통계-계산" id="toc-실습-2-통계-계산">💻 실습 2:
통계 계산</a>
<ul>
<li><a href="#평균-최대-최소" id="toc-평균-최대-최소">평균, 최대,
최소</a></li>
</ul></li>
<li><a href="#실습-3-상태-해석" id="toc-실습-3-상태-해석">💻 실습 3:
상태 해석</a>
<ul>
<li><a href="#센서-값의-의미-파악" id="toc-센서-값의-의미-파악">센서
값의 의미 파악</a></li>
</ul></li>
<li><a href="#실습-4-실시간-요약-시스템" id="toc-실습-4-실시간-요약-시스템">💻 실습 4: 실시간 요약 시스템</a>
<ul>
<li><a href="#mqtt-통계-해석-통합" id="toc-mqtt-통계-해석-통합">MQTT +
통계 + 해석 통합</a></li>
</ul></li>
<li><a href="#문제-해결-8" id="toc-문제-해결-8">🛠️ 문제 해결</a>
<ul>
<li><a href="#deque가-뭔가요" id="toc-deque가-뭔가요">deque가
뭔가요?</a></li>
<li><a href="#통계-계산-오류" id="toc-통계-계산-오류">통계 계산
오류</a></li>
</ul></li>
<li><a href="#도전-과제-10" id="toc-도전-과제-10">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-트렌드-분석" id="toc-과제-1-트렌드-분석">과제 1:
트렌드 분석</a></li>
<li><a href="#과제-2-알림-시스템" id="toc-과제-2-알림-시스템">과제 2:
알림 시스템</a></li>
</ul></li>
<li><a href="#핵심-정리-5" id="toc-핵심-정리-5">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-5" id="toc-꼭-기억하세요-5">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-7" id="toc-자주-묻는-질문-7">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-몇-개의-데이터로-요약해야-하나요" id="toc-q1.-몇-개의-데이터로-요약해야-하나요">Q1. 몇 개의 데이터로
요약해야 하나요?</a></li>
<li><a href="#q2.-중앙값median과-평균mean의-차이는" id="toc-q2.-중앙값median과-평균mean의-차이는">Q2. 중앙값(median)과
평균(mean)의 차이는?</a></li>
<li><a href="#q3.-상태-해석-기준은-어떻게-정하나요" id="toc-q3.-상태-해석-기준은-어떻게-정하나요">Q3. 상태 해석 기준은
어떻게 정하나요?</a></li>
</ul></li>
<li><a href="#다음-단계-6" id="toc-다음-단계-6">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-17.-openai-api-연동-및-프롬프트-설계" id="toc-chapter-17.-openai-api-연동-및-프롬프트-설계">Chapter 17. OpenAI
API 연동 및 프롬프트 설계</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-16" id="toc-이-챕터에서-배울-내용-16">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-16" id="toc-학습-목표-16">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-16" id="toc-핵심-개념-16">핵심 개념</a></li>
</ul></li>
<li><a href="#openai-api란" id="toc-openai-api란">📖 OpenAI API란?</a>
<ul>
<li><a href="#gpt를-코드로-사용하기" id="toc-gpt를-코드로-사용하기">GPT를 코드로 사용하기</a></li>
</ul></li>
<li><a href="#실습-준비-8" id="toc-실습-준비-8">🔧 실습 준비</a>
<ul>
<li><a href="#openai-api-키-발급" id="toc-openai-api-키-발급">OpenAI API
키 발급</a></li>
<li><a href="#라이브러리-설치" id="toc-라이브러리-설치">라이브러리
설치</a></li>
<li><a href="#env-파일-설정" id="toc-env-파일-설정">.env 파일
설정</a></li>
</ul></li>
<li><a href="#실습-1-openai-api-기본-사용" id="toc-실습-1-openai-api-기본-사용">💻 실습 1: OpenAI API 기본 사용</a>
<ul>
<li><a href="#첫-번째-api-호출" id="toc-첫-번째-api-호출">첫 번째 API
호출</a></li>
</ul></li>
<li><a href="#실습-2-센서-데이터-분석" id="toc-실습-2-센서-데이터-분석">💻 실습 2: 센서 데이터 분석</a>
<ul>
<li><a href="#센서-데이터를-ai로-분석" id="toc-센서-데이터를-ai로-분석">센서 데이터를 AI로 분석</a></li>
</ul></li>
<li><a href="#실습-3-프롬프트-설계" id="toc-실습-3-프롬프트-설계">💻
실습 3: 프롬프트 설계</a>
<ul>
<li><a href="#효과적인-프롬프트-작성" id="toc-효과적인-프롬프트-작성">효과적인 프롬프트 작성</a></li>
</ul></li>
<li><a href="#실습-4-실시간-ai-분석-시스템" id="toc-실습-4-실시간-ai-분석-시스템">💻 실습 4: 실시간 AI 분석
시스템</a>
<ul>
<li><a href="#mqtt-openai-통합" id="toc-mqtt-openai-통합">MQTT + OpenAI
통합</a></li>
</ul></li>
<li><a href="#비용-관리" id="toc-비용-관리">💰 비용 관리</a>
<ul>
<li><a href="#openai-api-요금" id="toc-openai-api-요금">OpenAI API
요금</a></li>
</ul></li>
<li><a href="#문제-해결-9" id="toc-문제-해결-9">🛠️ 문제 해결</a>
<ul>
<li><a href="#api-키-오류" id="toc-api-키-오류">API 키 오류</a></li>
<li><a href="#rate-limit-오류" id="toc-rate-limit-오류">Rate Limit
오류</a></li>
</ul></li>
<li><a href="#도전-과제-11" id="toc-도전-과제-11">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-감정-분석" id="toc-과제-1-감정-분석">과제 1: 감정
분석</a></li>
<li><a href="#과제-2-맞춤형-권장" id="toc-과제-2-맞춤형-권장">과제 2:
맞춤형 권장</a></li>
</ul></li>
<li><a href="#핵심-정리-6" id="toc-핵심-정리-6">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-6" id="toc-꼭-기억하세요-6">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-8" id="toc-자주-묻는-질문-8">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-gpt-4와-gpt-3.5의-차이는" id="toc-q1.-gpt-4와-gpt-3.5의-차이는">Q1. GPT-4와 GPT-3.5의
차이는?</a></li>
<li><a href="#q2.-api-키를-무료로-사용할-수-있나요" id="toc-q2.-api-키를-무료로-사용할-수-있나요">Q2. API 키를 무료로 사용할
수 있나요?</a></li>
<li><a href="#q3.-temperature는-어떻게-설정하나요" id="toc-q3.-temperature는-어떻게-설정하나요">Q3. temperature는 어떻게
설정하나요?</a></li>
</ul></li>
<li><a href="#다음-단계-7" id="toc-다음-단계-7">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-18.-ai-응답을-제어-명령으로-변환하기" id="toc-chapter-18.-ai-응답을-제어-명령으로-변환하기">Chapter 18. AI
응답을 제어 명령으로 변환하기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-17" id="toc-이-챕터에서-배울-내용-17">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-17" id="toc-학습-목표-17">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-17" id="toc-핵심-개념-17">핵심 개념</a></li>
</ul></li>
<li><a href="#왜-명령-변환이-필요한가" id="toc-왜-명령-변환이-필요한가">📖 왜 명령 변환이 필요한가?</a>
<ul>
<li><a href="#ai-응답의-문제점" id="toc-ai-응답의-문제점">AI 응답의
문제점</a></li>
</ul></li>
<li><a href="#실습-1-json-형식-응답-요청" id="toc-실습-1-json-형식-응답-요청">💻 실습 1: JSON 형식 응답 요청</a>
<ul>
<li><a href="#ai가-직접-json-생성" id="toc-ai가-직접-json-생성">AI가
직접 JSON 생성</a></li>
</ul></li>
<li><a href="#실습-2-명령-생성-클래스" id="toc-실습-2-명령-생성-클래스">💻 실습 2: 명령 생성 클래스</a>
<ul>
<li><a href="#재사용-가능한-명령-생성기" id="toc-재사용-가능한-명령-생성기">재사용 가능한 명령 생성기</a></li>
</ul></li>
<li><a href="#실습-3-규칙-기반-ai-하이브리드" id="toc-실습-3-규칙-기반-ai-하이브리드">💻 실습 3: 규칙 기반 + AI
하이브리드</a>
<ul>
<li><a href="#빠른-응답-ai-보조" id="toc-빠른-응답-ai-보조">빠른 응답 +
AI 보조</a></li>
</ul></li>
<li><a href="#실습-4-명령-검증" id="toc-실습-4-명령-검증">💻 실습 4:
명령 검증</a>
<ul>
<li><a href="#안전한-명령-실행" id="toc-안전한-명령-실행">안전한 명령
실행</a></li>
</ul></li>
<li><a href="#문제-해결-10" id="toc-문제-해결-10">🛠️ 문제 해결</a>
<ul>
<li><a href="#json-파싱-오류" id="toc-json-파싱-오류">JSON 파싱
오류</a></li>
<li><a href="#느린-응답" id="toc-느린-응답">느린 응답</a></li>
</ul></li>
<li><a href="#도전-과제-12" id="toc-도전-과제-12">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-복잡한-명령-생성" id="toc-과제-1-복잡한-명령-생성">과제 1: 복잡한 명령 생성</a></li>
<li><a href="#과제-2-우선순위-기반-제어" id="toc-과제-2-우선순위-기반-제어">과제 2: 우선순위 기반 제어</a></li>
</ul></li>
<li><a href="#핵심-정리-7" id="toc-핵심-정리-7">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-7" id="toc-꼭-기억하세요-7">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-9" id="toc-자주-묻는-질문-9">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-ai가-json이-아닌-텍스트를-반환하면" id="toc-q1.-ai가-json이-아닌-텍스트를-반환하면">Q1. AI가 JSON이 아닌
텍스트를 반환하면?</a></li>
<li><a href="#q2.-규칙-기반과-ai-중-무엇을-사용해야-하나요" id="toc-q2.-규칙-기반과-ai-중-무엇을-사용해야-하나요">Q2. 규칙 기반과 AI
중 무엇을 사용해야 하나요?</a></li>
<li><a href="#q3.-명령-검증은-필수인가요" id="toc-q3.-명령-검증은-필수인가요">Q3. 명령 검증은 필수인가요?</a></li>
</ul></li>
<li><a href="#다음-단계-8" id="toc-다음-단계-8">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-19.-헥사보드로-제어-명령-되돌려-보내기" id="toc-chapter-19.-헥사보드로-제어-명령-되돌려-보내기">Chapter 19.
헥사보드로 제어 명령 되돌려 보내기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-18" id="toc-이-챕터에서-배울-내용-18">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-18" id="toc-학습-목표-18">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-18" id="toc-핵심-개념-18">핵심 개념</a></li>
</ul></li>
<li><a href="#완전한-ai-제어-시스템" id="toc-완전한-ai-제어-시스템">📖
완전한 AI 제어 시스템</a>
<ul>
<li><a href="#전체-흐름" id="toc-전체-흐름">전체 흐름</a></li>
</ul></li>
<li><a href="#실습-준비-9" id="toc-실습-준비-9">🔧 실습 준비</a>
<ul>
<li><a href="#필요한-것-8" id="toc-필요한-것-8">필요한 것</a></li>
</ul></li>
<li><a href="#실습-1-제어-명령-전송" id="toc-실습-1-제어-명령-전송">💻
실습 1: 제어 명령 전송</a>
<ul>
<li><a href="#python에서-mqtt-publish" id="toc-python에서-mqtt-publish">Python에서 MQTT Publish</a></li>
</ul></li>
<li><a href="#실습-2-완전-자동-ai-제어-시스템" id="toc-실습-2-완전-자동-ai-제어-시스템">💻 실습 2: 완전 자동 AI 제어
시스템</a>
<ul>
<li><a href="#센서-수신-ai-분석-자동-제어" id="toc-센서-수신-ai-분석-자동-제어">센서 수신 + AI 분석 + 자동
제어</a></li>
</ul></li>
<li><a href="#실습-3-양방향-통신-헥사보드-코드" id="toc-실습-3-양방향-통신-헥사보드-코드">💻 실습 3: 양방향 통신
헥사보드 코드</a>
<ul>
<li><a href="#센서-전송-제어-수신" id="toc-센서-전송-제어-수신">센서
전송 + 제어 수신</a></li>
</ul></li>
<li><a href="#실습-4-시스템-모니터링" id="toc-실습-4-시스템-모니터링">💻
실습 4: 시스템 모니터링</a>
<ul>
<li><a href="#전체-시스템-상태-확인" id="toc-전체-시스템-상태-확인">전체
시스템 상태 확인</a></li>
</ul></li>
<li><a href="#문제-해결-11" id="toc-문제-해결-11">🛠️ 문제 해결</a>
<ul>
<li><a href="#제어-명령이-실행-안-됨" id="toc-제어-명령이-실행-안-됨">제어 명령이 실행 안 됨</a></li>
<li><a href="#너무-자주-제어됨" id="toc-너무-자주-제어됨">너무 자주
제어됨</a></li>
<li><a href="#ai-비용이-너무-많이-나옴" id="toc-ai-비용이-너무-많이-나옴">AI 비용이 너무 많이 나옴</a></li>
</ul></li>
<li><a href="#도전-과제-13" id="toc-도전-과제-13">🚀 도전 과제</a>
<ul>
<li><a href="#과제-1-다중-보드-제어" id="toc-과제-1-다중-보드-제어">과제
1: 다중 보드 제어</a></li>
<li><a href="#과제-2-학습-기능" id="toc-과제-2-학습-기능">과제 2: 학습
기능</a></li>
</ul></li>
<li><a href="#핵심-정리-8" id="toc-핵심-정리-8">📝 핵심 정리</a>
<ul>
<li><a href="#꼭-기억하세요-8" id="toc-꼭-기억하세요-8">꼭
기억하세요!</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-10" id="toc-자주-묻는-질문-10">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-얼마나-자주-제어해야-하나요" id="toc-q1.-얼마나-자주-제어해야-하나요">Q1. 얼마나 자주 제어해야
하나요?</a></li>
<li><a href="#q2.-여러-헥사보드를-제어하려면" id="toc-q2.-여러-헥사보드를-제어하려면">Q2. 여러 헥사보드를
제어하려면?</a></li>
<li><a href="#q3.-실시간-제어가-필요한가요" id="toc-q3.-실시간-제어가-필요한가요">Q3. 실시간 제어가
필요한가요?</a></li>
</ul></li>
<li><a href="#다음-단계-9" id="toc-다음-단계-9">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-20.-프로젝트-개요" id="toc-chapter-20.-프로젝트-개요">Chapter 20. 프로젝트 개요</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-19" id="toc-이-챕터에서-배울-내용-19">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#프로젝트-소개" id="toc-프로젝트-소개">🎯 프로젝트 소개</a>
<ul>
<li><a href="#ai-환경-무드-컨트롤러란" id="toc-ai-환경-무드-컨트롤러란">AI 환경 무드 컨트롤러란?</a></li>
</ul></li>
<li><a href="#시스템-구성" id="toc-시스템-구성">🏗️ 시스템 구성</a>
<ul>
<li><a href="#전체-아키텍처" id="toc-전체-아키텍처">전체
아키텍처</a></li>
<li><a href="#주요-컴포넌트" id="toc-주요-컴포넌트">주요
컴포넌트</a></li>
</ul></li>
<li><a href="#무드-시스템-정의" id="toc-무드-시스템-정의">🎨 무드 시스템
정의</a>
<ul>
<li><a href="#가지-무드-상태" id="toc-가지-무드-상태">5가지 무드
상태</a></li>
<li><a href="#led-패턴" id="toc-led-패턴">LED 패턴</a></li>
</ul></li>
<li><a href="#프로젝트-요구사항" id="toc-프로젝트-요구사항">📋 프로젝트
요구사항</a>
<ul>
<li><a href="#기능-요구사항" id="toc-기능-요구사항">기능
요구사항</a></li>
<li><a href="#비기능-요구사항" id="toc-비기능-요구사항">비기능
요구사항</a></li>
</ul></li>
<li><a href="#필요한-것-9" id="toc-필요한-것-9">🛠️ 필요한 것</a>
<ul>
<li><a href="#하드웨어" id="toc-하드웨어">하드웨어</a></li>
<li><a href="#소프트웨어" id="toc-소프트웨어">소프트웨어</a></li>
<li><a href="#라이브러리" id="toc-라이브러리">라이브러리</a></li>
</ul></li>
<li><a href="#구현-일정" id="toc-구현-일정">📅 구현 일정</a>
<ul>
<li><a href="#단계-구현-계획" id="toc-단계-구현-계획">3단계 구현
계획</a></li>
</ul></li>
<li><a href="#학습-목표-19" id="toc-학습-목표-19">🎯 학습 목표</a>
<ul>
<li><a href="#이-프로젝트를-통해-배울-것" id="toc-이-프로젝트를-통해-배울-것">이 프로젝트를 통해 배울 것</a></li>
</ul></li>
<li><a href="#프로젝트-확장-아이디어" id="toc-프로젝트-확장-아이디어">💡
프로젝트 확장 아이디어</a>
<ul>
<li><a href="#추가할-수-있는-기능" id="toc-추가할-수-있는-기능">추가할
수 있는 기능</a></li>
</ul></li>
<li><a href="#성공-지표" id="toc-성공-지표">📊 성공 지표</a>
<ul>
<li><a href="#프로젝트-완료-기준" id="toc-프로젝트-완료-기준">프로젝트
완료 기준</a></li>
</ul></li>
<li><a href="#사전-지식" id="toc-사전-지식">🎓 사전 지식</a>
<ul>
<li><a href="#필수-선수-과정" id="toc-필수-선수-과정">필수 선수
과정</a></li>
</ul></li>
<li><a href="#다음-단계-10" id="toc-다음-단계-10">🚀 다음 단계</a></li>
<li><a href="#체크리스트" id="toc-체크리스트">📝 체크리스트</a></li>
</ul></li>
<li><a href="#chapter-21.-시스템-아키텍처-설계" id="toc-chapter-21.-시스템-아키텍처-설계">Chapter 21. 시스템 아키텍처
설계</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-20" id="toc-이-챕터에서-배울-내용-20">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-20" id="toc-학습-목표-20">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-19" id="toc-핵심-개념-19">핵심 개념</a></li>
</ul></li>
<li><a href="#시스템-아키텍처-1" id="toc-시스템-아키텍처-1">🏗️ 시스템
아키텍처</a>
<ul>
<li><a href="#계층-구조" id="toc-계층-구조">3계층 구조</a></li>
</ul></li>
<li><a href="#데이터-흐름" id="toc-데이터-흐름">📡 데이터 흐름</a>
<ul>
<li><a href="#센서-ai-제어-흐름" id="toc-센서-ai-제어-흐름">센서 → AI →
제어 흐름</a></li>
</ul></li>
<li><a href="#상태-다이어그램" id="toc-상태-다이어그램">🔄 상태
다이어그램</a>
<ul>
<li><a href="#무드-전환-로직" id="toc-무드-전환-로직">무드 전환
로직</a></li>
</ul></li>
<li><a href="#topic-설계-1" id="toc-topic-설계-1">📋 Topic 설계</a>
<ul>
<li><a href="#mqtt-topic-구조" id="toc-mqtt-topic-구조">MQTT Topic
구조</a></li>
</ul></li>
<li><a href="#데이터-모델" id="toc-데이터-모델">🗂️ 데이터 모델</a>
<ul>
<li><a href="#센서-데이터-모델" id="toc-센서-데이터-모델">센서 데이터
모델</a></li>
<li><a href="#무드-분석-모델" id="toc-무드-분석-모델">무드 분석
모델</a></li>
<li><a href="#led-제어-모델" id="toc-led-제어-모델">LED 제어
모델</a></li>
</ul></li>
<li><a href="#컴포넌트-인터페이스" id="toc-컴포넌트-인터페이스">🔌
컴포넌트 인터페이스</a>
<ul>
<li><a href="#헥사보드-인터페이스" id="toc-헥사보드-인터페이스">헥사보드
인터페이스</a></li>
<li><a href="#python-ai-server-인터페이스" id="toc-python-ai-server-인터페이스">Python AI Server
인터페이스</a></li>
</ul></li>
<li><a href="#설정-파일-구조" id="toc-설정-파일-구조">⚙️ 설정 파일
구조</a>
<ul>
<li><a href="#환경-변수-.env" id="toc-환경-변수-.env">환경 변수
(.env)</a></li>
<li><a href="#무드-설정-config.json" id="toc-무드-설정-config.json">무드
설정 (config.json)</a></li>
</ul></li>
<li><a href="#에러-처리-전략" id="toc-에러-처리-전략">🛡️ 에러 처리
전략</a>
<ul>
<li><a href="#센서-오류" id="toc-센서-오류">센서 오류</a></li>
<li><a href="#mqtt-연결-끊김" id="toc-mqtt-연결-끊김">MQTT 연결
끊김</a></li>
<li><a href="#ai-api-오류" id="toc-ai-api-오류">AI API 오류</a></li>
</ul></li>
<li><a href="#성능-요구사항" id="toc-성능-요구사항">📊 성능 요구사항</a>
<ul>
<li><a href="#응답-시간" id="toc-응답-시간">응답 시간</a></li>
<li><a href="#리소스-사용" id="toc-리소스-사용">리소스 사용</a></li>
</ul></li>
<li><a href="#보안-고려사항" id="toc-보안-고려사항">🔐 보안 고려사항</a>
<ul>
<li><a href="#통신-보안" id="toc-통신-보안">통신 보안</a></li>
<li><a href="#데이터-프라이버시" id="toc-데이터-프라이버시">데이터
프라이버시</a></li>
</ul></li>
<li><a href="#핵심-정리-9" id="toc-핵심-정리-9">📝 핵심 정리</a>
<ul>
<li><a href="#아키텍처-원칙" id="toc-아키텍처-원칙">아키텍처
원칙</a></li>
<li><a href="#데이터-흐름-1" id="toc-데이터-흐름-1">데이터 흐름</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-11" id="toc-자주-묻는-질문-11">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-왜-10초마다-ai-분석하나요" id="toc-q1.-왜-10초마다-ai-분석하나요">Q1. 왜 10초마다 AI
분석하나요?</a></li>
<li><a href="#q2.-헥사보드가-오프라인이-되면" id="toc-q2.-헥사보드가-오프라인이-되면">Q2. 헥사보드가 오프라인이
되면?</a></li>
<li><a href="#q3.-여러-보드를-동시에-제어할-수-있나요" id="toc-q3.-여러-보드를-동시에-제어할-수-있나요">Q3. 여러 보드를 동시에
제어할 수 있나요?</a></li>
</ul></li>
<li><a href="#다음-단계-11" id="toc-다음-단계-11">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-22.-단계별-구현-실습" id="toc-chapter-22.-단계별-구현-실습">Chapter 22. 단계별 구현 실습</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-21" id="toc-이-챕터에서-배울-내용-21">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-21" id="toc-학습-목표-21">🎯 학습 목표</a>
<ul>
<li><a href="#구현-단계" id="toc-구현-단계">구현 단계</a></li>
</ul></li>
<li><a href="#phase-1-헥사보드-구현" id="toc-phase-1-헥사보드-구현">💻
Phase 1: 헥사보드 구현</a>
<ul>
<li><a href="#step-1-센서-수집-및-전송" id="toc-step-1-센서-수집-및-전송">Step 1: 센서 수집 및 전송</a></li>
</ul></li>
<li><a href="#phase-2-python-ai-서버-구현" id="toc-phase-2-python-ai-서버-구현">💻 Phase 2: Python AI 서버 구현</a>
<ul>
<li><a href="#step-2-무드-컨트롤러-서버" id="toc-step-2-무드-컨트롤러-서버">Step 2: 무드 컨트롤러 서버</a></li>
</ul></li>
<li><a href="#phase-3-통합-및-테스트" id="toc-phase-3-통합-및-테스트">🧪
Phase 3: 통합 및 테스트</a>
<ul>
<li><a href="#step-3-전체-시스템-테스트" id="toc-step-3-전체-시스템-테스트">Step 3: 전체 시스템 테스트</a></li>
<li><a href="#테스트-실행" id="toc-테스트-실행">테스트 실행</a></li>
</ul></li>
<li><a href="#디버깅-가이드" id="toc-디버깅-가이드">🐛 디버깅 가이드</a>
<ul>
<li><a href="#문제-1-센서-데이터가-안-보임" id="toc-문제-1-센서-데이터가-안-보임">문제 1: 센서 데이터가 안
보임</a></li>
<li><a href="#문제-2-led가-안-바뀜" id="toc-문제-2-led가-안-바뀜">문제
2: LED가 안 바뀜</a></li>
<li><a href="#문제-3-ai가-너무-자주-호출됨" id="toc-문제-3-ai가-너무-자주-호출됨">문제 3: AI가 너무 자주
호출됨</a></li>
</ul></li>
<li><a href="#핵심-정리-10" id="toc-핵심-정리-10">📝 핵심 정리</a>
<ul>
<li><a href="#구현-체크리스트" id="toc-구현-체크리스트">구현
체크리스트</a></li>
<li><a href="#파일-구조" id="toc-파일-구조">파일 구조</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-12" id="toc-자주-묻는-질문-12">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-헥사보드-코드를-자동-시작하려면" id="toc-q1.-헥사보드-코드를-자동-시작하려면">Q1. 헥사보드 코드를 자동
시작하려면?</a></li>
<li><a href="#q2.-python-서버를-백그라운드로-실행하려면" id="toc-q2.-python-서버를-백그라운드로-실행하려면">Q2. Python 서버를
백그라운드로 실행하려면?</a></li>
<li><a href="#q3.-무드-임계값을-변경하려면" id="toc-q3.-무드-임계값을-변경하려면">Q3. 무드 임계값을
변경하려면?</a></li>
</ul></li>
<li><a href="#다음-단계-12" id="toc-다음-단계-12">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-23.-ai-실험과-튜닝" id="toc-chapter-23.-ai-실험과-튜닝">Chapter 23. AI 실험과 튜닝</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-22" id="toc-이-챕터에서-배울-내용-22">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-22" id="toc-학습-목표-22">🎯 학습 목표</a>
<ul>
<li><a href="#핵심-개념-20" id="toc-핵심-개념-20">핵심 개념</a></li>
</ul></li>
<li><a href="#프롬프트-최적화" id="toc-프롬프트-최적화">🔧 프롬프트
최적화</a>
<ul>
<li><a href="#기본-프롬프트-개선-전" id="toc-기본-프롬프트-개선-전">기본
프롬프트 (개선 전)</a></li>
<li><a href="#개선된-프롬프트-v1" id="toc-개선된-프롬프트-v1">개선된
프롬프트 v1</a></li>
<li><a href="#최적화된-프롬프트-v2" id="toc-최적화된-프롬프트-v2">최적화된 프롬프트 v2</a></li>
</ul></li>
<li><a href="#성능-최적화" id="toc-성능-최적화">⚡ 성능 최적화</a>
<ul>
<li><a href="#모델-선택" id="toc-모델-선택">1. 모델 선택</a></li>
<li><a href="#토큰-최적화" id="toc-토큰-최적화">2. 토큰 최적화</a></li>
<li><a href="#캐싱-전략" id="toc-캐싱-전략">3. 캐싱 전략</a></li>
<li><a href="#규칙-기반-우선" id="toc-규칙-기반-우선">4. 규칙 기반
우선</a></li>
</ul></li>
<li><a href="#데이터-활용-고급" id="toc-데이터-활용-고급">📊 데이터 활용
고급</a>
<ul>
<li><a href="#통계-기반-분석" id="toc-통계-기반-분석">1. 통계 기반
분석</a></li>
<li><a href="#트렌드-감지" id="toc-트렌드-감지">2. 트렌드 감지</a></li>
</ul></li>
<li><a href="#고급-led-패턴" id="toc-고급-led-패턴">🎨 고급 LED 패턴</a>
<ul>
<li><a href="#부드러운-전환" id="toc-부드러운-전환">1. 부드러운
전환</a></li>
<li><a href="#그라데이션" id="toc-그라데이션">2. 그라데이션</a></li>
<li><a href="#무드별-애니메이션" id="toc-무드별-애니메이션">3. 무드별
애니메이션</a></li>
</ul></li>
<li><a href="#추가-기능-구현" id="toc-추가-기능-구현">🚀 추가 기능
구현</a>
<ul>
<li><a href="#알림-시스템" id="toc-알림-시스템">1. 알림 시스템</a></li>
<li><a href="#데이터-로깅" id="toc-데이터-로깅">2. 데이터 로깅</a></li>
<li><a href="#웹-api-선택" id="toc-웹-api-선택">3. 웹 API
(선택)</a></li>
</ul></li>
<li><a href="#실험-및-ab-테스트" id="toc-실험-및-ab-테스트">📊 실험 및
A/B 테스트</a>
<ul>
<li><a href="#실험-1-모델-비교" id="toc-실험-1-모델-비교">실험 1: 모델
비교</a></li>
<li><a href="#실험-2-프롬프트-ab-테스트" id="toc-실험-2-프롬프트-ab-테스트">실험 2: 프롬프트 A/B 테스트</a></li>
</ul></li>
<li><a href="#핵심-정리-11" id="toc-핵심-정리-11">📝 핵심 정리</a>
<ul>
<li><a href="#최적화-체크리스트" id="toc-최적화-체크리스트">최적화
체크리스트</a></li>
<li><a href="#성능-개선-결과" id="toc-성능-개선-결과">성능 개선
결과</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-13" id="toc-자주-묻는-질문-13">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-ai-없이도-동작하나요" id="toc-q1.-ai-없이도-동작하나요">Q1. AI 없이도 동작하나요?</a></li>
<li><a href="#q2.-비용을-더-줄이려면" id="toc-q2.-비용을-더-줄이려면">Q2. 비용을 더 줄이려면?</a></li>
<li><a href="#q3.-정확도를-높이려면" id="toc-q3.-정확도를-높이려면">Q3.
정확도를 높이려면?</a></li>
</ul></li>
<li><a href="#다음-단계-13" id="toc-다음-단계-13">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-24.-웹에서-센서-상태-모니터링하기" id="toc-chapter-24.-웹에서-센서-상태-모니터링하기">Chapter 24. 웹에서
센서 상태 모니터링하기</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-23" id="toc-이-챕터에서-배울-내용-23">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-23" id="toc-학습-목표-23">🎯 학습 목표</a>
<ul>
<li><a href="#웹-대시보드란" id="toc-웹-대시보드란">웹
대시보드란?</a></li>
</ul></li>
<li><a href="#필요한-것-10" id="toc-필요한-것-10">🛠️ 필요한 것</a>
<ul>
<li><a href="#소프트웨어-1" id="toc-소프트웨어-1">소프트웨어</a></li>
<li><a href="#사전-지식-1" id="toc-사전-지식-1">사전 지식</a></li>
</ul></li>
<li><a href="#실습-1-기본-웹-페이지-만들기" id="toc-실습-1-기본-웹-페이지-만들기">💻 실습 1: 기본 웹 페이지
만들기</a>
<ul>
<li><a href="#step-1-html-기본-구조-tailwind-css" id="toc-step-1-html-기본-구조-tailwind-css">Step 1: HTML 기본 구조
(Tailwind CSS)</a></li>
</ul></li>
<li><a href="#실습-2-mqtt-연결하기" id="toc-실습-2-mqtt-연결하기">💻
실습 2: MQTT 연결하기</a>
<ul>
<li><a href="#step-2-mqtt.js-추가" id="toc-step-2-mqtt.js-추가">Step 2:
MQTT.js 추가</a></li>
</ul></li>
<li><a href="#실습-3-완성된-대시보드-tailwind-css" id="toc-실습-3-완성된-대시보드-tailwind-css">💻 실습 3: 완성된 대시보드
(Tailwind CSS)</a>
<ul>
<li><a href="#전체-코드" id="toc-전체-코드">전체 코드</a></li>
</ul></li>
<li><a href="#hivemq-cloud-websocket-설정" id="toc-hivemq-cloud-websocket-설정">🔧 HiveMQ Cloud WebSocket 설정</a>
<ul>
<li><a href="#hivemq-cloud에서-websocket-활성화" id="toc-hivemq-cloud에서-websocket-활성화">HiveMQ Cloud에서 WebSocket
활성화</a></li>
</ul></li>
<li><a href="#핵심-정리-12" id="toc-핵심-정리-12">📝 핵심 정리</a>
<ul>
<li><a href="#주요-개념-1" id="toc-주요-개념-1">주요 개념</a></li>
<li><a href="#코드-구조" id="toc-코드-구조">코드 구조</a></li>
<li><a href="#tailwind-css-주요-클래스" id="toc-tailwind-css-주요-클래스">Tailwind CSS 주요 클래스</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-14" id="toc-자주-묻는-질문-14">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-연결이-안-됩니다" id="toc-q1.-연결이-안-됩니다">Q1.
연결이 안 됩니다!</a></li>
<li><a href="#q2.-스마트폰에서도-됩니까" id="toc-q2.-스마트폰에서도-됩니까">Q2. 스마트폰에서도 됩니까?</a></li>
<li><a href="#q3.-서버가-필요한가요" id="toc-q3.-서버가-필요한가요">Q3.
서버가 필요한가요?</a></li>
</ul></li>
<li><a href="#다음-단계-14" id="toc-다음-단계-14">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-25.-웹에서-헥사보드-수동-제어-tailwind-css" id="toc-chapter-25.-웹에서-헥사보드-수동-제어-tailwind-css">Chapter 25.
웹에서 헥사보드 수동 제어 (Tailwind CSS)</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-24" id="toc-이-챕터에서-배울-내용-24">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-24" id="toc-학습-목표-24">🎯 학습 목표</a>
<ul>
<li><a href="#웹-제어란" id="toc-웹-제어란">웹 제어란?</a></li>
</ul></li>
<li><a href="#실습-1-tailwind-css로-제어-ui-만들기" id="toc-실습-1-tailwind-css로-제어-ui-만들기">💻 실습 1: Tailwind CSS로
제어 UI 만들기</a>
<ul>
<li><a href="#step-1-색상-선택-버튼" id="toc-step-1-색상-선택-버튼">Step
1: 색상 선택 버튼</a></li>
<li><a href="#step-2-커스텀-색상-밝기-조절" id="toc-step-2-커스텀-색상-밝기-조절">Step 2: 커스텀 색상 &amp; 밝기
조절</a></li>
</ul></li>
<li><a href="#실습-2-javascript-제어-로직" id="toc-실습-2-javascript-제어-로직">💻 실습 2: JavaScript 제어 로직</a>
<ul>
<li><a href="#제어-함수-구현" id="toc-제어-함수-구현">제어 함수
구현</a></li>
</ul></li>
<li><a href="#실습-3-완성된-제어-대시보드" id="toc-실습-3-완성된-제어-대시보드">💻 실습 3: 완성된 제어 대시보드</a>
<ul>
<li><a href="#전체-코드-1" id="toc-전체-코드-1">전체 코드</a></li>
</ul></li>
<li><a href="#핵심-정리-13" id="toc-핵심-정리-13">📝 핵심 정리</a>
<ul>
<li><a href="#양방향-통신" id="toc-양방향-통신">양방향 통신</a></li>
<li><a href="#tailwind-css-제어-컴포넌트" id="toc-tailwind-css-제어-컴포넌트">Tailwind CSS 제어 컴포넌트</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-15" id="toc-자주-묻는-질문-15">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-명령이-전송되는지-확인하려면" id="toc-q1.-명령이-전송되는지-확인하려면">Q1. 명령이 전송되는지
확인하려면?</a></li>
<li><a href="#q2.-tailwind-css-없이도-작동하나요" id="toc-q2.-tailwind-css-없이도-작동하나요">Q2. Tailwind CSS 없이도
작동하나요?</a></li>
<li><a href="#q3.-모바일에서도-작동하나요" id="toc-q3.-모바일에서도-작동하나요">Q3. 모바일에서도
작동하나요?</a></li>
</ul></li>
<li><a href="#다음-단계-15" id="toc-다음-단계-15">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-26.-웹에서-자연어-기반-ai-제어-tailwind-css" id="toc-chapter-26.-웹에서-자연어-기반-ai-제어-tailwind-css">Chapter 26.
웹에서 자연어 기반 AI 제어 (Tailwind CSS)</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-25" id="toc-이-챕터에서-배울-내용-25">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-25" id="toc-학습-목표-25">🎯 학습 목표</a>
<ul>
<li><a href="#ai-제어란" id="toc-ai-제어란">AI 제어란?</a></li>
</ul></li>
<li><a href="#중요-api-키-보안" id="toc-중요-api-키-보안">⚠️ 중요: API
키 보안</a></li>
<li><a href="#실습-1-ai-제어-ui-tailwind-css" id="toc-실습-1-ai-제어-ui-tailwind-css">💻 실습 1: AI 제어 UI (Tailwind
CSS)</a>
<ul>
<li><a href="#step-1-ai-입력-인터페이스" id="toc-step-1-ai-입력-인터페이스">Step 1: AI 입력 인터페이스</a></li>
</ul></li>
<li><a href="#실습-2-openai-api-통합" id="toc-실습-2-openai-api-통합">💻
실습 2: OpenAI API 통합</a>
<ul>
<li><a href="#ai-명령-처리-함수" id="toc-ai-명령-처리-함수">AI 명령 처리
함수</a></li>
</ul></li>
<li><a href="#실습-3-python-백엔드-서버" id="toc-실습-3-python-백엔드-서버">💻 실습 3: Python 백엔드 서버</a>
<ul>
<li><a href="#flask-서버-권장" id="toc-flask-서버-권장">Flask 서버
(권장)</a></li>
</ul></li>
<li><a href="#핵심-정리-14" id="toc-핵심-정리-14">📝 핵심 정리</a>
<ul>
<li><a href="#ai-제어-흐름" id="toc-ai-제어-흐름">AI 제어 흐름</a></li>
<li><a href="#tailwind-css-ai-컴포넌트" id="toc-tailwind-css-ai-컴포넌트">Tailwind CSS AI 컴포넌트</a></li>
</ul></li>
<li><a href="#part-7-완료" id="toc-part-7-완료">🎉 PART 7 완료!</a>
<ul>
<li><a href="#완성한-것들" id="toc-완성한-것들">완성한 것들</a></li>
<li><a href="#최종-대시보드-기능" id="toc-최종-대시보드-기능">최종
대시보드 기능</a></li>
</ul></li>
<li><a href="#다음-단계-16" id="toc-다음-단계-16">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-27.-교육-커리큘럼-설계-가이드" id="toc-chapter-27.-교육-커리큘럼-설계-가이드">Chapter 27. 교육 커리큘럼
설계 가이드</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-26" id="toc-이-챕터에서-배울-내용-26">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-26" id="toc-학습-목표-26">🎯 학습 목표</a>
<ul>
<li><a href="#aiot-교육의-핵심" id="toc-aiot-교육의-핵심">AIoT 교육의
핵심</a></li>
</ul></li>
<li><a href="#커리큘럼-구조" id="toc-커리큘럼-구조">📋 커리큘럼 구조</a>
<ul>
<li><a href="#기본-20시간-코스-전체" id="toc-기본-20시간-코스-전체">기본
20시간 코스 (전체)</a></li>
</ul></li>
<li><a href="#수준별-커리큘럼" id="toc-수준별-커리큘럼">👥 수준별
커리큘럼</a>
<ul>
<li><a href="#초급-코스-10시간" id="toc-초급-코스-10시간">1. 초급 코스
(10시간)</a></li>
<li><a href="#중급-코스-15시간" id="toc-중급-코스-15시간">2. 중급 코스
(15시간)</a></li>
<li><a href="#고급-코스-20시간" id="toc-고급-코스-20시간">3. 고급 코스
(20시간)</a></li>
</ul></li>
<li><a href="#수업-운영-전략" id="toc-수업-운영-전략">📅 수업 운영
전략</a>
<ul>
<li><a href="#수업-구조-2시간-기준" id="toc-수업-구조-2시간-기준">수업
구조 (2시간 기준)</a></li>
<li><a href="#효과적인-티칭-팁" id="toc-효과적인-티칭-팁">효과적인 티칭
팁</a></li>
</ul></li>
<li><a href="#수업-준비물" id="toc-수업-준비물">🛠️ 수업 준비물</a>
<ul>
<li><a href="#하드웨어-학생-1인당" id="toc-하드웨어-학생-1인당">하드웨어
(학생 1인당)</a></li>
<li><a href="#소프트웨어-2" id="toc-소프트웨어-2">소프트웨어</a></li>
<li><a href="#기타-준비물" id="toc-기타-준비물">기타 준비물</a></li>
</ul></li>
<li><a href="#수업별-상세-계획" id="toc-수업별-상세-계획">📖 수업별 상세
계획</a>
<ul>
<li><a href="#week-1-헥사보드-시작하기" id="toc-week-1-헥사보드-시작하기">Week 1: 헥사보드 시작하기</a></li>
<li><a href="#week-2-센서-데이터-다루기" id="toc-week-2-센서-데이터-다루기">Week 2: 센서 데이터 다루기</a></li>
<li><a href="#week-3-mqtt로-연결하기" id="toc-week-3-mqtt로-연결하기">Week 3: MQTT로 연결하기</a></li>
<li><a href="#week-4-ai-통합하기" id="toc-week-4-ai-통합하기">Week 4: AI
통합하기</a></li>
<li><a href="#week-5-종합-프로젝트" id="toc-week-5-종합-프로젝트">Week
5: 종합 프로젝트</a></li>
</ul></li>
<li><a href="#평가-방법" id="toc-평가-방법">🎓 평가 방법</a>
<ul>
<li><a href="#평가-기준" id="toc-평가-기준">평가 기준</a></li>
<li><a href="#실습-과제-체크리스트" id="toc-실습-과제-체크리스트">실습
과제 체크리스트</a></li>
</ul></li>
<li><a href="#교육자를-위한-팁" id="toc-교육자를-위한-팁">💡 교육자를
위한 팁</a>
<ul>
<li><a href="#자주-발생하는-문제와-해결" id="toc-자주-발생하는-문제와-해결">자주 발생하는 문제와 해결</a></li>
<li><a href="#온라인-수업-팁" id="toc-온라인-수업-팁">온라인 수업
팁</a></li>
</ul></li>
<li><a href="#추가-학습-자료" id="toc-추가-학습-자료">📚 추가 학습
자료</a>
<ul>
<li><a href="#추천-순서" id="toc-추천-순서">추천 순서</a></li>
</ul></li>
<li><a href="#학습-성과-목표" id="toc-학습-성과-목표">🎯 학습 성과
목표</a>
<ul>
<li><a href="#코스-완료-후-학생은" id="toc-코스-완료-후-학생은">코스
완료 후 학생은…</a></li>
</ul></li>
<li><a href="#핵심-정리-15" id="toc-핵심-정리-15">📝 핵심 정리</a>
<ul>
<li><a href="#성공적인-aiot-교육의-원칙" id="toc-성공적인-aiot-교육의-원칙">성공적인 AIoT 교육의 원칙</a></li>
<li><a href="#교육자-마인드셋" id="toc-교육자-마인드셋">교육자
마인드셋</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-16" id="toc-자주-묻는-질문-16">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-비전공자도-가능한가요" id="toc-q1.-비전공자도-가능한가요">Q1. 비전공자도 가능한가요?</a></li>
<li><a href="#q2.-온라인으로도-진행-가능한가요" id="toc-q2.-온라인으로도-진행-가능한가요">Q2. 온라인으로도 진행
가능한가요?</a></li>
<li><a href="#q3.-몇-명이-적정한가요" id="toc-q3.-몇-명이-적정한가요">Q3. 몇 명이 적정한가요?</a></li>
</ul></li>
<li><a href="#다음-단계-17" id="toc-다음-단계-17">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-28.-미션-기반-실습-및-평가-설계" id="toc-chapter-28.-미션-기반-실습-및-평가-설계">Chapter 28. 미션 기반
실습 및 평가 설계</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-27" id="toc-이-챕터에서-배울-내용-27">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#학습-목표-27" id="toc-학습-목표-27">🎯 학습 목표</a>
<ul>
<li><a href="#미션-기반-학습이란" id="toc-미션-기반-학습이란">미션 기반
학습이란?</a></li>
</ul></li>
<li><a href="#레벨별-미션-설계" id="toc-레벨별-미션-설계">🎮 레벨별 미션
설계</a>
<ul>
<li><a href="#level-1-헥사보드-마스터-기초" id="toc-level-1-헥사보드-마스터-기초">Level 1: 헥사보드 마스터
(기초)</a></li>
<li><a href="#level-2-센서-전문가-중급" id="toc-level-2-센서-전문가-중급">Level 2: 센서 전문가 (중급)</a></li>
<li><a href="#level-3-iot-통신-마스터-고급" id="toc-level-3-iot-통신-마스터-고급">Level 3: IoT 통신 마스터
(고급)</a></li>
<li><a href="#level-4-ai-통합-전문가-심화" id="toc-level-4-ai-통합-전문가-심화">Level 4: AI 통합 전문가
(심화)</a></li>
</ul></li>
<li><a href="#평가-루브릭" id="toc-평가-루브릭">📊 평가 루브릭</a>
<ul>
<li><a href="#실습-미션-평가-기준" id="toc-실습-미션-평가-기준">실습
미션 평가 기준</a></li>
</ul></li>
<li><a href="#프로젝트-평가-기준" id="toc-프로젝트-평가-기준">🏆
프로젝트 평가 기준</a>
<ul>
<li><a href="#최종-프로젝트-루브릭-100점" id="toc-최종-프로젝트-루브릭-100점">최종 프로젝트 루브릭
(100점)</a></li>
</ul></li>
<li><a href="#도전-프로젝트-아이디어" id="toc-도전-프로젝트-아이디어">🎯
도전 프로젝트 아이디어</a>
<ul>
<li><a href="#테마별-프로젝트" id="toc-테마별-프로젝트">테마별
프로젝트</a></li>
</ul></li>
<li><a href="#실습-시트-템플릿" id="toc-실습-시트-템플릿">📝 실습 시트
템플릿</a>
<ul>
<li><a href="#미션-수행-기록지" id="toc-미션-수행-기록지">미션 수행
기록지</a></li>
</ul></li>
<li><a href="#교육자-가이드" id="toc-교육자-가이드">💡 교육자 가이드</a>
<ul>
<li><a href="#미션-운영-팁" id="toc-미션-운영-팁">미션 운영 팁</a></li>
<li><a href="#차별화-전략" id="toc-차별화-전략">차별화 전략</a></li>
</ul></li>
<li><a href="#자주-묻는-질문-17" id="toc-자주-묻는-질문-17">❓ 자주 묻는
질문</a>
<ul>
<li><a href="#q1.-미션을-못-완수하면-어떡하나요" id="toc-q1.-미션을-못-완수하면-어떡하나요">Q1. 미션을 못 완수하면
어떡하나요?</a></li>
<li><a href="#q2.-답을-복사하는-학생은" id="toc-q2.-답을-복사하는-학생은">Q2. 답을 복사하는 학생은?</a></li>
<li><a href="#q3.-평가-기준이-너무-엄격하지-않나요" id="toc-q3.-평가-기준이-너무-엄격하지-않나요">Q3. 평가 기준이 너무
엄격하지 않나요?</a></li>
</ul></li>
<li><a href="#다음-단계-18" id="toc-다음-단계-18">🚀 다음 단계</a></li>
</ul></li>
<li><a href="#chapter-29.-확장-아이디어-및-후속-프로젝트-방향" id="toc-chapter-29.-확장-아이디어-및-후속-프로젝트-방향">Chapter 29.
확장 아이디어 및 후속 프로젝트 방향</a>
<ul>
<li><a href="#이-챕터에서-배울-내용-28" id="toc-이-챕터에서-배울-내용-28">📚 이 챕터에서 배울 내용</a></li>
<li><a href="#확장의-방향" id="toc-확장의-방향">🎯 확장의 방향</a>
<ul>
<li><a href="#가지-확장-축" id="toc-가지-확장-축">3가지 확장 축</a></li>
</ul></li>
<li><a href="#하드웨어-확장" id="toc-하드웨어-확장">🔧 하드웨어 확장</a>
<ul>
<li><a href="#추가-가능한-센서" id="toc-추가-가능한-센서">추가 가능한
센서</a></li>
</ul></li>
<li><a href="#소프트웨어-확장" id="toc-소프트웨어-확장">💻 소프트웨어
확장</a>
<ul>
<li><a href="#고급-ai-기능" id="toc-고급-ai-기능">고급 AI 기능</a></li>
</ul></li>
<li><a href="#시스템-확장-1" id="toc-시스템-확장-1">🌐 시스템 확장</a>
<ul>
<li><a href="#멀티-보드-네트워크" id="toc-멀티-보드-네트워크">1. 멀티
보드 네트워크</a></li>
<li><a href="#클라우드-통합" id="toc-클라우드-통합">2. 클라우드
통합</a></li>
<li><a href="#데이터베이스-연동" id="toc-데이터베이스-연동">3.
데이터베이스 연동</a></li>
</ul></li>
<li><a href="#학습-경로-추천" id="toc-학습-경로-추천">🎓 학습 경로
추천</a>
<ul>
<li><a href="#초급-중급" id="toc-초급-중급">초급 → 중급</a></li>
<li><a href="#중급-고급" id="toc-중급-고급">중급 → 고급</a></li>
</ul></li>
<li><a href="#프로젝트-아이디어" id="toc-프로젝트-아이디어">🚀 프로젝트
아이디어</a>
<ul>
<li><a href="#레벨-1-개인-프로젝트" id="toc-레벨-1-개인-프로젝트">레벨
1: 개인 프로젝트</a></li>
<li><a href="#레벨-2-팀-프로젝트" id="toc-레벨-2-팀-프로젝트">레벨 2: 팀
프로젝트</a></li>
<li><a href="#레벨-3-공모전경진대회" id="toc-레벨-3-공모전경진대회">레벨
3: 공모전/경진대회</a></li>
</ul></li>
<li><a href="#학습-자료" id="toc-학습-자료">📚 학습 자료</a>
<ul>
<li><a href="#추천-온라인-코스" id="toc-추천-온라인-코스">추천 온라인
코스</a></li>
<li><a href="#추천-도서" id="toc-추천-도서">추천 도서</a></li>
<li><a href="#커뮤니티" id="toc-커뮤니티">커뮤니티</a></li>
</ul></li>
<li><a href="#유용한-도구" id="toc-유용한-도구">🛠️ 유용한 도구</a>
<ul>
<li><a href="#개발-도구" id="toc-개발-도구">개발 도구</a></li>
<li><a href="#모니터링-도구" id="toc-모니터링-도구">모니터링
도구</a></li>
</ul></li>
<li><a href="#공모전-경진대회" id="toc-공모전-경진대회">🏆 공모전 &amp;
경진대회</a>
<ul>
<li><a href="#국내-대회" id="toc-국내-대회">국내 대회</a></li>
<li><a href="#국제-대회" id="toc-국제-대회">국제 대회</a></li>
</ul></li>
<li><a href="#창업-아이디어" id="toc-창업-아이디어">💡 창업 아이디어</a>
<ul>
<li><a href="#b2c-소비자" id="toc-b2c-소비자">B2C (소비자)</a></li>
<li><a href="#b2b-기업" id="toc-b2b-기업">B2B (기업)</a></li>
</ul></li>
<li><a href="#핵심-정리-16" id="toc-핵심-정리-16">📝 핵심 정리</a>
<ul>
<li><a href="#확장의-3단계" id="toc-확장의-3단계">확장의 3단계</a></li>
<li><a href="#학습-계속하기" id="toc-학습-계속하기">학습
계속하기</a></li>
</ul></li>
<li><a href="#마무리" id="toc-마무리">🎉 마무리</a>
<ul>
<li><a href="#여러분은-이제" id="toc-여러분은-이제">여러분은
이제…</a></li>
</ul></li>
<li><a href="#당부의-말" id="toc-당부의-말">🌟 당부의 말</a></li>
</ul></li>
<li><a href="#맺음말" id="toc-맺음말">🎉 맺음말</a>
<ul>
<li><a href="#여러분-축하합니다" id="toc-여러분-축하합니다">여러분,
축하합니다!</a>
<ul>
<li><a href="#할-수-있게-된-것" id="toc-할-수-있게-된-것">할 수 있게 된
것</a></li>
<li><a href="#앞으로-할-수-있는-것" id="toc-앞으로-할-수-있는-것">앞으로
할 수 있는 것</a></li>
</ul></li>
<li><a href="#당부의-말-1" id="toc-당부의-말-1">당부의 말</a></li>
<li><a href="#다음-단계-19" id="toc-다음-단계-19">다음 단계</a>
<ul>
<li><a href="#계속-학습하기" id="toc-계속-학습하기">계속
학습하기</a></li>
<li><a href="#추천-프로젝트-아이디어" id="toc-추천-프로젝트-아이디어">추천 프로젝트 아이디어</a></li>
</ul></li>
<li><a href="#감사의-글" id="toc-감사의-글">감사의 글</a></li>
<li><a href="#계속-연결되어-있기" id="toc-계속-연결되어-있기">계속
연결되어 있기</a></li>
<li><a href="#마지막-메시지" id="toc-마지막-메시지">마지막
메시지</a></li>
</ul></li>
</ul>
</nav>
<h1 id="헥사보드-ai-센서랩">📘 헥사보드 AI 센서랩</h1>
<h2 id="openai와-함께하는-스마트-환경-실험실">OpenAI와 함께하는 스마트
환경 실험실</h2>
<hr />
<blockquote>
<p>헥사보드 버튼 · 네오픽셀 · 온습도 · 조도 센서 기반<br />
MQTT + Python + Web으로 구현하는 AI 제어 IoT 시스템</p>
</blockquote>
<p><strong>저자</strong>: MakeItNow Team<br />
<strong>버전</strong>: v1.0<br />
<strong>발행일</strong>: 2025년 1월<br />
<strong>전체 분량</strong>: 29개 챕터 / 약 20시간 학습</p>
<hr />
<h2 id="이-책에-대하여">📚 이 책에 대하여</h2>
<p><strong>헥사보드 AI 센서랩</strong>은 ESP32 기반 헥사보드를 활용하여
AIoT(AI + IoT) 시스템을 구축하는 방법을 단계별로 학습하는 실습 중심
전자책입니다.</p>
<h3 id="이-책의-특징">이 책의 특징</h3>
<ul>
<li>🎯 <strong>실무 중심</strong>: 실제 동작하는 AIoT 시스템 구축</li>
<li>🤖 <strong>AI 통합</strong>: OpenAI GPT를 활용한 자연어 제어</li>
<li>📊 <strong>전체 파이프라인</strong>: 센서 → MQTT → AI → 제어의
완전한 데이터 흐름</li>
<li>🌐 <strong>웹 확장</strong>: 브라우저 기반 모니터링 및 제어
대시보드</li>
<li>📚 <strong>교육 친화적</strong>: 20시간 완성, 초보자부터
고급까지</li>
</ul>
<h3 id="대상-독자">대상 독자</h3>
<ul>
<li>IoT 시스템에 관심 있는 초급~중급 개발자</li>
<li>교육용 AIoT 프로젝트를 찾는 교육자</li>
<li>스마트홈, 환경 모니터링에 관심 있는 메이커</li>
<li>Python과 AI를 실제 하드웨어와 연동하고 싶은 분</li>
</ul>
<h3 id="필요한-준비물">필요한 준비물</h3>
<p><strong>하드웨어</strong>:</p>
<ul>
<li>헥사보드 (ESP32 기반) × 1</li>
<li>DHT11 온습도 센서 모듈 × 1</li>
<li>조도 센서 모듈 × 1</li>
<li>3핀 케이블 × 2</li>
<li>USB 케이블 × 1</li>
</ul>
<p><strong>소프트웨어</strong>:</p>
<ul>
<li>MicroPython 1.24</li>
<li>Python 3.10+</li>
<li>Thonny IDE</li>
<li>웹 브라우저</li>
</ul>
<p><strong>클라우드/API</strong>:</p>
<ul>
<li>HiveMQ Cloud (무료)</li>
<li>OpenAI API (선택)</li>
</ul>
<hr />
<h2 id="목차">📑 목차</h2>
<h3 id="part-1.-ai-센서랩과-헥사보드-이해하기">PART 1. AI 센서랩과
헥사보드 이해하기</h3>
<ul>
<li><strong>Chapter 1.</strong> AI 센서랩이란 무엇인가</li>
<li><strong>Chapter 2.</strong> 헥사보드 구조 한눈에 보기</li>
<li><strong>Chapter 3.</strong> 개발 환경 준비하기</li>
</ul>
<h3 id="part-2.-헥사보드-기본-제어-버튼과-네오픽셀">PART 2. 헥사보드
기본 제어 – 버튼과 네오픽셀</h3>
<ul>
<li><strong>Chapter 4.</strong> 디지털 입력의 기본 – 버튼 2개
다루기</li>
<li><strong>Chapter 5.</strong> 네오픽셀 기초 – 한 칸에서 5x5까지</li>
<li><strong>Chapter 6.</strong> 버튼 + 네오픽셀로 만드는 상태 머신</li>
</ul>
<h3 id="part-3.-온습도-센서-조도-센서-연결하기">PART 3. 온습도 센서
&amp; 조도 센서 연결하기</h3>
<ul>
<li><strong>Chapter 7.</strong> 온습도 센서 이해와 연결</li>
<li><strong>Chapter 8.</strong> 조도 센서 이해와 연결</li>
<li><strong>Chapter 9.</strong> 센서 데이터 정리 및 단위 변환</li>
<li><strong>Chapter 10.</strong> 센서 데이터를 시각적으로 표현하기</li>
</ul>
<h3 id="part-4.-mqtt를-통한-센서-데이터-전송">PART 4. MQTT를 통한 센서
데이터 전송</h3>
<ul>
<li><strong>Chapter 11.</strong> MQTT 개념과 데이터 흐름 이해</li>
<li><strong>Chapter 12.</strong> MQTT 브로커 준비 (HiveMQ)</li>
<li><strong>Chapter 13.</strong> 헥사보드에서 MQTT Publish / Subscribe
구현</li>
<li><strong>Chapter 14.</strong> 멀티 헥사보드 확장 실험</li>
</ul>
<h3 id="part-5.-python-openai로-ai-명령-엔진-만들기">PART 5. Python +
OpenAI로 AI 명령 엔진 만들기</h3>
<ul>
<li><strong>Chapter 15.</strong> Python에서 MQTT 데이터 수신</li>
<li><strong>Chapter 16.</strong> 센서 데이터 요약과 상태 해석</li>
<li><strong>Chapter 17.</strong> OpenAI API 연동 및 프롬프트 설계</li>
<li><strong>Chapter 18.</strong> AI 응답을 제어 명령으로 변환하기</li>
<li><strong>Chapter 19.</strong> 헥사보드로 제어 명령 되돌려 보내기</li>
</ul>
<h3 id="part-6.-종합-프로젝트-ai-환경-무드-컨트롤러">PART 6. 종합
프로젝트 – AI 환경 무드 컨트롤러</h3>
<ul>
<li><strong>Chapter 20.</strong> 프로젝트 개요</li>
<li><strong>Chapter 21.</strong> 시스템 아키텍처 설계</li>
<li><strong>Chapter 22.</strong> 단계별 구현 실습</li>
<li><strong>Chapter 23.</strong> AI 실험과 튜닝</li>
</ul>
<h3 id="part-7.-웹-기반-ai-제어-대시보드">PART 7. 웹 기반 AI 제어
대시보드</h3>
<ul>
<li><strong>Chapter 24.</strong> 웹에서 센서 상태 모니터링하기</li>
<li><strong>Chapter 25.</strong> 웹에서 헥사보드 수동 제어</li>
<li><strong>Chapter 26.</strong> 웹에서 자연어 기반 AI 제어</li>
</ul>
<h3 id="part-8.-수업-설계와-확장-아이디어">PART 8. 수업 설계와 확장
아이디어</h3>
<ul>
<li><strong>Chapter 27.</strong> 교육 커리큘럼 설계 가이드</li>
<li><strong>Chapter 28.</strong> 미션 기반 실습 및 평가 설계</li>
<li><strong>Chapter 29.</strong> 확장 아이디어 및 후속 프로젝트
방향</li>
</ul>
<hr />
<h2 id="학습-가이드">📖 학습 가이드</h2>
<h3 id="추천-학습-순서">추천 학습 순서</h3>
<ol type="1">
<li><strong>PART 1-2 (4시간)</strong>: 하드웨어 이해 및 기본 제어</li>
<li><strong>PART 3 (3시간)</strong>: 외부 센서 연결 및 데이터 수집</li>
<li><strong>PART 4 (3.5시간)</strong>: MQTT 통신 구조 이해</li>
<li><strong>PART 5 (4시간)</strong>: Python 서버 및 OpenAI 연동</li>
<li><strong>PART 6 (3.5시간)</strong>: 종합 프로젝트 실습</li>
<li><strong>PART 7 (1.5시간)</strong>: 웹 인터페이스 구축</li>
<li><strong>PART 8 (0.5시간)</strong>: 교육 활용 및 확장</li>
</ol>
<p><strong>총 예상 시간</strong>: 20시간</p>
<h3 id="난이도">난이도</h3>
<ul>
<li>⭐ = 초급</li>
<li>⭐⭐ = 중급</li>
<li>⭐⭐⭐ = 고급</li>
</ul>
<hr />
<h2 id="빠른-시작">🚀 빠른 시작</h2>
<h3 id="하드웨어-준비">1. 하드웨어 준비</h3>
<ul>
<li>헥사보드 연결 (USB 케이블)</li>
<li>MicroPython 펌웨어 설치</li>
<li>Thonny IDE 설치</li>
</ul>
<h3 id="첫-번째-프로그램">2. 첫 번째 프로그램</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LED 깜빡이기</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># 빨간색</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>np.write()</span></code></pre></div>
<h3 id="챕터별-학습">3. 챕터별 학습</h3>
<ul>
<li>각 챕터를 순서대로 따라하기</li>
<li>예제 코드 직접 실행해보기</li>
<li>도전 과제로 실력 향상</li>
</ul>
<hr />
<h2 id="학습-팁">💡 학습 팁</h2>
<h3 id="성공적인-학습을-위해">성공적인 학습을 위해</h3>
<ol type="1">
<li><strong>실습 중심으로</strong>: 코드를 직접 작성하고 실행하세요</li>
<li><strong>오류를 두려워하지 마세요</strong>: 디버깅 과정에서 더 많이
배웁니다</li>
<li><strong>작은 성공 경험 쌓기</strong>: LED 하나 켜는 것부터
시작하세요</li>
<li><strong>커뮤니티 활용</strong>: 막힐 때 질문하고 공유하세요</li>
<li><strong>프로젝트로 완성</strong>: 배운 것을 응용한 나만의 프로젝트
만들기</li>
</ol>
<hr />
<h2 id="주의사항">⚠️ 주의사항</h2>
<h3 id="안전하게-사용하기">안전하게 사용하기</h3>
<ul>
<li>USB 케이블을 갑자기 뽑지 마세요 (데이터 손실 가능)</li>
<li>센서와 보드를 정전기로부터 보호하세요</li>
<li>전원 극성(+/-)을 확인하세요</li>
<li>높은 전압을 직접 연결하지 마세요</li>
</ul>
<h3 id="api-키-보안">API 키 보안</h3>
<ul>
<li>OpenAI API 키는 절대 공개 저장소에 올리지 마세요</li>
<li><code>.env</code> 파일을 사용하고 <code>.gitignore</code>에
추가하세요</li>
<li>정기적으로 키를 변경하세요</li>
</ul>
<hr />
<h2 id="지원-및-문의">📞 지원 및 문의</h2>
<h3 id="문제가-발생하면">문제가 발생하면</h3>
<ol type="1">
<li><strong>공식 문서 확인</strong>: MicroPython, OpenAI, MQTT 공식
문서</li>
<li><strong>예제 코드 다시 확인</strong>: GitHub 저장소의 예제 코드</li>
<li><strong>커뮤니티 질문</strong>: GitHub Issues, 포럼</li>
<li><strong>이메일 문의</strong>: support@example.com</li>
</ol>
<hr />
<h2 id="라이선스">📄 라이선스</h2>
<ul>
<li><strong>예제 코드</strong>: MIT License (자유롭게 사용 가능)</li>
<li><strong>전자책 콘텐츠</strong>: CC BY-NC-SA 4.0 (교육 목적 자유
사용, 상업적 출판 제한)</li>
</ul>
<hr />
<h2 id="이제-시작합니다">🎓 이제 시작합니다!</h2>
<blockquote>
<p>“작은 LED 하나를 켜는 것부터 시작하여<br />
완전한 AIoT 시스템을 만들어보세요.<br />
계속 도전하고, 실패하고, 배우세요.<br />
가장 중요한 것은 멈추지 않는 것입니다!”</p>
</blockquote>
<p><strong>즐거운 학습 되세요! 🚀</strong></p>
<hr />
<div style="page-break-after: always;">

</div>
<h1 id="chapter-1.-ai-센서랩이란-무엇인가">Chapter 1. AI 센서랩이란
무엇인가</h1>
<blockquote>
<p><strong>PART 1</strong>: AI 센서랩과 헥사보드 이해하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>AI 센서랩이 무엇인지 이해할 수
있다</label></li>
<li><label><input type="checkbox"></input>IoT와 AIoT의 차이를 알 수
있다</label></li>
<li><label><input type="checkbox"></input>이 책에서 만들 프로젝트를 이해할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 20분</p>
<hr />
<h2 id="학습-목표">🎯 학습 목표</h2>
<h3 id="핵심-개념">핵심 개념</h3>
<ul>
<li><strong>IoT</strong>: 사물인터넷, 센서와 네트워크로 연결된
장치들</li>
<li><strong>AI</strong>: 인공지능, 데이터를 학습하고 판단하는 기술</li>
<li><strong>AIoT</strong>: AI + IoT, 똑똑한 사물인터넷</li>
</ul>
<hr />
<h2 id="ai-센서랩이란">📖 AI 센서랩이란?</h2>
<h3 id="iot에서-aiot로">IoT에서 AIoT로</h3>
<p><strong>IoT (사물인터넷)</strong>는 센서와 네트워크로 주변 환경을
감지하고 제어합니다.</p>
<pre><code>센서 → 데이터 수집 → 서버 전송 → 규칙 기반 제어</code></pre>
<p>예시: “온도가 30도 이상이면 에어컨 켜기”</p>
<p><strong>문제점</strong>:</p>
<ul>
<li>모든 상황을 미리 규칙으로 만들어야 함</li>
<li>복잡한 상황 대응이 어려움</li>
<li>사용자의 자연스러운 명령 불가</li>
</ul>
<p><strong>AIoT (AI + IoT)</strong>는 여기에 인공지능을 더합니다!</p>
<pre><code>센서 → 데이터 수집 → AI 분석 → 똑똑한 제어</code></pre>
<p>예시: “너무 덥네요” → AI가 상황 파악 → 적절한 온도로 조절</p>
<p><strong>장점</strong>:</p>
<ul>
<li>✅ 자연어로 명령 가능</li>
<li>✅ 상황에 맞게 알아서 판단</li>
<li>✅ 사용자 패턴 학습 가능</li>
</ul>
<h3 id="ai-센서랩이란-1">AI 센서랩이란?</h3>
<p><strong>AI 센서랩</strong>은 헥사보드와 센서를 사용해서 AIoT 시스템을
직접 만들어보는 실험실입니다.</p>
<p>우리가 만들 시스템:</p>
<pre><code>헥사보드 (센서 + LED)
    ↓
MQTT (데이터 전송)
    ↓
Python AI 서버 (OpenAI)
    ↓
웹 대시보드 (모니터링 + 제어)</code></pre>
<hr />
<h2 id="무엇을-만들게-되나요">🚀 무엇을 만들게 되나요?</h2>
<h3 id="최종-프로젝트-ai-환경-무드-컨트롤러">최종 프로젝트: AI 환경 무드
컨트롤러</h3>
<p><strong>기능</strong>:</p>
<ol type="1">
<li><strong>센서로 환경 감지</strong>
<ul>
<li>온도, 습도, 밝기를 실시간 측정</li>
</ul></li>
<li><strong>AI가 상황 판단</strong>
<ul>
<li>“지금 온도가 높고 습도가 낮네요”</li>
<li>OpenAI가 데이터를 분석</li>
</ul></li>
<li><strong>자동 또는 음성 제어</strong>
<ul>
<li>“시원하게 해줘” → AI가 이해하고 LED 제어</li>
<li>버튼으로도 제어 가능</li>
</ul></li>
<li><strong>웹에서 모니터링</strong>
<ul>
<li>실시간 센서 값 확인</li>
<li>그래프로 변화 추이 확인</li>
</ul></li>
</ol>
<h3 id="단계별-학습-과정">단계별 학습 과정</h3>
<p><strong>PART 1-2</strong>: 헥사보드 기본 (버튼, LED)</p>
<pre><code>버튼 누르기 → LED 켜기</code></pre>
<p><strong>PART 3</strong>: 센서 연결</p>
<pre><code>온도 센서 → 데이터 읽기 → 화면 출력</code></pre>
<p><strong>PART 4</strong>: MQTT 통신</p>
<pre><code>헥사보드 → MQTT → 서버</code></pre>
<p><strong>PART 5</strong>: AI 통합</p>
<pre><code>센서 데이터 → OpenAI → 제어 명령</code></pre>
<p><strong>PART 6-7</strong>: 종합 프로젝트 + 웹</p>
<pre><code>전체 시스템 완성!</code></pre>
<hr />
<h2 id="이-책의-특징-1">🎓 이 책의 특징</h2>
<h3 id="초보자-친화적">1. 초보자 친화적</h3>
<ul>
<li>어려운 용어는 쉽게 설명</li>
<li>모든 코드는 복사해서 바로 실행 가능</li>
<li>단계별로 천천히 진행</li>
</ul>
<h3 id="실습-중심">2. 실습 중심</h3>
<ul>
<li>이론은 최소한으로</li>
<li>직접 해보면서 배우기</li>
<li>바로 결과 확인</li>
</ul>
<h3 id="완성된-프로젝트">3. 완성된 프로젝트</h3>
<ul>
<li>책 한 권으로 실제 동작하는 AIoT 시스템 완성</li>
<li>포트폴리오로 활용 가능</li>
<li>취업이나 프로젝트에 응용 가능</li>
</ul>
<hr />
<h2 id="준비물">📋 준비물</h2>
<h3 id="필수-하드웨어">필수 하드웨어</h3>
<ul>
<li><strong>헥사보드</strong> × 1
<ul>
<li>ESP32 기반</li>
<li>5×5 네오픽셀 LED</li>
<li>버튼 2개 내장</li>
</ul></li>
<li><strong>온습도 센서</strong> (DHT11 또는 DHT22) × 1</li>
<li><strong>조도 센서</strong> (포토레지스터) × 1</li>
<li><strong>USB 케이블</strong> × 1</li>
<li><strong>점퍼 케이블</strong> 약간</li>
</ul>
<h3 id="필수-소프트웨어">필수 소프트웨어</h3>
<ul>
<li><strong>Thonny IDE</strong> (MicroPython 개발)</li>
<li><strong>Python 3.10+</strong> (AI 서버)</li>
<li><strong>OpenAI API 키</strong> (무료 체험 가능)</li>
<li><strong>웹 브라우저</strong> (Chrome 권장)</li>
</ul>
<h3 id="선택-사항">선택 사항</h3>
<ul>
<li>MQTT 브로커 계정 (HiveMQ 무료 사용)</li>
</ul>
<blockquote>
<p>💡 <strong>팁</strong>: 모든 소프트웨어는 무료이거나 무료 체험이
가능합니다!</p>
</blockquote>
<hr />
<h2 id="학습-로드맵">🗺️ 학습 로드맵</h2>
<pre><code>PART 1: 이해하기 (1.5시간)
  └─ 헥사보드와 개념 이해

PART 2: 기본 제어 (2.5시간)
  └─ 버튼과 LED 제어

PART 3: 센서 연결 (3시간)
  └─ 온습도, 조도 센서

PART 4: 통신 (3.5시간)
  └─ MQTT로 데이터 주고받기

PART 5: AI 통합 (4시간)
  └─ OpenAI로 똑똑하게

PART 6-7: 프로젝트 (5시간)
  └─ 전체 시스템 + 웹

PART 8: 확장 (0.5시간)
  └─ 더 나아가기

총 20시간 = 완성된 AIoT 시스템!</code></pre>
<hr />
<h2 id="핵심-요약">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것">오늘 배운 것</h3>
<ol type="1">
<li><strong>IoT</strong>: 센서와 네트워크로 연결된 장치</li>
<li><strong>AIoT</strong>: IoT에 인공지능을 더해 똑똑하게</li>
<li><strong>AI 센서랩</strong>: 헥사보드로 AIoT를 직접 만들어보는
과정</li>
</ol>
<h3 id="우리가-만들-것">우리가 만들 것</h3>
<pre><code>센서 → MQTT → AI → 웹 대시보드</code></pre>
<p>자연어로 명령하고, AI가 판단하고, 자동으로 제어하는 똑똑한 환경
컨트롤러!</p>
<hr />
<h2 id="자주-묻는-질문">🤔 자주 묻는 질문</h2>
<p><strong>Q1: 프로그래밍을 처음인데 따라갈 수 있나요?</strong><br />
A: 네! 모든 코드를 복사해서 실행할 수 있습니다. 단계별로 천천히
설명합니다.</p>
<p><strong>Q2: 헥사보드가 꼭 필요한가요?</strong><br />
A: 네, 이 책은 헥사보드 전용입니다. 하지만 다른 ESP32 보드로 응용
가능합니다.</p>
<p><strong>Q3: OpenAI API 비용이 많이 드나요?</strong><br />
A: 실습 수준에서는 거의 무료입니다. 무료 크레딧으로 충분히
가능합니다.</p>
<p><strong>Q4: 완성된 프로젝트를 실제로 사용할 수 있나요?</strong><br />
A: 네! 방이나 사무실에서 실제로 사용 가능합니다. 확장도 가능합니다.</p>
<p><strong>Q5: 책을 끝까지 완료하면 무엇을 할 수 있나요?</strong><br />
A:</p>
<ul>
<li>AIoT 시스템을 처음부터 설계하고 구현</li>
<li>센서 데이터를 AI로 분석하고 제어</li>
<li>웹 기반 IoT 대시보드 제작</li>
<li>포트폴리오용 프로젝트 완성</li>
</ul>
<hr />
<h2 id="준비되셨나요">🚀 준비되셨나요?</h2>
<p>이제 AIoT의 세계로 들어갈 준비가 되었습니다!</p>
<p>다음 챕터에서는 우리의 파트너 <strong>헥사보드</strong>를 자세히
알아보겠습니다.</p>
<p><strong>다음 챕터</strong>: Chapter 2 - 헥사보드 구조 한눈에 보기</p>
<hr />
<h2 id="학습-체크">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>AI 센서랩이 무엇인지
이해했나요?</label></li>
<li><label><input type="checkbox"></input>IoT와 AIoT의 차이를
알겠나요?</label></li>
<li><label><input type="checkbox"></input>준비물을 확인했나요?</label></li>
<li><label><input type="checkbox"></input>20시간 학습 계획을
세웠나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 이 책은 순서대로 진행하는 것이 좋습니다. 각
챕터가 이전 챕터를 기반으로 합니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-2.-헥사보드-구조-한눈에-보기">Chapter 2. 헥사보드 구조
한눈에 보기</h1>
<blockquote>
<p><strong>PART 1</strong>: AI 센서랩과 헥사보드 이해하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-1">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>헥사보드의 주요 부품을 알 수
있다</label></li>
<li><label><input type="checkbox"></input>각 부품의 역할을 이해할 수
있다</label></li>
<li><label><input type="checkbox"></input>GPIO 핀 번호를 확인할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 20분</p>
<hr />
<h2 id="학습-목표-1">🎯 학습 목표</h2>
<h3 id="핵심-개념-1">핵심 개념</h3>
<ul>
<li><strong>헥사보드</strong>: ESP32 기반의 IoT 학습용 보드</li>
<li><strong>GPIO</strong>: 입출력을 위한 핀 (센서, LED 연결)</li>
<li><strong>네오픽셀</strong>: 개별 제어 가능한 RGB LED</li>
</ul>
<hr />
<h2 id="헥사보드란">📖 헥사보드란?</h2>
<h3 id="esp32-기반-학습-보드">ESP32 기반 학습 보드</h3>
<p>헥사보드는 <strong>ESP32</strong> 마이크로컨트롤러를 기반으로 만든
IoT 학습 보드입니다.</p>
<p><strong>ESP32의 특징</strong>:</p>
<ul>
<li>Wi-Fi 내장 (무선 통신 가능)</li>
<li>블루투스 지원</li>
<li>저전력 설계</li>
<li>많은 GPIO 핀 (센서 연결 가능)</li>
<li>MicroPython 지원</li>
</ul>
<blockquote>
<p>💡 <strong>팁</strong>: ESP32는 아두이노보다 강력하고,
라즈베리파이보다 간단합니다!</p>
</blockquote>
<hr />
<h2 id="헥사보드-주요-부품">🔧 헥사보드 주요 부품</h2>
<h3 id="네오픽셀-led-55">1. 네오픽셀 LED (5×5)</h3>
<p><strong>위치</strong>: 보드 중앙<br />
<strong>개수</strong>: 25개 (5행 × 5열)<br />
<strong>GPIO</strong>: 23번</p>
<p><strong>할 수 있는 것</strong>:</p>
<ul>
<li>각 LED의 색상 개별 제어</li>
<li>1,600만 가지 색상 표현</li>
<li>밝기 조절</li>
<li>애니메이션 효과</li>
</ul>
<p><strong>용도</strong>:</p>
<ul>
<li>센서 데이터 시각화 (온도 높으면 빨간색)</li>
<li>상태 표시 (연결 중, 오류 등)</li>
<li>게임이나 패턴 표현</li>
</ul>
<h3 id="버튼-2개">2. 버튼 2개</h3>
<p><strong>버튼 A</strong>:</p>
<ul>
<li>GPIO: 35번</li>
<li>Pull-down 방식 (누름 = 1)</li>
</ul>
<p><strong>버튼 B</strong>:</p>
<ul>
<li>GPIO: 34번</li>
<li>Pull-down 방식 (누름 = 1)</li>
</ul>
<p><strong>할 수 있는 것</strong>:</p>
<ul>
<li>모드 전환</li>
<li>카운터</li>
<li>게임 컨트롤</li>
<li>수동 제어</li>
</ul>
<h3 id="자이로-센서-i2c">3. 자이로 센서 (I2C)</h3>
<p><strong>연결</strong>: I2C (SDA=21, SCL=22)<br />
<strong>기능</strong>: 기울기, 회전, 흔들림 감지</p>
<blockquote>
<p>📌 <strong>참고</strong>: 이 책에서는 부록에서만 다룹니다</p>
</blockquote>
<h3 id="컬러-센서-i2c">4. 컬러 센서 (I2C)</h3>
<p><strong>연결</strong>: I2C (SDA=21, SCL=22)<br />
<strong>기능</strong>: 색상 인식 (RGB 값)</p>
<blockquote>
<p>📌 <strong>참고</strong>: 이 책에서는 부록에서만 다룹니다</p>
</blockquote>
<h3 id="외부-연결-핀">5. 외부 연결 핀</h3>
<p><strong>PIN1</strong> (GPIO 32):</p>
<ul>
<li>온습도 센서 연결 예정</li>
</ul>
<p><strong>PIN2</strong> (GPIO 33):</p>
<ul>
<li>조도 센서 연결 예정</li>
</ul>
<p><strong>전원 핀</strong>:</p>
<ul>
<li>3.3V: 센서 전원 공급</li>
<li>GND: 접지 (공통 그라운드)</li>
</ul>
<hr />
<h2 id="헥사보드-핀맵">📌 헥사보드 핀맵</h2>
<h3 id="주요-gpio-핀-정리">주요 GPIO 핀 정리</h3>
<pre><code>┌─────────────────────────────┐
│      헥사보드 핀맵          │
├─────────────────────────────┤
│ 버튼 A        : GPIO 35     │
│ 버튼 B        : GPIO 34     │
│ 네오픽셀      : GPIO 23     │
├─────────────────────────────┤
│ I2C SDA       : GPIO 21     │
│ I2C SCL       : GPIO 22     │
│ (자이로/컬러센서 공용)      │
├─────────────────────────────┤
│ PIN1 (확장)   : GPIO 32     │
│ PIN2 (확장)   : GPIO 33     │
├─────────────────────────────┤
│ 전원                         │
│ - 3.3V: 센서 전원           │
│ - GND: 접지                 │
└─────────────────────────────┘</code></pre>
<h3 id="중요-사항">중요 사항</h3>
<p><strong>버튼은 Pull-down 방식</strong>:</p>
<ul>
<li>안 누름: 0 (LOW)</li>
<li>누름: 1 (HIGH)</li>
</ul>
<p><strong>네오픽셀은 체인 연결</strong>:</p>
<ul>
<li>25개가 순서대로 연결</li>
<li>번호: 0번부터 24번까지</li>
</ul>
<p><strong>I2C는 공유</strong>:</p>
<ul>
<li>여러 센서가 같은 선 사용</li>
<li>주소로 구분</li>
</ul>
<hr />
<h2 id="헥사보드-연결하기">💻 헥사보드 연결하기</h2>
<h3 id="usb-연결">USB 연결</h3>
<ol type="1">
<li><strong>USB 케이블 준비</strong>
<ul>
<li>Micro USB 또는 USB-C (보드에 따라 다름)</li>
</ul></li>
<li><strong>컴퓨터에 연결</strong>
<ul>
<li>헥사보드의 USB 포트에 연결</li>
<li>PC/Mac USB 포트에 연결</li>
</ul></li>
<li><strong>전원 LED 확인</strong>
<ul>
<li>빨간색 LED가 켜지면 정상</li>
</ul></li>
</ol>
<h3 id="포트-확인">포트 확인</h3>
<p><strong>Windows</strong>:</p>
<pre><code>장치 관리자 → 포트 (COM &amp; LPT)
예: COM3, COM4</code></pre>
<p><strong>Mac</strong>:</p>
<pre><code>터미널에서:
ls /dev/tty.*
예: /dev/tty.usbserial-0001</code></pre>
<p><strong>Linux</strong>:</p>
<pre><code>터미널에서:
ls /dev/ttyUSB*
예: /dev/ttyUSB0</code></pre>
<hr />
<h2 id="핵심-요약-1">🎓 핵심 요약</h2>
<h3 id="헥사보드의-구성">헥사보드의 구성</h3>
<ol type="1">
<li><strong>ESP32</strong>: Wi-Fi 내장 마이크로컨트롤러</li>
<li><strong>네오픽셀</strong>: 5×5 RGB LED (GPIO 23)</li>
<li><strong>버튼</strong>: A(GPIO 35), B(GPIO 34)</li>
<li><strong>확장 핀</strong>: PIN1(GPIO 32), PIN2(GPIO 33)</li>
<li><strong>I2C 센서</strong>: 자이로, 컬러 (부록)</li>
</ol>
<h3 id="기억할-핀-번호">기억할 핀 번호</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 자주 사용할 핀</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>BUTTON_A <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>BUTTON_B <span class="op">=</span> <span class="dv">34</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>NEOPIXEL <span class="op">=</span> <span class="dv">23</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>PIN1 <span class="op">=</span> <span class="dv">32</span>  <span class="co"># 온습도 센서</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>PIN2 <span class="op">=</span> <span class="dv">33</span>  <span class="co"># 조도 센서</span></span></code></pre></div>
<hr />
<h2 id="실습-헥사보드-확인하기">🔍 실습: 헥사보드 확인하기</h2>
<h3 id="준비물-1">준비물</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블</label></li>
<li><label><input type="checkbox" checked></input>컴퓨터</label></li>
</ul>
<h3 id="확인-항목">확인 항목</h3>
<ol type="1">
<li><p><strong>외관 확인</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>네오픽셀 25개가
보이나요?</label></li>
<li><label><input type="checkbox"></input>버튼 2개가 보이나요?</label></li>
<li><label><input type="checkbox"></input>PIN1, PIN2 라벨이
있나요?</label></li>
</ul></li>
<li><p><strong>연결 확인</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>USB 케이블 연결</label></li>
<li><label><input type="checkbox"></input>전원 LED가 켜지나요?</label></li>
<li><label><input type="checkbox"></input>포트가 인식되나요?</label></li>
</ul></li>
<li><p><strong>버튼 테스트</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>버튼 A를 누르면 클릭감이
있나요?</label></li>
<li><label><input type="checkbox"></input>버튼 B를 누르면 클릭감이
있나요?</label></li>
</ul></li>
</ol>
<hr />
<h2 id="자주-묻는-질문-1">🤔 자주 묻는 질문</h2>
<p><strong>Q1: 헥사보드와 아두이노의 차이는?</strong><br />
A: 헥사보드는 ESP32 기반으로 Wi-Fi가 내장되어 있고, 네오픽셀과 센서가
이미 장착되어 있어 편리합니다.</p>
<p><strong>Q2: 네오픽셀이 왜 5×5인가요?</strong><br />
A: 시각적으로 데이터를 표현하기 좋은 크기입니다. 게임이나 애니메이션도
가능합니다.</p>
<p><strong>Q3: 버튼이 2개만 있는데 부족하지 않나요?</strong><br />
A: 2개로도 많은 것을 할 수 있습니다! 동시 입력, 길게 누르기 등 조합이
가능합니다.</p>
<p><strong>Q4: I2C가 뭔가요?</strong><br />
A: 센서와 통신하는 방식입니다. 2개의 선(SDA, SCL)으로 여러 센서를 연결할
수 있습니다.</p>
<p><strong>Q5: GPIO 번호는 외워야 하나요?</strong><br />
A: 자주 쓰는 것만 기억하면 됩니다. 코드에 상수로 정의해서
사용합니다.</p>
<hr />
<h2 id="헥사보드로-할-수-있는-것">🎨 헥사보드로 할 수 있는 것</h2>
<h3 id="기본-프로젝트">기본 프로젝트</h3>
<ul>
<li>LED 패턴 만들기</li>
<li>버튼 게임</li>
<li>센서 데이터 표시</li>
</ul>
<h3 id="중급-프로젝트">중급 프로젝트</h3>
<ul>
<li>Wi-Fi로 데이터 전송</li>
<li>웹에서 제어</li>
<li>MQTT 통신</li>
</ul>
<h3 id="고급-프로젝트">고급 프로젝트</h3>
<ul>
<li>AI 기반 제어</li>
<li>여러 헥사보드 연동</li>
<li>클라우드 연동</li>
</ul>
<blockquote>
<p>💡 <strong>팁</strong>: 이 책을 다 보면 고급 프로젝트까지
가능합니다!</p>
</blockquote>
<hr />
<h2 id="학습-체크-1">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>헥사보드의 주요 부품을 말할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>GPIO 핀 번호를
확인했나요?</label></li>
<li><label><input type="checkbox"></input>USB로 연결하고 포트를
확인했나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 3 - 개발 환경 준비하기</p>
<p>이제 헥사보드를 프로그래밍할 준비를 하겠습니다!</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 헥사보드 핀맵을 캡처하거나 메모해두면 나중에
유용합니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-3.-개발-환경-준비하기">Chapter 3. 개발 환경
준비하기</h1>
<blockquote>
<p><strong>PART 1</strong>: AI 센서랩과 헥사보드 이해하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-2">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>Thonny IDE를 설치하고 설정할 수
있다</label></li>
<li><label><input type="checkbox"></input>헥사보드에 MicroPython을 확인할 수
있다</label></li>
<li><label><input type="checkbox"></input>첫 번째 코드를 실행할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 30분</p>
<hr />
<h2 id="학습-목표-2">🎯 학습 목표</h2>
<h3 id="핵심-개념-2">핵심 개념</h3>
<ul>
<li><strong>Thonny</strong>: MicroPython 개발을 위한 간단한 IDE</li>
<li><strong>MicroPython</strong>: 마이크로컨트롤러용 Python</li>
<li><strong>REPL</strong>: 코드를 한 줄씩 실행하는 대화형 환경</li>
</ul>
<hr />
<h2 id="필요한-소프트웨어">📖 필요한 소프트웨어</h2>
<h3 id="thonny-ide">1. Thonny IDE</h3>
<p><strong>Thonny란?</strong></p>
<ul>
<li>초보자를 위한 Python IDE</li>
<li>MicroPython 지원</li>
<li>헥사보드와 쉽게 연결</li>
<li>무료!</li>
</ul>
<p><strong>특징</strong>:</p>
<ul>
<li>설치 간단</li>
<li>사용하기 쉬움</li>
<li>디버깅 편리</li>
<li>파일 관리 쉬움</li>
</ul>
<hr />
<h2 id="thonny-설치하기">💻 Thonny 설치하기</h2>
<h3 id="windows">Windows</h3>
<ol type="1">
<li><p><strong>다운로드</strong></p>
<ul>
<li>https://thonny.org 접속</li>
<li>“Windows” 버튼 클릭</li>
<li><code>thonny-X.X.X.exe</code> 다운로드</li>
</ul></li>
<li><p><strong>설치</strong></p>
<ul>
<li>다운로드한 파일 실행</li>
<li>“Install for me only” 선택 권장</li>
<li>“Next” 계속 클릭</li>
<li>“Install” 클릭</li>
<li>완료!</li>
</ul></li>
<li><p><strong>실행</strong></p>
<ul>
<li>바탕화면 또는 시작 메뉴에서 Thonny 실행</li>
</ul></li>
</ol>
<h3 id="mac">Mac</h3>
<ol type="1">
<li><p><strong>다운로드</strong></p>
<ul>
<li>https://thonny.org 접속</li>
<li>“Mac” 버튼 클릭</li>
<li><code>thonny-X.X.X.pkg</code> 다운로드</li>
</ul></li>
<li><p><strong>설치</strong></p>
<ul>
<li>다운로드한 파일 실행</li>
<li>설치 지시 따르기</li>
<li>보안 경고가 나오면:
<ul>
<li>시스템 환경설정 → 보안 및 개인정보 보호</li>
<li>“확인 없이 열기” 클릭</li>
</ul></li>
</ul></li>
<li><p><strong>실행</strong></p>
<ul>
<li>Applications 폴더에서 Thonny 실행</li>
</ul></li>
</ol>
<h3 id="linux-ubuntudebian">Linux (Ubuntu/Debian)</h3>
<p>터미널에서 실행:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install thonny</span></code></pre></div>
<p>실행:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">thonny</span></span></code></pre></div>
<hr />
<h2 id="thonny-설정하기">🔧 Thonny 설정하기</h2>
<h3 id="헥사보드-연결">1. 헥사보드 연결</h3>
<ol type="1">
<li><p><strong>USB 연결</strong></p>
<ul>
<li>헥사보드를 USB로 컴퓨터에 연결</li>
<li>전원 LED 확인</li>
</ul></li>
<li><p><strong>포트 선택</strong></p>
<ul>
<li>Thonny 실행</li>
<li>우측 하단 “Python X.X.X” 클릭</li>
<li>“MicroPython (ESP32)” 선택</li>
<li>또는 “Configure interpreter…” 선택</li>
</ul></li>
<li><p><strong>인터프리터 설정</strong></p>
<pre><code>Tools → Options → Interpreter

Which kind of interpreter:
→ MicroPython (ESP32)

Port or WebREPL:
→ &lt;자동으로 찾음&gt;
또는 수동 선택 (COM3, /dev/ttyUSB0 등)</code></pre></li>
<li><p><strong>OK</strong> 클릭</p></li>
</ol>
<h3 id="연결-확인">2. 연결 확인</h3>
<p>Thonny 하단의 <strong>Shell</strong> 창에서:</p>
<pre><code>&gt;&gt;&gt;
MicroPython v1.24.0 on 2024-XX-XX; ESP32 module with ESP32
Type &quot;help()&quot; for more information.
&gt;&gt;&gt;</code></pre>
<p>이렇게 보이면 성공! 🎉</p>
<hr />
<h2 id="첫-번째-코드-실행">✅ 첫 번째 코드 실행</h2>
<h3 id="hello-world">Hello World!</h3>
<ol type="1">
<li><strong>코드 입력</strong>
<ul>
<li>상단 빈 공간에 입력:</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Hello, HexaBoard!&quot;</span>)</span></code></pre></div>
<ol start="2" type="1">
<li><p><strong>실행</strong></p>
<ul>
<li>▶️ (초록색 실행 버튼) 클릭</li>
<li>또는 F5 키</li>
</ul></li>
<li><p><strong>결과 확인</strong></p>
<ul>
<li>하단 Shell에 출력:</li>
</ul></li>
</ol>
<pre><code>Hello, HexaBoard!</code></pre>
<p><strong>축하합니다! 첫 번째 프로그램이 실행되었습니다!</strong>
🎉</p>
<hr />
<h2 id="led-깜빡이기-선택">💡 LED 깜빡이기 (선택)</h2>
<h3 id="내장-led-테스트">내장 LED 테스트</h3>
<p>헥사보드에 연결이 잘 되었는지 확인해봅시다!</p>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 내장 LED (보통 GPIO 2번)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>led <span class="op">=</span> Pin(<span class="dv">2</span>, Pin.OUT)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 5번 깜빡이기</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    led.on()   <span class="co"># LED 켜기</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;LED ON&quot;</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    led.off()  <span class="co"># LED 끄기</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;LED OFF&quot;</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;완료!&quot;</span>)</span></code></pre></div>
<p><strong>실행하기</strong>:</p>
<ol type="1">
<li>코드를 입력하세요</li>
<li>▶️ 실행 버튼 클릭</li>
<li>LED가 5번 깜빡이는지 확인</li>
</ol>
<blockquote>
<p>💡 <strong>팁</strong>: LED가 안 보이면 정상입니다. 일부 헥사보드는
내장 LED가 보이지 않을 수 있습니다.</p>
</blockquote>
<hr />
<h2 id="thonny-화면-구성">🎓 Thonny 화면 구성</h2>
<pre><code>┌─────────────────────────────────────┐
│  파일 편집기 (코드 작성)            │
│                                     │
│  print(&quot;Hello!&quot;)                    │
│                                     │
├─────────────────────────────────────┤
│  Shell (결과 출력, REPL)            │
│                                     │
│  &gt;&gt;&gt; print(&quot;Hello!&quot;)                │
│  Hello!                             │
│  &gt;&gt;&gt;                                │
└─────────────────────────────────────┘</code></pre>
<p><strong>주요 영역</strong>:</p>
<ol type="1">
<li><strong>편집기</strong> (상단)
<ul>
<li>코드 작성</li>
<li>파일 저장/열기</li>
</ul></li>
<li><strong>Shell</strong> (하단)
<ul>
<li>실행 결과 출력</li>
<li>REPL로 즉석 테스트</li>
</ul></li>
<li><strong>도구 모음</strong>
<ul>
<li>▶️ 실행</li>
<li>🛑 정지</li>
<li>💾 저장</li>
</ul></li>
</ol>
<hr />
<h2 id="핵심-요약-2">🎓 핵심 요약</h2>
<h3 id="설치한-것">설치한 것</h3>
<ol type="1">
<li><strong>Thonny IDE</strong> - MicroPython 개발 도구</li>
<li><strong>헥사보드 연결</strong> - USB 연결 및 포트 설정</li>
</ol>
<h3 id="확인한-것">확인한 것</h3>
<ul>
<li>MicroPython 연결 ✅</li>
<li>첫 프로그램 실행 ✅</li>
<li>LED 테스트 (선택) ✅</li>
</ul>
<h3 id="다음-챕터-준비">다음 챕터 준비</h3>
<p>이제 버튼과 LED를 제어할 준비가 완료되었습니다!</p>
<hr />
<h2 id="문제-해결">🐛 문제 해결</h2>
<h3 id="문제-1-포트가-안-보여요">문제 1: 포트가 안 보여요</h3>
<p><strong>해결 방법</strong>:</p>
<ol type="1">
<li><p><strong>드라이버 설치 (Windows)</strong></p>
<ul>
<li>CP210x USB to UART Driver 검색</li>
<li>Silicon Labs 사이트에서 다운로드</li>
<li>설치 후 재시작</li>
</ul></li>
<li><p><strong>연결 확인</strong></p>
<ul>
<li>USB 케이블 다시 연결</li>
<li>다른 USB 포트 시도</li>
<li>Thonny 재시작</li>
</ul></li>
<li><p><strong>권한 문제 (Linux)</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod <span class="at">-a</span> <span class="at">-G</span> dialout <span class="va">$USER</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 로그아웃 후 다시 로그인</span></span></code></pre></div></li>
</ol>
<h3 id="문제-2-device-is-busy-에러">문제 2: “Device is busy” 에러</h3>
<p><strong>해결 방법</strong>:</p>
<ul>
<li>다른 프로그램이 포트를 사용 중</li>
<li>시리얼 모니터 종료</li>
<li>Thonny 재시작</li>
<li>헥사보드 재연결</li>
</ul>
<h3 id="문제-3-코드가-실행되지-않아요">문제 3: 코드가 실행되지
않아요</h3>
<p><strong>확인 사항</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>헥사보드가 연결되어
있나요?</label></li>
<li><label><input type="checkbox"></input>Shell에 “&gt;&gt;&gt;” 프롬프트가
보이나요?</label></li>
<li><label><input type="checkbox"></input>인터프리터가 “MicroPython
(ESP32)”인가요?</label></li>
<li><label><input type="checkbox"></input>코드에 오타가 없나요?</label></li>
</ul>
<hr />
<h2 id="실습-repl-사용해보기">📝 실습: REPL 사용해보기</h2>
<p><strong>REPL</strong>이란? Read-Eval-Print Loop의 약자로, 코드를 한
줄씩 실행해볼 수 있습니다.</p>
<h3 id="shell에서-직접-입력">Shell에서 직접 입력</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(<span class="st">&quot;Hello!&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Hello<span class="op">!</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> machine</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> machine.freq()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="dv">240000000</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 계산기처럼 사용!</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span></span></code></pre></div>
<blockquote>
<p>💡 <strong>팁</strong>: REPL은 빠르게 테스트할 때 유용합니다!</p>
</blockquote>
<hr />
<h2 id="다음-단계">🚀 다음 단계</h2>
<p>환경 설정이 완료되었습니다! 이제 실제로 헥사보드를 제어해봅시다.</p>
<p><strong>다음 챕터</strong>: Chapter 4 - 디지털 입력의 기본 – 버튼 2개
다루기</p>
<hr />
<h2 id="학습-체크-2">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>Thonny IDE를
설치했나요?</label></li>
<li><label><input type="checkbox"></input>헥사보드와 연결했나요?</label></li>
<li><label><input type="checkbox"></input>첫 번째 코드를
실행했나요?</label></li>
<li><label><input type="checkbox"></input>REPL을 사용해봤나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: Thonny의 View 메뉴에서 “Files”를 활성화하면
헥사보드의 파일을 쉽게 관리할 수 있습니다!</p>
</blockquote>
<hr />
<h2 id="part-1-완료">🎉 PART 1 완료!</h2>
<p>축하합니다! PART 1을 모두 마쳤습니다.</p>
<p>이제 알게 된 것:</p>
<ul>
<li>✅ AI 센서랩이 무엇인지</li>
<li>✅ 헥사보드의 구조</li>
<li>✅ 개발 환경 설정</li>
</ul>
<p><strong>PART 2</strong>에서는 본격적으로 헥사보드를 제어합니다!</p>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-4.-디지털-입력의-기본-버튼-2개-다루기">Chapter 4. 디지털
입력의 기본 – 버튼 2개 다루기</h1>
<blockquote>
<p><strong>PART 2</strong>: 헥사보드 기본 제어 – 버튼과 네오픽셀</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-3">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>버튼으로 디지털 입력을 읽을 수
있다</label></li>
<li><label><input type="checkbox"></input>헥사보드의 버튼 A와 B를 사용할 수
있다</label></li>
<li><label><input type="checkbox"></input>버튼을 눌렀을 때 메시지를 출력할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 30분</p>
<hr />
<h2 id="학습-목표-3">🎯 학습 목표</h2>
<h3 id="핵심-개념-3">핵심 개념</h3>
<ul>
<li><strong>디지털 입력</strong>: 버튼의 상태를 읽어오는 것 (눌림/안
눌림)</li>
<li><strong>GPIO</strong>: 헥사보드의 입출력 핀</li>
</ul>
<h3 id="실습-목표">실습 목표</h3>
<ol type="1">
<li>버튼 A를 눌렀을 때 감지하기</li>
<li>버튼 A와 B를 함께 사용하기</li>
</ol>
<hr />
<h2 id="이론-설명">📖 이론 설명</h2>
<h3 id="버튼은-어떻게-동작할까요">버튼은 어떻게 동작할까요?</h3>
<p>버튼은 가장 간단한 입력 장치입니다. 두 가지 상태만 가집니다:</p>
<ul>
<li><strong>0 (LOW)</strong>: 버튼을 누르지 않은 상태</li>
<li><strong>1 (HIGH)</strong>: 버튼을 누른 상태</li>
</ul>
<p>헥사보드의 버튼은 <strong>Pull-down 방식</strong>으로 연결되어
있습니다:</p>
<pre><code>버튼을 누르지 않았을 때 → 0 (LOW)
버튼을 눌렀을 때     → 1 (HIGH)</code></pre>
<p><strong>헥사보드 버튼 위치</strong>:</p>
<ul>
<li>버튼 A: GPIO 35</li>
<li>버튼 B: GPIO 34</li>
</ul>
<blockquote>
<p>💡 <strong>팁</strong>: Pull-down 방식은 버튼을 누르면 1이 됩니다.
간단하죠?</p>
</blockquote>
<hr />
<h2 id="실습-준비">🔧 실습 준비</h2>
<h3 id="필요한-것">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
<li><label><input type="checkbox" checked></input>Thonny IDE</label></li>
</ul>
<hr />
<h2 id="실습-1-버튼-a-눌러보기">💻 실습 1: 버튼 A 눌러보기</h2>
<h3 id="가장-간단한-버튼-읽기">가장 간단한 버튼 읽기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch04_button_simple.py</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 A 읽기</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 A 설정</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 A를 눌러보세요!&quot;</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 상태 읽기</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> button_a.value() <span class="op">==</span> <span class="dv">1</span>:  <span class="co"># 1 = 눌림</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;버튼 A가 눌렸습니다!&quot;</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.1</span>)</span></code></pre></div>
<p><strong>코드 설명</strong>:</p>
<ul>
<li><code>Pin(35, Pin.IN, Pin.PULL_DOWN)</code>: GPIO 35번을 입력으로
설정, Pull-down 방식</li>
<li><code>button_a.value()</code>: 버튼 상태 읽기 (0 또는 1)</li>
<li><code>if button_a.value() == 1</code>: 1이면 눌린 상태</li>
</ul>
<h3 id="실행하기">실행하기</h3>
<ol type="1">
<li>Thonny에서 위 코드를 입력하세요</li>
<li>▶️ 실행 버튼을 누르세요</li>
<li>헥사보드의 버튼 A를 눌러보세요</li>
<li>“버튼 A가 눌렸습니다!” 메시지가 나타납니다</li>
</ol>
<hr />
<h2 id="실습-2-버튼-눌림만-감지하기">💻 실습 2: 버튼 눌림만
감지하기</h2>
<p>위 코드는 버튼을 누르고 있으면 메시지가 계속 나옵니다.<br />
<strong>한 번만 출력</strong>되도록 개선해봅시다!</p>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch04_button_once.py</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼을 눌렀을 때 한 번만 출력</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>previous_state <span class="op">=</span> <span class="dv">0</span>  <span class="co"># 이전 상태 저장</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 A를 눌러보세요!&quot;</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    current_state <span class="op">=</span> button_a.value()</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0 → 1로 바뀔 때만 (눌렀을 때만)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> previous_state <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> current_state <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✓ 버튼 A 눌림!&quot;</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    previous_state <span class="op">=</span> current_state</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.05</span>)</span></code></pre></div>
<p><strong>핵심 아이디어</strong>:</p>
<ul>
<li>이전 상태를 기억해두고</li>
<li>0에서 1로 바뀌는 순간만 감지!</li>
</ul>
<hr />
<h2 id="실습-3-두-개의-버튼-사용하기">💻 실습 3: 두 개의 버튼
사용하기</h2>
<p>이제 버튼 A와 B를 함께 사용해봅시다!</p>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch04_dual_buttons.py</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 A와 B 함께 사용하기</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 두 버튼 설정</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>button_b <span class="op">=</span> Pin(<span class="dv">34</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>prev_a <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>prev_b <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 테스트&quot;</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 A 또는 B를 눌러보세요!&quot;</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    curr_a <span class="op">=</span> button_a.value()</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    curr_b <span class="op">=</span> button_b.value()</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 A 눌림</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prev_a <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_a <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;🔵 버튼 A&quot;</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 B 눌림</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prev_b <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_b <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;🟢 버튼 B&quot;</span>)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 두 버튼 동시 눌림</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> curr_a <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> curr_b <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prev_a <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> prev_b <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;🟣 A+B 동시!&quot;</span>)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    prev_a <span class="op">=</span> curr_a</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    prev_b <span class="op">=</span> curr_b</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.05</span>)</span></code></pre></div>
<hr />
<h2 id="동작-확인">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 버튼 A를 누르면 “🔵 버튼 A” 출력</li>
<li>✅ 버튼 B를 누르면 “🟢 버튼 B” 출력</li>
<li>✅ 두 버튼을 동시에 누르면 “🟣 A+B 동시!” 출력</li>
</ul>
<p><strong>결과 화면</strong>:</p>
<pre><code>==============================
버튼 테스트
==============================
버튼 A 또는 B를 눌러보세요!

🔵 버튼 A
🟢 버튼 B
🟣 A+B 동시!</code></pre>
<hr />
<h2 id="문제가-생겼나요">🐛 문제가 생겼나요?</h2>
<h3 id="문제-1-버튼을-눌러도-반응이-없어요">문제 1: 버튼을 눌러도 반응이
없어요</h3>
<p><strong>해결 방법</strong>:</p>
<ol type="1">
<li>헥사보드가 USB로 연결되어 있나요?</li>
<li>코드에서 핀 번호가 맞나요? (버튼 A = 35, 버튼 B = 34)</li>
<li><code>Pin.PULL_DOWN</code>이 제대로 입력되었나요?</li>
</ol>
<h3 id="문제-2-한-번-눌렀는데-여러-번-감지돼요">문제 2: 한 번 눌렀는데
여러 번 감지돼요</h3>
<p><strong>해결 방법</strong>:</p>
<ul>
<li><code>time.sleep(0.05)</code> 값을 <code>0.1</code>이나
<code>0.2</code>로 늘려보세요</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.1</span>)  <span class="co"># 100ms로 변경</span></span></code></pre></div>
<h3 id="문제-3-에러-메시지가-나와요">문제 3: 에러 메시지가 나와요</h3>
<p><strong>ImportError: no module named ‘machine’</strong></p>
<ul>
<li>일반 Python이 아닌 MicroPython으로 실행해야 합니다</li>
<li>Thonny 하단에서 “MicroPython (ESP32)”를 선택하세요</li>
</ul>
<hr />
<h2 id="핵심-요약-3">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-1">오늘 배운 것</h3>
<ol type="1">
<li><strong>버튼 읽기</strong>: <code>button.value()</code>로 버튼 상태
확인 (0 또는 1)</li>
<li><strong>Pull-down</strong>: 버튼을 누르면 1, 안 누르면 0</li>
<li><strong>상태 변화 감지</strong>: 이전 상태와 비교해서 눌림 감지</li>
</ol>
<h3 id="핵심-코드">핵심 코드</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 설정 (Pull-down)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 읽기</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> button_a.value() <span class="op">==</span> <span class="dv">1</span>:  <span class="co"># 1 = 눌림</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;버튼 눌림!&quot;</span>)</span></code></pre></div>
<hr />
<h2 id="도전-과제">🚀 도전 과제</h2>
<h3 id="과제-1-버튼-카운터">과제 1: 버튼 카운터 ⭐️</h3>
<p>버튼 A를 누를 때마다 숫자를 세는 프로그램을 만들어보세요.</p>
<pre><code>버튼 A를 1번 눌렀습니다!
버튼 A를 2번 눌렀습니다!
버튼 A를 3번 눌렀습니다!</code></pre>
<p><strong>힌트</strong>: <code>count = 0</code> 변수를 만들고 버튼을
누를 때마다 <code>count += 1</code></p>
<h3 id="과제-2-리셋-버튼">과제 2: 리셋 버튼 ⭐️⭐️</h3>
<ul>
<li>버튼 A: 카운트 증가</li>
<li>버튼 B: 카운트를 0으로 리셋</li>
</ul>
<p><strong>힌트</strong>: 버튼 B를 눌렀을 때 <code>count = 0</code></p>
<hr />
<h2 id="참고-자료">🔗 참고 자료</h2>
<ul>
<li><a href="https://docs.micropython.org/en/latest/library/machine.Pin.html">MicroPython
Pin 문서</a></li>
</ul>
<p><strong>다음 챕터</strong>: Chapter 5 - 네오픽셀 LED 제어하기</p>
<hr />
<h2 id="학습-체크-3">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>버튼 A를 눌러서 메시지를 출력할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>버튼 A와 B를 함께 사용할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>코드가 정상적으로
동작하나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분<br />
<strong>실제 소요 시간</strong>: ___분</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 버튼은 모든 IoT 프로젝트의 기본입니다.
간단하지만 매우 중요해요!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-5.-네오픽셀-기초-한-칸에서-5x5까지">Chapter 5. 네오픽셀
기초 – 한 칸에서 5x5까지</h1>
<blockquote>
<p><strong>PART 2</strong>: 헥사보드 기본 제어 – 버튼과 네오픽셀</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-4">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>네오픽셀 1개를 켜고 끌 수
있다</label></li>
<li><label><input type="checkbox"></input>네오픽셀의 색상을 바꿀 수
있다</label></li>
<li><label><input type="checkbox"></input>5×5 네오픽셀 전체를 제어할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-4">🎯 학습 목표</h2>
<h3 id="핵심-개념-4">핵심 개념</h3>
<ul>
<li><strong>네오픽셀</strong>: 개별 제어 가능한 RGB LED</li>
<li><strong>RGB</strong>: Red(빨강), Green(초록), Blue(파랑)의 조합으로
색상 표현</li>
<li><strong>인덱스</strong>: LED의 위치 번호 (0번부터 시작)</li>
</ul>
<hr />
<h2 id="네오픽셀이란">📖 네오픽셀이란?</h2>
<h3 id="rgb-led의-마법">RGB LED의 마법</h3>
<p>네오픽셀은 <strong>WS2812B</strong> 칩이 내장된 LED입니다.</p>
<p><strong>특징</strong>:</p>
<ul>
<li>빨강, 초록, 파랑을 섞어서 1,600만 가지 색상 표현</li>
<li>각 LED를 개별적으로 제어 가능</li>
<li>한 줄로 연결 (체인 방식)</li>
</ul>
<p><strong>색상 조합</strong>:</p>
<pre><code>빨강(255, 0, 0)
초록(0, 255, 0)
파랑(0, 0, 255)
흰색(255, 255, 255)
보라(255, 0, 255)
노랑(255, 255, 0)
꺼짐(0, 0, 0)</code></pre>
<blockquote>
<p>💡 <strong>팁</strong>: 숫자가 클수록 밝아집니다! (0~255)</p>
</blockquote>
<h3 id="헥사보드의-네오픽셀">헥사보드의 네오픽셀</h3>
<ul>
<li><strong>개수</strong>: 25개 (5행 × 5열)</li>
<li><strong>GPIO</strong>: 23번</li>
<li><strong>번호</strong>: 0번부터 24번까지</li>
</ul>
<pre><code>네오픽셀 배치 (5×5)
┌─────────────┐
│ 0  1  2  3  4 │
│ 5  6  7  8  9 │
│10 11 12 13 14│
│15 16 17 18 19│
│20 21 22 23 24│
└─────────────┘</code></pre>
<hr />
<h2 id="실습-준비-1">🔧 실습 준비</h2>
<h3 id="필요한-것-1">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
<li><label><input type="checkbox" checked></input>Thonny IDE</label></li>
</ul>
<hr />
<h2 id="실습-1-첫-번째-led-켜기">💻 실습 1: 첫 번째 LED 켜기</h2>
<h3 id="led-1개-켜기">LED 1개 켜기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch05_neopixel_one.py</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 네오픽셀 1개 켜기</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 네오픽셀 설정</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>NUM_LEDS <span class="op">=</span> <span class="dv">25</span>  <span class="co"># LED 개수</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>PIN <span class="op">=</span> <span class="dv">23</span>       <span class="co"># GPIO 핀</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 네오픽셀 초기화</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(PIN), NUM_LEDS)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 0번 LED를 빨간색으로</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># (R, G, B)</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>np.write()  <span class="co"># 실제로 켜기!</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;0번 LED가 빨간색으로 켜졌습니다!&quot;</span>)</span></code></pre></div>
<p><strong>코드 설명</strong>:</p>
<ul>
<li><code>neopixel.NeoPixel()</code>: 네오픽셀 객체 생성</li>
<li><code>np[0] = (255, 0, 0)</code>: 0번 LED를 빨간색으로 설정</li>
<li><code>np.write()</code>: 설정을 LED에 전송 (꼭 필요!)</li>
</ul>
<h3 id="실행하기-1">실행하기</h3>
<ol type="1">
<li>코드를 입력하세요</li>
<li>▶️ 실행</li>
<li>왼쪽 위 LED가 빨간색으로 켜집니다!</li>
</ol>
<hr />
<h2 id="실습-2-색상-바꾸기">💻 실습 2: 색상 바꾸기</h2>
<h3 id="여러-색상-표현하기">여러 색상 표현하기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch05_neopixel_colors.py</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 여러 색상 표현하기</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>NUM_LEDS <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>PIN <span class="op">=</span> <span class="dv">23</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(PIN), NUM_LEDS)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 색상 리스트</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>),    <span class="co"># 빨강</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>),    <span class="co"># 초록</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>),    <span class="co"># 파랑</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>),  <span class="co"># 노랑</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">255</span>),  <span class="co"># 보라</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">255</span>),  <span class="co"># 청록</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">128</span>, <span class="dv">0</span>),  <span class="co"># 주황</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>) <span class="co"># 흰색</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;색상이 바뀝니다...&quot;</span>)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 색상 순서대로 표시</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> color <span class="kw">in</span> colors:</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    np[<span class="dv">0</span>] <span class="op">=</span> color</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;색상: </span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 끄기</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>np.write()</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;완료!&quot;</span>)</span></code></pre></div>
<p><strong>실행 결과</strong>:</p>
<ul>
<li>0번 LED가 1초마다 색상이 바뀝니다</li>
<li>총 8가지 색상</li>
</ul>
<hr />
<h2 id="실습-3-여러-led-켜기">💻 실습 3: 여러 LED 켜기</h2>
<h3 id="개-led-켜기">5개 LED 켜기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch05_neopixel_multiple.py</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 여러 LED 켜기</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>NUM_LEDS <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>PIN <span class="op">=</span> <span class="dv">23</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(PIN), NUM_LEDS)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 처음 5개 LED를 서로 다른 색으로</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)    <span class="co"># 빨강</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">1</span>] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)    <span class="co"># 초록</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">2</span>] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)    <span class="co"># 파랑</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">3</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 노랑</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">4</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">255</span>)  <span class="co"># 보라</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>np.write()</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;5개 LED가 켜졌습니다!&quot;</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Ctrl+C로 종료하세요&quot;</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 프로그램 유지</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<p><strong>결과</strong>:</p>
<pre><code>┌─────────────┐
│🔴🟢🔵🟡🟣│  ← 첫 줄만 켜짐
│░░░░░░░░░░│
│░░░░░░░░░░│
│░░░░░░░░░░│
│░░░░░░░░░░│
└─────────────┘</code></pre>
<hr />
<h2 id="실습-4-전체-led-제어">💻 실습 4: 전체 LED 제어</h2>
<h3 id="모든-led를-같은-색으로">모든 LED를 같은 색으로</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch05_neopixel_all.py</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 전체 LED를 같은 색으로</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>NUM_LEDS <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>PIN <span class="op">=</span> <span class="dv">23</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(PIN), NUM_LEDS)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;모든 LED를 같은 색으로&quot;&quot;&quot;</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(NUM_LEDS):</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 빨간색으로 채우기</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;빨간색!&quot;</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>fill((<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">2</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 초록색으로 채우기</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;초록색!&quot;</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>fill((<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>))</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">2</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 파란색으로 채우기</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;파란색!&quot;</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>fill((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>))</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">2</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 끄기</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;끄기!&quot;</span>)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>fill((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><strong>핵심 아이디어</strong>:</p>
<ul>
<li><code>for</code> 반복문으로 모든 LED 제어</li>
<li><code>fill()</code> 함수로 재사용 가능</li>
</ul>
<hr />
<h2 id="실습-5-간단한-애니메이션">💻 실습 5: 간단한 애니메이션</h2>
<h3 id="led가-하나씩-켜지는-효과">LED가 하나씩 켜지는 효과</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch05_neopixel_wave.py</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># LED 웨이브 효과</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>NUM_LEDS <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>PIN <span class="op">=</span> <span class="dv">23</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(PIN), NUM_LEDS)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 모두 끄기</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(NUM_LEDS):</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>np.write()</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;웨이브 시작!&quot;</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># LED가 순서대로 켜짐</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(NUM_LEDS):</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 이전 LED 끄기</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>        np[i<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 현재 LED 켜기</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 초록색</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 마지막 LED 끄기</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>np[NUM_LEDS<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>np.write()</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;완료!&quot;</span>)</span></code></pre></div>
<p><strong>효과</strong>:</p>
<ul>
<li>초록색 LED가 0번부터 24번까지 순서대로 이동</li>
<li>물결치는 듯한 효과</li>
</ul>
<hr />
<h2 id="동작-확인-1">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 실습 1: 0번 LED가 빨간색으로 켜짐</li>
<li>✅ 실습 2: 0번 LED가 8가지 색으로 변함</li>
<li>✅ 실습 3: 첫 줄 5개 LED가 서로 다른 색으로 켜짐</li>
<li>✅ 실습 4: 전체 LED가 빨강 → 초록 → 파랑으로 변함</li>
<li>✅ 실습 5: LED가 순서대로 이동</li>
</ul>
<hr />
<h2 id="문제-해결-1">🐛 문제 해결</h2>
<h3 id="문제-1-led가-안-켜져요">문제 1: LED가 안 켜져요</h3>
<p><strong>해결 방법</strong>:</p>
<ol type="1">
<li><code>np.write()</code> 를 빼먹지 않았나요?</li>
<li>핀 번호가 23번이 맞나요?</li>
<li>헥사보드가 연결되어 있나요?</li>
</ol>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 올바른 순서</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>np.write()  <span class="co"># 꼭 필요!</span></span></code></pre></div>
<h3 id="문제-2-색이-이상해요">문제 2: 색이 이상해요</h3>
<p><strong>해결 방법</strong>:</p>
<ul>
<li>RGB 순서를 확인하세요</li>
<li>각 값은 0~255 범위</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 올바른 색상 값</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)    <span class="co"># 빨강 ✅</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">256</span>, <span class="dv">0</span>, <span class="dv">0</span>)    <span class="co"># 잘못됨 ❌ (255 초과)</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">100</span>) <span class="co"># 밝은 회색 ✅</span></span></code></pre></div>
<h3 id="문제-3-너무-밝아요">문제 3: 너무 밝아요!</h3>
<p><strong>해결 방법</strong>:</p>
<ul>
<li>숫자를 줄이세요 (밝기 조절)</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 밝기 50%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">128</span>, <span class="dv">0</span>, <span class="dv">0</span>)   <span class="co"># 어두운 빨강</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 밝기 20%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">0</span>)    <span class="co"># 더 어두운 빨강</span></span></code></pre></div>
<hr />
<h2 id="핵심-요약-4">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-2">오늘 배운 것</h3>
<ol type="1">
<li><strong>네오픽셀 기본</strong>: RGB 색상 조합</li>
<li><strong>개별 제어</strong>: <code>np[0] = (R, G, B)</code></li>
<li><strong>전체 제어</strong>: 반복문으로 모든 LED 제어</li>
<li><strong>애니메이션</strong>: 시간 지연으로 움직이는 효과</li>
</ol>
<h3 id="핵심-코드-1">핵심 코드</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 네오픽셀 초기화</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># LED 켜기</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>np[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># 빨간색</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>np.write()           <span class="co"># 실제로 표시!</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 모두 끄기</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>np.write()</span></code></pre></div>
<hr />
<h2 id="도전-과제-1">🚀 도전 과제</h2>
<h3 id="과제-1-무지개-만들기">과제 1: 무지개 만들기 ⭐️</h3>
<p>첫 줄 5개 LED를 무지개 색으로 만들어보세요!</p>
<pre><code>🔴🟠🟡🟢🔵</code></pre>
<p><strong>힌트</strong>: 빨강, 주황, 노랑, 초록, 파랑</p>
<h3 id="과제-2-깜빡이는-led">과제 2: 깜빡이는 LED ⭐️⭐️</h3>
<p>전체 LED가 켜졌다 꺼졌다 반복하게 만들어보세요.</p>
<p><strong>힌트</strong>: <code>while True</code> +
<code>time.sleep()</code></p>
<h3 id="과제-3-십자가-패턴">과제 3: 십자가 패턴 ⭐️⭐️</h3>
<p>5×5 LED의 가운데 십자(+) 모양만 켜보세요!</p>
<pre><code>░░🔴░░
░░🔴░░
🔴🔴🔴🔴🔴
░░🔴░░
░░🔴░░</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>세로: 2, 7, 12, 17, 22번</li>
<li>가로: 10, 11, 12, 13, 14번</li>
</ul>
<hr />
<h2 id="색상-참고표">🎨 색상 참고표</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 기본 색상</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>RED     <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>GREEN   <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>BLUE    <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>YELLOW  <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>PURPLE  <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">255</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>CYAN    <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">255</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>WHITE   <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>OFF     <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 파스텔 톤 (밝기 50%)</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>PINK    <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">128</span>, <span class="dv">128</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>MINT    <span class="op">=</span> (<span class="dv">128</span>, <span class="dv">255</span>, <span class="dv">128</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>LAVENDER<span class="op">=</span> (<span class="dv">128</span>, <span class="dv">128</span>, <span class="dv">255</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 어두운 톤 (밝기 20%)</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>DARK_RED <span class="op">=</span> (<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>DARK_GREEN <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">0</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>DARK_BLUE <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span></code></pre></div>
<hr />
<h2 id="학습-체크-4">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>네오픽셀 1개를 켜고 색상을 바꿀 수
있나요?</label></li>
<li><label><input type="checkbox"></input>여러 LED를 동시에 제어할 수
있나요?</label></li>
<li><label><input type="checkbox"></input><code>np.write()</code>의 역할을
이해했나요?</label></li>
<li><label><input type="checkbox"></input>RGB 색상 조합을
이해했나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 6 - 버튼 + 네오픽셀로 만드는 상태
머신</p>
<p>버튼과 LED를 결합하면 더 재미있는 프로젝트를 만들 수 있습니다!</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 네오픽셀은 밝기를 낮춰서 사용하면 눈이
편하고 전력도 절약됩니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-6.-버튼-네오픽셀로-만드는-상태-머신">Chapter 6. 버튼 +
네오픽셀로 만드는 상태 머신</h1>
<blockquote>
<p><strong>PART 2</strong>: 헥사보드 기본 제어 – 버튼과 네오픽셀</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-5">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>버튼으로 LED 색상을 바꿀 수
있다</label></li>
<li><label><input type="checkbox"></input>상태 머신의 개념을 이해할 수
있다</label></li>
<li><label><input type="checkbox"></input>간단한 게임을 만들 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-5">🎯 학습 목표</h2>
<h3 id="핵심-개념-5">핵심 개념</h3>
<ul>
<li><strong>상태 머신</strong>: 상태를 저장하고 전환하는 방식</li>
<li><strong>모드 전환</strong>: 버튼으로 여러 모드 바꾸기</li>
<li><strong>인터랙션</strong>: 입력과 출력을 결합</li>
</ul>
<hr />
<h2 id="상태-머신이란">📖 상태 머신이란?</h2>
<h3 id="간단한-예시">간단한 예시</h3>
<p>전등 스위치를 생각해봅시다:</p>
<pre><code>[켜짐] ←→ [꺼짐]
  ↑         ↑
버튼 누름  버튼 누름</code></pre>
<p><strong>상태</strong>: 켜짐 또는 꺼짐<br />
<strong>전환</strong>: 버튼을 누르면 상태가 바뀜</p>
<h3 id="프로그램에서의-상태-머신">프로그램에서의 상태 머신</h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 상태 저장</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="st">&quot;빨강&quot;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼을 누르면</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> button_pressed:</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;빨강&quot;</span>:</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="st">&quot;초록&quot;</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;초록&quot;</span>:</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="st">&quot;파랑&quot;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;파랑&quot;</span>:</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="st">&quot;빨강&quot;</span></span></code></pre></div>
<hr />
<h2 id="실습-준비-2">🔧 실습 준비</h2>
<h3 id="필요한-것-2">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
</ul>
<hr />
<h2 id="실습-1-버튼으로-led-켜기끄기">💻 실습 1: 버튼으로 LED
켜기/끄기</h2>
<h3 id="토글-스위치-만들기">토글 스위치 만들기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch06_led_toggle.py</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼으로 LED 켜기/끄기</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 설정</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 상태 변수</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>is_on <span class="op">=</span> <span class="va">False</span>  <span class="co"># LED가 켜져 있는지</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>prev_button <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 A를 눌러서 LED를 켜고 끄세요!&quot;</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    curr_button <span class="op">=</span> button_a.value()</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼을 눌렀을 때 (0 → 1)</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prev_button <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_button <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        is_on <span class="op">=</span> <span class="kw">not</span> is_on  <span class="co"># 상태 반전!</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_on:</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 전체 LED 켜기</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 초록색</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;LED ON&quot;</span>)</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 전체 LED 끄기</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;LED OFF&quot;</span>)</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        np.write()</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    prev_button <span class="op">=</span> curr_button</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.05</span>)</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ul>
<li>버튼 A를 누를 때마다 LED가 켜졌다 꺼졌다 반복</li>
</ul>
<hr />
<h2 id="실습-2-버튼으로-색상-바꾸기">💻 실습 2: 버튼으로 색상
바꾸기</h2>
<h3 id="가지-색상-순환">3가지 색상 순환</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch06_color_cycle.py</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼으로 색상 바꾸기</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 색상 리스트</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>),    <span class="co"># 빨강</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>),    <span class="co"># 초록</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)     <span class="co"># 파랑</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 상태 변수</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>color_index <span class="op">=</span> <span class="dv">0</span>  <span class="co"># 현재 색상 번호</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>prev_button <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;전체 LED를 같은 색으로&quot;&quot;&quot;</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 처음 색상 표시</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>fill(colors[color_index])</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;색상: </span><span class="sc">{</span>color_index<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>colors[color_index]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 A를 눌러서 색상을 바꾸세요!&quot;</span>)</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    curr_button <span class="op">=</span> button_a.value()</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 눌림 감지</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prev_button <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_button <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 다음 색상으로</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>        color_index <span class="op">=</span> (color_index <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># LED 업데이트</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>        fill(colors[color_index])</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;색상: </span><span class="sc">{</span>color_index<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>colors[color_index]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>    prev_button <span class="op">=</span> curr_button</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.05</span>)</span></code></pre></div>
<p><strong>핵심 아이디어</strong>:</p>
<ul>
<li><code>color_index</code>로 현재 색상 추적</li>
<li><code>(color_index + 1) % 3</code>: 0 → 1 → 2 → 0 순환</li>
</ul>
<hr />
<h2 id="실습-3-두-버튼으로-제어하기">💻 실습 3: 두 버튼으로
제어하기</h2>
<h3 id="버튼-a-색상-변경-버튼-b-끄기">버튼 A: 색상 변경, 버튼 B:
끄기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch06_two_buttons.py</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 두 버튼으로 제어</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>button_b <span class="op">=</span> Pin(<span class="dv">34</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>),    <span class="co"># 빨강</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>),    <span class="co"># 초록</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>),    <span class="co"># 파랑</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>),  <span class="co"># 노랑</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">255</span>)   <span class="co"># 보라</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>color_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>prev_a <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>prev_b <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>fill(colors[color_index])</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 A: 색상 변경&quot;</span>)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;버튼 B: 끄기&quot;</span>)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>    curr_a <span class="op">=</span> button_a.value()</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>    curr_b <span class="op">=</span> button_b.value()</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 A: 색상 변경</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prev_a <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_a <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>        color_index <span class="op">=</span> (color_index <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">5</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>        fill(colors[color_index])</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;색상 </span><span class="sc">{</span>color_index<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 B: 끄기</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prev_b <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_b <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>        fill((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>        color_index <span class="op">=</span> <span class="dv">0</span>  <span class="co"># 초기화</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;LED OFF&quot;</span>)</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>    prev_a <span class="op">=</span> curr_a</span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>    prev_b <span class="op">=</span> curr_b</span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.05</span>)</span></code></pre></div>
<hr />
<h2 id="실습-4-간단한-게임-빠르게-누르기">💻 실습 4: 간단한 게임 –
빠르게 누르기</h2>
<h3 id="반응-속도-게임">반응 속도 게임</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch06_reaction_game.py</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 반응 속도 게임</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;  반응 속도 게임&quot;</span>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;빨간색이 나오면 빠르게 버튼을 누르세요!&quot;</span>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>prev_button <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 모두 끄기</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    fill((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 랜덤 대기 시간 (1~3초)</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    wait_time <span class="op">=</span> random.uniform(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;대기 중... (</span><span class="sc">{</span>wait_time<span class="sc">:.1f}</span><span class="ss">초)&quot;</span>)</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>    time.sleep(wait_time)</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 빨간색 켜기!</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    fill((<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    start_time <span class="op">=</span> time.time()</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;지금!&quot;</span>)</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 누를 때까지 대기</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>        curr_button <span class="op">=</span> button_a.value()</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prev_button <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr_button <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 반응 시간 계산</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>            reaction_time <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 결과 표시</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> reaction_time <span class="op">&lt;</span> <span class="fl">0.3</span>:</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;⚡ 굉장해요! </span><span class="sc">{</span>reaction_time<span class="sc">:.3f}</span><span class="ss">초&quot;</span>)</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>                fill((<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>))  <span class="co"># 노란색</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> reaction_time <span class="op">&lt;</span> <span class="fl">0.5</span>:</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;👍 빨라요! </span><span class="sc">{</span>reaction_time<span class="sc">:.3f}</span><span class="ss">초&quot;</span>)</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>                fill((<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>))  <span class="co"># 초록색</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;💪 좋아요! </span><span class="sc">{</span>reaction_time<span class="sc">:.3f}</span><span class="ss">초&quot;</span>)</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>                fill((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>))  <span class="co"># 파란색</span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">2</span>)</span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>        prev_button <span class="op">=</span> curr_button</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code></pre></div>
<p><strong>게임 설명</strong>:</p>
<ol type="1">
<li>LED가 꺼진 상태로 대기</li>
<li>랜덤 시간 후 빨간색 켜짐</li>
<li>빠르게 버튼 누르기!</li>
<li>반응 시간 측정 및 결과 표시</li>
</ol>
<hr />
<h2 id="동작-확인-2">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 실습 1: 버튼으로 LED가 켜지고 꺼짐</li>
<li>✅ 실습 2: 버튼으로 색상이 순환함</li>
<li>✅ 실습 3: 두 버튼이 각각 다르게 동작</li>
<li>✅ 실습 4: 게임이 정상 작동</li>
</ul>
<hr />
<h2 id="핵심-요약-5">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-3">오늘 배운 것</h3>
<ol type="1">
<li><strong>상태 머신</strong>: 상태를 저장하고 전환</li>
<li><strong>버튼 + LED</strong>: 입력과 출력 결합</li>
<li><strong>모드 전환</strong>: 여러 상태 순환</li>
<li><strong>게임 만들기</strong>: 타이밍과 피드백</li>
</ol>
<h3 id="핵심-코드-패턴">핵심 코드 패턴</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 상태 저장</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 눌림 감지</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> prev <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> curr <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 상태 변경</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> (state <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LED 업데이트</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    update_led(state)</span></code></pre></div>
<hr />
<h2 id="도전-과제-2">🚀 도전 과제</h2>
<h3 id="과제-1-밝기-조절">과제 1: 밝기 조절 ⭐️</h3>
<p>버튼 A: 밝기 증가<br />
버튼 B: 밝기 감소</p>
<p><strong>힌트</strong>: 밝기 변수를 만들고 0~255 범위로 제한</p>
<h3 id="과제-2-패턴-선택">과제 2: 패턴 선택 ⭐️⭐️</h3>
<p>버튼을 누를 때마다 다른 패턴 표시:</p>
<ul>
<li>패턴 1: 전체 빨강</li>
<li>패턴 2: 십자가</li>
<li>패턴 3: 테두리만</li>
</ul>
<p><strong>힌트</strong>: 각 패턴을 함수로 만들기</p>
<h3 id="과제-3-타이머">과제 3: 타이머 ⭐️⭐️⭐️</h3>
<p>버튼 A를 누르면 5초 카운트다운:</p>
<ul>
<li>5초: 초록색</li>
<li>3초: 노란색</li>
<li>1초: 빨간색</li>
<li>0초: 깜빡임</li>
</ul>
<p><strong>힌트</strong>: <code>time.time()</code>으로 경과 시간
계산</p>
<hr />
<h2 id="학습-체크-5">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>버튼으로 LED를 제어할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>상태 머신의 개념을
이해했나요?</label></li>
<li><label><input type="checkbox"></input>두 버튼을 함께 사용할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>간단한 게임을 만들 수
있나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<h2 id="part-2-완료">🎉 PART 2 완료!</h2>
<p>축하합니다! PART 2를 모두 마쳤습니다.</p>
<p><strong>PART 2에서 배운 것</strong>:</p>
<ul>
<li>✅ 버튼 2개 제어</li>
<li>✅ 네오픽셀 25개 제어</li>
<li>✅ 버튼 + LED 결합</li>
<li>✅ 상태 머신 개념</li>
</ul>
<p><strong>다음은?</strong><br />
PART 3에서는 온습도 센서와 조도 센서를 연결합니다!</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 7 - 온습도 센서 이해와 연결</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 상태 머신은 복잡한 프로그램을 만들 때 매우
유용합니다. 나중에 AI 제어에서도 사용됩니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-7.-온습도-센서-이해와-연결">Chapter 7. 온습도 센서
이해와 연결</h1>
<blockquote>
<p><strong>PART 3</strong>: 온습도 센서 &amp; 조도 센서 연결하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-6">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>온습도 센서(DHT11)를 연결할 수
있다</label></li>
<li><label><input type="checkbox"></input>온도와 습도를 측정할 수
있다</label></li>
<li><label><input type="checkbox"></input>측정값을 화면에 출력할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-6">🎯 학습 목표</h2>
<h3 id="핵심-개념-6">핵심 개념</h3>
<ul>
<li><strong>온습도 센서</strong>: 온도와 습도를 동시에 측정하는
센서</li>
<li><strong>DHT11</strong>: 가장 많이 사용되는 온습도 센서</li>
<li><strong>디지털 센서</strong>: 데이터를 디지털로 전송</li>
</ul>
<hr />
<h2 id="온습도-센서란">📖 온습도 센서란?</h2>
<h3 id="dht11-vs-dht22">DHT11 vs DHT22</h3>
<p><strong>DHT11</strong> (우리가 사용):</p>
<ul>
<li>온도: 0~50°C (±2°C 오차)</li>
<li>습도: 20~90% (±5% 오차)</li>
<li>저렴함</li>
<li>초보자에게 적합</li>
</ul>
<p><strong>DHT22</strong> (고급):</p>
<ul>
<li>온도: -40~80°C (±0.5°C)</li>
<li>습도: 0~100% (±2%)</li>
<li>더 정확하지만 비쌈</li>
</ul>
<blockquote>
<p>💡 <strong>팁</strong>: 이 책에서는 DHT11을 사용하지만 DHT22도 같은
코드로 동작합니다!</p>
</blockquote>
<h3 id="dht11-핀-구성">DHT11 핀 구성</h3>
<pre><code>DHT11 센서 (3핀)
┌─────────┐
│  DHT11  │
│         │
│ 1  2  3 │
└─┬──┬──┬─┘
  │  │  │
VCC DATA GND</code></pre>
<ul>
<li><strong>VCC</strong>: 전원 (3.3V)</li>
<li><strong>DATA</strong>: 데이터 신호</li>
<li><strong>GND</strong>: 접지</li>
</ul>
<hr />
<h2 id="실습-준비-3">🔧 실습 준비</h2>
<h3 id="필요한-것-3">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>DHT11 센서 모듈 × 1 (저항
내장)</label></li>
<li><label><input type="checkbox" checked></input>3핀 케이블 ×
1</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
</ul>
<blockquote>
<p><strong>💡 TIP</strong>: DHT11 센서 모듈은 필요한 저항이 내장되어
있고, 3핀 케이블로 헥사보드에 바로 연결할 수 있어 매우 간편합니다!</p>
</blockquote>
<h3 id="센서-연결하기">센서 연결하기</h3>
<pre><code>DHT11          헥사보드
--------------------------
VCC (1번)  →  3.3V
DATA (2번) →  PIN1 (GPIO 32)
GND (3번)  →  GND</code></pre>
<p><strong>연결 순서</strong>:</p>
<ol type="1">
<li>헥사보드의 전원을 끕니다 (USB 제거)</li>
<li>점퍼 케이블로 연결합니다</li>
<li>연결을 다시 확인합니다</li>
<li>USB를 연결합니다</li>
</ol>
<p>⚠️ <strong>주의</strong>: VCC와 GND를 반대로 연결하면 센서가 고장날
수 있습니다!</p>
<hr />
<h2 id="실습-1-dht11-라이브러리-설치">💻 실습 1: DHT11 라이브러리
설치</h2>
<h3 id="dht-모듈-확인">dht 모듈 확인</h3>
<p>MicroPython에는 <code>dht</code> 모듈이 기본 내장되어 있습니다!</p>
<p><strong>테스트 코드</strong>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch07_test_import.py</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># DHT 모듈 확인</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> dht</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;✓ dht 모듈이 있습니다!&quot;</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;✗ dht 모듈이 없습니다&quot;</span>)</span></code></pre></div>
<p>실행하면 “dht 모듈이 있습니다!”가 나와야 합니다.</p>
<hr />
<h2 id="실습-2-첫-번째-온습도-측정">💻 실습 2: 첫 번째 온습도 측정</h2>
<h3 id="온도와-습도-읽기">온도와 습도 읽기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch07_dht_basic.py</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 온습도 센서 기본</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># DHT11 센서 설정 (GPIO 32번)</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;온습도 센서 테스트&quot;</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 한 번 측정</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>sensor.measure()  <span class="co"># 측정 시작</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> sensor.temperature()  <span class="co"># 온도 (°C)</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>humid <span class="op">=</span> sensor.humidity()    <span class="co"># 습도 (%)</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span></code></pre></div>
<p><strong>코드 설명</strong>:</p>
<ul>
<li><code>dht.DHT11(Pin(32))</code>: DHT11 센서를 GPIO 32번으로
설정</li>
<li><code>sensor.measure()</code>: 측정 명령 (꼭 필요!)</li>
<li><code>sensor.temperature()</code>: 온도 읽기</li>
<li><code>sensor.humidity()</code>: 습도 읽기</li>
</ul>
<h3 id="실행-결과-예시">실행 결과 예시</h3>
<pre><code>온습도 센서 테스트
------------------------------
온도: 24°C
습도: 65%</code></pre>
<hr />
<h2 id="실습-3-실시간-모니터링">💻 실습 3: 실시간 모니터링</h2>
<h3 id="초마다-측정하기">1초마다 측정하기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch07_dht_monitor.py</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 실시간 온습도 모니터링</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;  실시간 온습도 모니터링&quot;</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Ctrl+C로 종료&quot;</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 측정</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 출력</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">] 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C | 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2초 대기 (DHT11은 최소 2초 간격 필요)</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">OSError</span> <span class="im">as</span> e:</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;센서 읽기 실패:&quot;</span>, e)</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span></code></pre></div>
<p><strong>실행 결과</strong>:</p>
<pre><code>========================================
  실시간 온습도 모니터링
========================================
Ctrl+C로 종료

[1] 온도: 24°C | 습도: 65%
[2] 온도: 24°C | 습도: 66%
[3] 온도: 25°C | 습도: 65%</code></pre>
<blockquote>
<p>💡 <strong>팁</strong>: DHT11은 최소 2초 간격으로 측정해야
합니다!</p>
</blockquote>
<hr />
<h2 id="실습-4-led로-온도-표시">💻 실습 4: LED로 온도 표시</h2>
<h3 id="온도에-따라-색상-변경">온도에 따라 색상 변경</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch07_temp_led.py</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 온도에 따라 LED 색상 변경</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;전체 LED를 같은 색으로&quot;&quot;&quot;</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;온도 표시 LED&quot;</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;낮음: 파랑 | 보통: 초록 | 높음: 빨강&quot;</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 온도에 따라 색상 선택</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)  <span class="co"># 파랑 (추움)</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&quot;낮음&quot;</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">26</span>:</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 초록 (적당)</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&quot;보통&quot;</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># 빨강 (더움)</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&quot;높음&quot;</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># LED 업데이트</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>        fill(color)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C (</span><span class="sc">{</span>status<span class="sc">}</span><span class="ss">) | 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">OSError</span> <span class="im">as</span> e:</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;오류:&quot;</span>, e)</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ul>
<li>20°C 미만: 파란색 (추움)</li>
<li>20~25°C: 초록색 (적당)</li>
<li>26°C 이상: 빨간색 (더움)</li>
</ul>
<hr />
<h2 id="동작-확인-3">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 온도 값이 출력됨 (예: 24°C)</li>
<li>✅ 습도 값이 출력됨 (예: 65%)</li>
<li>✅ 2초마다 업데이트됨</li>
<li>✅ LED 색상이 온도에 따라 변함</li>
</ul>
<hr />
<h2 id="문제-해결-2">🐛 문제 해결</h2>
<h3 id="문제-1-oserror-에러">문제 1: “OSError” 에러</h3>
<p><strong>증상</strong>:</p>
<pre><code>OSError: [Errno 116] ETIMEDOUT</code></pre>
<p><strong>원인</strong>:</p>
<ul>
<li>센서가 제대로 연결되지 않음</li>
<li>측정 간격이 너무 짧음</li>
</ul>
<p><strong>해결 방법</strong>:</p>
<ol type="1">
<li>연결 확인:
<ul>
<li>VCC → 3.3V</li>
<li>DATA → GPIO 32</li>
<li>GND → GND</li>
</ul></li>
<li>2초 이상 간격으로 측정</li>
<li>센서를 다시 연결</li>
</ol>
<h3 id="문제-2-값이-이상해요">문제 2: 값이 이상해요</h3>
<p><strong>증상</strong>:</p>
<ul>
<li>온도가 너무 높거나 낮음 (예: 50°C)</li>
<li>습도가 0% 또는 100%</li>
</ul>
<p><strong>원인</strong>:</p>
<ul>
<li>센서가 초기화 중</li>
<li>불량 센서</li>
</ul>
<p><strong>해결 방법</strong>:</p>
<ol type="1">
<li>10초 정도 기다리기</li>
<li>헥사보드 재시작</li>
<li>센서를 다른 것으로 교체</li>
</ol>
<h3 id="문제-3-측정값이-안-변해요">문제 3: 측정값이 안 변해요</h3>
<p><strong>증상</strong>:</p>
<ul>
<li>계속 같은 값만 나옴</li>
</ul>
<p><strong>원인</strong>:</p>
<ul>
<li>DHT11은 측정이 느림 (2초 간격)</li>
<li>실제로 온습도가 안정적</li>
</ul>
<p><strong>해결 방법</strong>:</p>
<ul>
<li>손가락으로 센서를 살짝 감싸면 온도와 습도가 올라갑니다</li>
<li>입김을 불면 습도가 올라갑니다</li>
</ul>
<hr />
<h2 id="핵심-요약-6">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-4">오늘 배운 것</h3>
<ol type="1">
<li><strong>DHT11 센서</strong>: 온도와 습도를 동시 측정</li>
<li><strong>센서 연결</strong>: VCC, DATA, GND 3핀 연결</li>
<li><strong>측정 방법</strong>: <code>measure()</code> →
<code>temperature()</code> / <code>humidity()</code></li>
<li><strong>측정 간격</strong>: 최소 2초</li>
</ol>
<h3 id="핵심-코드-2">핵심 코드</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 온습도 센서 사용</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>sensor.measure()  <span class="co"># 측정</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> sensor.temperature()  <span class="co"># 온도</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>humid <span class="op">=</span> sensor.humidity()    <span class="co"># 습도</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">2</span>)  <span class="co"># 2초 대기 (중요!)</span></span></code></pre></div>
<hr />
<h2 id="도전-과제-3">🚀 도전 과제</h2>
<h3 id="과제-1-경고-시스템">과제 1: 경고 시스템 ⭐️</h3>
<p>온도가 28°C 이상이면 LED를 빨간색으로 깜빡이게 만들어보세요.</p>
<p><strong>힌트</strong>: <code>while</code> 안에
<code>if temp &gt; 28</code> 조건 추가</p>
<h3 id="과제-2-최고최저-온도">과제 2: 최고/최저 온도 ⭐️⭐️</h3>
<p>측정한 온도 중 최고 온도와 최저 온도를 기록하고 출력하세요.</p>
<p><strong>힌트</strong>: <code>max_temp = 0</code>,
<code>min_temp = 100</code> 변수 사용</p>
<h3 id="과제-3-쾌적도-표시">과제 3: 쾌적도 표시 ⭐️⭐️</h3>
<p>온도와 습도를 모두 고려해서 쾌적도를 표시하세요:</p>
<ul>
<li>쾌적: 온도 20~25°C, 습도 40~60%</li>
<li>보통: 그 외</li>
<li>불쾌: 온도 30°C 이상 또는 습도 80% 이상</li>
</ul>
<hr />
<h2 id="학습-체크-6">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>DHT11 센서를
연결했나요?</label></li>
<li><label><input type="checkbox"></input>온도와 습도를 측정할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>LED로 온도를 표시할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>2초 간격의 중요성을
이해했나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 8 - 조도 센서 이해와 연결</p>
<p>빛의 밝기를 측정해봅시다!</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: DHT11 센서는 실내 환경 모니터링에 아주
유용합니다. 스마트 홈의 시작입니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-8.-조도-센서-이해와-연결">Chapter 8. 조도 센서 이해와
연결</h1>
<blockquote>
<p><strong>PART 3</strong>: 온습도 센서 &amp; 조도 센서 연결하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-7">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>조도 센서를 연결할 수
있다</label></li>
<li><label><input type="checkbox"></input>빛의 밝기를 측정할 수
있다</label></li>
<li><label><input type="checkbox"></input>밝기에 따라 LED를 제어할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 35분</p>
<hr />
<h2 id="학습-목표-7">🎯 학습 목표</h2>
<h3 id="핵심-개념-7">핵심 개념</h3>
<ul>
<li><strong>조도 센서</strong>: 빛의 밝기를 측정하는 센서</li>
<li><strong>포토레지스터</strong>: 빛에 따라 저항이 변하는 소자</li>
<li><strong>ADC</strong>: 아날로그 값을 디지털로 변환</li>
</ul>
<hr />
<h2 id="조도-센서란">📖 조도 센서란?</h2>
<h3 id="포토레지스터-cds-센서">포토레지스터 (CdS 센서)</h3>
<p><strong>동작 원리</strong>:</p>
<ul>
<li>빛이 많으면 → 저항 낮아짐 → 전압 높아짐</li>
<li>빛이 적으면 → 저항 높아짐 → 전압 낮아짐</li>
</ul>
<p><strong>활용 예</strong>:</p>
<ul>
<li>자동 가로등 (어두우면 켜짐)</li>
<li>스마트폰 화면 밝기 자동 조절</li>
<li>보안등</li>
</ul>
<blockquote>
<p>💡 <strong>팁</strong>: 손으로 센서를 가리면 어두워져서 값이
변합니다!</p>
</blockquote>
<h3 id="adc란">ADC란?</h3>
<p><strong>ADC</strong> (Analog to Digital Converter):</p>
<ul>
<li>아날로그 전압 → 디지털 숫자로 변환</li>
<li>ESP32는 0~4095 범위 (12bit)</li>
</ul>
<pre><code>밝음 (높은 전압)  →  높은 숫자 (예: 3000)
어두움 (낮은 전압) →  낮은 숫자 (예: 100)</code></pre>
<hr />
<h2 id="실습-준비-4">🔧 실습 준비</h2>
<h3 id="필요한-것-4">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>조도 센서 모듈 × 1 (저항
내장)</label></li>
<li><label><input type="checkbox" checked></input>3핀 케이블 ×
1</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
</ul>
<blockquote>
<p><strong>💡 TIP</strong>: 조도 센서 모듈은 포토레지스터와 필요한
저항이 이미 내장되어 있고, 3핀 케이블로 헥사보드에 바로 연결할 수 있어
매우 간편합니다!</p>
</blockquote>
<h3 id="센서-연결하기-1">센서 연결하기</h3>
<pre><code>조도센서 모듈     헥사보드
--------------------------
VCC          →  3.3V
OUT          →  PIN2 (GPIO 33)
GND          →  GND</code></pre>
<p><strong>연결 순서</strong>:</p>
<ol type="1">
<li>VCC를 헥사보드 3.3V에 연결</li>
<li>OUT을 GPIO 33 (PIN2)에 연결</li>
<li>GND를 헥사보드 GND에 연결</li>
</ol>
<p>⚠️ <strong>주의</strong>: GPIO 33은 ADC 전용 핀입니다.</p>
<hr />
<h2 id="실습-1-adc-기본-사용">💻 실습 1: ADC 기본 사용</h2>
<h3 id="빛의-밝기-읽기">빛의 밝기 읽기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch08_light_basic.py</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 조도 센서 기본</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ADC 설정 (GPIO 33번)</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)  <span class="co"># 0~3.3V 범위</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;조도 센서 테스트&quot;</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 한 번 측정</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> light_sensor.read()  <span class="co"># 0~4095</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;밝기 값: </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">2000</span>:</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;상태: 밝음 ☀️&quot;</span>)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">1000</span>:</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;상태: 보통 ⛅&quot;</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;상태: 어두움 🌙&quot;</span>)</span></code></pre></div>
<p><strong>코드 설명</strong>:</p>
<ul>
<li><code>ADC(Pin(33))</code>: GPIO 33번을 ADC로 사용</li>
<li><code>atten(ADC.ATTN_11DB)</code>: 0~3.3V 전압 측정</li>
<li><code>read()</code>: 현재 값 읽기 (0~4095)</li>
</ul>
<h3 id="실행-결과-예시-1">실행 결과 예시</h3>
<pre><code>조도 센서 테스트
------------------------------
밝기 값: 2850
상태: 밝음 ☀️</code></pre>
<hr />
<h2 id="실습-2-실시간-밝기-모니터링">💻 실습 2: 실시간 밝기
모니터링</h2>
<h3 id="초마다-측정하기-1">0.5초마다 측정하기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch08_light_monitor.py</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 실시간 밝기 모니터링</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;  실시간 밝기 모니터링&quot;</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;손으로 센서를 가려보세요!&quot;</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Ctrl+C로 종료&quot;</span>)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> light_sensor.read()</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 상태 판단</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">2500</span>:</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;매우 밝음 ☀️☀️&quot;</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>        bar <span class="op">=</span> <span class="st">&quot;█&quot;</span> <span class="op">*</span> <span class="dv">20</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">2000</span>:</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;밝음 ☀️&quot;</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>        bar <span class="op">=</span> <span class="st">&quot;█&quot;</span> <span class="op">*</span> <span class="dv">15</span> <span class="op">+</span> <span class="st">&quot;░&quot;</span> <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">1000</span>:</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;보통 ⛅&quot;</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>        bar <span class="op">=</span> <span class="st">&quot;█&quot;</span> <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> <span class="st">&quot;░&quot;</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">500</span>:</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;어두움 🌙&quot;</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>        bar <span class="op">=</span> <span class="st">&quot;█&quot;</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="st">&quot;░&quot;</span> <span class="op">*</span> <span class="dv">15</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;매우 어두움 🌙🌙&quot;</span></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>        bar <span class="op">=</span> <span class="st">&quot;░&quot;</span> <span class="op">*</span> <span class="dv">20</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>count<span class="sc">:3d}</span><span class="ss">] </span><span class="sc">{</span>value<span class="sc">:4d}</span><span class="ss"> | </span><span class="sc">{</span>bar<span class="sc">}</span><span class="ss"> | </span><span class="sc">{</span>status<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)</span></code></pre></div>
<p><strong>실행 결과</strong>:</p>
<pre><code>========================================
  실시간 밝기 모니터링
========================================
손으로 센서를 가려보세요!
Ctrl+C로 종료

[  1] 2850 | ████████████████████ | 매우 밝음 ☀️☀️
[  2] 2750 | ████████████████████ | 매우 밝음 ☀️☀️
[  3] 1200 | ██████████░░░░░░░░░░ | 보통 ⛅
[  4]  350 | ░░░░░░░░░░░░░░░░░░░░ | 매우 어두움 🌙🌙</code></pre>
<hr />
<h2 id="실습-3-자동-조명-시스템">💻 실습 3: 자동 조명 시스템</h2>
<h3 id="어두우면-led-켜기">어두우면 LED 켜기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch08_auto_light.py</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 자동 조명 시스템</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;전체 LED를 같은 색으로&quot;&quot;&quot;</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;자동 조명 시스템&quot;</span>)</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;손으로 센서를 가려보세요!&quot;</span>)</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 기준값 설정</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>DARK_THRESHOLD <span class="op">=</span> <span class="dv">1000</span>  <span class="co"># 이 값보다 낮으면 어두움</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> light_sensor.read()</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">&lt;</span> DARK_THRESHOLD:</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 어두우면 LED 켜기</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>        fill((<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">100</span>))  <span class="co"># 따뜻한 흰색</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;밝기: </span><span class="sc">{</span>value<span class="sc">:4d}</span><span class="ss"> | LED ON  💡&quot;</span>)</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 밝으면 LED 끄기</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>        fill((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;밝기: </span><span class="sc">{</span>value<span class="sc">:4d}</span><span class="ss"> | LED OFF&quot;</span>)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ul>
<li>밝을 때: LED 꺼짐</li>
<li>어두울 때: LED 켜짐 (자동!)</li>
</ul>
<hr />
<h2 id="실습-4-밝기에-따른-led-색상">💻 실습 4: 밝기에 따른 LED
색상</h2>
<h3 id="밝기를-색상으로-표현">밝기를 색상으로 표현</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch08_brightness_color.py</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 밝기를 색상으로 표현</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill(color):</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;밝기 표시 LED&quot;</span>)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;빨강: 어두움 | 노랑: 보통 | 흰색: 밝음&quot;</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> light_sensor.read()</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 밝기에 따라 색상 결정</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">2500</span>:</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>)  <span class="co"># 흰색 (매우 밝음)</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;매우 밝음&quot;</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">2000</span>:</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 노랑 (밝음)</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;밝음&quot;</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">1000</span>:</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 초록 (보통)</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;보통&quot;</span></span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> value <span class="op">&gt;</span> <span class="dv">500</span>:</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">128</span>, <span class="dv">0</span>)  <span class="co"># 주황 (어두움)</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;어두움&quot;</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># 빨강 (매우 어두움)</span></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="st">&quot;매우 어두움&quot;</span></span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>    fill(color)</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;밝기: </span><span class="sc">{</span>value<span class="sc">:4d}</span><span class="ss"> | </span><span class="sc">{</span>status<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)</span></code></pre></div>
<hr />
<h2 id="동작-확인-4">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 밝기 값이 출력됨 (예: 2850)</li>
<li>✅ 손으로 가리면 값이 낮아짐</li>
<li>✅ LED가 밝기에 따라 변함</li>
<li>✅ 자동 조명이 작동함</li>
</ul>
<hr />
<h2 id="문제-해결-3">🐛 문제 해결</h2>
<h3 id="문제-1-값이-항상-0-또는-4095">문제 1: 값이 항상 0 또는 4095</h3>
<p><strong>원인</strong>:</p>
<ul>
<li>센서 연결 불량</li>
<li>잘못된 핀 번호</li>
</ul>
<p><strong>해결 방법</strong>:</p>
<ol type="1">
<li>연결 확인: VCC, OUT, GND</li>
<li>GPIO 33번 확인</li>
<li>센서 모듈 확인</li>
</ol>
<h3 id="문제-2-값이-너무-작거나-큼">문제 2: 값이 너무 작거나 큼</h3>
<p><strong>원인</strong>:</p>
<ul>
<li>환경이 너무 밝거나 어두움</li>
<li>센서 감도 차이</li>
</ul>
<p><strong>해결 방법</strong>:</p>
<ul>
<li><code>DARK_THRESHOLD</code> 값을 조정</li>
<li>손으로 가려서 테스트</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 기준값 조정</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>DARK_THRESHOLD <span class="op">=</span> <span class="dv">1500</span>  <span class="co"># 높이면 더 쉽게 켜짐</span></span></code></pre></div>
<h3 id="문제-3-값이-너무-빠르게-변해요">문제 3: 값이 너무 빠르게
변해요</h3>
<p><strong>원인</strong>:</p>
<ul>
<li>센서가 민감함</li>
<li>조명이 깜빡임</li>
</ul>
<p><strong>해결 방법</strong>:</p>
<ul>
<li>평균값 사용</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5번 측정 평균</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> light_sensor.read()</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> total <span class="op">//</span> <span class="dv">5</span></span></code></pre></div>
<hr />
<h2 id="핵심-요약-7">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-5">오늘 배운 것</h3>
<ol type="1">
<li><strong>조도 센서</strong>: 빛의 밝기를 0~4095로 측정</li>
<li><strong>ADC</strong>: 아날로그 전압을 디지털 값으로 변환</li>
<li><strong>자동 제어</strong>: 밝기에 따라 LED 자동 제어</li>
<li><strong>기준값</strong>: <code>THRESHOLD</code>로 켜짐/꺼짐
결정</li>
</ol>
<h3 id="핵심-코드-3">핵심 코드</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 조도 센서 사용</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> light_sensor.read()  <span class="co"># 0~4095</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> value <span class="op">&lt;</span> <span class="dv">1000</span>:  <span class="co"># 어두움</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    fill((<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">100</span>))  <span class="co"># LED 켜기</span></span></code></pre></div>
<hr />
<h2 id="도전-과제-4">🚀 도전 과제</h2>
<h3 id="과제-1-자동-밝기-조절">과제 1: 자동 밝기 조절 ⭐️</h3>
<p>밝기에 비례해서 LED 밝기를 조절하세요.</p>
<ul>
<li>매우 밝음 → LED 꺼짐</li>
<li>어두움 → LED 밝게</li>
</ul>
<p><strong>힌트</strong>: <code>value</code>를 0~255로 변환</p>
<h3 id="과제-2-야간-모드">과제 2: 야간 모드 ⭐️⭐️</h3>
<p>일정 시간 동안 어두우면 “야간 모드”로 전환하세요.</p>
<p><strong>힌트</strong>: 카운터 사용, 10회 연속 어두우면 전환</p>
<h3 id="과제-3-온도밝기-복합">과제 3: 온도+밝기 복합 ⭐️⭐️⭐️</h3>
<p>온도 센서와 조도 센서를 함께 사용:</p>
<ul>
<li>밝고 더우면: 빨간색</li>
<li>어둡고 추우면: 파란색</li>
<li>그 외: 초록색</li>
</ul>
<hr />
<h2 id="학습-체크-7">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>조도 센서를 연결했나요?</label></li>
<li><label><input type="checkbox"></input>밝기를 측정할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>자동 조명 시스템이
작동하나요?</label></li>
<li><label><input type="checkbox"></input>기준값을 조정할 수
있나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 9 - 센서 데이터 정리 및 단위
변환</p>
<p>센서 값을 더 유용하게 만들어봅시다!</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 조도 센서는 스마트 홈에서 가장 많이 사용되는
센서 중 하나입니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-9.-센서-데이터-정리-및-단위-변환">Chapter 9. 센서 데이터
정리 및 단위 변환</h1>
<blockquote>
<p><strong>PART 3</strong>: 온습도 센서 &amp; 조도 센서 연결하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-8">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>센서 데이터를 정리할 수
있다</label></li>
<li><label><input type="checkbox"></input>단위를 변환할 수 있다 (°C ↔︎ °F, ADC
↔︎ %)</label></li>
<li><label><input type="checkbox"></input>평균값을 계산할 수 있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 30분</p>
<hr />
<h2 id="학습-목표-8">🎯 학습 목표</h2>
<h3 id="핵심-개념-8">핵심 개념</h3>
<ul>
<li><strong>데이터 정리</strong>: 센서 오차 제거</li>
<li><strong>단위 변환</strong>: 사용자 친화적인 값으로 변환</li>
<li><strong>평균값</strong>: 안정적인 측정</li>
</ul>
<hr />
<h2 id="왜-데이터-정리가-필요한가">📖 왜 데이터 정리가 필요한가?</h2>
<h3 id="센서의-문제점">센서의 문제점</h3>
<p>센서는 완벽하지 않습니다:</p>
<ul>
<li>값이 튀는 경우 (노이즈)</li>
<li>소수점 너무 많음</li>
<li>단위가 사용자 친화적이지 않음</li>
</ul>
<p><strong>예시</strong>:</p>
<pre><code>온도: 24.8723°C     → 25°C로 표시
밝기: 2847 (ADC)    → 70% 밝음
습도: 64.9%         → 65%</code></pre>
<hr />
<h2 id="실습-1-값-반올림하기">💻 실습 1: 값 반올림하기</h2>
<h3 id="소수점-정리">소수점 정리</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch09_round.py</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 값 반올림</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;반올림 예제&quot;</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>sensor.measure()</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 원본 값</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;원본: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 반올림 (정수)</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>temp_rounded <span class="op">=</span> <span class="bu">round</span>(temp)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>humid_rounded <span class="op">=</span> <span class="bu">round</span>(humid)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;반올림: </span><span class="sc">{</span>temp_rounded<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid_rounded<span class="sc">}</span><span class="ss">%&quot;</span>)</span></code></pre></div>
<p><strong>함수</strong>:</p>
<ul>
<li><code>round(값)</code>: 반올림 (정수)</li>
<li><code>round(값, 1)</code>: 소수점 1자리</li>
</ul>
<hr />
<h2 id="실습-2-단위-변환">💻 실습 2: 단위 변환</h2>
<h3 id="c-f-변환">°C → °F 변환</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch09_convert.py</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 온도 단위 변환</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> celsius_to_fahrenheit(celsius):</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;섭씨를 화씨로 변환&quot;&quot;&quot;</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> celsius <span class="op">*</span> <span class="dv">9</span><span class="op">/</span><span class="dv">5</span> <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>sensor.measure()</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>temp_c <span class="op">=</span> sensor.temperature()</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 변환</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>temp_f <span class="op">=</span> celsius_to_fahrenheit(temp_c)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;섭씨: </span><span class="sc">{</span>temp_c<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;화씨: </span><span class="sc">{</span>temp_f<span class="sc">:.1f}</span><span class="ss">°F&quot;</span>)</span></code></pre></div>
<p><strong>변환 공식</strong>:</p>
<ul>
<li>°F = °C × 9/5 + 32</li>
<li>°C = (°F - 32) × 5/9</li>
</ul>
<hr />
<h2 id="실습-3-adc를-퍼센트로">💻 실습 3: ADC를 퍼센트로</h2>
<h3 id="section">0~4095 → 0~100%</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch09_adc_percent.py</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ADC 값을 퍼센트로</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adc_to_percent(value, min_val<span class="op">=</span><span class="dv">0</span>, max_val<span class="op">=</span><span class="dv">4095</span>):</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;ADC 값을 퍼센트로 변환&quot;&quot;&quot;</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> (value <span class="op">-</span> min_val) <span class="op">/</span> (max_val <span class="op">-</span> min_val) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(percent)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;ADC → 퍼센트 변환&quot;</span>)</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> light_sensor.read()</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> adc_to_percent(value)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;ADC: </span><span class="sc">{</span>value<span class="sc">:4d}</span><span class="ss"> | 밝기: </span><span class="sc">{</span>percent<span class="sc">:3d}</span><span class="ss">%&quot;</span>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<p><strong>변환 공식</strong>:</p>
<pre><code>퍼센트 = (현재값 - 최소값) / (최대값 - 최소값) × 100</code></pre>
<hr />
<h2 id="실습-4-평균값-계산">💻 실습 4: 평균값 계산</h2>
<h3 id="안정적인-측정">안정적인 측정</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch09_average.py</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 평균값으로 안정화</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_average(sensor, count<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;여러 번 측정하여 평균 계산&quot;&quot;&quot;</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(count):</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> sensor.read()</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total <span class="op">//</span> count</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;평균값 측정&quot;</span>)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 한 번 측정</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>    single <span class="op">=</span> light_sensor.read()</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5번 평균</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> read_average(light_sensor, <span class="dv">5</span>)</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;단일: </span><span class="sc">{</span>single<span class="sc">:4d}</span><span class="ss"> | 평균: </span><span class="sc">{</span>avg<span class="sc">:4d}</span><span class="ss">&quot;</span>)</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<p><strong>효과</strong>:</p>
<ul>
<li>노이즈 감소</li>
<li>더 안정적인 값</li>
</ul>
<hr />
<h2 id="실습-5-종합-데이터-클래스">💻 실습 5: 종합 데이터 클래스</h2>
<h3 id="모든-센서-데이터-정리">모든 센서 데이터 정리</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch09_sensor_data.py</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 센서 데이터 클래스</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SensorData:</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 관리 클래스&quot;&quot;&quot;</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dht_sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read_all(<span class="va">self</span>):</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;모든 센서 읽기&quot;&quot;&quot;</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 온습도</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dht_sensor.measure()</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> <span class="va">self</span>.dht_sensor.temperature()</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> <span class="va">self</span>.dht_sensor.humidity()</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 조도 (평균)</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>        light_total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>            light_total <span class="op">+=</span> <span class="va">self</span>.light_sensor.read()</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> light_total <span class="op">//</span> <span class="dv">5</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 조도 퍼센트</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>        light_percent <span class="op">=</span> <span class="bu">int</span>(light <span class="op">/</span> <span class="dv">4095</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;temperature&#39;</span>: <span class="bu">round</span>(temp),</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;humidity&#39;</span>: <span class="bu">round</span>(humid),</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;light_raw&#39;</span>: light,</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;light_percent&#39;</span>: light_percent</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> print_data(<span class="va">self</span>, data):</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;데이터 출력&quot;&quot;&quot;</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;온도: </span><span class="sc">{</span>data[<span class="st">&#39;temperature&#39;</span>]<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;습도: </span><span class="sc">{</span>data[<span class="st">&#39;humidity&#39;</span>]<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;밝기: </span><span class="sc">{</span>data[<span class="st">&#39;light_percent&#39;</span>]<span class="sc">}</span><span class="ss">% (</span><span class="sc">{</span>data[<span class="st">&#39;light_raw&#39;</span>]<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 사용 예시</span></span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>sensors <span class="op">=</span> SensorData()</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;  전체 센서 모니터링&quot;</span>)</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> sensors.read_all()</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">]&quot;</span>)</span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a>        sensors.print_data(data)</span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span></code></pre></div>
<p><strong>실행 결과</strong>:</p>
<pre><code>========================================
  전체 센서 모니터링
========================================

[1]
온도: 24°C
습도: 65%
밝기: 70% (2847)

[2]
온도: 24°C
습도: 66%
밝기: 68% (2765)</code></pre>
<hr />
<h2 id="동작-확인-5">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 값이 반올림됨</li>
<li>✅ 단위가 변환됨 (°C ↔︎ °F)</li>
<li>✅ ADC가 퍼센트로 표시됨</li>
<li>✅ 평균값이 더 안정적</li>
</ul>
<hr />
<h2 id="핵심-요약-8">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-6">오늘 배운 것</h3>
<ol type="1">
<li><strong>반올림</strong>: <code>round()</code> 함수</li>
<li><strong>단위 변환</strong>: 공식을 함수로 만들기</li>
<li><strong>퍼센트 변환</strong>: (값 / 최대값) × 100</li>
<li><strong>평균값</strong>: 여러 번 측정하여 안정화</li>
</ol>
<h3 id="핵심-코드-4">핵심 코드</h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 반올림</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> <span class="bu">round</span>(<span class="fl">24.8</span>)  <span class="co"># 25</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 온도 변환</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>temp_f <span class="op">=</span> temp_c <span class="op">*</span> <span class="dv">9</span><span class="op">/</span><span class="dv">5</span> <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 퍼센트</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>percent <span class="op">=</span> <span class="bu">int</span>(value <span class="op">/</span> <span class="dv">4095</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 평균</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> sensor.read()</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>avg <span class="op">=</span> total <span class="op">//</span> <span class="dv">5</span></span></code></pre></div>
<hr />
<h2 id="도전-과제-5">🚀 도전 과제</h2>
<h3 id="과제-1-불쾌지수-계산">과제 1: 불쾌지수 계산 ⭐️</h3>
<p>온도와 습도로 불쾌지수 계산:</p>
<pre><code>불쾌지수 = (9/5 × 온도) - (0.55 × (1 - 습도/100) × (9/5 × 온도 - 26)) + 32</code></pre>
<h3 id="과제-2-이동-평균">과제 2: 이동 평균 ⭐️⭐️</h3>
<p>최근 10개 값의 평균 계산</p>
<p><strong>힌트</strong>: 리스트 사용</p>
<h3 id="과제-3-json-형식">과제 3: JSON 형식 ⭐️⭐️</h3>
<p>센서 데이터를 JSON 문자열로 변환</p>
<p><strong>힌트</strong>: <code>ujson</code> 모듈</p>
<hr />
<h2 id="학습-체크-8">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>값을 반올림할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>단위를 변환할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>ADC를 퍼센트로 바꿀 수
있나요?</label></li>
<li><label><input type="checkbox"></input>평균값을 계산할 수
있나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 10 - 센서 데이터를 시각적으로
표현하기</p>
<p>LED로 데이터를 멋지게 표현해봅시다!</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 데이터 정리는 사용자 경험을 크게
향상시킵니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-10.-센서-데이터를-시각적으로-표현하기">Chapter 10. 센서
데이터를 시각적으로 표현하기</h1>
<blockquote>
<p><strong>PART 3</strong>: 온습도 센서 &amp; 조도 센서 연결하기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-9">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>LED로 온도를 바(Bar) 형태로 표시할
수 있다</label></li>
<li><label><input type="checkbox"></input>센서 값에 따라 다양한 패턴을 만들 수
있다</label></li>
<li><label><input type="checkbox"></input>5×5 LED를 그래프처럼 사용할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-9">🎯 학습 목표</h2>
<h3 id="핵심-개념-9">핵심 개념</h3>
<ul>
<li><strong>데이터 시각화</strong>: 숫자를 그림으로 표현</li>
<li><strong>바 그래프</strong>: 값을 막대 형태로 표시</li>
<li><strong>히트맵</strong>: 색상으로 온도 표시</li>
</ul>
<hr />
<h2 id="왜-시각화가-중요한가">📖 왜 시각화가 중요한가?</h2>
<p>숫자보다 그림이 더 직관적입니다!</p>
<p><strong>숫자로 보기</strong>:</p>
<pre><code>온도: 28°C</code></pre>
<p><strong>시각화로 보기</strong>:</p>
<pre><code>🟩🟩🟩🟨🟨  (온도 막대)</code></pre>
<p>한눈에 “조금 높구나!”를 알 수 있습니다.</p>
<hr />
<h2 id="실습-1-온도-바-그래프">💻 실습 1: 온도 바 그래프</h2>
<h3 id="온도를-막대로-표시">온도를 막대로 표시</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch10_temp_bar.py</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 온도 바 그래프</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_temperature_bar(temp):</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;온도를 바 그래프로 표시 (중앙 열)&quot;&quot;&quot;</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 모두 끄기</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 온도에 따라 막대 높이 결정 (15~35°C)</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">15</span>:</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> temp <span class="op">&gt;</span> <span class="dv">35</span>:</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> <span class="bu">int</span>((temp <span class="op">-</span> <span class="dv">15</span>) <span class="op">/</span> <span class="dv">20</span> <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 중앙 열에 표시 (2번, 7번, 12번, 17번, 22번)</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>    center_column <span class="op">=</span> [<span class="dv">22</span>, <span class="dv">17</span>, <span class="dv">12</span>, <span class="dv">7</span>, <span class="dv">2</span>]  <span class="co"># 아래부터 위로</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(bars):</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>        led_index <span class="op">=</span> center_column[i]</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 온도에 따라 색상 변경</span></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)  <span class="co"># 파랑 (추움)</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">25</span>:</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 초록 (적당)</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">30</span>:</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 노랑 (따뜻)</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># 빨강 (더움)</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>        np[led_index] <span class="op">=</span> color</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;온도 바 그래프&quot;</span>)</span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>        show_temperature_bar(temp)</span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span></code></pre></div>
<p><strong>시각화 예시</strong>:</p>
<pre><code>온도 18°C:          온도 28°C:
░░🔵░░            ░░🔴░░
░░🔵░░            ░░🔴░░
░░░░░            ░░🟡░░
░░░░░            ░░🟢░░
░░░░░            ░░🔵░░</code></pre>
<hr />
<h2 id="실습-2-습도-게이지">💻 실습 2: 습도 게이지</h2>
<h3 id="습도를-원형으로-표시">습도를 원형으로 표시</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch10_humid_gauge.py</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 습도 게이지</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_humidity_gauge(humid):</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;습도를 테두리로 표시&quot;&quot;&quot;</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 모두 끄기</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 테두리 LED (시계 방향)</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>    border <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">14</span>, <span class="dv">19</span>, <span class="dv">24</span>, <span class="dv">23</span>, <span class="dv">22</span>, <span class="dv">21</span>, <span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">5</span>]</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 습도에 따라 LED 개수 (0~100% → 0~16개)</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>    led_count <span class="op">=</span> <span class="bu">int</span>(humid <span class="op">/</span> <span class="dv">100</span> <span class="op">*</span> <span class="bu">len</span>(border))</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 색상 결정</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> humid <span class="op">&lt;</span> <span class="dv">40</span>:</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># 빨강 (건조)</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> humid <span class="op">&lt;</span> <span class="dv">70</span>:</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)  <span class="co"># 초록 (적당)</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)  <span class="co"># 파랑 (습함)</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LED 켜기</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(led_count):</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>        np[border[i]] <span class="op">=</span> color</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;습도 게이지&quot;</span>)</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>        show_humidity_gauge(humid)</span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span></code></pre></div>
<hr />
<h2 id="실습-3-밝기-히트맵">💻 실습 3: 밝기 히트맵</h2>
<h3 id="밝기를-색상-그라데이션으로">밝기를 색상 그라데이션으로</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch10_light_heatmap.py</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 밝기 히트맵</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> value_to_color(value):</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;값을 색상으로 변환 (0~4095)&quot;&quot;&quot;</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0~255 범위로 변환</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    brightness <span class="op">=</span> <span class="bu">int</span>(value <span class="op">/</span> <span class="dv">4095</span> <span class="op">*</span> <span class="dv">255</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> brightness <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 매우 어두움: 빨강</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (brightness <span class="op">*</span> <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> brightness <span class="op">&lt;</span> <span class="dv">128</span>:</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 어두움: 주황</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> (brightness <span class="op">-</span> <span class="dv">64</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">255</span>, b, <span class="dv">0</span>)</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> brightness <span class="op">&lt;</span> <span class="dv">192</span>:</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 보통: 노랑 → 초록</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> <span class="dv">255</span> <span class="op">-</span> (brightness <span class="op">-</span> <span class="dv">128</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (r, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 밝음: 흰색</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> (brightness <span class="op">-</span> <span class="dv">192</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">255</span>, <span class="dv">255</span>, b)</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_heatmap(value):</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;전체 LED를 같은 색으로&quot;&quot;&quot;</span></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> value_to_color(value)</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;밝기 히트맵&quot;</span>)</span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> light_sensor.read()</span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> <span class="bu">int</span>(value <span class="op">/</span> <span class="dv">4095</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>    show_heatmap(value)</span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;밝기: </span><span class="sc">{</span>percent<span class="sc">}</span><span class="ss">% (</span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)</span></code></pre></div>
<p><strong>색상 변화</strong>:</p>
<pre><code>어두움 → 밝음
🔴 → 🟠 → 🟡 → 🟢 → ⚪</code></pre>
<hr />
<h2 id="실습-4-종합-대시보드">💻 실습 4: 종합 대시보드</h2>
<h3 id="모든-센서를-한-화면에">모든 센서를 한 화면에</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch10_dashboard.py</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 센서 종합 대시보드</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, ADC</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 센서 초기화</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>temp_sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>light_sensor <span class="op">=</span> ADC(Pin(<span class="dv">33</span>))</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>light_sensor.atten(ADC.ATTN_11DB)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_dashboard(temp, humid, light):</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터를 LED로 표시&quot;&quot;&quot;</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 모두 끄기</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 왼쪽: 온도 (0, 5, 10, 15, 20)</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>    temp_bars <span class="op">=</span> <span class="bu">int</span>((temp <span class="op">-</span> <span class="dv">15</span>) <span class="op">/</span> <span class="dv">20</span> <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>    temp_leds <span class="op">=</span> [<span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">0</span>]</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(temp_bars, <span class="dv">5</span>)):</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>        np[temp_leds[i]] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="cf">if</span> temp <span class="op">&gt;</span> <span class="dv">26</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 중앙: 습도 (2, 7, 12, 17, 22)</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>    humid_bars <span class="op">=</span> <span class="bu">int</span>(humid <span class="op">/</span> <span class="dv">100</span> <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>    humid_leds <span class="op">=</span> [<span class="dv">22</span>, <span class="dv">17</span>, <span class="dv">12</span>, <span class="dv">7</span>, <span class="dv">2</span>]</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(humid_bars, <span class="dv">5</span>)):</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>        np[humid_leds[i]] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)</span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 오른쪽: 밝기 (4, 9, 14, 19, 24)</span></span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>    light_bars <span class="op">=</span> <span class="bu">int</span>(light <span class="op">/</span> <span class="dv">4095</span> <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>    light_leds <span class="op">=</span> [<span class="dv">24</span>, <span class="dv">19</span>, <span class="dv">14</span>, <span class="dv">9</span>, <span class="dv">4</span>]</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(light_bars, <span class="dv">5</span>)):</span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>        np[light_leds[i]] <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;  센서 종합 대시보드&quot;</span>)</span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;왼쪽: 온도 | 중앙: 습도 | 오른쪽: 밝기&quot;</span>)</span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb95-49"><a href="#cb95-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 온습도 측정</span></span>
<span id="cb95-50"><a href="#cb95-50" aria-hidden="true" tabindex="-1"></a>        temp_sensor.measure()</span>
<span id="cb95-51"><a href="#cb95-51" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> temp_sensor.temperature()</span>
<span id="cb95-52"><a href="#cb95-52" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> temp_sensor.humidity()</span>
<span id="cb95-53"><a href="#cb95-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-54"><a href="#cb95-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 밝기 측정</span></span>
<span id="cb95-55"><a href="#cb95-55" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> light_sensor.read()</span>
<span id="cb95-56"><a href="#cb95-56" aria-hidden="true" tabindex="-1"></a>        light_percent <span class="op">=</span> <span class="bu">int</span>(light <span class="op">/</span> <span class="dv">4095</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb95-57"><a href="#cb95-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-58"><a href="#cb95-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 표시</span></span>
<span id="cb95-59"><a href="#cb95-59" aria-hidden="true" tabindex="-1"></a>        show_dashboard(temp, humid, light)</span>
<span id="cb95-60"><a href="#cb95-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-61"><a href="#cb95-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;온도:</span><span class="sc">{</span>temp<span class="sc">:2d}</span><span class="ss">°C | 습도:</span><span class="sc">{</span>humid<span class="sc">:2d}</span><span class="ss">% | 밝기:</span><span class="sc">{</span>light_percent<span class="sc">:3d}</span><span class="ss">%&quot;</span>)</span>
<span id="cb95-62"><a href="#cb95-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-63"><a href="#cb95-63" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span>
<span id="cb95-64"><a href="#cb95-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-65"><a href="#cb95-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb95-66"><a href="#cb95-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb95-67"><a href="#cb95-67" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)</span></code></pre></div>
<p><strong>대시보드 화면</strong>:</p>
<pre><code>🔴  🔵  🟡
🔴  🔵  🟡
🟢  🔵  ░
🟢  ░   ░
░   ░   ░</code></pre>
<ul>
<li>왼쪽 빨강/초록: 온도</li>
<li>중앙 파랑: 습도</li>
<li>오른쪽 노랑: 밝기</li>
</ul>
<hr />
<h2 id="동작-확인-6">✅ 동작 확인</h2>
<p><strong>정상 동작하면</strong>:</p>
<ul>
<li>✅ 온도가 바 그래프로 표시됨</li>
<li>✅ 습도가 테두리로 표시됨</li>
<li>✅ 밝기가 색상으로 표시됨</li>
<li>✅ 대시보드가 동시에 표시됨</li>
</ul>
<hr />
<h2 id="핵심-요약-9">🎓 핵심 요약</h2>
<h3 id="오늘-배운-것-7">오늘 배운 것</h3>
<ol type="1">
<li><strong>바 그래프</strong>: 값을 높이로 표시</li>
<li><strong>게이지</strong>: 테두리를 채우는 형태</li>
<li><strong>히트맵</strong>: 색상 그라데이션</li>
<li><strong>대시보드</strong>: 여러 데이터 동시 표시</li>
</ol>
<h3 id="핵심-패턴">핵심 패턴</h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 값 → LED 개수</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> <span class="bu">int</span>(value <span class="op">/</span> max_value <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 값 → 색상</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> value <span class="op">&lt;</span> threshold1:</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> value <span class="op">&lt;</span> threshold2:</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)</span></code></pre></div>
<hr />
<h2 id="도전-과제-6">🚀 도전 과제</h2>
<h3 id="과제-1-그래프-애니메이션">과제 1: 그래프 애니메이션 ⭐️</h3>
<p>바가 부드럽게 올라가고 내려가게 만들기</p>
<h3 id="과제-2-경고-표시">과제 2: 경고 표시 ⭐️⭐️</h3>
<p>온도가 너무 높거나 낮으면 깜빡이기</p>
<h3 id="과제-3-데이터-히스토리">과제 3: 데이터 히스토리 ⭐️⭐️⭐️</h3>
<p>최근 5개 측정값을 세로로 표시 (트렌드 파악)</p>
<hr />
<h2 id="part-3-완료">🎉 PART 3 완료!</h2>
<p>축하합니다! PART 3를 모두 마쳤습니다.</p>
<p><strong>PART 3에서 배운 것</strong>:</p>
<ul>
<li>✅ 온습도 센서 (DHT11)</li>
<li>✅ 조도 센서 (포토레지스터)</li>
<li>✅ 데이터 정리 및 변환</li>
<li>✅ LED 시각화</li>
</ul>
<p><strong>다음은?</strong><br />
PART 4에서는 MQTT로 데이터를 전송합니다!</p>
<hr />
<p><strong>다음 챕터</strong>: Chapter 11 - MQTT 개념과 데이터 흐름
이해</p>
<hr />
<h2 id="학습-체크-9">📝 학습 체크</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>바 그래프를 만들 수
있나요?</label></li>
<li><label><input type="checkbox"></input>게이지를 표시할 수
있나요?</label></li>
<li><label><input type="checkbox"></input>대시보드를 만들 수
있나요?</label></li>
</ul>
<p><strong>완료 시간</strong>: ___시 ___분</p>
<hr />
<blockquote>
<p><strong>💡 TIP</strong>: 시각화는 IoT 프로젝트의 꽃입니다. 사용자
경험을 크게 향상시킵니다!</p>
</blockquote>
<hr />
<p><strong>챕터 작성</strong>: 2025-11-25<br />
<strong>작성자</strong>: AIoT eBook Team</p>
<h1 id="chapter-11.-mqtt-개념과-데이터-흐름-이해">Chapter 11. MQTT
개념과 데이터 흐름 이해</h1>
<blockquote>
<p><strong>PART 4</strong>: MQTT를 통한 센서 데이터 전송</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-10">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>MQTT가 무엇인지 이해할 수
있다</label></li>
<li><label><input type="checkbox"></input>Publish/Subscribe 구조를 이해할 수
있다</label></li>
<li><label><input type="checkbox"></input>Topic과 Message의 개념을 이해할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 30분</p>
<hr />
<h2 id="학습-목표-10">🎯 학습 목표</h2>
<h3 id="핵심-개념-10">핵심 개념</h3>
<ul>
<li><strong>MQTT</strong>: IoT를 위한 가벼운 통신 프로토콜</li>
<li><strong>Pub/Sub</strong>: 발행(Publish)과 구독(Subscribe) 구조</li>
<li><strong>Topic</strong>: 메시지를 분류하는 주소</li>
</ul>
<hr />
<h2 id="mqtt란-무엇인가">📖 MQTT란 무엇인가?</h2>
<h3 id="iot를-위한-통신-방식">IoT를 위한 통신 방식</h3>
<p><strong>MQTT (Message Queuing Telemetry Transport)</strong>는 IoT
기기들이 서로 메시지를 주고받기 위한 <strong>가볍고 효율적인</strong>
통신 프로토콜입니다.</p>
<p><strong>왜 MQTT를 사용할까?</strong></p>
<ul>
<li>✅ 적은 데이터 사용 (IoT 기기에 적합)</li>
<li>✅ 불안정한 네트워크에서도 동작</li>
<li>✅ 여러 기기가 동시에 통신 가능</li>
<li>✅ 배터리 효율적</li>
</ul>
<hr />
<h2 id="mqtt의-기본-구조">🏗️ MQTT의 기본 구조</h2>
<h3 id="publish-subscribe-모델">Publish / Subscribe 모델</h3>
<p>MQTT는 <strong>중앙 서버(브로커)</strong>를 중심으로 동작합니다.</p>
<pre><code>┌─────────────┐
│  헥사보드 A  │ ──── Publish ───→ ┌─────────────┐
└─────────────┘                    │             │
                                   │  MQTT       │
┌─────────────┐                    │  Broker     │
│  헥사보드 B  │ ←─── Subscribe ── │  (중개자)   │
└─────────────┘                    │             │
                                   └─────────────┘
┌─────────────┐
│  Python     │ ←─── Subscribe ──
│  AI Server  │ ──── Publish ───→
└─────────────┘</code></pre>
<h3 id="주요-개념">주요 개념</h3>
<h4 id="broker-브로커">1. <strong>Broker (브로커)</strong></h4>
<ul>
<li>모든 메시지를 중개하는 서버</li>
<li>예: HiveMQ Cloud, Mosquitto</li>
</ul>
<h4 id="publisher-발행자">2. <strong>Publisher (발행자)</strong></h4>
<ul>
<li>데이터를 보내는 기기</li>
<li>예: 센서 데이터를 보내는 헥사보드</li>
</ul>
<h4 id="subscriber-구독자">3. <strong>Subscriber (구독자)</strong></h4>
<ul>
<li>데이터를 받는 기기</li>
<li>예: 센서 데이터를 분석하는 Python 서버</li>
</ul>
<h4 id="topic-토픽">4. <strong>Topic (토픽)</strong></h4>
<ul>
<li>메시지의 주소 (카테고리)</li>
<li>예: <code>hexaboard/sensor/temperature</code></li>
</ul>
<hr />
<h2 id="topic의-개념">🏷️ Topic의 개념</h2>
<h3 id="topic은-메시지의-주소입니다">Topic은 메시지의 주소입니다</h3>
<p>Topic은 <strong>슬래시(<code>/</code>)</strong>로 구분된 계층 구조를
가집니다:</p>
<pre><code>hexaboard/sensor/temperature
hexaboard/sensor/humidity
hexaboard/control/led
hexaboard/control/buzzer</code></pre>
<p><strong>Topic 구조 예시</strong>:</p>
<pre><code>&lt;디바이스 이름&gt; / &lt;카테고리&gt; / &lt;세부 항목&gt;</code></pre>
<h3 id="topic-설계-예제">Topic 설계 예제</h3>
<p><strong>센서 데이터</strong>:</p>
<pre><code>hexaboard/A/sensor/temp     → 헥사보드 A의 온도
hexaboard/A/sensor/humid    → 헥사보드 A의 습도
hexaboard/B/sensor/light    → 헥사보드 B의 조도</code></pre>
<p><strong>제어 명령</strong>:</p>
<pre><code>hexaboard/A/control/led     → 헥사보드 A의 LED 제어
hexaboard/B/control/mode    → 헥사보드 B의 모드 변경</code></pre>
<hr />
<h2 id="message의-개념">💬 Message의 개념</h2>
<h3 id="message는-실제-데이터입니다">Message는 실제 데이터입니다</h3>
<p>Message는 Topic으로 전송되는 <strong>실제 내용</strong>입니다.</p>
<p><strong>예시 1: 센서 데이터 (JSON 형식)</strong></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;temperature&quot;</span><span class="fu">:</span> <span class="fl">25.3</span><span class="fu">,</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;humidity&quot;</span><span class="fu">:</span> <span class="dv">60</span><span class="fu">,</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2025-11-25T10:30:00&quot;</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>예시 2: 제어 명령 (JSON 형식)</strong></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;action&quot;</span><span class="fu">:</span> <span class="st">&quot;led_on&quot;</span><span class="fu">,</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;brightness&quot;</span><span class="fu">:</span> <span class="dv">50</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>예시 3: 단순 텍스트</strong></p>
<pre><code>25.3</code></pre>
<hr />
<h2 id="mqtt-통신-흐름">🔄 MQTT 통신 흐름</h2>
<h3 id="실제-동작-예시">실제 동작 예시</h3>
<p><strong>시나리오</strong>: 헥사보드가 온도를 전송하고, Python 서버가
받아서 처리</p>
<h4 id="step-1-구독자-등록">Step 1: 구독자 등록</h4>
<pre><code>Python 서버 → Broker: &quot;hexaboard/sensor/temp&quot; 구독 신청</code></pre>
<h4 id="step-2-발행">Step 2: 발행</h4>
<pre><code>헥사보드 → Broker: Topic &quot;hexaboard/sensor/temp&quot;로 &quot;25.3&quot; 전송</code></pre>
<h4 id="step-3-배포">Step 3: 배포</h4>
<pre><code>Broker → Python 서버: &quot;25.3&quot; 전달</code></pre>
<p><strong>흐름도</strong>:</p>
<pre><code>┌─────────────┐
│  헥사보드    │
│  (Publisher) │
└──────┬──────┘
       │
       │ ① Publish
       │ Topic: hexaboard/sensor/temp
       │ Message: &quot;25.3&quot;
       ↓
┌─────────────┐
│   Broker    │
│  (HiveMQ)   │
└──────┬──────┘
       │
       │ ② Deliver
       │ &quot;25.3&quot;
       ↓
┌─────────────┐
│  Python     │
│  (Subscriber)│
└─────────────┘</code></pre>
<hr />
<h2 id="mqtt의-장점">📊 MQTT의 장점</h2>
<h3 id="http-vs-mqtt">HTTP vs MQTT</h3>
<table>
<thead>
<tr>
<th>특징</th>
<th>HTTP</th>
<th>MQTT</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>연결 방식</strong></td>
<td>요청-응답 (1:1)</td>
<td>발행-구독 (1:N)</td>
</tr>
<tr>
<td><strong>데이터량</strong></td>
<td>헤더가 큼</td>
<td>매우 가벼움 (2바이트~)</td>
</tr>
<tr>
<td><strong>실시간성</strong></td>
<td>폴링 필요</td>
<td>실시간 푸시</td>
</tr>
<tr>
<td><strong>배터리</strong></td>
<td>전력 소모 많음</td>
<td>전력 효율적</td>
</tr>
<tr>
<td><strong>사용 사례</strong></td>
<td>웹 사이트, API 호출</td>
<td>IoT 센서, 실시간 통신</td>
</tr>
</tbody>
</table>
<h3 id="mqtt가-유리한-경우">MQTT가 유리한 경우</h3>
<ul>
<li>✅ 여러 기기가 동시에 데이터를 주고받을 때</li>
<li>✅ 실시간으로 데이터를 전송해야 할 때</li>
<li>✅ 네트워크가 불안정할 때</li>
<li>✅ 배터리 기기를 사용할 때</li>
</ul>
<hr />
<h2 id="mqtt-broker의-역할">🌐 MQTT Broker의 역할</h2>
<h3 id="broker는-우체국입니다">Broker는 우체국입니다</h3>
<p><strong>Broker의 주요 역할</strong>:</p>
<ol type="1">
<li><strong>메시지 중개</strong>: Publisher에게서 받은 메시지를
Subscriber에게 전달</li>
<li><strong>Topic 관리</strong>: 어떤 기기가 어떤 Topic을 구독하는지
관리</li>
<li><strong>연결 관리</strong>: 기기들의 연결 상태 유지</li>
</ol>
<p><strong>Broker 종류</strong>:</p>
<ul>
<li><strong>HiveMQ Cloud</strong>: 클라우드 기반 (무료 플랜 제공)</li>
<li><strong>Mosquitto</strong>: 로컬 서버 (직접 설치)</li>
</ul>
<hr />
<h2 id="mqtt의-보안">🔐 MQTT의 보안</h2>
<h3 id="qos-quality-of-service">QoS (Quality of Service)</h3>
<p>MQTT는 3가지 전송 품질 레벨을 제공합니다:</p>
<table>
<thead>
<tr>
<th>QoS</th>
<th>의미</th>
<th>사용 예시</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>최대 1번 전송 (손실 가능)</td>
<td>실시간 센서 데이터</td>
</tr>
<tr>
<td>1</td>
<td>최소 1번 전송 (중복 가능)</td>
<td>일반적인 센서 데이터</td>
</tr>
<tr>
<td>2</td>
<td>정확히 1번 전송</td>
<td>제어 명령, 결제 데이터</td>
</tr>
</tbody>
</table>
<p><strong>우리 프로젝트에서는 QoS 1을 주로 사용합니다.</strong></p>
<h3 id="tls-암호화">TLS 암호화</h3>
<p>HiveMQ Cloud는 TLS를 사용해 데이터를 암호화합니다:</p>
<ul>
<li>데이터가 네트워크에서 노출되지 않음</li>
<li>안전한 통신 보장</li>
</ul>
<hr />
<h2 id="헥사보드-ai-센서랩에서의-mqtt-활용">🎯 헥사보드 AI 센서랩에서의
MQTT 활용</h2>
<h3 id="우리-프로젝트의-mqtt-구조">우리 프로젝트의 MQTT 구조</h3>
<pre><code>┌─────────────────┐
│   헥사보드 A     │ ← Publish: 센서 데이터
└────────┬────────┘   Subscribe: 제어 명령
         │
         │         ┌─────────────────┐
         ├────────→│   MQTT Broker   │
         │         │   (HiveMQ)      │
         │         └────────┬────────┘
         │                  │
┌────────┴────────┐        │
│  Python AI      │ ← Subscribe: 센서 데이터
│  Server         │   Publish: 제어 명령
└─────────────────┘        │
                           │
                   ┌───────┴────────┐
                   │  Web Dashboard │ ← Subscribe: 모든 데이터
                   │  (브라우저)     │   Publish: 사용자 명령
                   └────────────────┘</code></pre>
<h3 id="topic-설계">Topic 설계</h3>
<p><strong>센서 데이터 전송</strong>:</p>
<pre><code>hexaboard/A/sensor/data → {&quot;temp&quot;: 25, &quot;humid&quot;: 60, &quot;light&quot;: 800}</code></pre>
<p><strong>AI 제어 명령</strong>:</p>
<pre><code>hexaboard/A/control/led → {&quot;color&quot;: [255, 0, 0], &quot;mode&quot;: &quot;on&quot;}</code></pre>
<hr />
<h2 id="핵심-정리">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>MQTT</strong>: IoT를 위한 가벼운 메시징 프로토콜</li>
<li><strong>Broker</strong>: 모든 메시지를 중개하는 서버</li>
<li><strong>Topic</strong>: 메시지의 주소 (예:
<code>hexaboard/sensor/temp</code>)</li>
<li><strong>Publish</strong>: 데이터 보내기</li>
<li><strong>Subscribe</strong>: 데이터 받기</li>
<li><strong>장점</strong>: 가볍고, 실시간이며, 여러 기기 동시 통신
가능</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-2">❓ 자주 묻는 질문</h2>
<h3 id="q1.-mqtt와-http의-차이는">Q1. MQTT와 HTTP의 차이는?</h3>
<p><strong>A</strong>: HTTP는 요청-응답 방식(1:1), MQTT는 발행-구독
방식(1:N). MQTT가 IoT에 더 적합합니다.</p>
<h3 id="q2.-broker가-없으면-통신이-안-되나요">Q2. Broker가 없으면 통신이
안 되나요?</h3>
<p><strong>A</strong>: 네, MQTT는 반드시 Broker를 통해야 합니다.
Broker가 모든 메시지를 중개합니다.</p>
<h3 id="q3.-topic을-어떻게-설계해야-하나요">Q3. Topic을 어떻게 설계해야
하나요?</h3>
<p><strong>A</strong>: 계층 구조로 설계합니다.
<code>&lt;디바이스&gt;/&lt;카테고리&gt;/&lt;항목&gt;</code> 형식을
권장합니다.</p>
<hr />
<h2 id="다음-단계-1">🚀 다음 단계</h2>
<p>이제 MQTT의 기본 개념을 이해했습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>HiveMQ Cloud MQTT Broker 설정하기</li>
<li>무료 계정 생성 및 설정</li>
<li>연결 정보 확인</li>
</ul>
<hr />
<h2 id="더-알아보기">💡 더 알아보기</h2>
<h3 id="mqtt-테스트-도구">MQTT 테스트 도구</h3>
<p><strong>온라인 MQTT 클라이언트</strong>:</p>
<ul>
<li>MQTT.fx</li>
<li>MQTTX</li>
<li>HiveMQ WebSocket Client</li>
</ul>
<p>다음 챕터에서 실제로 설정하고 테스트해봅시다!</p>
<hr />
<p><strong>🎉 Chapter 11 완료!</strong><br />
이제 MQTT의 기본 개념과 Pub/Sub 구조를 이해했습니다.</p>
<h1 id="chapter-12.-mqtt-브로커-준비-hivemq-cloud">Chapter 12. MQTT
브로커 준비 (HiveMQ Cloud)</h1>
<blockquote>
<p><strong>PART 4</strong>: MQTT를 통한 센서 데이터 전송</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-11">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>HiveMQ Cloud 계정을 생성할 수
있다</label></li>
<li><label><input type="checkbox"></input>무료 MQTT Broker를 설정할 수
있다</label></li>
<li><label><input type="checkbox"></input>Broker 연결 정보를 확인할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 30분</p>
<hr />
<h2 id="학습-목표-11">🎯 학습 목표</h2>
<h3 id="핵심-개념-11">핵심 개념</h3>
<ul>
<li><strong>HiveMQ Cloud</strong>: 클라우드 기반 MQTT 브로커</li>
<li><strong>Broker 설정</strong>: 연결 정보 및 인증</li>
<li><strong>테스트 연결</strong>: 온라인 도구로 확인</li>
</ul>
<hr />
<h2 id="hivemq-cloud란">📖 HiveMQ Cloud란?</h2>
<h3 id="클라우드-mqtt-브로커">클라우드 MQTT 브로커</h3>
<p><strong>HiveMQ Cloud</strong>는 클라우드에서 제공하는 MQTT Broker
서비스입니다.</p>
<p><strong>장점</strong>:</p>
<ul>
<li>✅ 무료 플랜 제공 (평생 무료)</li>
<li>✅ 설치 없이 바로 사용 가능</li>
<li>✅ TLS 암호화 기본 제공</li>
<li>✅ 안정적인 클라우드 인프라</li>
<li>✅ 웹 기반 관리 콘솔</li>
</ul>
<p><strong>무료 플랜 제공 사항</strong>:</p>
<ul>
<li>최대 100개 연결</li>
<li>월 10GB 데이터 전송</li>
<li>교육 및 프로토타입에 충분</li>
</ul>
<hr />
<h2 id="실습-1-hivemq-cloud-계정-생성">🔧 실습 1: HiveMQ Cloud 계정
생성</h2>
<h3 id="step-1-회원가입">Step 1: 회원가입</h3>
<ol type="1">
<li><p><strong>HiveMQ Cloud 웹사이트 접속</strong></p>
<ul>
<li>URL: https://www.hivemq.com/mqtt-cloud-broker/</li>
</ul></li>
<li><p><strong>“Sign Up” 버튼 클릭</strong></p>
<ul>
<li>우측 상단의 “Sign Up” 또는 “Start Free” 클릭</li>
</ul></li>
<li><p><strong>계정 정보 입력</strong></p>
<pre><code>- Email: 본인 이메일
- Password: 안전한 비밀번호
- First Name: 이름
- Last Name: 성</code></pre></li>
<li><p><strong>이메일 인증</strong></p>
<ul>
<li>가입 후 이메일 확인</li>
<li>인증 링크 클릭</li>
</ul></li>
</ol>
<hr />
<h2 id="실습-2-cluster-생성">🔧 실습 2: Cluster 생성</h2>
<h3 id="step-1-클러스터-만들기">Step 1: 클러스터 만들기</h3>
<p><strong>로그인 후</strong>:</p>
<ol type="1">
<li><p><strong>“Create new cluster” 버튼 클릭</strong></p></li>
<li><p><strong>Serverless 플랜 선택</strong></p>
<ul>
<li>“Serverless” 탭 선택</li>
<li>무료 플랜 확인</li>
</ul></li>
<li><p><strong>클러스터 설정</strong></p>
<pre><code>- Cluster Name: hexaboard-lab (원하는 이름)
- Cloud Provider: AWS
- Region: ap-northeast-2 (서울) 또는 가까운 지역</code></pre></li>
<li><p><strong>“Create” 버튼 클릭</strong></p>
<ul>
<li>클러스터 생성 시작 (약 1-2분 소요)</li>
</ul></li>
</ol>
<h3 id="step-2-클러스터-상태-확인">Step 2: 클러스터 상태 확인</h3>
<p>생성이 완료되면:</p>
<ul>
<li>Status: <strong>Running</strong> ✅</li>
<li>초록색 표시</li>
</ul>
<hr />
<h2 id="실습-3-접속-정보-설정">🔧 실습 3: 접속 정보 설정</h2>
<h3 id="step-1-credentials-생성">Step 1: Credentials 생성</h3>
<p><strong>클러스터 상세 페이지에서</strong>:</p>
<ol type="1">
<li><p><strong>“Access Management” 탭 클릭</strong></p></li>
<li><p><strong>“Add new credential” 버튼 클릭</strong></p></li>
<li><p><strong>사용자 정보 입력</strong></p>
<pre><code>- Username: hexaboard
- Password: YOUR_SECURE_PASSWORD (직접 생성)</code></pre></li>
<li><p><strong>권한 설정</strong></p>
<pre><code>- Topic: # (모든 토픽)
- Permission: Publish and Subscribe</code></pre></li>
<li><p><strong>“Add” 버튼 클릭</strong></p></li>
</ol>
<p>⚠️ <strong>중요</strong>: 비밀번호를 안전하게 저장하세요! 나중에 다시
볼 수 없습니다.</p>
<h3 id="step-2-연결-정보-확인">Step 2: 연결 정보 확인</h3>
<p><strong>“Overview” 탭에서 확인</strong>:</p>
<pre><code>┌─────────────────────────────────────────┐
│  Connection Settings                    │
├─────────────────────────────────────────┤
│  Host: abc123.s1.eu.hivemq.cloud        │
│  Port: 8883 (TLS)                       │
│  Username: hexaboard                    │
│  Password: YOUR_PASSWORD                │
└─────────────────────────────────────────┘</code></pre>
<p><strong>필요한 정보</strong>:</p>
<ul>
<li><strong>Host</strong>: Broker 주소 (예:
<code>abc123.s1.eu.hivemq.cloud</code>)</li>
<li><strong>Port</strong>: <code>8883</code> (TLS 암호화)</li>
<li><strong>Username</strong>: 위에서 생성한 사용자 이름</li>
<li><strong>Password</strong>: 위에서 생성한 비밀번호</li>
</ul>
<hr />
<h2 id="연결-정보-기록하기">📝 연결 정보 기록하기</h2>
<h3 id="정보-저장-방법">정보 저장 방법</h3>
<p><strong>메모장 또는 텍스트 파일에 저장</strong>:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mqtt_config.txt</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>MQTT_USERNAME <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password_here&quot;</span></span></code></pre></div>
<p>⚠️ <strong>주의</strong>:</p>
<ul>
<li>이 정보를 안전하게 보관하세요</li>
<li>GitHub 등 공개 저장소에 올리지 마세요</li>
<li>나중에 헥사보드와 Python 코드에 사용됩니다</li>
</ul>
<hr />
<h2 id="실습-4-온라인-테스트">🔧 실습 4: 온라인 테스트</h2>
<h3 id="hivemq-websocket-client로-테스트">HiveMQ WebSocket Client로
테스트</h3>
<p><strong>목적</strong>: Broker가 제대로 동작하는지 확인</p>
<h3 id="step-1-websocket-client-접속">Step 1: WebSocket Client 접속</h3>
<ol type="1">
<li><p><strong>URL 접속</strong></p>
<ul>
<li>http://www.hivemq.com/demos/websocket-client/</li>
</ul></li>
<li><p><strong>연결 설정 입력</strong></p>
<pre><code>Host: abc123.s1.eu.hivemq.cloud (본인의 Host)
Port: 8884 (WebSocket TLS)
Username: hexaboard
Password: YOUR_PASSWORD</code></pre></li>
<li><p><strong>“Connect” 버튼 클릭</strong></p>
<ul>
<li>연결 성공: 초록색 “Connected” 표시</li>
</ul></li>
</ol>
<h3 id="step-2-subscribe-테스트">Step 2: Subscribe 테스트</h3>
<ol type="1">
<li><p><strong>“Subscriptions” 섹션에서</strong></p>
<pre><code>Topic: hexaboard/test
QoS: 0</code></pre></li>
<li><p><strong>“Subscribe” 버튼 클릭</strong></p></li>
</ol>
<h3 id="step-3-publish-테스트">Step 3: Publish 테스트</h3>
<ol type="1">
<li><p><strong>“Publish” 섹션에서</strong></p>
<pre><code>Topic: hexaboard/test
Message: Hello MQTT!
QoS: 0</code></pre></li>
<li><p><strong>“Publish” 버튼 클릭</strong></p></li>
</ol>
<h3 id="step-4-메시지-확인">Step 4: 메시지 확인</h3>
<p><strong>“Messages” 섹션에서</strong>:</p>
<pre><code>hexaboard/test: Hello MQTT!</code></pre>
<p>메시지가 표시되면 <strong>성공</strong>! ✅</p>
<hr />
<h2 id="hivemq-cloud-대시보드">📊 HiveMQ Cloud 대시보드</h2>
<h3 id="모니터링-기능">모니터링 기능</h3>
<p><strong>HiveMQ Cloud 콘솔에서 확인 가능</strong>:</p>
<ol type="1">
<li><p><strong>Connected Clients</strong></p>
<ul>
<li>현재 연결된 기기 수</li>
<li>연결/해제 이벤트</li>
</ul></li>
<li><p><strong>Message Rate</strong></p>
<ul>
<li>초당 메시지 전송 수</li>
<li>Publish/Subscribe 통계</li>
</ul></li>
<li><p><strong>Data Transfer</strong></p>
<ul>
<li>데이터 사용량 (월별)</li>
<li>무료 플랜 한도 확인</li>
</ul></li>
</ol>
<hr />
<h2 id="보안-설정">🔐 보안 설정</h2>
<h3 id="tls-인증서">TLS 인증서</h3>
<p>HiveMQ Cloud는 <strong>자동으로 TLS를 활성화</strong>합니다:</p>
<ul>
<li>포트 <code>8883</code>: MQTT over TLS</li>
<li>포트 <code>8884</code>: WebSocket over TLS</li>
</ul>
<p><strong>별도 설정 불필요</strong>:</p>
<ul>
<li>인증서는 자동으로 제공됨</li>
<li>안전한 연결 보장</li>
</ul>
<h3 id="권한-관리">권한 관리</h3>
<p><strong>Credentials에서 관리</strong>:</p>
<ul>
<li>사용자별 접근 권한 설정</li>
<li>Topic 단위로 Publish/Subscribe 제한 가능</li>
</ul>
<p><strong>예시</strong>:</p>
<pre><code>Username: sensor_only
Topic: hexaboard/sensor/# (센서 데이터만)
Permission: Publish only</code></pre>
<hr />
<h2 id="문제-해결-4">🛠️ 문제 해결</h2>
<h3 id="연결이-안-될-때">연결이 안 될 때</h3>
<h4 id="인증-정보-확인">1. 인증 정보 확인</h4>
<pre><code>❌ 잘못된 Username 또는 Password
✅ HiveMQ 콘솔에서 Credentials 다시 확인</code></pre>
<h4 id="host-주소-확인">2. Host 주소 확인</h4>
<pre><code>❌ abc123.s1.eu.hivemq.cloud (예시)
✅ 본인의 실제 Host 주소 사용</code></pre>
<h4 id="port-번호-확인">3. Port 번호 확인</h4>
<pre><code>- MQTT: 8883
- WebSocket: 8884</code></pre>
<h4 id="방화벽-확인">4. 방화벽 확인</h4>
<pre><code>- 포트 8883, 8884가 열려 있는지 확인
- 공용 Wi-Fi는 차단될 수 있음</code></pre>
<h3 id="무료-플랜-제한">무료 플랜 제한</h3>
<p><strong>제한 사항</strong>:</p>
<ul>
<li>최대 100개 연결</li>
<li>월 10GB 데이터</li>
</ul>
<p><strong>초과 시</strong>:</p>
<ul>
<li>연결이 거부될 수 있음</li>
<li>대시보드에서 사용량 확인</li>
</ul>
<hr />
<h2 id="다음-챕터-준비-1">🚀 다음 챕터 준비</h2>
<h3 id="저장해야-할-정보">저장해야 할 정보</h3>
<p>다음 챕터에서 사용할 정보를 준비하세요:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 헥사보드 코드에 사용</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span>  <span class="co"># 본인의 Host</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span>                     <span class="co"># 본인의 Username</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span>             <span class="co"># 본인의 Password</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설계</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/A/control/led&quot;</span></span></code></pre></div>
<hr />
<h2 id="핵심-정리-1">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-1">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>HiveMQ Cloud</strong>: 무료 클라우드 MQTT Broker</li>
<li><strong>Cluster</strong>: MQTT Broker 인스턴스</li>
<li><strong>Credentials</strong>: 연결을 위한 Username/Password</li>
<li><strong>연결 정보</strong>: Host, Port, Username, Password</li>
<li><strong>테스트</strong>: WebSocket Client로 확인 가능</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-3">❓ 자주 묻는 질문</h2>
<h3 id="q1.-무료-플랜으로-충분한가요">Q1. 무료 플랜으로 충분한가요?</h3>
<p><strong>A</strong>: 네! 교육 및 개인 프로젝트에는 충분합니다. 100개
연결, 월 10GB 제공.</p>
<h3 id="q2.-tls-인증서를-따로-설정해야-하나요">Q2. TLS 인증서를 따로
설정해야 하나요?</h3>
<p><strong>A</strong>: 아니요. HiveMQ Cloud는 자동으로 TLS를
제공합니다.</p>
<h3 id="q3.-로컬-mosquitto와-어떻게-다른가요">Q3. 로컬 Mosquitto와
어떻게 다른가요?</h3>
<p><strong>A</strong>: HiveMQ는 클라우드 기반이라 어디서나 접속 가능.
Mosquitto는 로컬 네트워크에서만 사용.</p>
<h3 id="q4.-여러-개의-cluster를-만들-수-있나요">Q4. 여러 개의 Cluster를
만들 수 있나요?</h3>
<p><strong>A</strong>: 무료 플랜은 1개의 Cluster만 제공. 유료 플랜에서
추가 가능.</p>
<hr />
<h2 id="다음-단계-2">🚀 다음 단계</h2>
<p>Broker 설정이 완료되었습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>헥사보드에서 MQTT 라이브러리 사용하기</li>
<li>Publish로 센서 데이터 전송</li>
<li>Subscribe로 제어 명령 받기</li>
</ul>
<hr />
<p><strong>🎉 Chapter 12 완료!</strong><br />
이제 HiveMQ Cloud Broker를 사용할 준비가 되었습니다!</p>
<h1 id="chapter-13.-헥사보드에서-mqtt-publish-subscribe-구현">Chapter
13. 헥사보드에서 MQTT Publish / Subscribe 구현</h1>
<blockquote>
<p><strong>PART 4</strong>: MQTT를 통한 센서 데이터 전송</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-12">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>헥사보드에서 Wi-Fi에 연결할 수
있다</label></li>
<li><label><input type="checkbox"></input>MQTT Broker에 연결할 수
있다</label></li>
<li><label><input type="checkbox"></input>센서 데이터를 Publish할 수
있다</label></li>
<li><label><input type="checkbox"></input>제어 명령을 Subscribe할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-12">🎯 학습 목표</h2>
<h3 id="핵심-개념-12">핵심 개념</h3>
<ul>
<li><strong>Wi-Fi 연결</strong>: 헥사보드를 네트워크에 연결</li>
<li><strong>MQTT Publish</strong>: 센서 데이터 전송</li>
<li><strong>MQTT Subscribe</strong>: 제어 명령 수신</li>
</ul>
<hr />
<h2 id="실습-준비-5">🔧 실습 준비</h2>
<h3 id="필요한-것-5">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
<li><label><input type="checkbox" checked></input>Wi-Fi 네트워크
(2.4GHz)</label></li>
<li><label><input type="checkbox" checked></input>HiveMQ Cloud 연결 정보
(Chapter 12에서 준비)</label></li>
</ul>
<blockquote>
<p><strong>💡 TIP</strong>: ESP32는 <strong>2.4GHz Wi-Fi만</strong>
지원합니다. 5GHz는 사용할 수 없습니다!</p>
</blockquote>
<h3 id="연결-정보-준비">연결 정보 준비</h3>
<p>Chapter 12에서 저장한 정보를 준비하세요:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span>  <span class="co"># 본인의 주소</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span></code></pre></div>
<hr />
<h2 id="실습-1-wi-fi-연결">💻 실습 1: Wi-Fi 연결</h2>
<h3 id="wi-fi-기본-연결">Wi-Fi 기본 연결</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch13_wifi_connect.py</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 연결 테스트</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span>      <span class="co"># 본인의 Wi-Fi 이름</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span>   <span class="co"># 본인의 Wi-Fi 비밀번호</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 연결 대기 (최대 10초)</span></span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;.&quot;</span>, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ Wi-Fi 연결 성공!&quot;</span>)</span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;IP 주소: </span><span class="sc">{</span>wlan<span class="sc">.</span>ifconfig()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;❌ Wi-Fi 연결 실패&quot;</span>)</span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a>connect_wifi()</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ol type="1">
<li>Wi-Fi 모드 활성화</li>
<li>SSID와 Password로 연결</li>
<li>IP 주소 확인</li>
</ol>
<p><strong>출력 예시</strong>:</p>
<pre><code>Wi-Fi 연결 중...
..........
✅ Wi-Fi 연결 성공!
IP 주소: 192.168.0.101</code></pre>
<hr />
<h2 id="실습-2-mqtt-기본-연결">💻 실습 2: MQTT 기본 연결</h2>
<h3 id="broker에-연결하기">Broker에 연결하기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch13_mqtt_connect.py</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 연결 테스트</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span>  <span class="co"># 본인의 Broker</span></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ Wi-Fi 연결 성공!&quot;</span>)</span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb132-39"><a href="#cb132-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT Broker 연결&quot;&quot;&quot;</span></span>
<span id="cb132-40"><a href="#cb132-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb132-41"><a href="#cb132-41" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb132-42"><a href="#cb132-42" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb132-43"><a href="#cb132-43" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb132-44"><a href="#cb132-44" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb132-45"><a href="#cb132-45" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb132-46"><a href="#cb132-46" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb132-47"><a href="#cb132-47" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span>  <span class="co"># TLS 사용</span></span>
<span id="cb132-48"><a href="#cb132-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb132-49"><a href="#cb132-49" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb132-50"><a href="#cb132-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb132-51"><a href="#cb132-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb132-52"><a href="#cb132-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb132-53"><a href="#cb132-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb132-54"><a href="#cb132-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb132-55"><a href="#cb132-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-56"><a href="#cb132-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb132-57"><a href="#cb132-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb132-58"><a href="#cb132-58" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb132-59"><a href="#cb132-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb132-60"><a href="#cb132-60" aria-hidden="true" tabindex="-1"></a>        client.disconnect()</span>
<span id="cb132-61"><a href="#cb132-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;연결 테스트 완료!&quot;</span>)</span></code></pre></div>
<p><strong>핵심 코드</strong>:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> MQTTClient(</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>    client_id<span class="op">=</span><span class="st">&quot;hexaboard_A&quot;</span>,  <span class="co"># 고유한 ID</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    server<span class="op">=</span>MQTT_BROKER,       <span class="co"># Broker 주소</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    port<span class="op">=</span><span class="dv">8883</span>,                <span class="co"># TLS 포트</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    user<span class="op">=</span>MQTT_USER,           <span class="co"># Username</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    password<span class="op">=</span>MQTT_PASSWORD,   <span class="co"># Password</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    ssl<span class="op">=</span><span class="va">True</span>                  <span class="co"># TLS 활성화</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>client.<span class="ex">connect</span>()              <span class="co"># 연결</span></span></code></pre></div>
<hr />
<h2 id="실습-3-publish-데이터-전송">💻 실습 3: Publish (데이터
전송)</h2>
<h3 id="센서-데이터-보내기">센서 데이터 보내기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch13_mqtt_publish.py</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT Publish 예제</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wlan.isconnected()</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결&quot;&quot;&quot;</span></span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> publish_sensor_data(client, temp, humid, light):</span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 전송&quot;&quot;&quot;</span></span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;temperature&quot;</span>: temp,</span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;humidity&quot;</span>: humid,</span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;light&quot;</span>: light,</span>
<span id="cb134-63"><a href="#cb134-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;timestamp&quot;</span>: time.time()</span>
<span id="cb134-64"><a href="#cb134-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb134-65"><a href="#cb134-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-66"><a href="#cb134-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># JSON으로 변환</span></span>
<span id="cb134-67"><a href="#cb134-67" aria-hidden="true" tabindex="-1"></a>    message <span class="op">=</span> ujson.dumps(data)</span>
<span id="cb134-68"><a href="#cb134-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-69"><a href="#cb134-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Publish</span></span>
<span id="cb134-70"><a href="#cb134-70" aria-hidden="true" tabindex="-1"></a>    client.publish(TOPIC_SENSOR, message)</span>
<span id="cb134-71"><a href="#cb134-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📤 전송: </span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb134-72"><a href="#cb134-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-73"><a href="#cb134-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb134-74"><a href="#cb134-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb134-75"><a href="#cb134-75" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb134-76"><a href="#cb134-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-77"><a href="#cb134-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb134-78"><a href="#cb134-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb134-79"><a href="#cb134-79" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 5번 전송 테스트</span></span>
<span id="cb134-80"><a href="#cb134-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb134-81"><a href="#cb134-81" aria-hidden="true" tabindex="-1"></a>                temp <span class="op">=</span> <span class="dv">20</span> <span class="op">+</span> i  <span class="co"># 가상 센서 데이터</span></span>
<span id="cb134-82"><a href="#cb134-82" aria-hidden="true" tabindex="-1"></a>                humid <span class="op">=</span> <span class="dv">50</span> <span class="op">+</span> i</span>
<span id="cb134-83"><a href="#cb134-83" aria-hidden="true" tabindex="-1"></a>                light <span class="op">=</span> <span class="dv">500</span> <span class="op">+</span> i <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb134-84"><a href="#cb134-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-85"><a href="#cb134-85" aria-hidden="true" tabindex="-1"></a>                publish_sensor_data(client, temp, humid, light)</span>
<span id="cb134-86"><a href="#cb134-86" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="dv">2</span>)  <span class="co"># 2초 대기</span></span>
<span id="cb134-87"><a href="#cb134-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-88"><a href="#cb134-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;전송 완료!&quot;</span>)</span>
<span id="cb134-89"><a href="#cb134-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-90"><a href="#cb134-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb134-91"><a href="#cb134-91" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ol type="1">
<li>Wi-Fi와 MQTT Broker 연결</li>
<li>센서 데이터를 JSON으로 변환</li>
<li>Topic으로 Publish</li>
<li>2초마다 반복</li>
</ol>
<p><strong>출력 예시</strong>:</p>
<pre><code>✅ MQTT 연결 성공!
📤 전송: {&quot;temperature&quot;: 20, &quot;humidity&quot;: 50, &quot;light&quot;: 500, &quot;timestamp&quot;: 1234567890}
📤 전송: {&quot;temperature&quot;: 21, &quot;humidity&quot;: 51, &quot;light&quot;: 600, &quot;timestamp&quot;: 1234567892}
...
전송 완료!</code></pre>
<hr />
<h2 id="실습-4-subscribe-명령-수신">💻 실습 4: Subscribe (명령
수신)</h2>
<h3 id="led-제어-명령-받기">LED 제어 명령 받기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch13_mqtt_subscribe.py</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT Subscribe 예제</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/A/control/led&quot;</span></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a><span class="co"># NeoPixel 설정</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb136-41"><a href="#cb136-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-42"><a href="#cb136-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wlan.isconnected()</span>
<span id="cb136-43"><a href="#cb136-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-44"><a href="#cb136-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(topic, msg):</span>
<span id="cb136-45"><a href="#cb136-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신 콜백&quot;&quot;&quot;</span></span>
<span id="cb136-46"><a href="#cb136-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📥 수신: </span><span class="sc">{</span>msg<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb136-47"><a href="#cb136-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-48"><a href="#cb136-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb136-49"><a href="#cb136-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON 파싱</span></span>
<span id="cb136-50"><a href="#cb136-50" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> ujson.loads(msg)</span>
<span id="cb136-51"><a href="#cb136-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-52"><a href="#cb136-52" aria-hidden="true" tabindex="-1"></a>        action <span class="op">=</span> data.get(<span class="st">&quot;action&quot;</span>)</span>
<span id="cb136-53"><a href="#cb136-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-54"><a href="#cb136-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> action <span class="op">==</span> <span class="st">&quot;led_on&quot;</span>:</span>
<span id="cb136-55"><a href="#cb136-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># LED 켜기</span></span>
<span id="cb136-56"><a href="#cb136-56" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> data.get(<span class="st">&quot;color&quot;</span>, [<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>])</span>
<span id="cb136-57"><a href="#cb136-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb136-58"><a href="#cb136-58" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> <span class="bu">tuple</span>(color)</span>
<span id="cb136-59"><a href="#cb136-59" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb136-60"><a href="#cb136-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;💡 LED ON&quot;</span>)</span>
<span id="cb136-61"><a href="#cb136-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-62"><a href="#cb136-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&quot;led_off&quot;</span>:</span>
<span id="cb136-63"><a href="#cb136-63" aria-hidden="true" tabindex="-1"></a>            <span class="co"># LED 끄기</span></span>
<span id="cb136-64"><a href="#cb136-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb136-65"><a href="#cb136-65" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb136-66"><a href="#cb136-66" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb136-67"><a href="#cb136-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;💡 LED OFF&quot;</span>)</span>
<span id="cb136-68"><a href="#cb136-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-69"><a href="#cb136-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&quot;led_color&quot;</span>:</span>
<span id="cb136-70"><a href="#cb136-70" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 색상 변경</span></span>
<span id="cb136-71"><a href="#cb136-71" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> data.get(<span class="st">&quot;color&quot;</span>, [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb136-72"><a href="#cb136-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb136-73"><a href="#cb136-73" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> <span class="bu">tuple</span>(color)</span>
<span id="cb136-74"><a href="#cb136-74" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb136-75"><a href="#cb136-75" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;🎨 색상 변경: </span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb136-76"><a href="#cb136-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-77"><a href="#cb136-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb136-78"><a href="#cb136-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 처리 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb136-79"><a href="#cb136-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-80"><a href="#cb136-80" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb136-81"><a href="#cb136-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결 및 Subscribe&quot;&quot;&quot;</span></span>
<span id="cb136-82"><a href="#cb136-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb136-83"><a href="#cb136-83" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb136-84"><a href="#cb136-84" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb136-85"><a href="#cb136-85" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb136-86"><a href="#cb136-86" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb136-87"><a href="#cb136-87" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb136-88"><a href="#cb136-88" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb136-89"><a href="#cb136-89" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb136-90"><a href="#cb136-90" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb136-91"><a href="#cb136-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-92"><a href="#cb136-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 메시지 콜백 설정</span></span>
<span id="cb136-93"><a href="#cb136-93" aria-hidden="true" tabindex="-1"></a>        client.set_callback(on_message)</span>
<span id="cb136-94"><a href="#cb136-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-95"><a href="#cb136-95" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb136-96"><a href="#cb136-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb136-97"><a href="#cb136-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-98"><a href="#cb136-98" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Topic 구독</span></span>
<span id="cb136-99"><a href="#cb136-99" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_CONTROL)</span>
<span id="cb136-100"><a href="#cb136-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독 시작: </span><span class="sc">{</span>TOPIC_CONTROL<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb136-101"><a href="#cb136-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-102"><a href="#cb136-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb136-103"><a href="#cb136-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-104"><a href="#cb136-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb136-105"><a href="#cb136-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb136-106"><a href="#cb136-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb136-107"><a href="#cb136-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-108"><a href="#cb136-108" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb136-109"><a href="#cb136-109" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb136-110"><a href="#cb136-110" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb136-111"><a href="#cb136-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-112"><a href="#cb136-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb136-113"><a href="#cb136-113" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;명령 대기 중... (Ctrl+C로 종료)&quot;</span>)</span>
<span id="cb136-114"><a href="#cb136-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-115"><a href="#cb136-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb136-116"><a href="#cb136-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb136-117"><a href="#cb136-117" aria-hidden="true" tabindex="-1"></a>                client.check_msg()  <span class="co"># 메시지 확인</span></span>
<span id="cb136-118"><a href="#cb136-118" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb136-119"><a href="#cb136-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-120"><a href="#cb136-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb136-121"><a href="#cb136-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">종료&quot;</span>)</span>
<span id="cb136-122"><a href="#cb136-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-123"><a href="#cb136-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb136-124"><a href="#cb136-124" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<p><strong>핵심 코드</strong>:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 콜백 함수 정의</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(topic, msg):</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 메시지 처리</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 콜백 설정</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>client.set_callback(on_message)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Subscribe</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>client.subscribe(<span class="st">&quot;hexaboard/A/control/led&quot;</span>)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 메시지 확인 (반복)</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>    client.check_msg()</span></code></pre></div>
<p><strong>테스트 방법</strong>:</p>
<p>HiveMQ WebSocket Client에서 다음 메시지 전송:</p>
<p><strong>LED 켜기</strong>:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="er">Topic:</span> <span class="er">hexaboard/A/control/led</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="er">Message:</span> <span class="fu">{</span><span class="dt">&quot;action&quot;</span><span class="fu">:</span> <span class="st">&quot;led_on&quot;</span><span class="fu">,</span> <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span><span class="fu">}</span></span></code></pre></div>
<p><strong>LED 끄기</strong>:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="er">Topic:</span> <span class="er">hexaboard/A/control/led</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="er">Message:</span> <span class="fu">{</span><span class="dt">&quot;action&quot;</span><span class="fu">:</span> <span class="st">&quot;led_off&quot;</span><span class="fu">}</span></span></code></pre></div>
<p><strong>색상 변경</strong>:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="er">Topic:</span> <span class="er">hexaboard/A/control/led</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="er">Message:</span> <span class="fu">{</span><span class="dt">&quot;action&quot;</span><span class="fu">:</span> <span class="st">&quot;led_color&quot;</span><span class="fu">,</span> <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="실습-5-publish-subscribe-통합">💻 실습 5: Publish + Subscribe
통합</h2>
<h3 id="센서-데이터-전송-제어-명령-수신">센서 데이터 전송 + 제어 명령
수신</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch13_mqtt_full.py</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT Publish + Subscribe 통합</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정</span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/A/control/led&quot;</span></span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 하드웨어 설정</span></span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb141-34"><a href="#cb141-34" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb141-35"><a href="#cb141-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-36"><a href="#cb141-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb141-37"><a href="#cb141-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb141-38"><a href="#cb141-38" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb141-39"><a href="#cb141-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-40"><a href="#cb141-40" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb141-41"><a href="#cb141-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb141-42"><a href="#cb141-42" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb141-43"><a href="#cb141-43" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb141-44"><a href="#cb141-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-45"><a href="#cb141-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb141-46"><a href="#cb141-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ Wi-Fi 연결 성공!&quot;</span>)</span>
<span id="cb141-47"><a href="#cb141-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb141-48"><a href="#cb141-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb141-49"><a href="#cb141-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-50"><a href="#cb141-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(topic, msg):</span>
<span id="cb141-51"><a href="#cb141-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;제어 명령 수신&quot;&quot;&quot;</span></span>
<span id="cb141-52"><a href="#cb141-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📥 수신: </span><span class="sc">{</span>msg<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb141-53"><a href="#cb141-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-54"><a href="#cb141-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb141-55"><a href="#cb141-55" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> ujson.loads(msg)</span>
<span id="cb141-56"><a href="#cb141-56" aria-hidden="true" tabindex="-1"></a>        action <span class="op">=</span> data.get(<span class="st">&quot;action&quot;</span>)</span>
<span id="cb141-57"><a href="#cb141-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-58"><a href="#cb141-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> action <span class="op">==</span> <span class="st">&quot;led_on&quot;</span>:</span>
<span id="cb141-59"><a href="#cb141-59" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> data.get(<span class="st">&quot;color&quot;</span>, [<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>])</span>
<span id="cb141-60"><a href="#cb141-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb141-61"><a href="#cb141-61" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> <span class="bu">tuple</span>(color)</span>
<span id="cb141-62"><a href="#cb141-62" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb141-63"><a href="#cb141-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;💡 LED ON&quot;</span>)</span>
<span id="cb141-64"><a href="#cb141-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-65"><a href="#cb141-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&quot;led_off&quot;</span>:</span>
<span id="cb141-66"><a href="#cb141-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb141-67"><a href="#cb141-67" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb141-68"><a href="#cb141-68" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb141-69"><a href="#cb141-69" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;💡 LED OFF&quot;</span>)</span>
<span id="cb141-70"><a href="#cb141-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-71"><a href="#cb141-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb141-72"><a href="#cb141-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 처리 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb141-73"><a href="#cb141-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-74"><a href="#cb141-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb141-75"><a href="#cb141-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결&quot;&quot;&quot;</span></span>
<span id="cb141-76"><a href="#cb141-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb141-77"><a href="#cb141-77" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb141-78"><a href="#cb141-78" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb141-79"><a href="#cb141-79" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb141-80"><a href="#cb141-80" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb141-81"><a href="#cb141-81" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb141-82"><a href="#cb141-82" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb141-83"><a href="#cb141-83" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb141-84"><a href="#cb141-84" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb141-85"><a href="#cb141-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-86"><a href="#cb141-86" aria-hidden="true" tabindex="-1"></a>        client.set_callback(on_message)</span>
<span id="cb141-87"><a href="#cb141-87" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb141-88"><a href="#cb141-88" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_CONTROL)</span>
<span id="cb141-89"><a href="#cb141-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-90"><a href="#cb141-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb141-91"><a href="#cb141-91" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_CONTROL<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb141-92"><a href="#cb141-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-93"><a href="#cb141-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb141-94"><a href="#cb141-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-95"><a href="#cb141-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb141-96"><a href="#cb141-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb141-97"><a href="#cb141-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb141-98"><a href="#cb141-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-99"><a href="#cb141-99" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> publish_sensor_data(client):</span>
<span id="cb141-100"><a href="#cb141-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 전송&quot;&quot;&quot;</span></span>
<span id="cb141-101"><a href="#cb141-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb141-102"><a href="#cb141-102" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb141-103"><a href="#cb141-103" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb141-104"><a href="#cb141-104" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb141-105"><a href="#cb141-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-106"><a href="#cb141-106" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> {</span>
<span id="cb141-107"><a href="#cb141-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;temperature&quot;</span>: temp,</span>
<span id="cb141-108"><a href="#cb141-108" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;humidity&quot;</span>: humid,</span>
<span id="cb141-109"><a href="#cb141-109" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;timestamp&quot;</span>: time.time()</span>
<span id="cb141-110"><a href="#cb141-110" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb141-111"><a href="#cb141-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-112"><a href="#cb141-112" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> ujson.dumps(data)</span>
<span id="cb141-113"><a href="#cb141-113" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_SENSOR, message)</span>
<span id="cb141-114"><a href="#cb141-114" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📤 전송: 온도 </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, 습도 </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb141-115"><a href="#cb141-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-116"><a href="#cb141-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb141-117"><a href="#cb141-117" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 센서 읽기 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb141-118"><a href="#cb141-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-119"><a href="#cb141-119" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb141-120"><a href="#cb141-120" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb141-121"><a href="#cb141-121" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb141-122"><a href="#cb141-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-123"><a href="#cb141-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb141-124"><a href="#cb141-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;시스템 실행 중... (Ctrl+C로 종료)&quot;</span>)</span>
<span id="cb141-125"><a href="#cb141-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-126"><a href="#cb141-126" aria-hidden="true" tabindex="-1"></a>        last_publish <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb141-127"><a href="#cb141-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-128"><a href="#cb141-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb141-129"><a href="#cb141-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb141-130"><a href="#cb141-130" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 제어 명령 확인</span></span>
<span id="cb141-131"><a href="#cb141-131" aria-hidden="true" tabindex="-1"></a>                client.check_msg()</span>
<span id="cb141-132"><a href="#cb141-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-133"><a href="#cb141-133" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 5초마다 센서 데이터 전송</span></span>
<span id="cb141-134"><a href="#cb141-134" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> time.time() <span class="op">-</span> last_publish <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb141-135"><a href="#cb141-135" aria-hidden="true" tabindex="-1"></a>                    publish_sensor_data(client)</span>
<span id="cb141-136"><a href="#cb141-136" aria-hidden="true" tabindex="-1"></a>                    last_publish <span class="op">=</span> time.time()</span>
<span id="cb141-137"><a href="#cb141-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-138"><a href="#cb141-138" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb141-139"><a href="#cb141-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-140"><a href="#cb141-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb141-141"><a href="#cb141-141" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">종료&quot;</span>)</span>
<span id="cb141-142"><a href="#cb141-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-143"><a href="#cb141-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb141-144"><a href="#cb141-144" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ol type="1">
<li>Wi-Fi 연결</li>
<li>MQTT Broker 연결</li>
<li>제어 Topic 구독</li>
<li>5초마다 센서 데이터 Publish</li>
<li>제어 명령 수신 시 LED 제어</li>
</ol>
<hr />
<h2 id="문제-해결-5">🛠️ 문제 해결</h2>
<h3 id="wi-fi-연결-실패">Wi-Fi 연결 실패</h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>❌ Wi<span class="op">-</span>Fi 연결 실패</span></code></pre></div>
<p><strong>원인</strong>:</p>
<ul>
<li>SSID 또는 Password 오류</li>
<li>5GHz Wi-Fi 사용 (ESP32는 2.4GHz만 지원)</li>
<li>Wi-Fi 신호 약함</li>
</ul>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SSID와 Password 재확인</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;정확한_이름&quot;</span>  <span class="co"># 공백, 대소문자 주의</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;정확한_비밀번호&quot;</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.4GHz 네트워크 사용</span></span></code></pre></div>
<h3 id="mqtt-연결-실패">MQTT 연결 실패</h3>
<div class="sourceCode" id="cb144"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>❌ MQTT 연결 실패: <span class="pp">OSError</span>: <span class="op">-</span><span class="dv">1</span></span></code></pre></div>
<p><strong>원인</strong>:</p>
<ul>
<li>Broker 주소 오류</li>
<li>Username/Password 오류</li>
<li>방화벽/네트워크 차단</li>
</ul>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HiveMQ 콘솔에서 연결 정보 재확인</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;본인의_실제_주소&quot;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;정확한_Username&quot;</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;정확한_Password&quot;</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co"># TLS 포트 확인</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span>  <span class="co"># 8883이어야 함</span></span></code></pre></div>
<h3 id="메시지가-안-보일-때">메시지가 안 보일 때</h3>
<pre><code>메시지 전송했지만 아무 반응 없음</code></pre>
<p><strong>원인</strong>:</p>
<ul>
<li>Topic 이름 불일치</li>
<li>Subscribe 안 됨</li>
<li>JSON 형식 오류</li>
</ul>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 일치 확인</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>Publisher: <span class="st">&quot;hexaboard/A/control/led&quot;</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>Subscriber: <span class="st">&quot;hexaboard/A/control/led&quot;</span>  <span class="co"># 정확히 동일해야 함</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co"># JSON 형식 확인</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>{<span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_on&quot;</span>, <span class="st">&quot;color&quot;</span>: [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>]}  <span class="co"># 올바른 형식</span></span></code></pre></div>
<hr />
<h2 id="도전-과제-7">🚀 도전 과제</h2>
<h3 id="과제-1-버튼으로-메시지-전송">과제 1: 버튼으로 메시지 전송</h3>
<p>버튼 A를 누르면 “Button A Pressed” 메시지를 전송하세요.</p>
<p><strong>힌트</strong>:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>TOPIC_BUTTON <span class="op">=</span> <span class="st">&quot;hexaboard/A/button&quot;</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> button_a.value() <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    client.publish(TOPIC_BUTTON, <span class="st">&quot;Button A Pressed&quot;</span>)</span></code></pre></div>
<h3 id="과제-2-온도에-따라-led-색상-변경">과제 2: 온도에 따라 LED 색상
변경</h3>
<p>온도가 25°C 이상이면 빨간색, 미만이면 파란색 LED를 켜는 메시지를
받으세요.</p>
<hr />
<h2 id="핵심-정리-2">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-2">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>Wi-Fi 연결</strong>:
<code>network.WLAN().connect(ssid, password)</code></li>
<li><strong>MQTT 연결</strong>: <code>MQTTClient()</code>로 Broker
연결</li>
<li><strong>Publish</strong>:
<code>client.publish(topic, message)</code>로 전송</li>
<li><strong>Subscribe</strong>: <code>client.subscribe(topic)</code>로
구독</li>
<li><strong>메시지 수신</strong>: <code>client.check_msg()</code>로
확인</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-4">❓ 자주 묻는 질문</h2>
<h3 id="q1.-esp32가-5ghz-wi-fi를-지원하나요">Q1. ESP32가 5GHz Wi-Fi를
지원하나요?</h3>
<p><strong>A</strong>: 아니요. ESP32는 <strong>2.4GHz Wi-Fi만</strong>
지원합니다.</p>
<h3 id="q2.-tls-인증서를-따로-설정해야-하나요-1">Q2. TLS 인증서를 따로
설정해야 하나요?</h3>
<p><strong>A</strong>: HiveMQ Cloud는 자동으로 TLS 인증서를 제공하므로
<code>ssl=True</code>만 설정하면 됩니다.</p>
<h3 id="q3.-메시지가-전송되는지-어떻게-확인하나요">Q3. 메시지가
전송되는지 어떻게 확인하나요?</h3>
<p><strong>A</strong>: HiveMQ WebSocket Client나 대시보드에서 확인할 수
있습니다.</p>
<hr />
<h2 id="다음-단계-3">🚀 다음 단계</h2>
<p>단일 헥사보드로 MQTT 통신에 성공했습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>여러 개의 헥사보드를 연결</li>
<li>보드 간 통신</li>
<li>멀티 디바이스 제어</li>
</ul>
<hr />
<p><strong>🎉 Chapter 13 완료!</strong><br />
이제 헥사보드가 MQTT로 데이터를 주고받을 수 있습니다!</p>
<h1 id="chapter-14.-멀티-헥사보드-확장-실험">Chapter 14. 멀티 헥사보드
확장 실험</h1>
<blockquote>
<p><strong>PART 4</strong>: MQTT를 통한 센서 데이터 전송</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-13">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>여러 헥사보드를 동시에 연결할 수
있다</label></li>
<li><label><input type="checkbox"></input>보드 간 통신을 구현할 수
있다</label></li>
<li><label><input type="checkbox"></input>Topic으로 보드를 구분할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-13">🎯 학습 목표</h2>
<h3 id="핵심-개념-13">핵심 개념</h3>
<ul>
<li><strong>멀티 디바이스</strong>: 여러 IoT 기기 동시 연결</li>
<li><strong>Client ID</strong>: 각 기기의 고유 식별자</li>
<li><strong>Topic 설계</strong>: 보드별 데이터 분리</li>
</ul>
<hr />
<h2 id="왜-멀티-보드가-필요한가">📖 왜 멀티 보드가 필요한가?</h2>
<h3 id="실제-iot-시스템">실제 IoT 시스템</h3>
<p>실제 IoT 환경에서는 <strong>여러 센서와 디바이스</strong>가 동시에
동작합니다.</p>
<p><strong>예시</strong>:</p>
<ul>
<li>집의 각 방마다 온도 센서</li>
<li>여러 층의 조명 제어</li>
<li>다수의 스마트 기기 모니터링</li>
</ul>
<p><strong>MQTT의 장점</strong>:</p>
<ul>
<li>✅ 수십~수백 개의 기기 동시 연결</li>
<li>✅ Broker 하나로 모든 기기 관리</li>
<li>✅ 기기 간 직접 통신 가능</li>
</ul>
<hr />
<h2 id="멀티-보드-시스템-구조">🏗️ 멀티 보드 시스템 구조</h2>
<h3 id="시스템-아키텍처">시스템 아키텍처</h3>
<pre><code>┌─────────────┐
│ 헥사보드 A   │ ─┐
└─────────────┘  │
                 │
┌─────────────┐  │
│ 헥사보드 B   │ ─┤─→ ┌─────────────┐
└─────────────┘  │   │    MQTT     │
                 │   │   Broker    │
┌─────────────┐  │   │  (HiveMQ)   │
│ 헥사보드 C   │ ─┘   └─────────────┘
└─────────────┘            │
                           │
                   ┌───────┴────────┐
                   │   Python AI    │
                   │     Server     │
                   └────────────────┘</code></pre>
<hr />
<h2 id="topic-설계-전략">🏷️ Topic 설계 전략</h2>
<h3 id="보드별-topic-구조">보드별 Topic 구조</h3>
<p>각 헥사보드는 <strong>고유한 Topic</strong>을 가져야 합니다.</p>
<p><strong>권장 구조</strong>:</p>
<pre><code>hexaboard/&lt;보드ID&gt;/&lt;카테고리&gt;/&lt;항목&gt;</code></pre>
<p><strong>예시</strong>:</p>
<p><strong>헥사보드 A</strong>:</p>
<pre><code>hexaboard/A/sensor/data     → 센서 데이터
hexaboard/A/control/led     → LED 제어
hexaboard/A/status          → 상태 정보</code></pre>
<p><strong>헥사보드 B</strong>:</p>
<pre><code>hexaboard/B/sensor/data
hexaboard/B/control/led
hexaboard/B/status</code></pre>
<p><strong>헥사보드 C</strong>:</p>
<pre><code>hexaboard/C/sensor/data
hexaboard/C/control/led
hexaboard/C/status</code></pre>
<hr />
<h2 id="실습-준비-6">🔧 실습 준비</h2>
<h3 id="필요한-것-6">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 2개 이상 (또는
1개로 시뮬레이션)</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
2개</label></li>
<li><label><input type="checkbox" checked></input>Wi-Fi
네트워크</label></li>
<li><label><input type="checkbox" checked></input>HiveMQ Cloud 연결
정보</label></li>
</ul>
<blockquote>
<p><strong>💡 TIP</strong>: 헥사보드가 1개만 있다면 코드를 수정해가며
테스트할 수 있습니다!</p>
</blockquote>
<hr />
<h2 id="실습-1-헥사보드-a-센서-전송">💻 실습 1: 헥사보드 A (센서
전송)</h2>
<h3 id="보드-a-코드">보드 A 코드</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch14_board_A.py</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 헥사보드 A - 센서 데이터 전송</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span>  <span class="co"># 고유 ID</span></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정 (보드 A)</span></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a>TOPIC_STATUS <span class="op">=</span> <span class="st">&quot;hexaboard/A/status&quot;</span></span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 하드웨어</span></span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-34"><a href="#cb154-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb154-35"><a href="#cb154-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[A] Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb154-36"><a href="#cb154-36" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb154-37"><a href="#cb154-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-38"><a href="#cb154-38" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb154-39"><a href="#cb154-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb154-40"><a href="#cb154-40" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb154-41"><a href="#cb154-41" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb154-42"><a href="#cb154-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-43"><a href="#cb154-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb154-44"><a href="#cb154-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[A] ✅ Wi-Fi 연결 성공!&quot;</span>)</span>
<span id="cb154-45"><a href="#cb154-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb154-46"><a href="#cb154-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb154-47"><a href="#cb154-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-48"><a href="#cb154-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb154-49"><a href="#cb154-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결&quot;&quot;&quot;</span></span>
<span id="cb154-50"><a href="#cb154-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb154-51"><a href="#cb154-51" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb154-52"><a href="#cb154-52" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb154-53"><a href="#cb154-53" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb154-54"><a href="#cb154-54" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb154-55"><a href="#cb154-55" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb154-56"><a href="#cb154-56" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb154-57"><a href="#cb154-57" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb154-58"><a href="#cb154-58" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb154-59"><a href="#cb154-59" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb154-60"><a href="#cb154-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-61"><a href="#cb154-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 연결 상태 전송</span></span>
<span id="cb154-62"><a href="#cb154-62" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_STATUS, <span class="st">&quot;online&quot;</span>)</span>
<span id="cb154-63"><a href="#cb154-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-64"><a href="#cb154-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[A] ✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb154-65"><a href="#cb154-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb154-66"><a href="#cb154-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-67"><a href="#cb154-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb154-68"><a href="#cb154-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[A] ❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb154-69"><a href="#cb154-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb154-70"><a href="#cb154-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-71"><a href="#cb154-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> publish_sensor_data(client):</span>
<span id="cb154-72"><a href="#cb154-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 전송&quot;&quot;&quot;</span></span>
<span id="cb154-73"><a href="#cb154-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb154-74"><a href="#cb154-74" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb154-75"><a href="#cb154-75" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb154-76"><a href="#cb154-76" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb154-77"><a href="#cb154-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-78"><a href="#cb154-78" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> {</span>
<span id="cb154-79"><a href="#cb154-79" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;board&quot;</span>: <span class="st">&quot;A&quot;</span>,</span>
<span id="cb154-80"><a href="#cb154-80" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;temperature&quot;</span>: temp,</span>
<span id="cb154-81"><a href="#cb154-81" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;humidity&quot;</span>: humid,</span>
<span id="cb154-82"><a href="#cb154-82" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;timestamp&quot;</span>: time.time()</span>
<span id="cb154-83"><a href="#cb154-83" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-84"><a href="#cb154-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-85"><a href="#cb154-85" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> ujson.dumps(data)</span>
<span id="cb154-86"><a href="#cb154-86" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_SENSOR, message)</span>
<span id="cb154-87"><a href="#cb154-87" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[A] 📤 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb154-88"><a href="#cb154-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-89"><a href="#cb154-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb154-90"><a href="#cb154-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[A] ❌ 센서 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb154-91"><a href="#cb154-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-92"><a href="#cb154-92" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb154-93"><a href="#cb154-93" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb154-94"><a href="#cb154-94" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb154-95"><a href="#cb154-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-96"><a href="#cb154-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb154-97"><a href="#cb154-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[A] 센서 데이터 전송 시작...&quot;</span>)</span>
<span id="cb154-98"><a href="#cb154-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-99"><a href="#cb154-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb154-100"><a href="#cb154-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb154-101"><a href="#cb154-101" aria-hidden="true" tabindex="-1"></a>                publish_sensor_data(client)</span>
<span id="cb154-102"><a href="#cb154-102" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="dv">5</span>)  <span class="co"># 5초마다 전송</span></span>
<span id="cb154-103"><a href="#cb154-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-104"><a href="#cb154-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb154-105"><a href="#cb154-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">[A] 종료&quot;</span>)</span>
<span id="cb154-106"><a href="#cb154-106" aria-hidden="true" tabindex="-1"></a>            client.publish(TOPIC_STATUS, <span class="st">&quot;offline&quot;</span>)</span>
<span id="cb154-107"><a href="#cb154-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-108"><a href="#cb154-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb154-109"><a href="#cb154-109" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<p><strong>특징</strong>:</p>
<ul>
<li>Client ID: <code>hexaboard_A</code></li>
<li>Topic: <code>hexaboard/A/...</code></li>
<li>5초마다 센서 데이터 전송</li>
</ul>
<hr />
<h2 id="실습-2-헥사보드-b-제어-수신">💻 실습 2: 헥사보드 B (제어
수신)</h2>
<h3 id="보드-b-코드">보드 B 코드</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch14_board_B.py</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 헥사보드 B - LED 제어 수신</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_B&quot;</span>  <span class="co"># 고유 ID</span></span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정 (보드 B)</span></span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/B/control/led&quot;</span></span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>TOPIC_STATUS <span class="op">=</span> <span class="st">&quot;hexaboard/B/status&quot;</span></span>
<span id="cb155-25"><a href="#cb155-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-26"><a href="#cb155-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 하드웨어</span></span>
<span id="cb155-27"><a href="#cb155-27" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb155-28"><a href="#cb155-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-29"><a href="#cb155-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb155-30"><a href="#cb155-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb155-31"><a href="#cb155-31" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb155-32"><a href="#cb155-32" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb155-33"><a href="#cb155-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-34"><a href="#cb155-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb155-35"><a href="#cb155-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[B] Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb155-36"><a href="#cb155-36" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb155-37"><a href="#cb155-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-38"><a href="#cb155-38" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb155-39"><a href="#cb155-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb155-40"><a href="#cb155-40" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb155-41"><a href="#cb155-41" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb155-42"><a href="#cb155-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-43"><a href="#cb155-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb155-44"><a href="#cb155-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[B] ✅ Wi-Fi 연결 성공!&quot;</span>)</span>
<span id="cb155-45"><a href="#cb155-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb155-46"><a href="#cb155-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb155-47"><a href="#cb155-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-48"><a href="#cb155-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(topic, msg):</span>
<span id="cb155-49"><a href="#cb155-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;LED 제어 명령 수신&quot;&quot;&quot;</span></span>
<span id="cb155-50"><a href="#cb155-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[B] 📥 수신: </span><span class="sc">{</span>msg<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb155-51"><a href="#cb155-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-52"><a href="#cb155-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb155-53"><a href="#cb155-53" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> ujson.loads(msg)</span>
<span id="cb155-54"><a href="#cb155-54" aria-hidden="true" tabindex="-1"></a>        action <span class="op">=</span> data.get(<span class="st">&quot;action&quot;</span>)</span>
<span id="cb155-55"><a href="#cb155-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-56"><a href="#cb155-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> action <span class="op">==</span> <span class="st">&quot;led_on&quot;</span>:</span>
<span id="cb155-57"><a href="#cb155-57" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> data.get(<span class="st">&quot;color&quot;</span>, [<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>])</span>
<span id="cb155-58"><a href="#cb155-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb155-59"><a href="#cb155-59" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> <span class="bu">tuple</span>(color)</span>
<span id="cb155-60"><a href="#cb155-60" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb155-61"><a href="#cb155-61" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[B] 💡 LED ON: </span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb155-62"><a href="#cb155-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-63"><a href="#cb155-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&quot;led_off&quot;</span>:</span>
<span id="cb155-64"><a href="#cb155-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb155-65"><a href="#cb155-65" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb155-66"><a href="#cb155-66" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb155-67"><a href="#cb155-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;[B] 💡 LED OFF&quot;</span>)</span>
<span id="cb155-68"><a href="#cb155-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-69"><a href="#cb155-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb155-70"><a href="#cb155-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[B] ❌ 처리 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb155-71"><a href="#cb155-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-72"><a href="#cb155-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb155-73"><a href="#cb155-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결 및 Subscribe&quot;&quot;&quot;</span></span>
<span id="cb155-74"><a href="#cb155-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb155-75"><a href="#cb155-75" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb155-76"><a href="#cb155-76" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb155-77"><a href="#cb155-77" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb155-78"><a href="#cb155-78" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb155-79"><a href="#cb155-79" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb155-80"><a href="#cb155-80" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb155-81"><a href="#cb155-81" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb155-82"><a href="#cb155-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb155-83"><a href="#cb155-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-84"><a href="#cb155-84" aria-hidden="true" tabindex="-1"></a>        client.set_callback(on_message)</span>
<span id="cb155-85"><a href="#cb155-85" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb155-86"><a href="#cb155-86" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_CONTROL)</span>
<span id="cb155-87"><a href="#cb155-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-88"><a href="#cb155-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 상태 전송</span></span>
<span id="cb155-89"><a href="#cb155-89" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_STATUS, <span class="st">&quot;online&quot;</span>)</span>
<span id="cb155-90"><a href="#cb155-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-91"><a href="#cb155-91" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[B] ✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb155-92"><a href="#cb155-92" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[B] 📬 구독: </span><span class="sc">{</span>TOPIC_CONTROL<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb155-93"><a href="#cb155-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb155-94"><a href="#cb155-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-95"><a href="#cb155-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb155-96"><a href="#cb155-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[B] ❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb155-97"><a href="#cb155-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb155-98"><a href="#cb155-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-99"><a href="#cb155-99" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb155-100"><a href="#cb155-100" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb155-101"><a href="#cb155-101" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb155-102"><a href="#cb155-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-103"><a href="#cb155-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb155-104"><a href="#cb155-104" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[B] 제어 명령 대기 중...&quot;</span>)</span>
<span id="cb155-105"><a href="#cb155-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-106"><a href="#cb155-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb155-107"><a href="#cb155-107" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb155-108"><a href="#cb155-108" aria-hidden="true" tabindex="-1"></a>                client.check_msg()</span>
<span id="cb155-109"><a href="#cb155-109" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb155-110"><a href="#cb155-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-111"><a href="#cb155-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb155-112"><a href="#cb155-112" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">[B] 종료&quot;</span>)</span>
<span id="cb155-113"><a href="#cb155-113" aria-hidden="true" tabindex="-1"></a>            client.publish(TOPIC_STATUS, <span class="st">&quot;offline&quot;</span>)</span>
<span id="cb155-114"><a href="#cb155-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-115"><a href="#cb155-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb155-116"><a href="#cb155-116" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<p><strong>특징</strong>:</p>
<ul>
<li>Client ID: <code>hexaboard_B</code></li>
<li>Topic: <code>hexaboard/B/...</code></li>
<li>LED 제어 명령 수신</li>
</ul>
<hr />
<h2 id="실습-3-보드-간-통신">💻 실습 3: 보드 간 통신</h2>
<h3 id="보드-a-보드-b-메시지-전송">보드 A → 보드 B 메시지 전송</h3>
<p><strong>시나리오</strong>: 보드 A가 버튼을 누르면 보드 B의 LED가
켜짐</p>
<p><strong>보드 A 코드 (일부)</strong>:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch14_board_A_button.py</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 A - 버튼으로 보드 B 제어</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 버튼 설정</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>button_a <span class="op">=</span> Pin(<span class="dv">35</span>, Pin.IN, Pin.PULL_DOWN)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic (보드 B 제어)</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>TOPIC_B_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/B/control/led&quot;</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>last_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>    current_state <span class="op">=</span> button_a.value()</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 버튼 눌림 감지</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> current_state <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> last_state <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 보드 B에 LED ON 명령 전송</span></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> {<span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_on&quot;</span>, <span class="st">&quot;color&quot;</span>: [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>]}</span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> ujson.dumps(cmd)</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_B_CONTROL, message)</span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[A] → [B] LED ON 전송&quot;</span>)</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.05</span>)</span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>    last_state <span class="op">=</span> current_state</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>    client.check_msg()  <span class="co"># 보드 A도 메시지 수신 가능</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.01</span>)</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ol type="1">
<li>보드 A에서 버튼 A 누름</li>
<li><code>hexaboard/B/control/led</code> Topic으로 메시지 전송</li>
<li>보드 B가 메시지 수신</li>
<li>보드 B의 LED가 빨간색으로 켜짐</li>
</ol>
<hr />
<h2 id="실습-4-통합-모니터링">💻 실습 4: 통합 모니터링</h2>
<h3 id="모든-보드의-데이터-수신">모든 보드의 데이터 수신</h3>
<p><strong>Python 모니터링 스크립트</strong>:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch14_monitor.py</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 헥사보드 모니터링</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정 (와일드카드 사용)</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>TOPIC_ALL <span class="op">=</span> <span class="st">&quot;hexaboard/#&quot;</span>  <span class="co"># 모든 hexaboard Topic</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ Broker 연결 성공!&quot;</span>)</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_ALL)</span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_ALL<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 연결 실패: </span><span class="sc">{</span>rc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신&quot;&quot;&quot;</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>    topic <span class="op">=</span> msg.topic</span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> msg.payload.decode()</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📥 [</span><span class="sc">{</span>topic<span class="sc">}</span><span class="ss">]&quot;</span>)</span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(payload)</span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   데이터: </span><span class="sc">{</span>data<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb157-36"><a href="#cb157-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   내용: </span><span class="sc">{</span>payload<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb157-37"><a href="#cb157-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-38"><a href="#cb157-38" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트 생성</span></span>
<span id="cb157-39"><a href="#cb157-39" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb157-40"><a href="#cb157-40" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb157-41"><a href="#cb157-41" aria-hidden="true" tabindex="-1"></a>client.tls_set()  <span class="co"># TLS 활성화</span></span>
<span id="cb157-42"><a href="#cb157-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-43"><a href="#cb157-43" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb157-44"><a href="#cb157-44" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb157-45"><a href="#cb157-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-46"><a href="#cb157-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 연결 및 실행</span></span>
<span id="cb157-47"><a href="#cb157-47" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb157-48"><a href="#cb157-48" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb157-49"><a href="#cb157-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;모니터링 시작... (Ctrl+C로 종료)&quot;</span>)</span>
<span id="cb157-50"><a href="#cb157-50" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb157-51"><a href="#cb157-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-52"><a href="#cb157-52" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb157-53"><a href="#cb157-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">종료&quot;</span>)</span>
<span id="cb157-54"><a href="#cb157-54" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>동작</strong>:</p>
<ul>
<li>모든 <code>hexaboard/*</code> Topic 구독</li>
<li>모든 보드의 메시지 실시간 표시</li>
</ul>
<p><strong>출력 예시</strong>:</p>
<pre><code>✅ Broker 연결 성공!
📬 구독: hexaboard/#

📥 [hexaboard/A/sensor/data]
   데이터: {&#39;board&#39;: &#39;A&#39;, &#39;temperature&#39;: 25, &#39;humidity&#39;: 60, &#39;timestamp&#39;: 1234567890}

📥 [hexaboard/B/status]
   내용: online

📥 [hexaboard/A/sensor/data]
   데이터: {&#39;board&#39;: &#39;A&#39;, &#39;temperature&#39;: 26, &#39;humidity&#39;: 61, &#39;timestamp&#39;: 1234567895}</code></pre>
<hr />
<h2 id="topic-와일드카드">🎯 Topic 와일드카드</h2>
<h3 id="wildcard-사용법">Wildcard 사용법</h3>
<p>MQTT는 <strong>와일드카드</strong>를 지원해 여러 Topic을 한 번에
구독할 수 있습니다.</p>
<h4 id="single-level">1. <code>+</code> (Single Level)</h4>
<p>하나의 계층만 대체:</p>
<pre><code>hexaboard/+/sensor/data</code></pre>
<p><strong>매칭</strong>:</p>
<ul>
<li>✅ <code>hexaboard/A/sensor/data</code></li>
<li>✅ <code>hexaboard/B/sensor/data</code></li>
<li>❌ <code>hexaboard/A/control/led</code></li>
</ul>
<h4 id="multi-level">2. <code>#</code> (Multi Level)</h4>
<p>모든 하위 계층 대체:</p>
<pre><code>hexaboard/#</code></pre>
<p><strong>매칭</strong>:</p>
<ul>
<li>✅ <code>hexaboard/A/sensor/data</code></li>
<li>✅ <code>hexaboard/B/control/led</code></li>
<li>✅ <code>hexaboard/C/status</code></li>
<li>✅ 모든 hexaboard 관련 Topic</li>
</ul>
<p><strong>예시</strong>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 보드의 센서 데이터만 구독</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>client.subscribe(<span class="st">&quot;hexaboard/+/sensor/data&quot;</span>)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 A의 모든 Topic 구독</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>client.subscribe(<span class="st">&quot;hexaboard/A/#&quot;</span>)</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 보드의 상태만 구독</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>client.subscribe(<span class="st">&quot;hexaboard/+/status&quot;</span>)</span></code></pre></div>
<hr />
<h2 id="client-id-관리">🔐 Client ID 관리</h2>
<h3 id="고유한-client-id">고유한 Client ID</h3>
<p>각 헥사보드는 <strong>고유한 Client ID</strong>를 가져야 합니다.</p>
<p><strong>잘못된 예</strong>:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 보드에서 동일한 ID 사용 (❌)</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span></code></pre></div>
<p><strong>올바른 예</strong>:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 A</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 B</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_B&quot;</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 C</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_C&quot;</span></span></code></pre></div>
<p><strong>중복 시 문제</strong>:</p>
<ul>
<li>먼저 연결된 기기가 강제 연결 해제됨</li>
<li>계속 재연결 시도로 불안정</li>
</ul>
<hr />
<h2 id="시스템-확장">📊 시스템 확장</h2>
<h3 id="많은-보드-관리">많은 보드 관리</h3>
<p><strong>권장 구조</strong>:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 정보를 딕셔너리로 관리</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>boards <span class="op">=</span> {</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;A&quot;</span>: {<span class="st">&quot;location&quot;</span>: <span class="st">&quot;거실&quot;</span>, <span class="st">&quot;type&quot;</span>: <span class="st">&quot;sensor&quot;</span>},</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;B&quot;</span>: {<span class="st">&quot;location&quot;</span>: <span class="st">&quot;침실&quot;</span>, <span class="st">&quot;type&quot;</span>: <span class="st">&quot;control&quot;</span>},</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;C&quot;</span>: {<span class="st">&quot;location&quot;</span>: <span class="st">&quot;주방&quot;</span>, <span class="st">&quot;type&quot;</span>: <span class="st">&quot;sensor&quot;</span>}</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 동적으로 Topic 생성</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>board_id <span class="op">=</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>topic_sensor <span class="op">=</span> <span class="ss">f&quot;hexaboard/</span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">/sensor/data&quot;</span></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>topic_control <span class="op">=</span> <span class="ss">f&quot;hexaboard/</span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">/control/led&quot;</span></span></code></pre></div>
<hr />
<h2 id="문제-해결-6">🛠️ 문제 해결</h2>
<h3 id="client-id-중복">Client ID 중복</h3>
<pre><code>연결이 계속 끊어짐</code></pre>
<p><strong>원인</strong>: Client ID 중복</p>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 각 보드마다 다른 ID 사용</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span>  <span class="co"># 보드 A</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_B&quot;</span>  <span class="co"># 보드 B</span></span></code></pre></div>
<h3 id="topic-메시지가-안-보임">Topic 메시지가 안 보임</h3>
<pre><code>메시지를 보냈는데 다른 보드가 못 받음</code></pre>
<p><strong>원인</strong>: Topic 이름 불일치</p>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 보내는 쪽</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>client.publish(<span class="st">&quot;hexaboard/B/control/led&quot;</span>, msg)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 받는 쪽 (정확히 동일해야 함)</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>client.subscribe(<span class="st">&quot;hexaboard/B/control/led&quot;</span>)</span></code></pre></div>
<h3 id="연결-수-제한">연결 수 제한</h3>
<pre><code>100개 이상 연결 시도 시 실패</code></pre>
<p><strong>원인</strong>: HiveMQ 무료 플랜 제한 (최대 100개)</p>
<p><strong>해결</strong>:</p>
<ul>
<li>사용하지 않는 연결 정리</li>
<li>또는 유료 플랜으로 업그레이드</li>
</ul>
<hr />
<h2 id="도전-과제-8">🚀 도전 과제</h2>
<h3 id="과제-1-3개-보드-체인-통신">과제 1: 3개 보드 체인 통신</h3>
<p>보드 A → 보드 B → 보드 C 순서로 메시지를 전달하세요.</p>
<p><strong>힌트</strong>:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 A: B에게 전송</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>client.publish(<span class="st">&quot;hexaboard/B/message&quot;</span>, <span class="st">&quot;Hello B&quot;</span>)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 보드 B: C에게 전달</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(topic, msg):</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>    client.publish(<span class="st">&quot;hexaboard/C/message&quot;</span>, <span class="st">&quot;Hello C from B&quot;</span>)</span></code></pre></div>
<h3 id="과제-2-브로드캐스트-메시지">과제 2: 브로드캐스트 메시지</h3>
<p>하나의 메시지를 모든 보드가 동시에 받도록 구현하세요.</p>
<p><strong>힌트</strong>:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 공통 Topic</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>TOPIC_BROADCAST <span class="op">=</span> <span class="st">&quot;hexaboard/broadcast&quot;</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 보드가 구독</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>client.subscribe(TOPIC_BROADCAST)</span></code></pre></div>
<hr />
<h2 id="핵심-정리-3">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-3">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>Client ID</strong>: 각 기기마다 고유해야 함</li>
<li><strong>Topic 구조</strong>:
<code>hexaboard/&lt;보드ID&gt;/&lt;카테고리&gt;/&lt;항목&gt;</code></li>
<li><strong>와일드카드</strong>: <code>+</code> (단일), <code>#</code>
(전체)</li>
<li><strong>보드 간 통신</strong>: Topic만 맞으면 자유롭게 통신
가능</li>
<li><strong>모니터링</strong>: 와일드카드로 모든 메시지 확인</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-5">❓ 자주 묻는 질문</h2>
<h3 id="q1.-헥사보드를-몇-개까지-연결할-수-있나요">Q1. 헥사보드를 몇
개까지 연결할 수 있나요?</h3>
<p><strong>A</strong>: HiveMQ 무료 플랜은 최대 100개 연결을
지원합니다.</p>
<h3 id="q2.-client-id를-동일하게-해도-되나요">Q2. Client ID를 동일하게
해도 되나요?</h3>
<p><strong>A</strong>: 안 됩니다. Client ID가 같으면 먼저 연결된 기기가
강제 해제됩니다.</p>
<h3 id="q3.-보드-간-직접-통신이-가능한가요">Q3. 보드 간 직접 통신이
가능한가요?</h3>
<p><strong>A</strong>: MQTT는 Broker를 통해 통신합니다. 하지만 Topic을
통해 보드 간 메시지 전달이 가능합니다.</p>
<h3 id="q4.-와일드카드는-publish에도-사용할-수-있나요">Q4. 와일드카드는
Publish에도 사용할 수 있나요?</h3>
<p><strong>A</strong>: 아니요. 와일드카드는
<strong>Subscribe에만</strong> 사용 가능합니다.</p>
<hr />
<h2 id="다음-단계-4">🚀 다음 단계</h2>
<p>멀티 헥사보드 시스템을 완성했습니다!</p>
<p><strong>다음 PART에서는</strong>:</p>
<ul>
<li>Python AI 서버 구축</li>
<li>OpenAI API 연동</li>
<li>센서 데이터를 AI로 해석</li>
</ul>
<hr />
<p><strong>🎉 Chapter 14 완료!</strong><br />
<strong>🎉 PART 4 완료!</strong></p>
<p>이제 여러 헥사보드를 MQTT로 연결하고 통신할 수 있습니다!</p>
<h1 id="chapter-15.-python에서-mqtt-데이터-수신">Chapter 15. Python에서
MQTT 데이터 수신</h1>
<blockquote>
<p><strong>PART 5</strong>: Python + OpenAI로 AI 명령 엔진 만들기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-14">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>Python에서 MQTT 클라이언트를 구현할
수 있다</label></li>
<li><label><input type="checkbox"></input>헥사보드의 센서 데이터를 수신할 수
있다</label></li>
<li><label><input type="checkbox"></input>JSON 데이터를 파싱하고 저장할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-14">🎯 학습 목표</h2>
<h3 id="핵심-개념-14">핵심 개념</h3>
<ul>
<li><strong>paho-mqtt</strong>: Python MQTT 클라이언트 라이브러리</li>
<li><strong>Subscribe</strong>: 헥사보드 데이터 구독</li>
<li><strong>JSON 파싱</strong>: 센서 데이터 처리</li>
</ul>
<hr />
<h2 id="왜-python-서버가-필요한가">📖 왜 Python 서버가 필요한가?</h2>
<h3 id="python의-역할">Python의 역할</h3>
<p>헥사보드는 센서 데이터를 수집하고, <strong>Python 서버</strong>는
이를 받아서 처리합니다.</p>
<p><strong>Python 서버의 역할</strong>:</p>
<ul>
<li>✅ MQTT로 센서 데이터 수신</li>
<li>✅ 데이터 분석 및 저장</li>
<li>✅ AI(OpenAI)와 연동</li>
<li>✅ 제어 명령 생성 및 전송</li>
</ul>
<p><strong>시스템 구조</strong>:</p>
<pre><code>헥사보드 (MicroPython)
   ↓ MQTT Publish
MQTT Broker (HiveMQ)
   ↓ MQTT Subscribe
Python AI 서버 ← 이번 챕터!
   ↓ OpenAI API
AI 분석 및 제어
   ↓ MQTT Publish
헥사보드 (제어 실행)</code></pre>
<hr />
<h2 id="실습-준비-7">🔧 실습 준비</h2>
<h3 id="필요한-것-7">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>Python 3.10
이상</label></li>
<li><label><input type="checkbox" checked></input>HiveMQ Cloud 연결
정보</label></li>
<li><label><input type="checkbox" checked></input>헥사보드 (데이터
전송용)</label></li>
</ul>
<h3 id="python-라이브러리-설치">Python 라이브러리 설치</h3>
<p><strong>필요한 라이브러리</strong>:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install paho-mqtt python-dotenv</span></code></pre></div>
<p><strong>각 라이브러리 역할</strong>:</p>
<ul>
<li><code>paho-mqtt</code>: MQTT 클라이언트 라이브러리</li>
<li><code>python-dotenv</code>: 환경 변수 관리 (.env 파일 사용)</li>
</ul>
<hr />
<h2 id="실습-1-기본-mqtt-수신">💻 실습 1: 기본 MQTT 수신</h2>
<h3 id="python-mqtt-클라이언트-기본">Python MQTT 클라이언트 기본</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch15_mqtt_basic.py</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Python MQTT 기본 수신</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span>  <span class="co"># 본인의 Broker</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공 시 호출&quot;&quot;&quot;</span></span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT Broker 연결 성공!&quot;</span>)</span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Topic 구독</span></span>
<span id="cb174-20"><a href="#cb174-20" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb174-21"><a href="#cb174-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독 시작: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb174-22"><a href="#cb174-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb174-23"><a href="#cb174-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 연결 실패 (코드: </span><span class="sc">{</span>rc<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb174-24"><a href="#cb174-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-25"><a href="#cb174-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb174-26"><a href="#cb174-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신 시 호출&quot;&quot;&quot;</span></span>
<span id="cb174-27"><a href="#cb174-27" aria-hidden="true" tabindex="-1"></a>    topic <span class="op">=</span> msg.topic</span>
<span id="cb174-28"><a href="#cb174-28" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> msg.payload.decode()</span>
<span id="cb174-29"><a href="#cb174-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-30"><a href="#cb174-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📥 수신:&quot;</span>)</span>
<span id="cb174-31"><a href="#cb174-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Topic: </span><span class="sc">{</span>topic<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb174-32"><a href="#cb174-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Data: </span><span class="sc">{</span>payload<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb174-33"><a href="#cb174-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-34"><a href="#cb174-34" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트 생성</span></span>
<span id="cb174-35"><a href="#cb174-35" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb174-36"><a href="#cb174-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-37"><a href="#cb174-37" aria-hidden="true" tabindex="-1"></a><span class="co"># TLS 설정 (HiveMQ Cloud)</span></span>
<span id="cb174-38"><a href="#cb174-38" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb174-39"><a href="#cb174-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-40"><a href="#cb174-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 인증 정보 설정</span></span>
<span id="cb174-41"><a href="#cb174-41" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb174-42"><a href="#cb174-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-43"><a href="#cb174-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 콜백 함수 등록</span></span>
<span id="cb174-44"><a href="#cb174-44" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb174-45"><a href="#cb174-45" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb174-46"><a href="#cb174-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-47"><a href="#cb174-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Broker 연결</span></span>
<span id="cb174-48"><a href="#cb174-48" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb174-49"><a href="#cb174-49" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb174-50"><a href="#cb174-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;MQTT 서버 시작...&quot;</span>)</span>
<span id="cb174-51"><a href="#cb174-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Ctrl+C로 종료&quot;</span>)</span>
<span id="cb174-52"><a href="#cb174-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-53"><a href="#cb174-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 메시지 수신 대기 (무한 루프)</span></span>
<span id="cb174-54"><a href="#cb174-54" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb174-55"><a href="#cb174-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-56"><a href="#cb174-56" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb174-57"><a href="#cb174-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">서버 종료&quot;</span>)</span>
<span id="cb174-58"><a href="#cb174-58" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>핵심 코드 설명</strong>:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 클라이언트 생성</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. TLS 암호화 설정</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 인증 정보</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 콜백 함수</span></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect  <span class="co"># 연결 시</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message  <span class="co"># 메시지 수신 시</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. 연결 및 실행</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>client.loop_forever()  <span class="co"># 계속 수신</span></span></code></pre></div>
<p><strong>실행</strong>:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> ch15_mqtt_basic.py</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>MQTT 서버 시작...
Ctrl+C로 종료
✅ MQTT Broker 연결 성공!
📬 구독 시작: hexaboard/A/sensor/data

📥 수신:
   Topic: hexaboard/A/sensor/data
   Data: {&quot;temperature&quot;: 25, &quot;humidity&quot;: 60, &quot;timestamp&quot;: 1234567890}</code></pre>
<hr />
<h2 id="실습-2-json-데이터-파싱">💻 실습 2: JSON 데이터 파싱</h2>
<h3 id="센서-데이터-처리">센서 데이터 처리</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch15_mqtt_json.py</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="co"># JSON 데이터 파싱</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 연결 실패: </span><span class="sc">{</span>rc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신 및 처리&quot;&quot;&quot;</span></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON 파싱</span></span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> msg.payload.decode()</span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(payload)</span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 추출</span></span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> data.get(<span class="st">&quot;board&quot;</span>, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> data.get(<span class="st">&quot;light&quot;</span>)</span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a>        timestamp <span class="op">=</span> data.get(<span class="st">&quot;timestamp&quot;</span>)</span>
<span id="cb178-38"><a href="#cb178-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-39"><a href="#cb178-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 시간 변환</span></span>
<span id="cb178-40"><a href="#cb178-40" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb178-41"><a href="#cb178-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-42"><a href="#cb178-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 출력</span></span>
<span id="cb178-43"><a href="#cb178-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] 보드 </span><span class="sc">{</span>board<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb178-44"><a href="#cb178-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  🌡️  온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb178-45"><a href="#cb178-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  💧 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb178-46"><a href="#cb178-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb178-47"><a href="#cb178-47" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;  💡 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb178-48"><a href="#cb178-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb178-49"><a href="#cb178-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-50"><a href="#cb178-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb178-51"><a href="#cb178-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ JSON 파싱 오류: </span><span class="sc">{</span>msg<span class="sc">.</span>payload<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb178-52"><a href="#cb178-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb178-53"><a href="#cb178-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 처리 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb178-54"><a href="#cb178-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-55"><a href="#cb178-55" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트 생성 및 실행</span></span>
<span id="cb178-56"><a href="#cb178-56" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb178-57"><a href="#cb178-57" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb178-58"><a href="#cb178-58" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb178-59"><a href="#cb178-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-60"><a href="#cb178-60" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb178-61"><a href="#cb178-61" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb178-62"><a href="#cb178-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-63"><a href="#cb178-63" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb178-64"><a href="#cb178-64" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb178-65"><a href="#cb178-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Python MQTT 서버 시작...&quot;</span>)</span>
<span id="cb178-66"><a href="#cb178-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;센서 데이터 대기 중...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb178-67"><a href="#cb178-67" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb178-68"><a href="#cb178-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-69"><a href="#cb178-69" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb178-70"><a href="#cb178-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">서버 종료&quot;</span>)</span>
<span id="cb178-71"><a href="#cb178-71" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>Python MQTT 서버 시작...
센서 데이터 대기 중...

✅ MQTT 연결 성공!
📬 구독: hexaboard/A/sensor/data

[10:30:15] 보드 A
  🌡️  온도: 25°C
  💧 습도: 60%
  💡 조도: 800

[10:30:20] 보드 A
  🌡️  온도: 26°C
  💧 습도: 61%
  💡 조도: 810</code></pre>
<hr />
<h2 id="실습-3-데이터-저장">💻 실습 3: 데이터 저장</h2>
<h3 id="csv-파일에-저장">CSV 파일에 저장</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch15_mqtt_save.py</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 센서 데이터 저장</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span>  <span class="co"># 모든 보드</span></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a><span class="co"># CSV 파일 설정</span></span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a>CSV_FILE <span class="op">=</span> <span class="st">&quot;sensor_data.csv&quot;</span></span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_csv():</span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;CSV 파일 초기화&quot;&quot;&quot;</span></span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(CSV_FILE):</span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(CSV_FILE, <span class="st">&#39;w&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.writer(f)</span>
<span id="cb180-26"><a href="#cb180-26" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="st">&#39;Timestamp&#39;</span>, <span class="st">&#39;Board&#39;</span>, <span class="st">&#39;Temperature&#39;</span>, <span class="st">&#39;Humidity&#39;</span>, <span class="st">&#39;Light&#39;</span>])</span>
<span id="cb180-27"><a href="#cb180-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;✅ CSV 파일 생성: </span><span class="sc">{</span>CSV_FILE<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb180-28"><a href="#cb180-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-29"><a href="#cb180-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(board, temp, humid, light):</span>
<span id="cb180-30"><a href="#cb180-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;CSV 파일에 데이터 저장&quot;&quot;&quot;</span></span>
<span id="cb180-31"><a href="#cb180-31" aria-hidden="true" tabindex="-1"></a>    timestamp <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&quot;</span>)</span>
<span id="cb180-32"><a href="#cb180-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-33"><a href="#cb180-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(CSV_FILE, <span class="st">&#39;a&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb180-34"><a href="#cb180-34" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(f)</span>
<span id="cb180-35"><a href="#cb180-35" aria-hidden="true" tabindex="-1"></a>        writer.writerow([timestamp, board, temp, humid, light])</span>
<span id="cb180-36"><a href="#cb180-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-37"><a href="#cb180-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;💾 저장 완료: </span><span class="sc">{</span>timestamp<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb180-38"><a href="#cb180-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-39"><a href="#cb180-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb180-40"><a href="#cb180-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb180-41"><a href="#cb180-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb180-42"><a href="#cb180-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb180-43"><a href="#cb180-43" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb180-44"><a href="#cb180-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb180-45"><a href="#cb180-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb180-46"><a href="#cb180-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 연결 실패: </span><span class="sc">{</span>rc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb180-47"><a href="#cb180-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-48"><a href="#cb180-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb180-49"><a href="#cb180-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신 및 저장&quot;&quot;&quot;</span></span>
<span id="cb180-50"><a href="#cb180-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb180-51"><a href="#cb180-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON 파싱</span></span>
<span id="cb180-52"><a href="#cb180-52" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> msg.payload.decode()</span>
<span id="cb180-53"><a href="#cb180-53" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(payload)</span>
<span id="cb180-54"><a href="#cb180-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-55"><a href="#cb180-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 추출</span></span>
<span id="cb180-56"><a href="#cb180-56" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> data.get(<span class="st">&quot;board&quot;</span>, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb180-57"><a href="#cb180-57" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb180-58"><a href="#cb180-58" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb180-59"><a href="#cb180-59" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> data.get(<span class="st">&quot;light&quot;</span>)</span>
<span id="cb180-60"><a href="#cb180-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-61"><a href="#cb180-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 콘솔 출력</span></span>
<span id="cb180-62"><a href="#cb180-62" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb180-63"><a href="#cb180-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] 보드 </span><span class="sc">{</span>board<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%, 조도 </span><span class="sc">{</span>light<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb180-64"><a href="#cb180-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-65"><a href="#cb180-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV 저장</span></span>
<span id="cb180-66"><a href="#cb180-66" aria-hidden="true" tabindex="-1"></a>        save_to_csv(board, temp, humid, light)</span>
<span id="cb180-67"><a href="#cb180-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-68"><a href="#cb180-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb180-69"><a href="#cb180-69" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb180-70"><a href="#cb180-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-71"><a href="#cb180-71" aria-hidden="true" tabindex="-1"></a><span class="co"># CSV 초기화</span></span>
<span id="cb180-72"><a href="#cb180-72" aria-hidden="true" tabindex="-1"></a>init_csv()</span>
<span id="cb180-73"><a href="#cb180-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-74"><a href="#cb180-74" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트 생성</span></span>
<span id="cb180-75"><a href="#cb180-75" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb180-76"><a href="#cb180-76" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb180-77"><a href="#cb180-77" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb180-78"><a href="#cb180-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-79"><a href="#cb180-79" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb180-80"><a href="#cb180-80" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb180-81"><a href="#cb180-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-82"><a href="#cb180-82" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb180-83"><a href="#cb180-83" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb180-84"><a href="#cb180-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;센서 데이터 수집 및 저장 시작...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb180-85"><a href="#cb180-85" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb180-86"><a href="#cb180-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-87"><a href="#cb180-87" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb180-88"><a href="#cb180-88" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">서버 종료&quot;</span>)</span>
<span id="cb180-89"><a href="#cb180-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📁 데이터 저장 위치: </span><span class="sc">{</span>CSV_FILE<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb180-90"><a href="#cb180-90" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>CSV 파일 결과</strong>:</p>
<pre class="csv"><code>Timestamp,Board,Temperature,Humidity,Light
2025-11-25 10:30:15,A,25,60,800
2025-11-25 10:30:20,A,26,61,810
2025-11-25 10:30:25,B,24,58,750</code></pre>
<hr />
<h2 id="실습-4-환경-변수-사용">💻 실습 4: 환경 변수 사용</h2>
<h3 id="env-파일로-설정-관리">.env 파일로 설정 관리</h3>
<p><strong><code>.env</code> 파일 생성</strong>:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .env</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_BROKER</span><span class="op">=</span>abc123.s1.eu.hivemq.cloud</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_PORT</span><span class="op">=</span>8883</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_USER</span><span class="op">=</span>hexaboard</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_PASSWORD</span><span class="op">=</span>your_password_here</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="va">TOPIC_SENSOR</span><span class="op">=</span>hexaboard/+/sensor/data</span></code></pre></div>
<p><strong>Python 코드</strong>:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch15_mqtt_env.py</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 환경 변수 사용</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 환경 변수 로드</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 설정 불러오기</span></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_BROKER&quot;</span>)</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">&quot;MQTT_PORT&quot;</span>, <span class="dv">8883</span>))</span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_USER&quot;</span>)</span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_PASSWORD&quot;</span>)</span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> os.getenv(<span class="st">&quot;TOPIC_SENSOR&quot;</span>)</span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신&quot;&quot;&quot;</span></span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(msg.payload.decode())</span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> data.get(<span class="st">&quot;board&quot;</span>, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] 보드 </span><span class="sc">{</span>board<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb183-41"><a href="#cb183-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-42"><a href="#cb183-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb183-43"><a href="#cb183-43" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb183-44"><a href="#cb183-44" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb183-45"><a href="#cb183-45" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb183-46"><a href="#cb183-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-47"><a href="#cb183-47" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb183-48"><a href="#cb183-48" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb183-49"><a href="#cb183-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-50"><a href="#cb183-50" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb183-51"><a href="#cb183-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;연결 중: </span><span class="sc">{</span>MQTT_BROKER<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>MQTT_PORT<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb183-52"><a href="#cb183-52" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb183-53"><a href="#cb183-53" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb183-54"><a href="#cb183-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-55"><a href="#cb183-55" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb183-56"><a href="#cb183-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">서버 종료&quot;</span>)</span>
<span id="cb183-57"><a href="#cb183-57" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>장점</strong>:</p>
<ul>
<li>✅ 민감한 정보 분리 (Git에 올리지 않음)</li>
<li>✅ 설정 변경 용이</li>
<li>✅ 배포 환경별 다른 설정 사용 가능</li>
</ul>
<hr />
<h2 id="실습-5-여러-topic-구독">💻 실습 5: 여러 Topic 구독</h2>
<h3 id="와일드카드-사용">와일드카드 사용</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch15_mqtt_multi.py</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 여러 Topic 구독</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>        client.subscribe(<span class="st">&quot;hexaboard/+/sensor/data&quot;</span>)  <span class="co"># 모든 보드 센서</span></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>        client.subscribe(<span class="st">&quot;hexaboard/+/status&quot;</span>)       <span class="co"># 모든 보드 상태</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ 멀티 Topic 구독 완료</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📥 [</span><span class="sc">{</span>msg<span class="sc">.</span>topic<span class="sc">}</span><span class="ss">]&quot;</span>)</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>msg<span class="sc">.</span>payload<span class="sc">.</span>decode()<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a>client.loop_forever()</span></code></pre></div>
<p><strong>와일드카드</strong>:</p>
<ul>
<li><code>+</code>: 한 레벨 (예: <code>hexaboard/+/sensor</code>)</li>
<li><code>#</code>: 모든 하위 (예: <code>hexaboard/#</code>)</li>
</ul>
<hr />
<h2 id="문제-해결-7">🛠️ 문제 해결</h2>
<h3 id="연결-실패">연결 실패</h3>
<pre><code>❌ 연결 실패 (코드: 5)</code></pre>
<p><strong>원인</strong>: 인증 실패</p>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Username/Password 재확인</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;정확한_사용자명&quot;</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;정확한_비밀번호&quot;</span></span></code></pre></div>
<h3 id="tls-오류">TLS 오류</h3>
<pre><code>ssl.SSLError: [SSL: CERTIFICATE_VERIFY_FAILED]</code></pre>
<p><strong>원인</strong>: TLS 인증서 검증 실패</p>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 인증서 검증 비활성화 (개발용)</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ssl</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>client.tls_set(cert_reqs<span class="op">=</span>ssl.CERT_NONE)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 또는 인증서 지정</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>client.tls_set(certfile<span class="op">=</span><span class="st">&quot;path/to/cert.pem&quot;</span>)</span></code></pre></div>
<h3 id="메시지가-안-올-때">메시지가 안 올 때</h3>
<pre><code>연결은 되지만 메시지가 안 옴</code></pre>
<p><strong>확인 사항</strong>:</p>
<ol type="1">
<li>헥사보드가 데이터를 전송하고 있는지 확인</li>
<li>Topic 이름이 정확한지 확인</li>
<li>HiveMQ 대시보드에서 메시지 확인</li>
</ol>
<hr />
<h2 id="도전-과제-9">🚀 도전 과제</h2>
<h3 id="과제-1-데이터-필터링">과제 1: 데이터 필터링</h3>
<p>온도가 25°C 이상일 때만 출력하세요.</p>
<p><strong>힌트</strong>:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> temp <span class="op">&gt;=</span> <span class="dv">25</span>:</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;⚠️ 높은 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C&quot;</span>)</span></code></pre></div>
<h3 id="과제-2-실시간-통계">과제 2: 실시간 통계</h3>
<p>최근 5개 데이터의 평균 온도를 계산하세요.</p>
<p><strong>힌트</strong>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>temp_history <span class="op">=</span> []</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(temp_history) <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> <span class="bu">sum</span>(temp_history[<span class="op">-</span><span class="dv">5</span>:]) <span class="op">/</span> <span class="dv">5</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;평균 온도: </span><span class="sc">{</span>avg<span class="sc">:.1f}</span><span class="ss">°C&quot;</span>)</span></code></pre></div>
<hr />
<h2 id="핵심-정리-4">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-4">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>paho-mqtt</strong>: Python MQTT 클라이언트 라이브러리</li>
<li><strong>on_connect</strong>: 연결 성공 시 콜백</li>
<li><strong>on_message</strong>: 메시지 수신 시 콜백</li>
<li><strong>client.subscribe()</strong>: Topic 구독</li>
<li><strong>client.loop_forever()</strong>: 계속 수신</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-6">❓ 자주 묻는 질문</h2>
<h3 id="q1.-loop_forever는-무엇인가요">Q1. loop_forever()는
무엇인가요?</h3>
<p><strong>A</strong>: MQTT 클라이언트가 계속 실행되며 메시지를 수신하는
무한 루프입니다. Ctrl+C로 종료할 수 있습니다.</p>
<h3 id="q2.-여러-topic을-구독하려면">Q2. 여러 Topic을 구독하려면?</h3>
<p><strong>A</strong>: 와일드카드(<code>+</code>, <code>#</code>)를
사용하거나, <code>subscribe()</code>를 여러 번 호출하면 됩니다.</p>
<h3 id="q3.-.env-파일을-git에-올려도-되나요">Q3. .env 파일을 Git에
올려도 되나요?</h3>
<p><strong>A</strong>: 절대 안 됩니다! <code>.gitignore</code>에
<code>.env</code>를 추가하고, <code>.env.example</code>만 올리세요.</p>
<hr />
<h2 id="다음-단계-5">🚀 다음 단계</h2>
<p>Python으로 MQTT 데이터 수신에 성공했습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>센서 데이터 요약 및 통계</li>
<li>상태 해석 (좋음/나쁨)</li>
<li>AI 연동 준비</li>
</ul>
<hr />
<p><strong>🎉 Chapter 15 완료!</strong><br />
이제 Python 서버가 헥사보드의 센서 데이터를 실시간으로 받을 수
있습니다!</p>
<h1 id="chapter-16.-센서-데이터-요약과-상태-해석">Chapter 16. 센서
데이터 요약과 상태 해석</h1>
<blockquote>
<p><strong>PART 5</strong>: Python + OpenAI로 AI 명령 엔진 만들기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-15">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>센서 데이터를 요약할 수
있다</label></li>
<li><label><input type="checkbox"></input>통계 정보를 계산할 수 있다 (평균,
최대, 최소)</label></li>
<li><label><input type="checkbox"></input>상태를 해석할 수 있다
(좋음/나쁨)</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-15">🎯 학습 목표</h2>
<h3 id="핵심-개념-15">핵심 개념</h3>
<ul>
<li><strong>데이터 요약</strong>: 핵심 정보 추출</li>
<li><strong>통계 계산</strong>: 평균, 최대, 최소</li>
<li><strong>상태 해석</strong>: 센서 값의 의미 파악</li>
</ul>
<hr />
<h2 id="왜-데이터-요약이-필요한가">📖 왜 데이터 요약이 필요한가?</h2>
<h3 id="ai에게-전달할-정보">AI에게 전달할 정보</h3>
<p>센서 데이터를 <strong>그대로</strong> AI에 전달하면:</p>
<ul>
<li>❌ 너무 많은 데이터 (비용 증가)</li>
<li>❌ AI가 이해하기 어려움</li>
<li>❌ 응답 시간 느림</li>
</ul>
<p><strong>요약하면</strong>:</p>
<ul>
<li>✅ 핵심 정보만 전달</li>
<li>✅ AI가 이해하기 쉬움</li>
<li>✅ 빠른 응답</li>
</ul>
<p><strong>예시</strong>:</p>
<p><strong>요약 전</strong> (100개 데이터):</p>
<pre><code>{&quot;temp&quot;: 25, &quot;humid&quot;: 60}, {&quot;temp&quot;: 25, &quot;humid&quot;: 61}, ...</code></pre>
<p><strong>요약 후</strong>:</p>
<pre><code>평균 온도: 25.3°C (적정)
평균 습도: 60.5% (보통)
조도: 밝음</code></pre>
<hr />
<h2 id="실습-1-데이터-수집-및-저장">💻 실습 1: 데이터 수집 및 저장</h2>
<h3 id="최근-데이터-관리">최근 데이터 관리</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch16_data_collector.py</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 수집 및 관리</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 저장 (최근 10개)</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>sensor_data <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신 및 저장&quot;&quot;&quot;</span></span>
<span id="cb194-29"><a href="#cb194-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb194-30"><a href="#cb194-30" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(msg.payload.decode())</span>
<span id="cb194-31"><a href="#cb194-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-32"><a href="#cb194-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 타임스탬프 추가</span></span>
<span id="cb194-33"><a href="#cb194-33" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">&#39;received_at&#39;</span>] <span class="op">=</span> datetime.now().isoformat()</span>
<span id="cb194-34"><a href="#cb194-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-35"><a href="#cb194-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 저장</span></span>
<span id="cb194-36"><a href="#cb194-36" aria-hidden="true" tabindex="-1"></a>        sensor_data.append(data)</span>
<span id="cb194-37"><a href="#cb194-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-38"><a href="#cb194-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 출력</span></span>
<span id="cb194-39"><a href="#cb194-39" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb194-40"><a href="#cb194-40" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb194-41"><a href="#cb194-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span><span class="bu">len</span>(sensor_data)<span class="sc">}</span><span class="ss">/10] </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb194-42"><a href="#cb194-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-43"><a href="#cb194-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 10개 모이면 요약</span></span>
<span id="cb194-44"><a href="#cb194-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sensor_data) <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb194-45"><a href="#cb194-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📊 10개 데이터 수집 완료!&quot;</span>)</span>
<span id="cb194-46"><a href="#cb194-46" aria-hidden="true" tabindex="-1"></a>            show_summary()</span>
<span id="cb194-47"><a href="#cb194-47" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>()</span>
<span id="cb194-48"><a href="#cb194-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-49"><a href="#cb194-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb194-50"><a href="#cb194-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb194-51"><a href="#cb194-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-52"><a href="#cb194-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_summary():</span>
<span id="cb194-53"><a href="#cb194-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;데이터 요약 출력&quot;&quot;&quot;</span></span>
<span id="cb194-54"><a href="#cb194-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> sensor_data:</span>
<span id="cb194-55"><a href="#cb194-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;데이터 없음&quot;</span>)</span>
<span id="cb194-56"><a href="#cb194-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb194-57"><a href="#cb194-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-58"><a href="#cb194-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 온도 리스트</span></span>
<span id="cb194-59"><a href="#cb194-59" aria-hidden="true" tabindex="-1"></a>    temps <span class="op">=</span> [d.get(<span class="st">&quot;temperature&quot;</span>) <span class="cf">for</span> d <span class="kw">in</span> sensor_data <span class="cf">if</span> d.get(<span class="st">&quot;temperature&quot;</span>)]</span>
<span id="cb194-60"><a href="#cb194-60" aria-hidden="true" tabindex="-1"></a>    humids <span class="op">=</span> [d.get(<span class="st">&quot;humidity&quot;</span>) <span class="cf">for</span> d <span class="kw">in</span> sensor_data <span class="cf">if</span> d.get(<span class="st">&quot;humidity&quot;</span>)]</span>
<span id="cb194-61"><a href="#cb194-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-62"><a href="#cb194-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 통계 계산</span></span>
<span id="cb194-63"><a href="#cb194-63" aria-hidden="true" tabindex="-1"></a>    avg_temp <span class="op">=</span> <span class="bu">sum</span>(temps) <span class="op">/</span> <span class="bu">len</span>(temps) <span class="cf">if</span> temps <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb194-64"><a href="#cb194-64" aria-hidden="true" tabindex="-1"></a>    avg_humid <span class="op">=</span> <span class="bu">sum</span>(humids) <span class="op">/</span> <span class="bu">len</span>(humids) <span class="cf">if</span> humids <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb194-65"><a href="#cb194-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-66"><a href="#cb194-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;평균 온도: </span><span class="sc">{</span>avg_temp<span class="sc">:.1f}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb194-67"><a href="#cb194-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;평균 습도: </span><span class="sc">{</span>avg_humid<span class="sc">:.1f}</span><span class="ss">%&quot;</span>)</span>
<span id="cb194-68"><a href="#cb194-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-69"><a href="#cb194-69" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb194-70"><a href="#cb194-70" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb194-71"><a href="#cb194-71" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb194-72"><a href="#cb194-72" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb194-73"><a href="#cb194-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-74"><a href="#cb194-74" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb194-75"><a href="#cb194-75" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb194-76"><a href="#cb194-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-77"><a href="#cb194-77" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb194-78"><a href="#cb194-78" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb194-79"><a href="#cb194-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;데이터 수집 시작...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb194-80"><a href="#cb194-80" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb194-81"><a href="#cb194-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-82"><a href="#cb194-82" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb194-83"><a href="#cb194-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">서버 종료&quot;</span>)</span>
<span id="cb194-84"><a href="#cb194-84" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>데이터 수집 시작...

✅ MQTT 연결 성공!
📬 구독: hexaboard/+/sensor/data

[1/10] 25°C, 60%
[2/10] 26°C, 61%
...
[10/10] 24°C, 59%

📊 10개 데이터 수집 완료!
평균 온도: 25.3°C
평균 습도: 60.5%</code></pre>
<hr />
<h2 id="실습-2-통계-계산">💻 실습 2: 통계 계산</h2>
<h3 id="평균-최대-최소">평균, 최대, 최소</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch16_statistics.py</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 센서 데이터 통계</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SensorStats:</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 통계 클래스&quot;&quot;&quot;</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, maxlen<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.temperatures <span class="op">=</span> deque(maxlen<span class="op">=</span>maxlen)</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.humidities <span class="op">=</span> deque(maxlen<span class="op">=</span>maxlen)</span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lights <span class="op">=</span> deque(maxlen<span class="op">=</span>maxlen)</span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_data(<span class="va">self</span>, temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;데이터 추가&quot;&quot;&quot;</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.temperatures.append(temp)</span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> humid <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.humidities.append(humid)</span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.lights.append(light)</span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_temp_stats(<span class="va">self</span>):</span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;온도 통계&quot;&quot;&quot;</span></span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.temperatures:</span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;avg&#39;</span>: statistics.mean(<span class="va">self</span>.temperatures),</span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;min&#39;</span>: <span class="bu">min</span>(<span class="va">self</span>.temperatures),</span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;max&#39;</span>: <span class="bu">max</span>(<span class="va">self</span>.temperatures),</span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;median&#39;</span>: statistics.median(<span class="va">self</span>.temperatures),</span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;count&#39;</span>: <span class="bu">len</span>(<span class="va">self</span>.temperatures)</span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_humid_stats(<span class="va">self</span>):</span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;습도 통계&quot;&quot;&quot;</span></span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.humidities:</span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;avg&#39;</span>: statistics.mean(<span class="va">self</span>.humidities),</span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;min&#39;</span>: <span class="bu">min</span>(<span class="va">self</span>.humidities),</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;max&#39;</span>: <span class="bu">max</span>(<span class="va">self</span>.humidities),</span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;count&#39;</span>: <span class="bu">len</span>(<span class="va">self</span>.humidities)</span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-49"><a href="#cb196-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_summary(<span class="va">self</span>):</span>
<span id="cb196-50"><a href="#cb196-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;전체 요약&quot;&quot;&quot;</span></span>
<span id="cb196-51"><a href="#cb196-51" aria-hidden="true" tabindex="-1"></a>        temp_stats <span class="op">=</span> <span class="va">self</span>.get_temp_stats()</span>
<span id="cb196-52"><a href="#cb196-52" aria-hidden="true" tabindex="-1"></a>        humid_stats <span class="op">=</span> <span class="va">self</span>.get_humid_stats()</span>
<span id="cb196-53"><a href="#cb196-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-54"><a href="#cb196-54" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> []</span>
<span id="cb196-55"><a href="#cb196-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-56"><a href="#cb196-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp_stats:</span>
<span id="cb196-57"><a href="#cb196-57" aria-hidden="true" tabindex="-1"></a>            summary.append(<span class="ss">f&quot;🌡️  온도: </span><span class="sc">{</span>temp_stats[<span class="st">&#39;avg&#39;</span>]<span class="sc">:.1f}</span><span class="ss">°C (최소 </span><span class="sc">{</span>temp_stats[<span class="st">&#39;min&#39;</span>]<span class="sc">}</span><span class="ss">°C, 최대 </span><span class="sc">{</span>temp_stats[<span class="st">&#39;max&#39;</span>]<span class="sc">}</span><span class="ss">°C)&quot;</span>)</span>
<span id="cb196-58"><a href="#cb196-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-59"><a href="#cb196-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> humid_stats:</span>
<span id="cb196-60"><a href="#cb196-60" aria-hidden="true" tabindex="-1"></a>            summary.append(<span class="ss">f&quot;💧 습도: </span><span class="sc">{</span>humid_stats[<span class="st">&#39;avg&#39;</span>]<span class="sc">:.1f}</span><span class="ss">% (최소 </span><span class="sc">{</span>humid_stats[<span class="st">&#39;min&#39;</span>]<span class="sc">}</span><span class="ss">%, 최대 </span><span class="sc">{</span>humid_stats[<span class="st">&#39;max&#39;</span>]<span class="sc">}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb196-61"><a href="#cb196-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-62"><a href="#cb196-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(summary)</span>
<span id="cb196-63"><a href="#cb196-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-64"><a href="#cb196-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 사용 예시</span></span>
<span id="cb196-65"><a href="#cb196-65" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb196-66"><a href="#cb196-66" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> SensorStats()</span>
<span id="cb196-67"><a href="#cb196-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-68"><a href="#cb196-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 샘플 데이터 추가</span></span>
<span id="cb196-69"><a href="#cb196-69" aria-hidden="true" tabindex="-1"></a>    stats.add_data(<span class="dv">25</span>, <span class="dv">60</span>, <span class="dv">800</span>)</span>
<span id="cb196-70"><a href="#cb196-70" aria-hidden="true" tabindex="-1"></a>    stats.add_data(<span class="dv">26</span>, <span class="dv">61</span>, <span class="dv">810</span>)</span>
<span id="cb196-71"><a href="#cb196-71" aria-hidden="true" tabindex="-1"></a>    stats.add_data(<span class="dv">24</span>, <span class="dv">59</span>, <span class="dv">790</span>)</span>
<span id="cb196-72"><a href="#cb196-72" aria-hidden="true" tabindex="-1"></a>    stats.add_data(<span class="dv">25</span>, <span class="dv">60</span>, <span class="dv">800</span>)</span>
<span id="cb196-73"><a href="#cb196-73" aria-hidden="true" tabindex="-1"></a>    stats.add_data(<span class="dv">27</span>, <span class="dv">62</span>, <span class="dv">820</span>)</span>
<span id="cb196-74"><a href="#cb196-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-75"><a href="#cb196-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 통계 출력</span></span>
<span id="cb196-76"><a href="#cb196-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📊 센서 데이터 통계</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb196-77"><a href="#cb196-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(stats.get_summary())</span>
<span id="cb196-78"><a href="#cb196-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb196-79"><a href="#cb196-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-80"><a href="#cb196-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 상세 정보</span></span>
<span id="cb196-81"><a href="#cb196-81" aria-hidden="true" tabindex="-1"></a>    temp_stats <span class="op">=</span> stats.get_temp_stats()</span>
<span id="cb196-82"><a href="#cb196-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;온도 중앙값: </span><span class="sc">{</span>temp_stats[<span class="st">&#39;median&#39;</span>]<span class="sc">:.1f}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb196-83"><a href="#cb196-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;데이터 개수: </span><span class="sc">{</span>temp_stats[<span class="st">&#39;count&#39;</span>]<span class="sc">}</span><span class="ss">개&quot;</span>)</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>📊 센서 데이터 통계

🌡️  온도: 25.4°C (최소 24°C, 최대 27°C)
💧 습도: 60.4% (최소 59%, 최대 62%)

온도 중앙값: 25.0°C
데이터 개수: 5개</code></pre>
<hr />
<h2 id="실습-3-상태-해석">💻 실습 3: 상태 해석</h2>
<h3 id="센서-값의-의미-파악">센서 값의 의미 파악</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch16_interpret.py</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 상태 해석</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SensorInterpreter:</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 해석 클래스&quot;&quot;&quot;</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> interpret_temperature(<span class="va">self</span>, temp):</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;온도 해석&quot;&quot;&quot;</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">18</span>:</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;매우 추움&quot;</span>, <span class="st">&quot;😰&quot;</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">22</span>:</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;추움&quot;</span>, <span class="st">&quot;🥶&quot;</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">26</span>:</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;적정&quot;</span>, <span class="st">&quot;😊&quot;</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">30</span>:</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;더움&quot;</span>, <span class="st">&quot;🥵&quot;</span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;매우 더움&quot;</span>, <span class="st">&quot;🔥&quot;</span></span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> interpret_humidity(<span class="va">self</span>, humid):</span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;습도 해석&quot;&quot;&quot;</span></span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> humid <span class="op">&lt;</span> <span class="dv">30</span>:</span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;매우 건조&quot;</span>, <span class="st">&quot;🏜️&quot;</span></span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> humid <span class="op">&lt;</span> <span class="dv">40</span>:</span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;건조&quot;</span>, <span class="st">&quot;😐&quot;</span></span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> humid <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb198-27"><a href="#cb198-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;적정&quot;</span>, <span class="st">&quot;😊&quot;</span></span>
<span id="cb198-28"><a href="#cb198-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> humid <span class="op">&lt;</span> <span class="dv">70</span>:</span>
<span id="cb198-29"><a href="#cb198-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;습함&quot;</span>, <span class="st">&quot;💧&quot;</span></span>
<span id="cb198-30"><a href="#cb198-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb198-31"><a href="#cb198-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;매우 습함&quot;</span>, <span class="st">&quot;💦&quot;</span></span>
<span id="cb198-32"><a href="#cb198-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-33"><a href="#cb198-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> interpret_light(<span class="va">self</span>, light):</span>
<span id="cb198-34"><a href="#cb198-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;조도 해석&quot;&quot;&quot;</span></span>
<span id="cb198-35"><a href="#cb198-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb198-36"><a href="#cb198-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;매우 어두움&quot;</span>, <span class="st">&quot;🌑&quot;</span></span>
<span id="cb198-37"><a href="#cb198-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> light <span class="op">&lt;</span> <span class="dv">300</span>:</span>
<span id="cb198-38"><a href="#cb198-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;어두움&quot;</span>, <span class="st">&quot;🌘&quot;</span></span>
<span id="cb198-39"><a href="#cb198-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> light <span class="op">&lt;</span> <span class="dv">700</span>:</span>
<span id="cb198-40"><a href="#cb198-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;보통&quot;</span>, <span class="st">&quot;☁️&quot;</span></span>
<span id="cb198-41"><a href="#cb198-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> light <span class="op">&lt;</span> <span class="dv">1500</span>:</span>
<span id="cb198-42"><a href="#cb198-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;밝음&quot;</span>, <span class="st">&quot;🌤️&quot;</span></span>
<span id="cb198-43"><a href="#cb198-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb198-44"><a href="#cb198-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;매우 밝음&quot;</span>, <span class="st">&quot;☀️&quot;</span></span>
<span id="cb198-45"><a href="#cb198-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-46"><a href="#cb198-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_overall_status(<span class="va">self</span>, temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb198-47"><a href="#cb198-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;종합 상태&quot;&quot;&quot;</span></span>
<span id="cb198-48"><a href="#cb198-48" aria-hidden="true" tabindex="-1"></a>        temp_status, temp_emoji <span class="op">=</span> <span class="va">self</span>.interpret_temperature(temp)</span>
<span id="cb198-49"><a href="#cb198-49" aria-hidden="true" tabindex="-1"></a>        humid_status, humid_emoji <span class="op">=</span> <span class="va">self</span>.interpret_humidity(humid)</span>
<span id="cb198-50"><a href="#cb198-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-51"><a href="#cb198-51" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> []</span>
<span id="cb198-52"><a href="#cb198-52" aria-hidden="true" tabindex="-1"></a>        status.append(<span class="ss">f&quot;온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C (</span><span class="sc">{</span>temp_status<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>temp_emoji<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb198-53"><a href="#cb198-53" aria-hidden="true" tabindex="-1"></a>        status.append(<span class="ss">f&quot;습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">% (</span><span class="sc">{</span>humid_status<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>humid_emoji<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb198-54"><a href="#cb198-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-55"><a href="#cb198-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb198-56"><a href="#cb198-56" aria-hidden="true" tabindex="-1"></a>            light_status, light_emoji <span class="op">=</span> <span class="va">self</span>.interpret_light(light)</span>
<span id="cb198-57"><a href="#cb198-57" aria-hidden="true" tabindex="-1"></a>            status.append(<span class="ss">f&quot;조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>light_status<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>light_emoji<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb198-58"><a href="#cb198-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-59"><a href="#cb198-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(status)</span>
<span id="cb198-60"><a href="#cb198-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-61"><a href="#cb198-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_recommendation(<span class="va">self</span>, temp, humid):</span>
<span id="cb198-62"><a href="#cb198-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;권장 사항&quot;&quot;&quot;</span></span>
<span id="cb198-63"><a href="#cb198-63" aria-hidden="true" tabindex="-1"></a>        recommendations <span class="op">=</span> []</span>
<span id="cb198-64"><a href="#cb198-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-65"><a href="#cb198-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 온도 기반</span></span>
<span id="cb198-66"><a href="#cb198-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb198-67"><a href="#cb198-67" aria-hidden="true" tabindex="-1"></a>            recommendations.append(<span class="st">&quot;🔥 난방을 켜세요&quot;</span>)</span>
<span id="cb198-68"><a href="#cb198-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&gt;</span> <span class="dv">28</span>:</span>
<span id="cb198-69"><a href="#cb198-69" aria-hidden="true" tabindex="-1"></a>            recommendations.append(<span class="st">&quot;❄️ 냉방을 켜세요&quot;</span>)</span>
<span id="cb198-70"><a href="#cb198-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-71"><a href="#cb198-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 습도 기반</span></span>
<span id="cb198-72"><a href="#cb198-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> humid <span class="op">&lt;</span> <span class="dv">35</span>:</span>
<span id="cb198-73"><a href="#cb198-73" aria-hidden="true" tabindex="-1"></a>            recommendations.append(<span class="st">&quot;💧 가습기를 켜세요&quot;</span>)</span>
<span id="cb198-74"><a href="#cb198-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> humid <span class="op">&gt;</span> <span class="dv">65</span>:</span>
<span id="cb198-75"><a href="#cb198-75" aria-hidden="true" tabindex="-1"></a>            recommendations.append(<span class="st">&quot;💨 환기를 하세요&quot;</span>)</span>
<span id="cb198-76"><a href="#cb198-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-77"><a href="#cb198-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> recommendations:</span>
<span id="cb198-78"><a href="#cb198-78" aria-hidden="true" tabindex="-1"></a>            recommendations.append(<span class="st">&quot;✅ 환경이 쾌적합니다&quot;</span>)</span>
<span id="cb198-79"><a href="#cb198-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-80"><a href="#cb198-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(recommendations)</span>
<span id="cb198-81"><a href="#cb198-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-82"><a href="#cb198-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 사용 예시</span></span>
<span id="cb198-83"><a href="#cb198-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb198-84"><a href="#cb198-84" aria-hidden="true" tabindex="-1"></a>    interpreter <span class="op">=</span> SensorInterpreter()</span>
<span id="cb198-85"><a href="#cb198-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-86"><a href="#cb198-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 테스트 데이터</span></span>
<span id="cb198-87"><a href="#cb198-87" aria-hidden="true" tabindex="-1"></a>    test_cases <span class="op">=</span> [</span>
<span id="cb198-88"><a href="#cb198-88" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">25</span>, <span class="dv">60</span>, <span class="dv">800</span>),</span>
<span id="cb198-89"><a href="#cb198-89" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">30</span>, <span class="dv">70</span>, <span class="dv">1000</span>),</span>
<span id="cb198-90"><a href="#cb198-90" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">18</span>, <span class="dv">35</span>, <span class="dv">200</span>),</span>
<span id="cb198-91"><a href="#cb198-91" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb198-92"><a href="#cb198-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-93"><a href="#cb198-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (temp, humid, light) <span class="kw">in</span> <span class="bu">enumerate</span>(test_cases, <span class="dv">1</span>):</span>
<span id="cb198-94"><a href="#cb198-94" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📊 테스트 케이스 </span><span class="sc">{</span>i<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb198-95"><a href="#cb198-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(interpreter.get_overall_status(temp, humid, light))</span>
<span id="cb198-96"><a href="#cb198-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb198-97"><a href="#cb198-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;💡 권장 사항:&quot;</span>)</span>
<span id="cb198-98"><a href="#cb198-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(interpreter.get_recommendation(temp, humid))</span>
<span id="cb198-99"><a href="#cb198-99" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">50</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>📊 테스트 케이스 1

온도: 25°C (적정 😊)
습도: 60% (적정 😊)
조도: 800 (밝음 🌤️)

💡 권장 사항:
✅ 환경이 쾌적합니다

==================================================

📊 테스트 케이스 2

온도: 30°C (매우 더움 🔥)
습도: 70% (매우 습함 💦)
조도: 1000 (밝음 🌤️)

💡 권장 사항:
❄️ 냉방을 켜세요
💨 환기를 하세요

==================================================</code></pre>
<hr />
<h2 id="실습-4-실시간-요약-시스템">💻 실습 4: 실시간 요약 시스템</h2>
<h3 id="mqtt-통계-해석-통합">MQTT + 통계 + 해석 통합</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch16_summary_system.py</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 실시간 요약 시스템</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span></span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 저장</span></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>sensor_buffer <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataSummarizer:</span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;데이터 요약기&quot;&quot;&quot;</span></span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> interpret_temp(temp):</span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;온도 해석&quot;&quot;&quot;</span></span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;추움&quot;</span></span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">26</span>:</span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;적정&quot;</span></span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;더움&quot;</span></span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> interpret_humid(humid):</span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;습도 해석&quot;&quot;&quot;</span></span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> humid <span class="op">&lt;</span> <span class="dv">40</span>:</span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;건조&quot;</span></span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> humid <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;적정&quot;</span></span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;습함&quot;</span></span>
<span id="cb200-43"><a href="#cb200-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-44"><a href="#cb200-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb200-45"><a href="#cb200-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> summarize(data_list):</span>
<span id="cb200-46"><a href="#cb200-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;데이터 요약&quot;&quot;&quot;</span></span>
<span id="cb200-47"><a href="#cb200-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> data_list:</span>
<span id="cb200-48"><a href="#cb200-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;데이터 없음&quot;</span></span>
<span id="cb200-49"><a href="#cb200-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-50"><a href="#cb200-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 추출</span></span>
<span id="cb200-51"><a href="#cb200-51" aria-hidden="true" tabindex="-1"></a>        temps <span class="op">=</span> [d[<span class="st">&#39;temperature&#39;</span>] <span class="cf">for</span> d <span class="kw">in</span> data_list <span class="cf">if</span> <span class="st">&#39;temperature&#39;</span> <span class="kw">in</span> d]</span>
<span id="cb200-52"><a href="#cb200-52" aria-hidden="true" tabindex="-1"></a>        humids <span class="op">=</span> [d[<span class="st">&#39;humidity&#39;</span>] <span class="cf">for</span> d <span class="kw">in</span> data_list <span class="cf">if</span> <span class="st">&#39;humidity&#39;</span> <span class="kw">in</span> d]</span>
<span id="cb200-53"><a href="#cb200-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-54"><a href="#cb200-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> temps <span class="kw">or</span> <span class="kw">not</span> humids:</span>
<span id="cb200-55"><a href="#cb200-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;데이터 부족&quot;</span></span>
<span id="cb200-56"><a href="#cb200-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-57"><a href="#cb200-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 통계</span></span>
<span id="cb200-58"><a href="#cb200-58" aria-hidden="true" tabindex="-1"></a>        avg_temp <span class="op">=</span> statistics.mean(temps)</span>
<span id="cb200-59"><a href="#cb200-59" aria-hidden="true" tabindex="-1"></a>        avg_humid <span class="op">=</span> statistics.mean(humids)</span>
<span id="cb200-60"><a href="#cb200-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-61"><a href="#cb200-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 해석</span></span>
<span id="cb200-62"><a href="#cb200-62" aria-hidden="true" tabindex="-1"></a>        temp_status <span class="op">=</span> DataSummarizer.interpret_temp(avg_temp)</span>
<span id="cb200-63"><a href="#cb200-63" aria-hidden="true" tabindex="-1"></a>        humid_status <span class="op">=</span> DataSummarizer.interpret_humid(avg_humid)</span>
<span id="cb200-64"><a href="#cb200-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-65"><a href="#cb200-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 요약 생성</span></span>
<span id="cb200-66"><a href="#cb200-66" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb200-67"><a href="#cb200-67" aria-hidden="true" tabindex="-1"></a><span class="ss">📊 환경 요약 (최근 </span><span class="sc">{</span><span class="bu">len</span>(data_list)<span class="sc">}</span><span class="ss">개 데이터)</span></span>
<span id="cb200-68"><a href="#cb200-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-69"><a href="#cb200-69" aria-hidden="true" tabindex="-1"></a><span class="ss">🌡️  온도</span></span>
<span id="cb200-70"><a href="#cb200-70" aria-hidden="true" tabindex="-1"></a><span class="ss">  • 평균: </span><span class="sc">{</span>avg_temp<span class="sc">:.1f}</span><span class="ss">°C (</span><span class="sc">{</span>temp_status<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb200-71"><a href="#cb200-71" aria-hidden="true" tabindex="-1"></a><span class="ss">  • 범위: </span><span class="sc">{</span><span class="bu">min</span>(temps)<span class="sc">:.1f}</span><span class="ss">°C ~ </span><span class="sc">{</span><span class="bu">max</span>(temps)<span class="sc">:.1f}</span><span class="ss">°C</span></span>
<span id="cb200-72"><a href="#cb200-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-73"><a href="#cb200-73" aria-hidden="true" tabindex="-1"></a><span class="ss">💧 습도</span></span>
<span id="cb200-74"><a href="#cb200-74" aria-hidden="true" tabindex="-1"></a><span class="ss">  • 평균: </span><span class="sc">{</span>avg_humid<span class="sc">:.1f}</span><span class="ss">% (</span><span class="sc">{</span>humid_status<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb200-75"><a href="#cb200-75" aria-hidden="true" tabindex="-1"></a><span class="ss">  • 범위: </span><span class="sc">{</span><span class="bu">min</span>(humids)<span class="sc">:.1f}</span><span class="ss">% ~ </span><span class="sc">{</span><span class="bu">max</span>(humids)<span class="sc">:.1f}</span><span class="ss">%</span></span>
<span id="cb200-76"><a href="#cb200-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-77"><a href="#cb200-77" aria-hidden="true" tabindex="-1"></a><span class="ss">⏰ 마지막 업데이트: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)<span class="sc">}</span></span>
<span id="cb200-78"><a href="#cb200-78" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb200-79"><a href="#cb200-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> summary</span>
<span id="cb200-80"><a href="#cb200-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-81"><a href="#cb200-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb200-82"><a href="#cb200-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb200-83"><a href="#cb200-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb200-84"><a href="#cb200-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb200-85"><a href="#cb200-85" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb200-86"><a href="#cb200-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb200-87"><a href="#cb200-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-88"><a href="#cb200-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb200-89"><a href="#cb200-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신&quot;&quot;&quot;</span></span>
<span id="cb200-90"><a href="#cb200-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb200-91"><a href="#cb200-91" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(msg.payload.decode())</span>
<span id="cb200-92"><a href="#cb200-92" aria-hidden="true" tabindex="-1"></a>        sensor_buffer.append(data)</span>
<span id="cb200-93"><a href="#cb200-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-94"><a href="#cb200-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 간단한 출력</span></span>
<span id="cb200-95"><a href="#cb200-95" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb200-96"><a href="#cb200-96" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb200-97"><a href="#cb200-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📥 [</span><span class="sc">{</span><span class="bu">len</span>(sensor_buffer)<span class="sc">}</span><span class="ss">/10] </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb200-98"><a href="#cb200-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-99"><a href="#cb200-99" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5개마다 요약</span></span>
<span id="cb200-100"><a href="#cb200-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sensor_buffer) <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb200-101"><a href="#cb200-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb200-102"><a href="#cb200-102" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> DataSummarizer.summarize(<span class="bu">list</span>(sensor_buffer))</span>
<span id="cb200-103"><a href="#cb200-103" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(summary)</span>
<span id="cb200-104"><a href="#cb200-104" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">50</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb200-105"><a href="#cb200-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-106"><a href="#cb200-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb200-107"><a href="#cb200-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb200-108"><a href="#cb200-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-109"><a href="#cb200-109" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb200-110"><a href="#cb200-110" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb200-111"><a href="#cb200-111" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb200-112"><a href="#cb200-112" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb200-113"><a href="#cb200-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-114"><a href="#cb200-114" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb200-115"><a href="#cb200-115" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb200-116"><a href="#cb200-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-117"><a href="#cb200-117" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb200-118"><a href="#cb200-118" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb200-119"><a href="#cb200-119" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;실시간 요약 시스템 시작...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb200-120"><a href="#cb200-120" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb200-121"><a href="#cb200-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-122"><a href="#cb200-122" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb200-123"><a href="#cb200-123" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">서버 종료&quot;</span>)</span>
<span id="cb200-124"><a href="#cb200-124" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>실시간 요약 시스템 시작...

✅ MQTT 연결 성공!
📬 구독: hexaboard/+/sensor/data

📥 [1/10] 25°C, 60%
📥 [2/10] 26°C, 61%
📥 [3/10] 24°C, 59%
📥 [4/10] 25°C, 60%
📥 [5/10] 27°C, 62%

==================================================

📊 환경 요약 (최근 5개 데이터)

🌡️  온도
  • 평균: 25.4°C (적정)
  • 범위: 24.0°C ~ 27.0°C

💧 습도
  • 평균: 60.4% (적정)
  • 범위: 59.0% ~ 62.0%

⏰ 마지막 업데이트: 10:35:22

==================================================</code></pre>
<hr />
<h2 id="문제-해결-8">🛠️ 문제 해결</h2>
<h3 id="deque가-뭔가요">deque가 뭔가요?</h3>
<div class="sourceCode" id="cb202"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 최대 10개만 저장 (오래된 것 자동 삭제)</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">10</span>)</span></code></pre></div>
<p><strong>장점</strong>:</p>
<ul>
<li>자동으로 오래된 데이터 제거</li>
<li>메모리 효율적</li>
<li>빠른 삽입/삭제</li>
</ul>
<h3 id="통계-계산-오류">통계 계산 오류</h3>
<pre><code>statistics.StatisticsError: mean requires at least one data point</code></pre>
<p><strong>원인</strong>: 빈 리스트</p>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> temps:</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> statistics.mean(temps)</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
<hr />
<h2 id="도전-과제-10">🚀 도전 과제</h2>
<h3 id="과제-1-트렌드-분석">과제 1: 트렌드 분석</h3>
<p>최근 데이터가 증가 추세인지, 감소 추세인지 판단하세요.</p>
<p><strong>힌트</strong>:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> temps[<span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> temps[<span class="dv">0</span>]:</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📈 온도 상승 중&quot;</span>)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📉 온도 하강 중&quot;</span>)</span></code></pre></div>
<h3 id="과제-2-알림-시스템">과제 2: 알림 시스템</h3>
<p>온도가 30°C 이상이면 경고 메시지를 출력하세요.</p>
<hr />
<h2 id="핵심-정리-5">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-5">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>데이터 요약</strong>: AI에 전달하기 전 핵심 정보 추출</li>
<li><strong>통계 계산</strong>: 평균, 최대, 최소로 데이터 파악</li>
<li><strong>상태 해석</strong>: 숫자를 의미 있는 상태로 변환</li>
<li><strong>deque</strong>: 고정 크기 데이터 버퍼</li>
<li><strong>실시간 요약</strong>: 주기적으로 데이터 정리</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-7">❓ 자주 묻는 질문</h2>
<h3 id="q1.-몇-개의-데이터로-요약해야-하나요">Q1. 몇 개의 데이터로
요약해야 하나요?</h3>
<p><strong>A</strong>: 10~20개 정도가 적당합니다. 너무 적으면 통계가
불안정하고, 너무 많으면 실시간성이 떨어집니다.</p>
<h3 id="q2.-중앙값median과-평균mean의-차이는">Q2. 중앙값(median)과
평균(mean)의 차이는?</h3>
<p><strong>A</strong>: 중앙값은 이상치(outlier)에 덜 민감합니다. 평균은
모든 값을 고려합니다.</p>
<h3 id="q3.-상태-해석-기준은-어떻게-정하나요">Q3. 상태 해석 기준은
어떻게 정하나요?</h3>
<p><strong>A</strong>: 환경 기준, 사용자 선호도, 국제 표준 등을 참고하여
정합니다.</p>
<hr />
<h2 id="다음-단계-6">🚀 다음 단계</h2>
<p>센서 데이터를 요약하고 해석할 수 있게 되었습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>OpenAI API 연동</li>
<li>요약된 데이터를 AI에 전달</li>
<li>자연어로 상태 설명 받기</li>
</ul>
<hr />
<p><strong>🎉 Chapter 16 완료!</strong><br />
이제 센서 데이터를 의미 있는 정보로 변환할 수 있습니다!</p>
<h1 id="chapter-17.-openai-api-연동-및-프롬프트-설계">Chapter 17. OpenAI
API 연동 및 프롬프트 설계</h1>
<blockquote>
<p><strong>PART 5</strong>: Python + OpenAI로 AI 명령 엔진 만들기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-16">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>OpenAI API를 연동할 수
있다</label></li>
<li><label><input type="checkbox"></input>센서 데이터를 자연어로 변환할 수
있다</label></li>
<li><label><input type="checkbox"></input>효과적인 프롬프트를 설계할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-16">🎯 학습 목표</h2>
<h3 id="핵심-개념-16">핵심 개념</h3>
<ul>
<li><strong>OpenAI API</strong>: GPT-4를 사용한 AI 분석</li>
<li><strong>프롬프트</strong>: AI에게 주는 명령/질문</li>
<li><strong>자연어 생성</strong>: 센서 데이터를 사람이 이해하기 쉬운
문장으로 변환</li>
</ul>
<hr />
<h2 id="openai-api란">📖 OpenAI API란?</h2>
<h3 id="gpt를-코드로-사용하기">GPT를 코드로 사용하기</h3>
<p><strong>OpenAI API</strong>는 ChatGPT와 같은 AI 모델을 프로그램에서
사용할 수 있게 해줍니다.</p>
<p><strong>가능한 작업</strong>:</p>
<ul>
<li>✅ 센서 데이터 분석 및 설명</li>
<li>✅ 환경 상태 해석</li>
<li>✅ 제어 명령 생성</li>
<li>✅ 사용자 질문에 답변</li>
</ul>
<p><strong>우리 프로젝트에서의 역할</strong>:</p>
<pre><code>센서 데이터 (25°C, 60%)
  ↓
OpenAI API
  ↓
자연어 설명 (&quot;쾌적한 환경입니다&quot;)
  ↓
제어 명령 (LED 초록색)</code></pre>
<hr />
<h2 id="실습-준비-8">🔧 실습 준비</h2>
<h3 id="openai-api-키-발급">OpenAI API 키 발급</h3>
<ol type="1">
<li><p><strong>OpenAI 웹사이트 접속</strong></p>
<ul>
<li>https://platform.openai.com/</li>
</ul></li>
<li><p><strong>회원가입/로그인</strong></p></li>
<li><p><strong>API 키 생성</strong></p>
<ul>
<li>Settings → API Keys → Create new secret key</li>
<li>키를 복사하여 안전하게 보관</li>
</ul></li>
<li><p><strong>요금 확인</strong></p>
<ul>
<li>Pay-as-you-go (사용한 만큼 지불)</li>
<li>GPT-4: ~$0.03 / 1K tokens</li>
<li>테스트용으로는 몇 달러면 충분</li>
</ul></li>
</ol>
<h3 id="라이브러리-설치">라이브러리 설치</h3>
<div class="sourceCode" id="cb207"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install openai python-dotenv</span></code></pre></div>
<h3 id="env-파일-설정">.env 파일 설정</h3>
<div class="sourceCode" id="cb208"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .env</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="va">OPENAI_API_KEY</span><span class="op">=</span>sk-proj-XXXXXXXXXXXXXXXXXXXX</span></code></pre></div>
<p>⚠️ <strong>중요</strong>: API 키를 절대 Git에 올리지 마세요!</p>
<hr />
<h2 id="실습-1-openai-api-기본-사용">💻 실습 1: OpenAI API 기본
사용</h2>
<h3 id="첫-번째-api-호출">첫 번째 API 호출</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch17_openai_basic.py</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenAI API 기본 사용</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 환경 변수 로드</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenAI 클라이언트 생성</span></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ask_gpt(prompt):</span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;GPT에게 질문&quot;&quot;&quot;</span></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb209-19"><a href="#cb209-19" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb209-20"><a href="#cb209-20" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;당신은 IoT 환경 분석 전문가입니다.&quot;</span>},</span>
<span id="cb209-21"><a href="#cb209-21" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb209-22"><a href="#cb209-22" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb209-23"><a href="#cb209-23" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb209-24"><a href="#cb209-24" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb209-25"><a href="#cb209-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb209-26"><a href="#cb209-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-27"><a href="#cb209-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span>
<span id="cb209-28"><a href="#cb209-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-29"><a href="#cb209-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb209-30"><a href="#cb209-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb209-31"><a href="#cb209-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-32"><a href="#cb209-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb209-33"><a href="#cb209-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb209-34"><a href="#cb209-34" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="st">&quot;온도 25°C, 습도 60%인 환경에 대해 설명해주세요.&quot;</span></span>
<span id="cb209-35"><a href="#cb209-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-36"><a href="#cb209-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📤 질문:&quot;</span>)</span>
<span id="cb209-37"><a href="#cb209-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(prompt)</span>
<span id="cb209-38"><a href="#cb209-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">🤖 AI 응답:&quot;</span>)</span>
<span id="cb209-39"><a href="#cb209-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-40"><a href="#cb209-40" aria-hidden="true" tabindex="-1"></a>    answer <span class="op">=</span> ask_gpt(prompt)</span>
<span id="cb209-41"><a href="#cb209-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(answer)</span></code></pre></div>
<p><strong>주요 파라미터</strong>:</p>
<ul>
<li><code>model</code>: 사용할 AI 모델 (<code>gpt-4</code>,
<code>gpt-3.5-turbo</code>)</li>
<li><code>messages</code>: 대화 내용
<ul>
<li><code>system</code>: AI의 역할 설정</li>
<li><code>user</code>: 사용자 질문</li>
</ul></li>
<li><code>max_tokens</code>: 최대 응답 길이</li>
<li><code>temperature</code>: 창의성 (0~2, 낮을수록 일관적)</li>
</ul>
<p><strong>출력 예시</strong>:</p>
<pre><code>📤 질문:
온도 25°C, 습도 60%인 환경에 대해 설명해주세요.

🤖 AI 응답:
현재 환경은 매우 쾌적합니다. 온도 25°C는 실내 적정 온도 범위(22-26°C)에 포함되며, 습도 60%도 이상적인 범위(40-60%)에 있습니다. 이러한 환경에서는 대부분의 사람들이 편안함을 느끼며, 별도의 냉난방 조절이 필요하지 않습니다.</code></pre>
<hr />
<h2 id="실습-2-센서-데이터-분석">💻 실습 2: 센서 데이터 분석</h2>
<h3 id="센서-데이터를-ai로-분석">센서 데이터를 AI로 분석</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch17_analyze_sensor.py</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 센서 데이터 AI 분석</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_sensor_data(temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 분석&quot;&quot;&quot;</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 프롬프트 생성</span></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a><span class="ss">다음 센서 데이터를 분석하고 환경 상태를 설명해주세요:</span></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> light <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="ss">f&quot;- 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a><span class="st">다음 항목을 포함해 3-4문장으로 설명해주세요:</span></span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a><span class="st">1. 현재 환경 상태</span></span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a><span class="st">2. 쾌적도 평가</span></span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a><span class="st">3. 간단한 권장 사항</span></span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb211-33"><a href="#cb211-33" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb211-34"><a href="#cb211-34" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb211-35"><a href="#cb211-35" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb211-36"><a href="#cb211-36" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;당신은 실내 환경 분석 전문가입니다. 간결하고 명확하게 답변하세요.&quot;</span>},</span>
<span id="cb211-37"><a href="#cb211-37" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb211-38"><a href="#cb211-38" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb211-39"><a href="#cb211-39" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">250</span>,</span>
<span id="cb211-40"><a href="#cb211-40" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb211-41"><a href="#cb211-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb211-42"><a href="#cb211-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-43"><a href="#cb211-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span>
<span id="cb211-44"><a href="#cb211-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-45"><a href="#cb211-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb211-46"><a href="#cb211-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;분석 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb211-47"><a href="#cb211-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-48"><a href="#cb211-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb211-49"><a href="#cb211-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb211-50"><a href="#cb211-50" aria-hidden="true" tabindex="-1"></a>    test_cases <span class="op">=</span> [</span>
<span id="cb211-51"><a href="#cb211-51" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">25</span>, <span class="dv">60</span>, <span class="dv">800</span>),   <span class="co"># 쾌적</span></span>
<span id="cb211-52"><a href="#cb211-52" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">30</span>, <span class="dv">75</span>, <span class="dv">1200</span>),  <span class="co"># 덥고 습함</span></span>
<span id="cb211-53"><a href="#cb211-53" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">18</span>, <span class="dv">35</span>, <span class="dv">200</span>),   <span class="co"># 춥고 건조</span></span>
<span id="cb211-54"><a href="#cb211-54" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb211-55"><a href="#cb211-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-56"><a href="#cb211-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (temp, humid, light) <span class="kw">in</span> <span class="bu">enumerate</span>(test_cases, <span class="dv">1</span>):</span>
<span id="cb211-57"><a href="#cb211-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb211-58"><a href="#cb211-58" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;테스트 케이스 </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%, 조도 </span><span class="sc">{</span>light<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb211-59"><a href="#cb211-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb211-60"><a href="#cb211-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-61"><a href="#cb211-61" aria-hidden="true" tabindex="-1"></a>        analysis <span class="op">=</span> analyze_sensor_data(temp, humid, light)</span>
<span id="cb211-62"><a href="#cb211-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(analysis)</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>============================================================
테스트 케이스 1: 25°C, 60%, 조도 800
============================================================

현재 환경은 매우 쾌적한 상태입니다. 온도 25°C와 습도 60%는 모두 이상적인 범위에 있으며, 조도 800도 실내 활동에 적합한 밝기입니다. 대부분의 사람들이 편안함을 느낄 수 있는 환경으로, 별도의 환경 조절이 필요하지 않습니다. 현재 상태를 유지하시면 됩니다.

============================================================
테스트 케이스 2: 30°C, 75%, 조도 1200
============================================================

현재 환경은 다소 불쾌한 상태입니다. 온도 30°C는 적정 온도보다 높고, 습도 75%도 권장 범위를 초과하여 끈적이고 답답함을 느낄 수 있습니다. 조도 1200은 매우 밝은 편입니다. 에어컨이나 선풍기로 온도를 낮추고, 제습기를 사용하거나 환기를 통해 습도를 조절하는 것이 좋습니다.</code></pre>
<hr />
<h2 id="실습-3-프롬프트-설계">💻 실습 3: 프롬프트 설계</h2>
<h3 id="효과적인-프롬프트-작성">효과적인 프롬프트 작성</h3>
<p><strong>좋은 프롬프트의 조건</strong>:</p>
<ol type="1">
<li>✅ <strong>명확한 역할</strong> 정의 (system message)</li>
<li>✅ <strong>구체적인 데이터</strong> 제공</li>
<li>✅ <strong>원하는 출력 형식</strong> 지정</li>
<li>✅ <strong>예시</strong> 제공 (필요 시)</li>
</ol>
<p><strong>예시 1: 나쁜 프롬프트</strong></p>
<div class="sourceCode" id="cb213"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">&quot;온도 25도&quot;</span></span></code></pre></div>
<p>❌ 무엇을 원하는지 불명확</p>
<p><strong>예시 2: 좋은 프롬프트</strong></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="st">센서 데이터:</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="st">- 온도: 25°C</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="st">- 습도: 60%</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="st">위 데이터를 분석하여 다음 형식으로 답변해주세요:</span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="st">1. 환경 상태 (한 문장)</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="st">2. 권장 조치 (있으면 제시, 없으면 &quot;없음&quot;)</span></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span></code></pre></div>
<p>✅ 명확하고 구조화됨</p>
<p><strong>프롬프트 템플릿</strong>:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch17_prompt_template.py</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 프롬프트 템플릿</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PromptBuilder:</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;프롬프트 생성 클래스&quot;&quot;&quot;</span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_analysis_prompt(temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;분석용 프롬프트&quot;&quot;&quot;</span></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a><span class="ss">당신은 실내 환경 분석 AI입니다.</span></span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="ss">## 현재 센서 데이터</span></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">+=</span> <span class="ss">f&quot;- 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a><span class="st">## 분석 요청</span></span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a><span class="st">위 데이터를 바탕으로 다음을 제공해주세요:</span></span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a><span class="st">1. **환경 평가**: 현재 환경이 쾌적한지 평가 (한 문장)</span></span>
<span id="cb215-27"><a href="#cb215-27" aria-hidden="true" tabindex="-1"></a><span class="st">2. **문제점**: 있다면 구체적으로 언급 (없으면 &quot;없음&quot;)</span></span>
<span id="cb215-28"><a href="#cb215-28" aria-hidden="true" tabindex="-1"></a><span class="st">3. **권장 조치**: 개선이 필요하면 구체적인 방법 제시 (없으면 &quot;현재 상태 유지&quot;)</span></span>
<span id="cb215-29"><a href="#cb215-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-30"><a href="#cb215-30" aria-hidden="true" tabindex="-1"></a><span class="st">## 답변 형식</span></span>
<span id="cb215-31"><a href="#cb215-31" aria-hidden="true" tabindex="-1"></a><span class="st">간결하고 실용적으로 답변해주세요. (100자 이내)</span></span>
<span id="cb215-32"><a href="#cb215-32" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb215-33"><a href="#cb215-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> prompt</span>
<span id="cb215-34"><a href="#cb215-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-35"><a href="#cb215-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb215-36"><a href="#cb215-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_control_prompt(temp, humid):</span>
<span id="cb215-37"><a href="#cb215-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;제어 명령 생성용 프롬프트&quot;&quot;&quot;</span></span>
<span id="cb215-38"><a href="#cb215-38" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb215-39"><a href="#cb215-39" aria-hidden="true" tabindex="-1"></a><span class="ss">센서 데이터:</span></span>
<span id="cb215-40"><a href="#cb215-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb215-41"><a href="#cb215-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb215-42"><a href="#cb215-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-43"><a href="#cb215-43" aria-hidden="true" tabindex="-1"></a><span class="ss">위 데이터를 바탕으로 LED 색상을 추천해주세요:</span></span>
<span id="cb215-44"><a href="#cb215-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- 쾌적함: 초록색</span></span>
<span id="cb215-45"><a href="#cb215-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- 주의 필요: 노란색</span></span>
<span id="cb215-46"><a href="#cb215-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- 개선 필요: 빨간색</span></span>
<span id="cb215-47"><a href="#cb215-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-48"><a href="#cb215-48" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;초록색&quot;, &quot;노란색&quot;, &quot;빨간색&quot; 중 하나만 답변하세요.</span></span>
<span id="cb215-49"><a href="#cb215-49" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb215-50"><a href="#cb215-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> prompt</span>
<span id="cb215-51"><a href="#cb215-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-52"><a href="#cb215-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 사용 예시</span></span>
<span id="cb215-53"><a href="#cb215-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb215-54"><a href="#cb215-54" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb215-55"><a href="#cb215-55" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb215-56"><a href="#cb215-56" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb215-57"><a href="#cb215-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-58"><a href="#cb215-58" aria-hidden="true" tabindex="-1"></a>    load_dotenv()</span>
<span id="cb215-59"><a href="#cb215-59" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb215-60"><a href="#cb215-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-61"><a href="#cb215-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 분석 프롬프트 테스트</span></span>
<span id="cb215-62"><a href="#cb215-62" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> PromptBuilder.build_analysis_prompt(<span class="dv">30</span>, <span class="dv">75</span>, <span class="dv">1200</span>)</span>
<span id="cb215-63"><a href="#cb215-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-64"><a href="#cb215-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📤 프롬프트:&quot;</span>)</span>
<span id="cb215-65"><a href="#cb215-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(prompt)</span>
<span id="cb215-66"><a href="#cb215-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb215-67"><a href="#cb215-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-68"><a href="#cb215-68" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb215-69"><a href="#cb215-69" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb215-70"><a href="#cb215-70" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[</span>
<span id="cb215-71"><a href="#cb215-71" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb215-72"><a href="#cb215-72" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb215-73"><a href="#cb215-73" aria-hidden="true" tabindex="-1"></a>        max_tokens<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb215-74"><a href="#cb215-74" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb215-75"><a href="#cb215-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb215-76"><a href="#cb215-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-77"><a href="#cb215-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;🤖 AI 응답:&quot;</span>)</span>
<span id="cb215-78"><a href="#cb215-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(response.choices[<span class="dv">0</span>].message.content)</span></code></pre></div>
<hr />
<h2 id="실습-4-실시간-ai-분석-시스템">💻 실습 4: 실시간 AI 분석
시스템</h2>
<h3 id="mqtt-openai-통합">MQTT + OpenAI 통합</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch17_ai_system.py</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 실시간 AI 분석 시스템</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 환경 변수 로드</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 설정</span></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_BROKER&quot;</span>)</span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">&quot;MQTT_PORT&quot;</span>, <span class="dv">8883</span>))</span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_USER&quot;</span>)</span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_PASSWORD&quot;</span>)</span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span></span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenAI 클라이언트</span></span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>openai_client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_with_ai(temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;AI로 센서 데이터 분석&quot;&quot;&quot;</span></span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a><span class="ss">센서 데이터 분석:</span></span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> light:</span>
<span id="cb216-33"><a href="#cb216-33" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="ss">f&quot;- 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb216-34"><a href="#cb216-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-35"><a href="#cb216-35" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">+=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">환경을 한 문장으로 평가하고, 필요한 조치를 제안해주세요.&quot;</span></span>
<span id="cb216-36"><a href="#cb216-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-37"><a href="#cb216-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb216-38"><a href="#cb216-38" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb216-39"><a href="#cb216-39" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb216-40"><a href="#cb216-40" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb216-41"><a href="#cb216-41" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;실내 환경 분석 전문가. 간결하게 답변.&quot;</span>},</span>
<span id="cb216-42"><a href="#cb216-42" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb216-43"><a href="#cb216-43" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb216-44"><a href="#cb216-44" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb216-45"><a href="#cb216-45" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb216-46"><a href="#cb216-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb216-47"><a href="#cb216-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-48"><a href="#cb216-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span>
<span id="cb216-49"><a href="#cb216-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-50"><a href="#cb216-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb216-51"><a href="#cb216-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;AI 분석 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb216-52"><a href="#cb216-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-53"><a href="#cb216-53" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb216-54"><a href="#cb216-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결&quot;&quot;&quot;</span></span>
<span id="cb216-55"><a href="#cb216-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb216-56"><a href="#cb216-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb216-57"><a href="#cb216-57" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb216-58"><a href="#cb216-58" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb216-59"><a href="#cb216-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-60"><a href="#cb216-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb216-61"><a href="#cb216-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;메시지 수신 및 AI 분석&quot;&quot;&quot;</span></span>
<span id="cb216-62"><a href="#cb216-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb216-63"><a href="#cb216-63" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(msg.payload.decode())</span>
<span id="cb216-64"><a href="#cb216-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-65"><a href="#cb216-65" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb216-66"><a href="#cb216-66" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb216-67"><a href="#cb216-67" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> data.get(<span class="st">&quot;light&quot;</span>)</span>
<span id="cb216-68"><a href="#cb216-68" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> data.get(<span class="st">&quot;board&quot;</span>, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb216-69"><a href="#cb216-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-70"><a href="#cb216-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 출력</span></span>
<span id="cb216-71"><a href="#cb216-71" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb216-72"><a href="#cb216-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb216-73"><a href="#cb216-73" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] 보드 </span><span class="sc">{</span>board<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb216-74"><a href="#cb216-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb216-75"><a href="#cb216-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;🌡️  온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb216-76"><a href="#cb216-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;💧 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb216-77"><a href="#cb216-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light:</span>
<span id="cb216-78"><a href="#cb216-78" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;💡 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb216-79"><a href="#cb216-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-80"><a href="#cb216-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># AI 분석</span></span>
<span id="cb216-81"><a href="#cb216-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">🤖 AI 분석 중...&quot;</span>)</span>
<span id="cb216-82"><a href="#cb216-82" aria-hidden="true" tabindex="-1"></a>        analysis <span class="op">=</span> analyze_with_ai(temp, humid, light)</span>
<span id="cb216-83"><a href="#cb216-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">💬 </span><span class="sc">{</span>analysis<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb216-84"><a href="#cb216-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb216-85"><a href="#cb216-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-86"><a href="#cb216-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb216-87"><a href="#cb216-87" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb216-88"><a href="#cb216-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-89"><a href="#cb216-89" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb216-90"><a href="#cb216-90" aria-hidden="true" tabindex="-1"></a>mqtt_client <span class="op">=</span> mqtt.Client()</span>
<span id="cb216-91"><a href="#cb216-91" aria-hidden="true" tabindex="-1"></a>mqtt_client.tls_set()</span>
<span id="cb216-92"><a href="#cb216-92" aria-hidden="true" tabindex="-1"></a>mqtt_client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb216-93"><a href="#cb216-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-94"><a href="#cb216-94" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb216-95"><a href="#cb216-95" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_message <span class="op">=</span> on_message</span>
<span id="cb216-96"><a href="#cb216-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-97"><a href="#cb216-97" aria-hidden="true" tabindex="-1"></a><span class="co"># 실행</span></span>
<span id="cb216-98"><a href="#cb216-98" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb216-99"><a href="#cb216-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;🚀 AI 환경 분석 시스템 시작...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb216-100"><a href="#cb216-100" aria-hidden="true" tabindex="-1"></a>    mqtt_client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb216-101"><a href="#cb216-101" aria-hidden="true" tabindex="-1"></a>    mqtt_client.loop_forever()</span>
<span id="cb216-102"><a href="#cb216-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-103"><a href="#cb216-103" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb216-104"><a href="#cb216-104" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">시스템 종료&quot;</span>)</span>
<span id="cb216-105"><a href="#cb216-105" aria-hidden="true" tabindex="-1"></a>    mqtt_client.disconnect()</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>🚀 AI 환경 분석 시스템 시작...

✅ MQTT 연결 성공!
📬 구독: hexaboard/+/sensor/data

============================================================
[10:45:32] 보드 A
============================================================
🌡️  온도: 30°C
💧 습도: 75%
💡 조도: 1200

🤖 AI 분석 중...

💬 현재 환경은 덥고 습하여 불쾌지수가 높습니다. 에어컨을 가동하고 제습기를 사용하거나 환기를 통해 온도를 25°C 이하, 습도를 60% 이하로 낮추는 것이 좋습니다.</code></pre>
<hr />
<h2 id="비용-관리">💰 비용 관리</h2>
<h3 id="openai-api-요금">OpenAI API 요금</h3>
<p><strong>GPT-4 요금</strong> (2024년 기준):</p>
<ul>
<li>Input: ~$0.03 / 1K tokens</li>
<li>Output: ~$0.06 / 1K tokens</li>
</ul>
<p><strong>예상 비용</strong>:</p>
<pre><code>1회 분석: ~200 tokens
비용: ~$0.01
100회 분석: ~$1</code></pre>
<p><strong>절약 팁</strong>:</p>
<ol type="1">
<li>✅ <code>gpt-3.5-turbo</code> 사용 (저렴함)</li>
<li>✅ <code>max_tokens</code> 제한</li>
<li>✅ 분석 빈도 조절 (5-10초마다)</li>
<li>✅ 캐싱 (같은 데이터는 재분석 안 함)</li>
</ol>
<hr />
<h2 id="문제-해결-9">🛠️ 문제 해결</h2>
<h3 id="api-키-오류">API 키 오류</h3>
<pre><code>openai.AuthenticationError: Incorrect API key</code></pre>
<p><strong>해결</strong>:</p>
<ul>
<li><code>.env</code> 파일 확인</li>
<li>API 키 재생성</li>
</ul>
<h3 id="rate-limit-오류">Rate Limit 오류</h3>
<pre><code>openai.RateLimitError: Rate limit reached</code></pre>
<p><strong>해결</strong>:</p>
<ul>
<li>요청 빈도 낮추기</li>
<li>요금제 업그레이드</li>
</ul>
<hr />
<h2 id="도전-과제-11">🚀 도전 과제</h2>
<h3 id="과제-1-감정-분석">과제 1: 감정 분석</h3>
<p>환경 데이터를 바탕으로 “기쁨”, “불편”, “경고” 중 하나를
반환하세요.</p>
<h3 id="과제-2-맞춤형-권장">과제 2: 맞춤형 권장</h3>
<p>사용자 선호도 (따뜻함 선호, 시원함 선호)를 고려한 권장 사항을
제시하세요.</p>
<hr />
<h2 id="핵심-정리-6">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-6">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>OpenAI API</strong>: GPT-4를 코드로 사용</li>
<li><strong>프롬프트</strong>: 명확하고 구체적으로 작성</li>
<li><strong>system message</strong>: AI 역할 정의</li>
<li><strong>temperature</strong>: 창의성 조절 (0=일관적, 2=창의적)</li>
<li><strong>비용 관리</strong>: 불필요한 호출 최소화</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-8">❓ 자주 묻는 질문</h2>
<h3 id="q1.-gpt-4와-gpt-3.5의-차이는">Q1. GPT-4와 GPT-3.5의 차이는?</h3>
<p><strong>A</strong>: GPT-4가 더 정확하지만 비쌉니다. 간단한 분석은
GPT-3.5로도 충분합니다.</p>
<h3 id="q2.-api-키를-무료로-사용할-수-있나요">Q2. API 키를 무료로 사용할
수 있나요?</h3>
<p><strong>A</strong>: 무료 크레딧이 제공될 수 있지만, 기본적으로는
유료입니다.</p>
<h3 id="q3.-temperature는-어떻게-설정하나요">Q3. temperature는 어떻게
설정하나요?</h3>
<p><strong>A</strong>: 일관된 분석에는 0.3-0.5, 창의적인 응답에는
0.7-1.0을 권장합니다.</p>
<hr />
<h2 id="다음-단계-7">🚀 다음 단계</h2>
<p>OpenAI API를 센서 데이터 분석에 성공적으로 연동했습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>AI 응답을 제어 명령으로 변환</li>
<li>LED 색상 자동 결정</li>
<li>자동 제어 시스템 구축</li>
</ul>
<hr />
<p><strong>🎉 Chapter 17 완료!</strong><br />
이제 AI가 센서 데이터를 분석하고 조언을 제공할 수 있습니다!</p>
<h1 id="chapter-18.-ai-응답을-제어-명령으로-변환하기">Chapter 18. AI
응답을 제어 명령으로 변환하기</h1>
<blockquote>
<p><strong>PART 5</strong>: Python + OpenAI로 AI 명령 엔진 만들기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-17">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>AI 응답을 JSON 명령으로 변환할 수
있다</label></li>
<li><label><input type="checkbox"></input>LED 색상을 자동으로 결정할 수
있다</label></li>
<li><label><input type="checkbox"></input>제어 명령을 생성할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-17">🎯 학습 목표</h2>
<h3 id="핵심-개념-17">핵심 개념</h3>
<ul>
<li><strong>명령 변환</strong>: AI 텍스트 → JSON 명령</li>
<li><strong>구조화된 출력</strong>: AI가 JSON 형식으로 응답</li>
<li><strong>자동 제어</strong>: 센서 데이터 → AI 분석 → 제어</li>
</ul>
<hr />
<h2 id="왜-명령-변환이-필요한가">📖 왜 명령 변환이 필요한가?</h2>
<h3 id="ai-응답의-문제점">AI 응답의 문제점</h3>
<p>AI는 <strong>자연어</strong>로 응답합니다:</p>
<pre><code>&quot;온도가 높으니 LED를 빨간색으로 켜세요&quot;</code></pre>
<p>하지만 헥사보드는 <strong>JSON 명령</strong>이 필요합니다:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;action&quot;</span><span class="fu">:</span> <span class="st">&quot;led_on&quot;</span><span class="fu">,</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>해결책</strong>:</p>
<ol type="1">
<li>AI에게 JSON 형식으로 응답하도록 요청</li>
<li>또는 AI 응답을 파싱하여 JSON으로 변환</li>
</ol>
<hr />
<h2 id="실습-1-json-형식-응답-요청">💻 실습 1: JSON 형식 응답 요청</h2>
<h3 id="ai가-직접-json-생성">AI가 직접 JSON 생성</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch18_json_response.py</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AI로 JSON 명령 생성</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_led_command(temp, humid):</span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;온도/습도에 따른 LED 명령 생성&quot;&quot;&quot;</span></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a><span class="ss">센서 데이터:</span></span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a><span class="ss">위 데이터를 분석하여 LED 제어 명령을 JSON 형식으로 생성하세요.</span></span>
<span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-22"><a href="#cb223-22" aria-hidden="true" tabindex="-1"></a><span class="ss">규칙:</span></span>
<span id="cb223-23"><a href="#cb223-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도 &lt; 20°C 또는 습도 &lt; 40%: 파란색 [0, 0, 255]</span></span>
<span id="cb223-24"><a href="#cb223-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도 20-26°C, 습도 40-60%: 초록색 [0, 255, 0]</span></span>
<span id="cb223-25"><a href="#cb223-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도 &gt; 26°C 또는 습도 &gt; 60%: 빨간색 [255, 0, 0]</span></span>
<span id="cb223-26"><a href="#cb223-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-27"><a href="#cb223-27" aria-hidden="true" tabindex="-1"></a><span class="ss">출력 형식 (JSON만):</span></span>
<span id="cb223-28"><a href="#cb223-28" aria-hidden="true" tabindex="-1"></a><span class="ch">{{</span></span>
<span id="cb223-29"><a href="#cb223-29" aria-hidden="true" tabindex="-1"></a><span class="ss">  &quot;action&quot;: &quot;led_color&quot;,</span></span>
<span id="cb223-30"><a href="#cb223-30" aria-hidden="true" tabindex="-1"></a><span class="ss">  &quot;color&quot;: [R, G, B],</span></span>
<span id="cb223-31"><a href="#cb223-31" aria-hidden="true" tabindex="-1"></a><span class="ss">  &quot;reason&quot;: &quot;이유 (한 문장)&quot;</span></span>
<span id="cb223-32"><a href="#cb223-32" aria-hidden="true" tabindex="-1"></a><span class="ch">}}</span></span>
<span id="cb223-33"><a href="#cb223-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-34"><a href="#cb223-34" aria-hidden="true" tabindex="-1"></a><span class="ss">JSON만 출력하세요. 다른 텍스트는 포함하지 마세요.</span></span>
<span id="cb223-35"><a href="#cb223-35" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb223-36"><a href="#cb223-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-37"><a href="#cb223-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb223-38"><a href="#cb223-38" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb223-39"><a href="#cb223-39" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb223-40"><a href="#cb223-40" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb223-41"><a href="#cb223-41" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;당신은 JSON 명령을 생성하는 시스템입니다. 항상 유효한 JSON만 출력하세요.&quot;</span>},</span>
<span id="cb223-42"><a href="#cb223-42" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb223-43"><a href="#cb223-43" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb223-44"><a href="#cb223-44" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb223-45"><a href="#cb223-45" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb223-46"><a href="#cb223-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb223-47"><a href="#cb223-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-48"><a href="#cb223-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON 파싱</span></span>
<span id="cb223-49"><a href="#cb223-49" aria-hidden="true" tabindex="-1"></a>        json_str <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb223-50"><a href="#cb223-50" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> json.loads(json_str)</span>
<span id="cb223-51"><a href="#cb223-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-52"><a href="#cb223-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> command</span>
<span id="cb223-53"><a href="#cb223-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-54"><a href="#cb223-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> json.JSONDecodeError <span class="im">as</span> e:</span>
<span id="cb223-55"><a href="#cb223-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;JSON 파싱 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb223-56"><a href="#cb223-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;응답: </span><span class="sc">{</span>response<span class="sc">.</span>choices[<span class="dv">0</span>]<span class="sc">.</span>message<span class="sc">.</span>content<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb223-57"><a href="#cb223-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb223-58"><a href="#cb223-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb223-59"><a href="#cb223-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb223-60"><a href="#cb223-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb223-61"><a href="#cb223-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-62"><a href="#cb223-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb223-63"><a href="#cb223-63" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb223-64"><a href="#cb223-64" aria-hidden="true" tabindex="-1"></a>    test_cases <span class="op">=</span> [</span>
<span id="cb223-65"><a href="#cb223-65" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">25</span>, <span class="dv">55</span>, <span class="st">&quot;쾌적&quot;</span>),</span>
<span id="cb223-66"><a href="#cb223-66" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">30</span>, <span class="dv">70</span>, <span class="st">&quot;덥고 습함&quot;</span>),</span>
<span id="cb223-67"><a href="#cb223-67" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">18</span>, <span class="dv">35</span>, <span class="st">&quot;춥고 건조&quot;</span>),</span>
<span id="cb223-68"><a href="#cb223-68" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb223-69"><a href="#cb223-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-70"><a href="#cb223-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> temp, humid, desc <span class="kw">in</span> test_cases:</span>
<span id="cb223-71"><a href="#cb223-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb223-72"><a href="#cb223-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;테스트: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">% (</span><span class="sc">{</span>desc<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb223-73"><a href="#cb223-73" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb223-74"><a href="#cb223-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-75"><a href="#cb223-75" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> generate_led_command(temp, humid)</span>
<span id="cb223-76"><a href="#cb223-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-77"><a href="#cb223-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> command:</span>
<span id="cb223-78"><a href="#cb223-78" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;✅ 생성된 명령:&quot;</span>)</span>
<span id="cb223-79"><a href="#cb223-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(json.dumps(command, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>============================================================
테스트: 25°C, 55% (쾌적)
============================================================

✅ 생성된 명령:
{
  &quot;action&quot;: &quot;led_color&quot;,
  &quot;color&quot;: [0, 255, 0],
  &quot;reason&quot;: &quot;온도와 습도가 모두 적정 범위에 있어 쾌적합니다&quot;
}

============================================================
테스트: 30°C, 70% (덥고 습함)
============================================================

✅ 생성된 명령:
{
  &quot;action&quot;: &quot;led_color&quot;,
  &quot;color&quot;: [255, 0, 0],
  &quot;reason&quot;: &quot;온도가 높고 습도도 높아 불쾌한 환경입니다&quot;
}</code></pre>
<hr />
<h2 id="실습-2-명령-생성-클래스">💻 실습 2: 명령 생성 클래스</h2>
<h3 id="재사용-가능한-명령-생성기">재사용 가능한 명령 생성기</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch18_command_generator.py</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 명령 생성 클래스</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CommandGenerator:</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;AI 기반 명령 생성기&quot;&quot;&quot;</span></span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_led_command(<span class="va">self</span>, temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;LED 제어 명령 생성&quot;&quot;&quot;</span></span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a><span class="ss">센서 데이터 분석 및 LED 제어 명령 생성:</span></span>
<span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb225-24"><a href="#cb225-24" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb225-25"><a href="#cb225-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-26"><a href="#cb225-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light:</span>
<span id="cb225-27"><a href="#cb225-27" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">+=</span> <span class="ss">f&quot;- 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb225-28"><a href="#cb225-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-29"><a href="#cb225-29" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb225-30"><a href="#cb225-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-31"><a href="#cb225-31" aria-hidden="true" tabindex="-1"></a><span class="st">조건에 따라 LED 색상을 결정하세요:</span></span>
<span id="cb225-32"><a href="#cb225-32" aria-hidden="true" tabindex="-1"></a><span class="st">1. 매우 쾌적 (온도 22-26°C, 습도 40-60%): 초록색 [0, 255, 0]</span></span>
<span id="cb225-33"><a href="#cb225-33" aria-hidden="true" tabindex="-1"></a><span class="st">2. 주의 필요 (온도 18-30°C, 습도 30-70%): 노란색 [255, 255, 0]</span></span>
<span id="cb225-34"><a href="#cb225-34" aria-hidden="true" tabindex="-1"></a><span class="st">3. 개선 필요 (그 외): 빨간색 [255, 0, 0]</span></span>
<span id="cb225-35"><a href="#cb225-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-36"><a href="#cb225-36" aria-hidden="true" tabindex="-1"></a><span class="st">JSON 형식으로 응답:</span></span>
<span id="cb225-37"><a href="#cb225-37" aria-hidden="true" tabindex="-1"></a><span class="st">{</span></span>
<span id="cb225-38"><a href="#cb225-38" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;action&quot;: &quot;led_color&quot;,</span></span>
<span id="cb225-39"><a href="#cb225-39" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;color&quot;: [R, G, B],</span></span>
<span id="cb225-40"><a href="#cb225-40" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;brightness&quot;: 50-100 (숫자),</span></span>
<span id="cb225-41"><a href="#cb225-41" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;reason&quot;: &quot;이유&quot;</span></span>
<span id="cb225-42"><a href="#cb225-42" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb225-43"><a href="#cb225-43" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb225-44"><a href="#cb225-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-45"><a href="#cb225-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb225-46"><a href="#cb225-46" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.client.chat.completions.create(</span>
<span id="cb225-47"><a href="#cb225-47" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb225-48"><a href="#cb225-48" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[</span>
<span id="cb225-49"><a href="#cb225-49" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;JSON 명령 생성 전문가. 유효한 JSON만 출력.&quot;</span>},</span>
<span id="cb225-50"><a href="#cb225-50" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb225-51"><a href="#cb225-51" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb225-52"><a href="#cb225-52" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb225-53"><a href="#cb225-53" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb225-54"><a href="#cb225-54" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb225-55"><a href="#cb225-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-56"><a href="#cb225-56" aria-hidden="true" tabindex="-1"></a>            json_str <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb225-57"><a href="#cb225-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-58"><a href="#cb225-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ```json ... ``` 제거</span></span>
<span id="cb225-59"><a href="#cb225-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> json_str.startswith(<span class="st">&quot;```&quot;</span>):</span>
<span id="cb225-60"><a href="#cb225-60" aria-hidden="true" tabindex="-1"></a>                json_str <span class="op">=</span> json_str.split(<span class="st">&quot;```&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb225-61"><a href="#cb225-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> json_str.startswith(<span class="st">&quot;json&quot;</span>):</span>
<span id="cb225-62"><a href="#cb225-62" aria-hidden="true" tabindex="-1"></a>                    json_str <span class="op">=</span> json_str[<span class="dv">4</span>:]</span>
<span id="cb225-63"><a href="#cb225-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-64"><a href="#cb225-64" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> json.loads(json_str.strip())</span>
<span id="cb225-65"><a href="#cb225-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> command</span>
<span id="cb225-66"><a href="#cb225-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-67"><a href="#cb225-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb225-68"><a href="#cb225-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;명령 생성 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb225-69"><a href="#cb225-69" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 기본 명령 반환</span></span>
<span id="cb225-70"><a href="#cb225-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb225-71"><a href="#cb225-71" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>,</span>
<span id="cb225-72"><a href="#cb225-72" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;color&quot;</span>: [<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>],</span>
<span id="cb225-73"><a href="#cb225-73" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;brightness&quot;</span>: <span class="dv">50</span>,</span>
<span id="cb225-74"><a href="#cb225-74" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;reason&quot;</span>: <span class="st">&quot;AI 분석 실패&quot;</span></span>
<span id="cb225-75"><a href="#cb225-75" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb225-76"><a href="#cb225-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-77"><a href="#cb225-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_multiple_commands(<span class="va">self</span>, temp, humid):</span>
<span id="cb225-78"><a href="#cb225-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;여러 제어 명령 생성 (LED + 권장사항)&quot;&quot;&quot;</span></span>
<span id="cb225-79"><a href="#cb225-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-80"><a href="#cb225-80" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb225-81"><a href="#cb225-81" aria-hidden="true" tabindex="-1"></a><span class="ss">센서: 온도 </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, 습도 </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb225-82"><a href="#cb225-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-83"><a href="#cb225-83" aria-hidden="true" tabindex="-1"></a><span class="ss">다음 JSON 배열 형식으로 제어 명령을 생성하세요:</span></span>
<span id="cb225-84"><a href="#cb225-84" aria-hidden="true" tabindex="-1"></a><span class="ss">[</span></span>
<span id="cb225-85"><a href="#cb225-85" aria-hidden="true" tabindex="-1"></a><span class="ss">  </span><span class="ch">{{</span></span>
<span id="cb225-86"><a href="#cb225-86" aria-hidden="true" tabindex="-1"></a><span class="ss">    &quot;device&quot;: &quot;led&quot;,</span></span>
<span id="cb225-87"><a href="#cb225-87" aria-hidden="true" tabindex="-1"></a><span class="ss">    &quot;action&quot;: &quot;color&quot;,</span></span>
<span id="cb225-88"><a href="#cb225-88" aria-hidden="true" tabindex="-1"></a><span class="ss">    &quot;params&quot;: </span><span class="ch">{{</span><span class="ss">&quot;color&quot;: [R, G, B]</span><span class="ch">}}</span></span>
<span id="cb225-89"><a href="#cb225-89" aria-hidden="true" tabindex="-1"></a><span class="ss">  </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb225-90"><a href="#cb225-90" aria-hidden="true" tabindex="-1"></a><span class="ss">  </span><span class="ch">{{</span></span>
<span id="cb225-91"><a href="#cb225-91" aria-hidden="true" tabindex="-1"></a><span class="ss">    &quot;device&quot;: &quot;notification&quot;,</span></span>
<span id="cb225-92"><a href="#cb225-92" aria-hidden="true" tabindex="-1"></a><span class="ss">    &quot;action&quot;: &quot;message&quot;,</span></span>
<span id="cb225-93"><a href="#cb225-93" aria-hidden="true" tabindex="-1"></a><span class="ss">    &quot;params&quot;: </span><span class="ch">{{</span><span class="ss">&quot;text&quot;: &quot;권장사항 메시지&quot;</span><span class="ch">}}</span></span>
<span id="cb225-94"><a href="#cb225-94" aria-hidden="true" tabindex="-1"></a><span class="ss">  </span><span class="ch">}}</span></span>
<span id="cb225-95"><a href="#cb225-95" aria-hidden="true" tabindex="-1"></a><span class="ss">]</span></span>
<span id="cb225-96"><a href="#cb225-96" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb225-97"><a href="#cb225-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-98"><a href="#cb225-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb225-99"><a href="#cb225-99" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.client.chat.completions.create(</span>
<span id="cb225-100"><a href="#cb225-100" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">&quot;gpt-4&quot;</span>,</span>
<span id="cb225-101"><a href="#cb225-101" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[</span>
<span id="cb225-102"><a href="#cb225-102" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;JSON 배열 생성. 유효한 JSON만 출력.&quot;</span>},</span>
<span id="cb225-103"><a href="#cb225-103" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb225-104"><a href="#cb225-104" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb225-105"><a href="#cb225-105" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">250</span>,</span>
<span id="cb225-106"><a href="#cb225-106" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb225-107"><a href="#cb225-107" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb225-108"><a href="#cb225-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-109"><a href="#cb225-109" aria-hidden="true" tabindex="-1"></a>            json_str <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb225-110"><a href="#cb225-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-111"><a href="#cb225-111" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 코드 블록 제거</span></span>
<span id="cb225-112"><a href="#cb225-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&quot;```&quot;</span> <span class="kw">in</span> json_str:</span>
<span id="cb225-113"><a href="#cb225-113" aria-hidden="true" tabindex="-1"></a>                json_str <span class="op">=</span> json_str.split(<span class="st">&quot;```&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb225-114"><a href="#cb225-114" aria-hidden="true" tabindex="-1"></a>                json_str <span class="op">=</span> json_str.replace(<span class="st">&quot;json&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="dv">1</span>).strip()</span>
<span id="cb225-115"><a href="#cb225-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-116"><a href="#cb225-116" aria-hidden="true" tabindex="-1"></a>            commands <span class="op">=</span> json.loads(json_str)</span>
<span id="cb225-117"><a href="#cb225-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> commands</span>
<span id="cb225-118"><a href="#cb225-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-119"><a href="#cb225-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb225-120"><a href="#cb225-120" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;명령 생성 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb225-121"><a href="#cb225-121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> []</span>
<span id="cb225-122"><a href="#cb225-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-123"><a href="#cb225-123" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb225-124"><a href="#cb225-124" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb225-125"><a href="#cb225-125" aria-hidden="true" tabindex="-1"></a>    generator <span class="op">=</span> CommandGenerator()</span>
<span id="cb225-126"><a href="#cb225-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-127"><a href="#cb225-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 테스트 1: 단일 명령</span></span>
<span id="cb225-128"><a href="#cb225-128" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📋 테스트 1: LED 명령 생성</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb225-129"><a href="#cb225-129" aria-hidden="true" tabindex="-1"></a>    cmd <span class="op">=</span> generator.generate_led_command(<span class="dv">28</span>, <span class="dv">65</span>, <span class="dv">900</span>)</span>
<span id="cb225-130"><a href="#cb225-130" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(json.dumps(cmd, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb225-131"><a href="#cb225-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-132"><a href="#cb225-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 테스트 2: 여러 명령</span></span>
<span id="cb225-133"><a href="#cb225-133" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb225-134"><a href="#cb225-134" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;📋 테스트 2: 다중 명령 생성</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb225-135"><a href="#cb225-135" aria-hidden="true" tabindex="-1"></a>    cmds <span class="op">=</span> generator.generate_multiple_commands(<span class="dv">30</span>, <span class="dv">75</span>)</span>
<span id="cb225-136"><a href="#cb225-136" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(json.dumps(cmds, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
<hr />
<h2 id="실습-3-규칙-기반-ai-하이브리드">💻 실습 3: 규칙 기반 + AI
하이브리드</h2>
<h3 id="빠른-응답-ai-보조">빠른 응답 + AI 보조</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch18_hybrid.py</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 규칙 기반 + AI 하이브리드</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HybridController:</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;규칙 기반 + AI 하이브리드 제어&quot;&quot;&quot;</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, use_ai<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.use_ai <span class="op">=</span> use_ai</span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> use_ai:</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>            <span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a>            <span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>            load_dotenv()</span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ai_client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rule_based_command(<span class="va">self</span>, temp, humid):</span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;규칙 기반 명령 (빠름)&quot;&quot;&quot;</span></span>
<span id="cb226-17"><a href="#cb226-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-18"><a href="#cb226-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 기본 규칙</span></span>
<span id="cb226-19"><a href="#cb226-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">20</span> <span class="kw">or</span> humid <span class="op">&lt;</span> <span class="dv">40</span>:</span>
<span id="cb226-20"><a href="#cb226-20" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>]  <span class="co"># 파란색</span></span>
<span id="cb226-21"><a href="#cb226-21" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&quot;추움/건조&quot;</span></span>
<span id="cb226-22"><a href="#cb226-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&gt;</span> <span class="dv">26</span> <span class="kw">or</span> humid <span class="op">&gt;</span> <span class="dv">60</span>:</span>
<span id="cb226-23"><a href="#cb226-23" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>]  <span class="co"># 빨간색</span></span>
<span id="cb226-24"><a href="#cb226-24" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&quot;더움/습함&quot;</span></span>
<span id="cb226-25"><a href="#cb226-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb226-26"><a href="#cb226-26" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>]  <span class="co"># 초록색</span></span>
<span id="cb226-27"><a href="#cb226-27" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&quot;쾌적&quot;</span></span>
<span id="cb226-28"><a href="#cb226-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-29"><a href="#cb226-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb226-30"><a href="#cb226-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>,</span>
<span id="cb226-31"><a href="#cb226-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;color&quot;</span>: color,</span>
<span id="cb226-32"><a href="#cb226-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;reason&quot;</span>: status,</span>
<span id="cb226-33"><a href="#cb226-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;method&quot;</span>: <span class="st">&quot;rule&quot;</span></span>
<span id="cb226-34"><a href="#cb226-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb226-35"><a href="#cb226-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-36"><a href="#cb226-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ai_based_command(<span class="va">self</span>, temp, humid):</span>
<span id="cb226-37"><a href="#cb226-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;AI 기반 명령 (정교함)&quot;&quot;&quot;</span></span>
<span id="cb226-38"><a href="#cb226-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-39"><a href="#cb226-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.use_ai:</span>
<span id="cb226-40"><a href="#cb226-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.rule_based_command(temp, humid)</span>
<span id="cb226-41"><a href="#cb226-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-42"><a href="#cb226-42" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb226-43"><a href="#cb226-43" aria-hidden="true" tabindex="-1"></a><span class="ss">온도 </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, 습도 </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb226-44"><a href="#cb226-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-45"><a href="#cb226-45" aria-hidden="true" tabindex="-1"></a><span class="ss">LED 색상 (JSON):</span></span>
<span id="cb226-46"><a href="#cb226-46" aria-hidden="true" tabindex="-1"></a><span class="ch">{{</span><span class="ss">&quot;action&quot;: &quot;led_color&quot;, &quot;color&quot;: [R,G,B], &quot;reason&quot;: &quot;이유&quot;</span><span class="ch">}}</span></span>
<span id="cb226-47"><a href="#cb226-47" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb226-48"><a href="#cb226-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-49"><a href="#cb226-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb226-50"><a href="#cb226-50" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.ai_client.chat.completions.create(</span>
<span id="cb226-51"><a href="#cb226-51" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,  <span class="co"># 빠르고 저렴</span></span>
<span id="cb226-52"><a href="#cb226-52" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[</span>
<span id="cb226-53"><a href="#cb226-53" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;JSON 생성. 간결하게.&quot;</span>},</span>
<span id="cb226-54"><a href="#cb226-54" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb226-55"><a href="#cb226-55" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb226-56"><a href="#cb226-56" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb226-57"><a href="#cb226-57" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb226-58"><a href="#cb226-58" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb226-59"><a href="#cb226-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-60"><a href="#cb226-60" aria-hidden="true" tabindex="-1"></a>            json_str <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb226-61"><a href="#cb226-61" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> json.loads(json_str)</span>
<span id="cb226-62"><a href="#cb226-62" aria-hidden="true" tabindex="-1"></a>            command[<span class="st">&quot;method&quot;</span>] <span class="op">=</span> <span class="st">&quot;ai&quot;</span></span>
<span id="cb226-63"><a href="#cb226-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> command</span>
<span id="cb226-64"><a href="#cb226-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-65"><a href="#cb226-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb226-66"><a href="#cb226-66" aria-hidden="true" tabindex="-1"></a>            <span class="co"># AI 실패 시 규칙 기반으로 폴백</span></span>
<span id="cb226-67"><a href="#cb226-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.rule_based_command(temp, humid)</span>
<span id="cb226-68"><a href="#cb226-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-69"><a href="#cb226-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_command(<span class="va">self</span>, temp, humid, force_ai<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb226-70"><a href="#cb226-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;명령 생성 (하이브리드)&quot;&quot;&quot;</span></span>
<span id="cb226-71"><a href="#cb226-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-72"><a href="#cb226-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 극단적인 경우는 규칙 기반 (빠름)</span></span>
<span id="cb226-73"><a href="#cb226-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (temp <span class="op">&lt;</span> <span class="dv">15</span> <span class="kw">or</span> temp <span class="op">&gt;</span> <span class="dv">35</span> <span class="kw">or</span> humid <span class="op">&lt;</span> <span class="dv">20</span> <span class="kw">or</span> humid <span class="op">&gt;</span> <span class="dv">80</span>) <span class="kw">and</span> <span class="kw">not</span> force_ai:</span>
<span id="cb226-74"><a href="#cb226-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.rule_based_command(temp, humid)</span>
<span id="cb226-75"><a href="#cb226-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-76"><a href="#cb226-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 일반적인 경우는 AI 사용</span></span>
<span id="cb226-77"><a href="#cb226-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.use_ai:</span>
<span id="cb226-78"><a href="#cb226-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.ai_based_command(temp, humid)</span>
<span id="cb226-79"><a href="#cb226-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb226-80"><a href="#cb226-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.rule_based_command(temp, humid)</span>
<span id="cb226-81"><a href="#cb226-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-82"><a href="#cb226-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb226-83"><a href="#cb226-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb226-84"><a href="#cb226-84" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb226-85"><a href="#cb226-85" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> time</span>
<span id="cb226-86"><a href="#cb226-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-87"><a href="#cb226-87" aria-hidden="true" tabindex="-1"></a>    controller <span class="op">=</span> HybridController(use_ai<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb226-88"><a href="#cb226-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-89"><a href="#cb226-89" aria-hidden="true" tabindex="-1"></a>    test_cases <span class="op">=</span> [</span>
<span id="cb226-90"><a href="#cb226-90" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">10</span>, <span class="dv">25</span>, <span class="st">&quot;극단: 매우 추움&quot;</span>),</span>
<span id="cb226-91"><a href="#cb226-91" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">25</span>, <span class="dv">55</span>, <span class="st">&quot;일반: 쾌적&quot;</span>),</span>
<span id="cb226-92"><a href="#cb226-92" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">30</span>, <span class="dv">70</span>, <span class="st">&quot;일반: 덥고 습함&quot;</span>),</span>
<span id="cb226-93"><a href="#cb226-93" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb226-94"><a href="#cb226-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-95"><a href="#cb226-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> temp, humid, desc <span class="kw">in</span> test_cases:</span>
<span id="cb226-96"><a href="#cb226-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb226-97"><a href="#cb226-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>desc<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb226-98"><a href="#cb226-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb226-99"><a href="#cb226-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-100"><a href="#cb226-100" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> time.time()</span>
<span id="cb226-101"><a href="#cb226-101" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> controller.get_command(temp, humid)</span>
<span id="cb226-102"><a href="#cb226-102" aria-hidden="true" tabindex="-1"></a>        elapsed <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb226-103"><a href="#cb226-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-104"><a href="#cb226-104" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(json.dumps(cmd, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb226-105"><a href="#cb226-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">⏱️  처리 시간: </span><span class="sc">{</span>elapsed<span class="sc">:.2f}</span><span class="ss">초&quot;</span>)</span>
<span id="cb226-106"><a href="#cb226-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📊 처리 방식: </span><span class="sc">{</span>cmd<span class="sc">.</span>get(<span class="st">&#39;method&#39;</span>, <span class="st">&#39;unknown&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>============================================================
극단: 매우 추움: 10°C, 25%
============================================================

{
  &quot;action&quot;: &quot;led_color&quot;,
  &quot;color&quot;: [0, 0, 255],
  &quot;reason&quot;: &quot;추움/건조&quot;,
  &quot;method&quot;: &quot;rule&quot;
}

⏱️  처리 시간: 0.00초
📊 처리 방식: rule

============================================================
일반: 쾌적: 25°C, 55%
============================================================

{
  &quot;action&quot;: &quot;led_color&quot;,
  &quot;color&quot;: [0, 255, 0],
  &quot;reason&quot;: &quot;온도와 습도가 적정 범위입니다&quot;,
  &quot;method&quot;: &quot;ai&quot;
}

⏱️  처리 시간: 1.23초
📊 처리 방식: ai</code></pre>
<hr />
<h2 id="실습-4-명령-검증">💻 실습 4: 명령 검증</h2>
<h3 id="안전한-명령-실행">안전한 명령 실행</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch18_validator.py</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 명령 검증</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CommandValidator:</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;명령 검증 클래스&quot;&quot;&quot;</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validate_led_command(command):</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;LED 명령 검증&quot;&quot;&quot;</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 필수 필드 확인</span></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(command, <span class="bu">dict</span>):</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>, <span class="st">&quot;명령이 딕셔너리가 아님&quot;</span></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;action&quot;</span> <span class="kw">not</span> <span class="kw">in</span> command:</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>, <span class="st">&quot;action 필드 없음&quot;</span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;color&quot;</span> <span class="kw">not</span> <span class="kw">in</span> command:</span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>, <span class="st">&quot;color 필드 없음&quot;</span></span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 색상 검증</span></span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> command[<span class="st">&quot;color&quot;</span>]</span>
<span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(color, <span class="bu">list</span>) <span class="kw">or</span> <span class="bu">len</span>(color) <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>, <span class="st">&quot;color는 3개 요소의 리스트여야 함&quot;</span></span>
<span id="cb228-26"><a href="#cb228-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-27"><a href="#cb228-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># RGB 범위 확인</span></span>
<span id="cb228-28"><a href="#cb228-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, c <span class="kw">in</span> <span class="bu">enumerate</span>(color):</span>
<span id="cb228-29"><a href="#cb228-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(c, <span class="bu">int</span>) <span class="kw">or</span> c <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> c <span class="op">&gt;</span> <span class="dv">255</span>:</span>
<span id="cb228-30"><a href="#cb228-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span>, <span class="ss">f&quot;color[</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">]는 0-255 범위의 정수여야 함&quot;</span></span>
<span id="cb228-31"><a href="#cb228-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-32"><a href="#cb228-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 밝기 검증 (선택)</span></span>
<span id="cb228-33"><a href="#cb228-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;brightness&quot;</span> <span class="kw">in</span> command:</span>
<span id="cb228-34"><a href="#cb228-34" aria-hidden="true" tabindex="-1"></a>            brightness <span class="op">=</span> command[<span class="st">&quot;brightness&quot;</span>]</span>
<span id="cb228-35"><a href="#cb228-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(brightness, <span class="bu">int</span>) <span class="kw">or</span> brightness <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> brightness <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb228-36"><a href="#cb228-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span>, <span class="st">&quot;brightness는 0-100 범위의 정수여야 함&quot;</span></span>
<span id="cb228-37"><a href="#cb228-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-38"><a href="#cb228-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span>, <span class="st">&quot;검증 통과&quot;</span></span>
<span id="cb228-39"><a href="#cb228-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-40"><a href="#cb228-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb228-41"><a href="#cb228-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_command(command):</span>
<span id="cb228-42"><a href="#cb228-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;명령 정제 (안전하게 수정)&quot;&quot;&quot;</span></span>
<span id="cb228-43"><a href="#cb228-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-44"><a href="#cb228-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(command, <span class="bu">dict</span>):</span>
<span id="cb228-45"><a href="#cb228-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb228-46"><a href="#cb228-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-47"><a href="#cb228-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 안전한 명령 생성</span></span>
<span id="cb228-48"><a href="#cb228-48" aria-hidden="true" tabindex="-1"></a>        safe_command <span class="op">=</span> {}</span>
<span id="cb228-49"><a href="#cb228-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-50"><a href="#cb228-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># action</span></span>
<span id="cb228-51"><a href="#cb228-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;action&quot;</span> <span class="kw">in</span> command:</span>
<span id="cb228-52"><a href="#cb228-52" aria-hidden="true" tabindex="-1"></a>            safe_command[<span class="st">&quot;action&quot;</span>] <span class="op">=</span> <span class="bu">str</span>(command[<span class="st">&quot;action&quot;</span>])</span>
<span id="cb228-53"><a href="#cb228-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-54"><a href="#cb228-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># color</span></span>
<span id="cb228-55"><a href="#cb228-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;color&quot;</span> <span class="kw">in</span> command <span class="kw">and</span> <span class="bu">isinstance</span>(command[<span class="st">&quot;color&quot;</span>], <span class="bu">list</span>):</span>
<span id="cb228-56"><a href="#cb228-56" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> command[<span class="st">&quot;color&quot;</span>]</span>
<span id="cb228-57"><a href="#cb228-57" aria-hidden="true" tabindex="-1"></a>            safe_command[<span class="st">&quot;color&quot;</span>] <span class="op">=</span> [</span>
<span id="cb228-58"><a href="#cb228-58" aria-hidden="true" tabindex="-1"></a>                <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">min</span>(<span class="dv">255</span>, <span class="bu">int</span>(c))) <span class="cf">for</span> c <span class="kw">in</span> color[:<span class="dv">3</span>]</span>
<span id="cb228-59"><a href="#cb228-59" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb228-60"><a href="#cb228-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-61"><a href="#cb228-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># brightness</span></span>
<span id="cb228-62"><a href="#cb228-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;brightness&quot;</span> <span class="kw">in</span> command:</span>
<span id="cb228-63"><a href="#cb228-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb228-64"><a href="#cb228-64" aria-hidden="true" tabindex="-1"></a>                brightness <span class="op">=</span> <span class="bu">int</span>(command[<span class="st">&quot;brightness&quot;</span>])</span>
<span id="cb228-65"><a href="#cb228-65" aria-hidden="true" tabindex="-1"></a>                safe_command[<span class="st">&quot;brightness&quot;</span>] <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">min</span>(<span class="dv">100</span>, brightness))</span>
<span id="cb228-66"><a href="#cb228-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb228-67"><a href="#cb228-67" aria-hidden="true" tabindex="-1"></a>                safe_command[<span class="st">&quot;brightness&quot;</span>] <span class="op">=</span> <span class="dv">50</span>  <span class="co"># 기본값</span></span>
<span id="cb228-68"><a href="#cb228-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-69"><a href="#cb228-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> safe_command</span>
<span id="cb228-70"><a href="#cb228-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-71"><a href="#cb228-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트</span></span>
<span id="cb228-72"><a href="#cb228-72" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb228-73"><a href="#cb228-73" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb228-74"><a href="#cb228-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-75"><a href="#cb228-75" aria-hidden="true" tabindex="-1"></a>    validator <span class="op">=</span> CommandValidator()</span>
<span id="cb228-76"><a href="#cb228-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-77"><a href="#cb228-77" aria-hidden="true" tabindex="-1"></a>    test_commands <span class="op">=</span> [</span>
<span id="cb228-78"><a href="#cb228-78" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>, <span class="st">&quot;color&quot;</span>: [<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>]},  <span class="co"># 정상</span></span>
<span id="cb228-79"><a href="#cb228-79" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>, <span class="st">&quot;color&quot;</span>: [<span class="dv">0</span>, <span class="dv">300</span>, <span class="op">-</span><span class="dv">10</span>]},  <span class="co"># 범위 초과</span></span>
<span id="cb228-80"><a href="#cb228-80" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>, <span class="st">&quot;color&quot;</span>: <span class="st">&quot;red&quot;</span>},  <span class="co"># 잘못된 형식</span></span>
<span id="cb228-81"><a href="#cb228-81" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;color&quot;</span>: [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>]},  <span class="co"># action 누락</span></span>
<span id="cb228-82"><a href="#cb228-82" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb228-83"><a href="#cb228-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-84"><a href="#cb228-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, cmd <span class="kw">in</span> <span class="bu">enumerate</span>(test_commands, <span class="dv">1</span>):</span>
<span id="cb228-85"><a href="#cb228-85" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">테스트 </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb228-86"><a href="#cb228-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;입력: </span><span class="sc">{</span>json<span class="sc">.</span>dumps(cmd, ensure_ascii<span class="op">=</span><span class="va">False</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb228-87"><a href="#cb228-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-88"><a href="#cb228-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 검증</span></span>
<span id="cb228-89"><a href="#cb228-89" aria-hidden="true" tabindex="-1"></a>        valid, msg <span class="op">=</span> validator.validate_led_command(cmd)</span>
<span id="cb228-90"><a href="#cb228-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;검증: </span><span class="sc">{</span><span class="st">&#39;✅ &#39;</span> <span class="op">+</span> msg <span class="cf">if</span> valid <span class="cf">else</span> <span class="st">&#39;❌ &#39;</span> <span class="op">+</span> msg<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb228-91"><a href="#cb228-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-92"><a href="#cb228-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 정제</span></span>
<span id="cb228-93"><a href="#cb228-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> valid:</span>
<span id="cb228-94"><a href="#cb228-94" aria-hidden="true" tabindex="-1"></a>            safe_cmd <span class="op">=</span> validator.sanitize_command(cmd)</span>
<span id="cb228-95"><a href="#cb228-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> safe_cmd:</span>
<span id="cb228-96"><a href="#cb228-96" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;정제: </span><span class="sc">{</span>json<span class="sc">.</span>dumps(safe_cmd, ensure_ascii<span class="op">=</span><span class="va">False</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<hr />
<h2 id="문제-해결-10">🛠️ 문제 해결</h2>
<h3 id="json-파싱-오류">JSON 파싱 오류</h3>
<pre><code>json.JSONDecodeError: Expecting value</code></pre>
<p><strong>원인</strong>: AI가 JSON 외 텍스트 포함</p>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 코드 블록 제거</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>json_str <span class="op">=</span> response.content.strip()</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&quot;```&quot;</span> <span class="kw">in</span> json_str:</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>    json_str <span class="op">=</span> json_str.split(<span class="st">&quot;```&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>    json_str <span class="op">=</span> json_str.replace(<span class="st">&quot;json&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="dv">1</span>)</span></code></pre></div>
<h3 id="느린-응답">느린 응답</h3>
<p><strong>해결</strong>:</p>
<ul>
<li><code>gpt-3.5-turbo</code> 사용 (더 빠름)</li>
<li><code>max_tokens</code> 줄이기</li>
<li>규칙 기반으로 폴백</li>
</ul>
<hr />
<h2 id="도전-과제-12">🚀 도전 과제</h2>
<h3 id="과제-1-복잡한-명령-생성">과제 1: 복잡한 명령 생성</h3>
<p>LED 색상 + 깜빡임 패턴을 포함한 명령을 생성하세요.</p>
<h3 id="과제-2-우선순위-기반-제어">과제 2: 우선순위 기반 제어</h3>
<p>여러 센서 데이터 중 가장 시급한 것을 우선 처리하세요.</p>
<hr />
<h2 id="핵심-정리-7">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-7">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>JSON 응답</strong>: AI에게 JSON 형식 요청</li>
<li><strong>명령 검증</strong>: 안전성 확인</li>
<li><strong>하이브리드</strong>: 규칙 + AI 조합</li>
<li><strong>폴백</strong>: AI 실패 시 규칙 기반</li>
<li><strong>정제</strong>: 잘못된 값 자동 수정</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-9">❓ 자주 묻는 질문</h2>
<h3 id="q1.-ai가-json이-아닌-텍스트를-반환하면">Q1. AI가 JSON이 아닌
텍스트를 반환하면?</h3>
<p><strong>A</strong>: 프롬프트를 더 명확하게 작성하고, 파싱 전에
정제하세요.</p>
<h3 id="q2.-규칙-기반과-ai-중-무엇을-사용해야-하나요">Q2. 규칙 기반과 AI
중 무엇을 사용해야 하나요?</h3>
<p><strong>A</strong>: 간단한 경우는 규칙, 복잡한 판단은 AI를
권장합니다.</p>
<h3 id="q3.-명령-검증은-필수인가요">Q3. 명령 검증은 필수인가요?</h3>
<p><strong>A</strong>: 네! 안전한 시스템을 위해 반드시 검증하세요.</p>
<hr />
<h2 id="다음-단계-8">🚀 다음 단계</h2>
<p>AI 응답을 제어 명령으로 변환하는 데 성공했습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>헥사보드로 명령 전송</li>
<li>MQTT로 제어 명령 Publish</li>
<li>완전한 자동 제어 시스템 구축</li>
</ul>
<hr />
<p><strong>🎉 Chapter 18 완료!</strong><br />
이제 AI가 생성한 명령을 헥사보드가 실행할 수 있는 형식으로 변환할 수
있습니다!</p>
<h1 id="chapter-19.-헥사보드로-제어-명령-되돌려-보내기">Chapter 19.
헥사보드로 제어 명령 되돌려 보내기</h1>
<blockquote>
<p><strong>PART 5</strong>: Python + OpenAI로 AI 명령 엔진 만들기</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-18">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>Python에서 MQTT로 제어 명령을 보낼
수 있다</label></li>
<li><label><input type="checkbox"></input>완전한 AI 제어 시스템을 구축할 수
있다</label></li>
<li><label><input type="checkbox"></input>센서 데이터 → AI 분석 → 자동 제어
흐름을 완성할 수 있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-18">🎯 학습 목표</h2>
<h3 id="핵심-개념-18">핵심 개념</h3>
<ul>
<li><strong>양방향 통신</strong>: Subscribe (센서) + Publish (제어)</li>
<li><strong>완전 자동화</strong>: 사람 개입 없이 AI가 자동 제어</li>
<li><strong>피드백 루프</strong>: 제어 → 센서 변화 → 재분석</li>
</ul>
<hr />
<h2 id="완전한-ai-제어-시스템">📖 완전한 AI 제어 시스템</h2>
<h3 id="전체-흐름">전체 흐름</h3>
<pre><code>┌─────────────────┐
│   헥사보드       │
│  (센서 데이터)   │
└────────┬────────┘
         │ ① Publish (센서)
         ↓
┌─────────────────┐
│  MQTT Broker    │
│   (HiveMQ)      │
└────────┬────────┘
         │ ② Subscribe
         ↓
┌─────────────────┐
│  Python AI      │
│  • 데이터 수신   │
│  • AI 분석       │
│  • 명령 생성     │
└────────┬────────┘
         │ ③ Publish (제어)
         ↓
┌─────────────────┐
│  MQTT Broker    │
└────────┬────────┘
         │ ④ Subscribe
         ↓
┌─────────────────┐
│   헥사보드       │
│  (명령 실행)     │
└─────────────────┘</code></pre>
<hr />
<h2 id="실습-준비-9">🔧 실습 준비</h2>
<h3 id="필요한-것-8">필요한 것</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 (Chapter 13 코드
실행 중)</label></li>
<li><label><input type="checkbox" checked></input>Python 환경</label></li>
<li><label><input type="checkbox" checked></input>OpenAI API
키</label></li>
<li><label><input type="checkbox" checked></input>MQTT 연결
정보</label></li>
</ul>
<hr />
<h2 id="실습-1-제어-명령-전송">💻 실습 1: 제어 명령 전송</h2>
<h3 id="python에서-mqtt-publish">Python에서 MQTT Publish</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch19_send_command.py</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 제어 명령 전송</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_BROKER&quot;</span>)</span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">&quot;MQTT_PORT&quot;</span>, <span class="dv">8883</span>))</span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_USER&quot;</span>)</span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_PASSWORD&quot;</span>)</span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정</span></span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/A/control/led&quot;</span></span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> send_led_command(client, color, action<span class="op">=</span><span class="st">&quot;led_color&quot;</span>):</span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;LED 제어 명령 전송&quot;&quot;&quot;</span></span>
<span id="cb232-22"><a href="#cb232-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-23"><a href="#cb232-23" aria-hidden="true" tabindex="-1"></a>    command <span class="op">=</span> {</span>
<span id="cb232-24"><a href="#cb232-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;action&quot;</span>: action,</span>
<span id="cb232-25"><a href="#cb232-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;color&quot;</span>: color</span>
<span id="cb232-26"><a href="#cb232-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb232-27"><a href="#cb232-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-28"><a href="#cb232-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># JSON으로 변환</span></span>
<span id="cb232-29"><a href="#cb232-29" aria-hidden="true" tabindex="-1"></a>    message <span class="op">=</span> json.dumps(command)</span>
<span id="cb232-30"><a href="#cb232-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-31"><a href="#cb232-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Publish</span></span>
<span id="cb232-32"><a href="#cb232-32" aria-hidden="true" tabindex="-1"></a>    client.publish(TOPIC_CONTROL, message)</span>
<span id="cb232-33"><a href="#cb232-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📤 명령 전송: </span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb232-34"><a href="#cb232-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-35"><a href="#cb232-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb232-36"><a href="#cb232-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb232-37"><a href="#cb232-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb232-38"><a href="#cb232-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb232-39"><a href="#cb232-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-40"><a href="#cb232-40" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb232-41"><a href="#cb232-41" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb232-42"><a href="#cb232-42" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb232-43"><a href="#cb232-43" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb232-44"><a href="#cb232-44" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb232-45"><a href="#cb232-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-46"><a href="#cb232-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 연결</span></span>
<span id="cb232-47"><a href="#cb232-47" aria-hidden="true" tabindex="-1"></a>client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb232-48"><a href="#cb232-48" aria-hidden="true" tabindex="-1"></a>client.loop_start()</span>
<span id="cb232-49"><a href="#cb232-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-50"><a href="#cb232-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 테스트 명령 전송</span></span>
<span id="cb232-51"><a href="#cb232-51" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb232-52"><a href="#cb232-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;제어 명령 테스트</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb232-53"><a href="#cb232-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-54"><a href="#cb232-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 빨간색</span></span>
<span id="cb232-55"><a href="#cb232-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;1️⃣  빨간색 LED&quot;</span>)</span>
<span id="cb232-56"><a href="#cb232-56" aria-hidden="true" tabindex="-1"></a>    send_led_command(client, [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb232-57"><a href="#cb232-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span>(<span class="st">&quot;Enter로 다음...&quot;</span>)</span>
<span id="cb232-58"><a href="#cb232-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-59"><a href="#cb232-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 초록색</span></span>
<span id="cb232-60"><a href="#cb232-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">2️⃣  초록색 LED&quot;</span>)</span>
<span id="cb232-61"><a href="#cb232-61" aria-hidden="true" tabindex="-1"></a>    send_led_command(client, [<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>])</span>
<span id="cb232-62"><a href="#cb232-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span>(<span class="st">&quot;Enter로 다음...&quot;</span>)</span>
<span id="cb232-63"><a href="#cb232-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-64"><a href="#cb232-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 파란색</span></span>
<span id="cb232-65"><a href="#cb232-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">3️⃣  파란색 LED&quot;</span>)</span>
<span id="cb232-66"><a href="#cb232-66" aria-hidden="true" tabindex="-1"></a>    send_led_command(client, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>])</span>
<span id="cb232-67"><a href="#cb232-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span>(<span class="st">&quot;Enter로 다음...&quot;</span>)</span>
<span id="cb232-68"><a href="#cb232-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-69"><a href="#cb232-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LED 끄기</span></span>
<span id="cb232-70"><a href="#cb232-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">4️⃣  LED 끄기&quot;</span>)</span>
<span id="cb232-71"><a href="#cb232-71" aria-hidden="true" tabindex="-1"></a>    send_led_command(client, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], <span class="st">&quot;led_off&quot;</span>)</span>
<span id="cb232-72"><a href="#cb232-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-73"><a href="#cb232-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">✅ 테스트 완료!&quot;</span>)</span>
<span id="cb232-74"><a href="#cb232-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-75"><a href="#cb232-75" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb232-76"><a href="#cb232-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">종료&quot;</span>)</span>
<span id="cb232-77"><a href="#cb232-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-78"><a href="#cb232-78" aria-hidden="true" tabindex="-1"></a><span class="cf">finally</span>:</span>
<span id="cb232-79"><a href="#cb232-79" aria-hidden="true" tabindex="-1"></a>    client.loop_stop()</span>
<span id="cb232-80"><a href="#cb232-80" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<p><strong>실행</strong>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> ch19_send_command.py</span></code></pre></div>
<hr />
<h2 id="실습-2-완전-자동-ai-제어-시스템">💻 실습 2: 완전 자동 AI 제어
시스템</h2>
<h3 id="센서-수신-ai-분석-자동-제어">센서 수신 + AI 분석 + 자동
제어</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch19_auto_control.py</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 완전 자동 AI 제어 시스템</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_BROKER&quot;</span>)</span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">&quot;MQTT_PORT&quot;</span>, <span class="dv">8883</span>))</span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_USER&quot;</span>)</span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_PASSWORD&quot;</span>)</span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic 설정</span></span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span></span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/</span><span class="sc">{board}</span><span class="st">/control/led&quot;</span></span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenAI 클라이언트</span></span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a>openai_client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-27"><a href="#cb234-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 제어 간격 (초)</span></span>
<span id="cb234-28"><a href="#cb234-28" aria-hidden="true" tabindex="-1"></a>CONTROL_INTERVAL <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb234-29"><a href="#cb234-29" aria-hidden="true" tabindex="-1"></a>last_control_time <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb234-30"><a href="#cb234-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-31"><a href="#cb234-31" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIController:</span>
<span id="cb234-32"><a href="#cb234-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;AI 자동 제어 시스템&quot;&quot;&quot;</span></span>
<span id="cb234-33"><a href="#cb234-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-34"><a href="#cb234-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, mqtt_client):</span>
<span id="cb234-35"><a href="#cb234-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mqtt_client <span class="op">=</span> mqtt_client</span>
<span id="cb234-36"><a href="#cb234-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-37"><a href="#cb234-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_and_control(<span class="va">self</span>, board, temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb234-38"><a href="#cb234-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;AI 분석 및 자동 제어&quot;&quot;&quot;</span></span>
<span id="cb234-39"><a href="#cb234-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-40"><a href="#cb234-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> last_control_time</span>
<span id="cb234-41"><a href="#cb234-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-42"><a href="#cb234-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 제어 간격 확인 (너무 자주 제어하지 않도록)</span></span>
<span id="cb234-43"><a href="#cb234-43" aria-hidden="true" tabindex="-1"></a>        current_time <span class="op">=</span> time.time()</span>
<span id="cb234-44"><a href="#cb234-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_time <span class="op">-</span> last_control_time <span class="op">&lt;</span> CONTROL_INTERVAL:</span>
<span id="cb234-45"><a href="#cb234-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb234-46"><a href="#cb234-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-47"><a href="#cb234-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-48"><a href="#cb234-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;🤖 AI 분석 시작 (보드 </span><span class="sc">{</span>board<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb234-49"><a href="#cb234-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-50"><a href="#cb234-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-51"><a href="#cb234-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. 센서 데이터 요약</span></span>
<span id="cb234-52"><a href="#cb234-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📊 센서 데이터:&quot;</span>)</span>
<span id="cb234-53"><a href="#cb234-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C&quot;</span>)</span>
<span id="cb234-54"><a href="#cb234-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb234-55"><a href="#cb234-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light:</span>
<span id="cb234-56"><a href="#cb234-56" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-57"><a href="#cb234-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-58"><a href="#cb234-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. AI로 명령 생성</span></span>
<span id="cb234-59"><a href="#cb234-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🧠 AI 분석 중...&quot;</span>)</span>
<span id="cb234-60"><a href="#cb234-60" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> <span class="va">self</span>.generate_command(temp, humid, light)</span>
<span id="cb234-61"><a href="#cb234-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-62"><a href="#cb234-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> command:</span>
<span id="cb234-63"><a href="#cb234-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">✅ 생성된 명령:&quot;</span>)</span>
<span id="cb234-64"><a href="#cb234-64" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   색상: </span><span class="sc">{</span>command[<span class="st">&#39;color&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-65"><a href="#cb234-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   이유: </span><span class="sc">{</span>command<span class="sc">.</span>get(<span class="st">&#39;reason&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-66"><a href="#cb234-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-67"><a href="#cb234-67" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 3. 명령 전송</span></span>
<span id="cb234-68"><a href="#cb234-68" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.send_command(board, command)</span>
<span id="cb234-69"><a href="#cb234-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-70"><a href="#cb234-70" aria-hidden="true" tabindex="-1"></a>            last_control_time <span class="op">=</span> current_time</span>
<span id="cb234-71"><a href="#cb234-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb234-72"><a href="#cb234-72" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">❌ 명령 생성 실패&quot;</span>)</span>
<span id="cb234-73"><a href="#cb234-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-74"><a href="#cb234-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb234-75"><a href="#cb234-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-76"><a href="#cb234-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_command(<span class="va">self</span>, temp, humid, light<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb234-77"><a href="#cb234-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;AI로 LED 제어 명령 생성&quot;&quot;&quot;</span></span>
<span id="cb234-78"><a href="#cb234-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-79"><a href="#cb234-79" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb234-80"><a href="#cb234-80" aria-hidden="true" tabindex="-1"></a><span class="ss">센서 데이터:</span></span>
<span id="cb234-81"><a href="#cb234-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb234-82"><a href="#cb234-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb234-83"><a href="#cb234-83" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb234-84"><a href="#cb234-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-85"><a href="#cb234-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> light:</span>
<span id="cb234-86"><a href="#cb234-86" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">+=</span> <span class="ss">f&quot;- 조도: </span><span class="sc">{</span>light<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb234-87"><a href="#cb234-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-88"><a href="#cb234-88" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb234-89"><a href="#cb234-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-90"><a href="#cb234-90" aria-hidden="true" tabindex="-1"></a><span class="st">LED 색상을 결정하세요:</span></span>
<span id="cb234-91"><a href="#cb234-91" aria-hidden="true" tabindex="-1"></a><span class="st">- 쾌적: 초록색 [0, 255, 0]</span></span>
<span id="cb234-92"><a href="#cb234-92" aria-hidden="true" tabindex="-1"></a><span class="st">- 주의: 노란색 [255, 255, 0]</span></span>
<span id="cb234-93"><a href="#cb234-93" aria-hidden="true" tabindex="-1"></a><span class="st">- 경고: 빨간색 [255, 0, 0]</span></span>
<span id="cb234-94"><a href="#cb234-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-95"><a href="#cb234-95" aria-hidden="true" tabindex="-1"></a><span class="st">JSON 형식 (다른 텍스트 없이):</span></span>
<span id="cb234-96"><a href="#cb234-96" aria-hidden="true" tabindex="-1"></a><span class="st">{&quot;action&quot;: &quot;led_color&quot;, &quot;color&quot;: [R,G,B], &quot;reason&quot;: &quot;이유&quot;}</span></span>
<span id="cb234-97"><a href="#cb234-97" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb234-98"><a href="#cb234-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-99"><a href="#cb234-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb234-100"><a href="#cb234-100" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb234-101"><a href="#cb234-101" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,</span>
<span id="cb234-102"><a href="#cb234-102" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[</span>
<span id="cb234-103"><a href="#cb234-103" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;JSON만 출력. 간결하게.&quot;</span>},</span>
<span id="cb234-104"><a href="#cb234-104" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb234-105"><a href="#cb234-105" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb234-106"><a href="#cb234-106" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb234-107"><a href="#cb234-107" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb234-108"><a href="#cb234-108" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb234-109"><a href="#cb234-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-110"><a href="#cb234-110" aria-hidden="true" tabindex="-1"></a>            json_str <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb234-111"><a href="#cb234-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-112"><a href="#cb234-112" aria-hidden="true" tabindex="-1"></a>            <span class="co"># JSON 정제</span></span>
<span id="cb234-113"><a href="#cb234-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&quot;```&quot;</span> <span class="kw">in</span> json_str:</span>
<span id="cb234-114"><a href="#cb234-114" aria-hidden="true" tabindex="-1"></a>                json_str <span class="op">=</span> json_str.split(<span class="st">&quot;```&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb234-115"><a href="#cb234-115" aria-hidden="true" tabindex="-1"></a>                json_str <span class="op">=</span> json_str.replace(<span class="st">&quot;json&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="dv">1</span>).strip()</span>
<span id="cb234-116"><a href="#cb234-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-117"><a href="#cb234-117" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> json.loads(json_str)</span>
<span id="cb234-118"><a href="#cb234-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> command</span>
<span id="cb234-119"><a href="#cb234-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-120"><a href="#cb234-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb234-121"><a href="#cb234-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   AI 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-122"><a href="#cb234-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-123"><a href="#cb234-123" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 규칙 기반 폴백</span></span>
<span id="cb234-124"><a href="#cb234-124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> temp <span class="op">&gt;</span> <span class="dv">26</span> <span class="kw">or</span> humid <span class="op">&gt;</span> <span class="dv">60</span>:</span>
<span id="cb234-125"><a href="#cb234-125" aria-hidden="true" tabindex="-1"></a>                color <span class="op">=</span> [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>]  <span class="co"># 빨간색</span></span>
<span id="cb234-126"><a href="#cb234-126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">20</span> <span class="kw">or</span> humid <span class="op">&lt;</span> <span class="dv">40</span>:</span>
<span id="cb234-127"><a href="#cb234-127" aria-hidden="true" tabindex="-1"></a>                color <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>]  <span class="co"># 파란색</span></span>
<span id="cb234-128"><a href="#cb234-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb234-129"><a href="#cb234-129" aria-hidden="true" tabindex="-1"></a>                color <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>]  <span class="co"># 초록색</span></span>
<span id="cb234-130"><a href="#cb234-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-131"><a href="#cb234-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb234-132"><a href="#cb234-132" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>,</span>
<span id="cb234-133"><a href="#cb234-133" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;color&quot;</span>: color,</span>
<span id="cb234-134"><a href="#cb234-134" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;reason&quot;</span>: <span class="st">&quot;규칙 기반 (AI 실패)&quot;</span></span>
<span id="cb234-135"><a href="#cb234-135" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb234-136"><a href="#cb234-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-137"><a href="#cb234-137" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> send_command(<span class="va">self</span>, board, command):</span>
<span id="cb234-138"><a href="#cb234-138" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;제어 명령 전송&quot;&quot;&quot;</span></span>
<span id="cb234-139"><a href="#cb234-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-140"><a href="#cb234-140" aria-hidden="true" tabindex="-1"></a>        topic <span class="op">=</span> TOPIC_CONTROL.<span class="bu">format</span>(board<span class="op">=</span>board)</span>
<span id="cb234-141"><a href="#cb234-141" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> json.dumps(command)</span>
<span id="cb234-142"><a href="#cb234-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-143"><a href="#cb234-143" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mqtt_client.publish(topic, message)</span>
<span id="cb234-144"><a href="#cb234-144" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📤 명령 전송: </span><span class="sc">{</span>topic<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-145"><a href="#cb234-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-146"><a href="#cb234-146" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 콜백</span></span>
<span id="cb234-147"><a href="#cb234-147" aria-hidden="true" tabindex="-1"></a>ai_controller <span class="op">=</span> <span class="va">None</span></span>
<span id="cb234-148"><a href="#cb234-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-149"><a href="#cb234-149" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb234-150"><a href="#cb234-150" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb234-151"><a href="#cb234-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb234-152"><a href="#cb234-152" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb234-153"><a href="#cb234-153" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb234-154"><a href="#cb234-154" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-155"><a href="#cb234-155" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">⏰ 제어 간격: </span><span class="sc">{</span>CONTROL_INTERVAL<span class="sc">}</span><span class="ss">초&quot;</span>)</span>
<span id="cb234-156"><a href="#cb234-156" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🚀 AI 자동 제어 시스템 시작...</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb234-157"><a href="#cb234-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-158"><a href="#cb234-158" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb234-159"><a href="#cb234-159" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 수신 → AI 분석 → 자동 제어&quot;&quot;&quot;</span></span>
<span id="cb234-160"><a href="#cb234-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-161"><a href="#cb234-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb234-162"><a href="#cb234-162" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 파싱</span></span>
<span id="cb234-163"><a href="#cb234-163" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(msg.payload.decode())</span>
<span id="cb234-164"><a href="#cb234-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-165"><a href="#cb234-165" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> data.get(<span class="st">&quot;board&quot;</span>, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb234-166"><a href="#cb234-166" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb234-167"><a href="#cb234-167" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb234-168"><a href="#cb234-168" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> data.get(<span class="st">&quot;light&quot;</span>)</span>
<span id="cb234-169"><a href="#cb234-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-170"><a href="#cb234-170" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 간단한 로그</span></span>
<span id="cb234-171"><a href="#cb234-171" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb234-172"><a href="#cb234-172" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] 📥 보드 </span><span class="sc">{</span>board<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb234-173"><a href="#cb234-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-174"><a href="#cb234-174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># AI 분석 및 제어</span></span>
<span id="cb234-175"><a href="#cb234-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ai_controller:</span>
<span id="cb234-176"><a href="#cb234-176" aria-hidden="true" tabindex="-1"></a>            ai_controller.analyze_and_control(board, temp, humid, light)</span>
<span id="cb234-177"><a href="#cb234-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-178"><a href="#cb234-178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb234-179"><a href="#cb234-179" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 처리 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-180"><a href="#cb234-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-181"><a href="#cb234-181" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트 생성</span></span>
<span id="cb234-182"><a href="#cb234-182" aria-hidden="true" tabindex="-1"></a>mqtt_client <span class="op">=</span> mqtt.Client()</span>
<span id="cb234-183"><a href="#cb234-183" aria-hidden="true" tabindex="-1"></a>mqtt_client.tls_set()</span>
<span id="cb234-184"><a href="#cb234-184" aria-hidden="true" tabindex="-1"></a>mqtt_client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb234-185"><a href="#cb234-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-186"><a href="#cb234-186" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb234-187"><a href="#cb234-187" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_message <span class="op">=</span> on_message</span>
<span id="cb234-188"><a href="#cb234-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-189"><a href="#cb234-189" aria-hidden="true" tabindex="-1"></a><span class="co"># AI 컨트롤러 초기화</span></span>
<span id="cb234-190"><a href="#cb234-190" aria-hidden="true" tabindex="-1"></a>ai_controller <span class="op">=</span> AIController(mqtt_client)</span>
<span id="cb234-191"><a href="#cb234-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-192"><a href="#cb234-192" aria-hidden="true" tabindex="-1"></a><span class="co"># 실행</span></span>
<span id="cb234-193"><a href="#cb234-193" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb234-194"><a href="#cb234-194" aria-hidden="true" tabindex="-1"></a>    mqtt_client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb234-195"><a href="#cb234-195" aria-hidden="true" tabindex="-1"></a>    mqtt_client.loop_forever()</span>
<span id="cb234-196"><a href="#cb234-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-197"><a href="#cb234-197" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb234-198"><a href="#cb234-198" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">🛑 시스템 종료&quot;</span>)</span>
<span id="cb234-199"><a href="#cb234-199" aria-hidden="true" tabindex="-1"></a>    mqtt_client.disconnect()</span></code></pre></div>
<p><strong>실행</strong>:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> ch19_auto_control.py</span></code></pre></div>
<p><strong>출력 예시</strong>:</p>
<pre><code>✅ MQTT 연결 성공!
📬 구독: hexaboard/+/sensor/data

⏰ 제어 간격: 10초

🚀 AI 자동 제어 시스템 시작...

[10:50:15] 📥 보드 A: 30°C, 75%

============================================================
🤖 AI 분석 시작 (보드 A)
============================================================
📊 센서 데이터:
   온도: 30°C
   습도: 75%

🧠 AI 분석 중...

✅ 생성된 명령:
   색상: [255, 0, 0]
   이유: 온도와 습도가 높아 불쾌합니다

📤 명령 전송: hexaboard/A/control/led

============================================================</code></pre>
<hr />
<h2 id="실습-3-양방향-통신-헥사보드-코드">💻 실습 3: 양방향 통신
헥사보드 코드</h2>
<h3 id="센서-전송-제어-수신">센서 전송 + 제어 수신</h3>
<p><strong>헥사보드 코드</strong>:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch19_hexaboard_full.py</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 완전한 양방향 통신</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb237-19"><a href="#cb237-19" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb237-20"><a href="#cb237-20" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb237-21"><a href="#cb237-21" aria-hidden="true" tabindex="-1"></a>MQTT_CLIENT_ID <span class="op">=</span> <span class="st">&quot;hexaboard_A&quot;</span></span>
<span id="cb237-22"><a href="#cb237-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-23"><a href="#cb237-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic</span></span>
<span id="cb237-24"><a href="#cb237-24" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/A/sensor/data&quot;</span></span>
<span id="cb237-25"><a href="#cb237-25" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/A/control/led&quot;</span></span>
<span id="cb237-26"><a href="#cb237-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-27"><a href="#cb237-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 하드웨어</span></span>
<span id="cb237-28"><a href="#cb237-28" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb237-29"><a href="#cb237-29" aria-hidden="true" tabindex="-1"></a>sensor <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb237-30"><a href="#cb237-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-31"><a href="#cb237-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb237-32"><a href="#cb237-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb237-33"><a href="#cb237-33" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb237-34"><a href="#cb237-34" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb237-35"><a href="#cb237-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-36"><a href="#cb237-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb237-37"><a href="#cb237-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[헥사보드] Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb237-38"><a href="#cb237-38" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb237-39"><a href="#cb237-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-40"><a href="#cb237-40" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb237-41"><a href="#cb237-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb237-42"><a href="#cb237-42" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb237-43"><a href="#cb237-43" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb237-44"><a href="#cb237-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-45"><a href="#cb237-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb237-46"><a href="#cb237-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[헥사보드] ✅ Wi-Fi 연결 성공!&quot;</span>)</span>
<span id="cb237-47"><a href="#cb237-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb237-48"><a href="#cb237-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb237-49"><a href="#cb237-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-50"><a href="#cb237-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_control_message(topic, msg):</span>
<span id="cb237-51"><a href="#cb237-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;제어 명령 수신&quot;&quot;&quot;</span></span>
<span id="cb237-52"><a href="#cb237-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] 📥 제어 명령 수신: </span><span class="sc">{</span>msg<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-53"><a href="#cb237-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-54"><a href="#cb237-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb237-55"><a href="#cb237-55" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> ujson.loads(msg)</span>
<span id="cb237-56"><a href="#cb237-56" aria-hidden="true" tabindex="-1"></a>        action <span class="op">=</span> command.get(<span class="st">&quot;action&quot;</span>)</span>
<span id="cb237-57"><a href="#cb237-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-58"><a href="#cb237-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> action <span class="op">==</span> <span class="st">&quot;led_color&quot;</span>:</span>
<span id="cb237-59"><a href="#cb237-59" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> command.get(<span class="st">&quot;color&quot;</span>, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb237-60"><a href="#cb237-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb237-61"><a href="#cb237-61" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> <span class="bu">tuple</span>(color)</span>
<span id="cb237-62"><a href="#cb237-62" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb237-63"><a href="#cb237-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] 💡 LED 색상 변경: </span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-64"><a href="#cb237-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-65"><a href="#cb237-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&quot;led_off&quot;</span>:</span>
<span id="cb237-66"><a href="#cb237-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb237-67"><a href="#cb237-67" aria-hidden="true" tabindex="-1"></a>                np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb237-68"><a href="#cb237-68" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb237-69"><a href="#cb237-69" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] 💡 LED 끄기&quot;</span>)</span>
<span id="cb237-70"><a href="#cb237-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-71"><a href="#cb237-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb237-72"><a href="#cb237-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] ❌ 제어 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-73"><a href="#cb237-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-74"><a href="#cb237-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb237-75"><a href="#cb237-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결&quot;&quot;&quot;</span></span>
<span id="cb237-76"><a href="#cb237-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb237-77"><a href="#cb237-77" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb237-78"><a href="#cb237-78" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span>MQTT_CLIENT_ID,</span>
<span id="cb237-79"><a href="#cb237-79" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb237-80"><a href="#cb237-80" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb237-81"><a href="#cb237-81" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb237-82"><a href="#cb237-82" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb237-83"><a href="#cb237-83" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb237-84"><a href="#cb237-84" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb237-85"><a href="#cb237-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-86"><a href="#cb237-86" aria-hidden="true" tabindex="-1"></a>        client.set_callback(on_control_message)</span>
<span id="cb237-87"><a href="#cb237-87" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb237-88"><a href="#cb237-88" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_CONTROL)</span>
<span id="cb237-89"><a href="#cb237-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-90"><a href="#cb237-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[헥사보드] ✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb237-91"><a href="#cb237-91" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] 📬 구독: </span><span class="sc">{</span>TOPIC_CONTROL<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-92"><a href="#cb237-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-93"><a href="#cb237-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb237-94"><a href="#cb237-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-95"><a href="#cb237-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb237-96"><a href="#cb237-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] ❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-97"><a href="#cb237-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb237-98"><a href="#cb237-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-99"><a href="#cb237-99" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> publish_sensor_data(client):</span>
<span id="cb237-100"><a href="#cb237-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 전송&quot;&quot;&quot;</span></span>
<span id="cb237-101"><a href="#cb237-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb237-102"><a href="#cb237-102" aria-hidden="true" tabindex="-1"></a>        sensor.measure()</span>
<span id="cb237-103"><a href="#cb237-103" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb237-104"><a href="#cb237-104" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor.humidity()</span>
<span id="cb237-105"><a href="#cb237-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-106"><a href="#cb237-106" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> {</span>
<span id="cb237-107"><a href="#cb237-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;board&quot;</span>: <span class="st">&quot;A&quot;</span>,</span>
<span id="cb237-108"><a href="#cb237-108" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;temperature&quot;</span>: temp,</span>
<span id="cb237-109"><a href="#cb237-109" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;humidity&quot;</span>: humid,</span>
<span id="cb237-110"><a href="#cb237-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;timestamp&quot;</span>: time.time()</span>
<span id="cb237-111"><a href="#cb237-111" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb237-112"><a href="#cb237-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-113"><a href="#cb237-113" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> ujson.dumps(data)</span>
<span id="cb237-114"><a href="#cb237-114" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_SENSOR, message)</span>
<span id="cb237-115"><a href="#cb237-115" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] 📤 센서 데이터: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb237-116"><a href="#cb237-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-117"><a href="#cb237-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb237-118"><a href="#cb237-118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[헥사보드] ❌ 센서 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-119"><a href="#cb237-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-120"><a href="#cb237-120" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb237-121"><a href="#cb237-121" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb237-122"><a href="#cb237-122" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb237-123"><a href="#cb237-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-124"><a href="#cb237-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb237-125"><a href="#cb237-125" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">[헥사보드] 🚀 시스템 시작</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb237-126"><a href="#cb237-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-127"><a href="#cb237-127" aria-hidden="true" tabindex="-1"></a>        last_publish <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb237-128"><a href="#cb237-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-129"><a href="#cb237-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb237-130"><a href="#cb237-130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb237-131"><a href="#cb237-131" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 제어 명령 확인</span></span>
<span id="cb237-132"><a href="#cb237-132" aria-hidden="true" tabindex="-1"></a>                client.check_msg()</span>
<span id="cb237-133"><a href="#cb237-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-134"><a href="#cb237-134" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 5초마다 센서 데이터 전송</span></span>
<span id="cb237-135"><a href="#cb237-135" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> time.time() <span class="op">-</span> last_publish <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb237-136"><a href="#cb237-136" aria-hidden="true" tabindex="-1"></a>                    publish_sensor_data(client)</span>
<span id="cb237-137"><a href="#cb237-137" aria-hidden="true" tabindex="-1"></a>                    last_publish <span class="op">=</span> time.time()</span>
<span id="cb237-138"><a href="#cb237-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-139"><a href="#cb237-139" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb237-140"><a href="#cb237-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-141"><a href="#cb237-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb237-142"><a href="#cb237-142" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">[헥사보드] 종료&quot;</span>)</span>
<span id="cb237-143"><a href="#cb237-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-144"><a href="#cb237-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb237-145"><a href="#cb237-145" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<hr />
<h2 id="실습-4-시스템-모니터링">💻 실습 4: 시스템 모니터링</h2>
<h3 id="전체-시스템-상태-확인">전체 시스템 상태 확인</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: ch19_monitor.py</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 시스템 모니터링</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_BROKER&quot;</span>)</span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">&quot;MQTT_PORT&quot;</span>, <span class="dv">8883</span>))</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_USER&quot;</span>)</span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_PASSWORD&quot;</span>)</span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 Topic 구독</span></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>TOPIC_ALL <span class="op">=</span> <span class="st">&quot;hexaboard/#&quot;</span></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 통계</span></span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> {</span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sensor_count&quot;</span>: <span class="dv">0</span>,</span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;control_count&quot;</span>: <span class="dv">0</span></span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb238-26"><a href="#cb238-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-27"><a href="#cb238-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb238-28"><a href="#cb238-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb238-29"><a href="#cb238-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb238-30"><a href="#cb238-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ 모니터링 시작!&quot;</span>)</span>
<span id="cb238-31"><a href="#cb238-31" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_ALL)</span>
<span id="cb238-32"><a href="#cb238-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_ALL<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb238-33"><a href="#cb238-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-34"><a href="#cb238-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb238-35"><a href="#cb238-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;모든 메시지 모니터링&quot;&quot;&quot;</span></span>
<span id="cb238-36"><a href="#cb238-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-37"><a href="#cb238-37" aria-hidden="true" tabindex="-1"></a>    topic <span class="op">=</span> msg.topic</span>
<span id="cb238-38"><a href="#cb238-38" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> msg.payload.decode()</span>
<span id="cb238-39"><a href="#cb238-39" aria-hidden="true" tabindex="-1"></a>    time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb238-40"><a href="#cb238-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-41"><a href="#cb238-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Topic 종류 구분</span></span>
<span id="cb238-42"><a href="#cb238-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;sensor&quot;</span> <span class="kw">in</span> topic:</span>
<span id="cb238-43"><a href="#cb238-43" aria-hidden="true" tabindex="-1"></a>        stats[<span class="st">&quot;sensor_count&quot;</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb238-44"><a href="#cb238-44" aria-hidden="true" tabindex="-1"></a>        icon <span class="op">=</span> <span class="st">&quot;📊&quot;</span></span>
<span id="cb238-45"><a href="#cb238-45" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;센서&quot;</span></span>
<span id="cb238-46"><a href="#cb238-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&quot;control&quot;</span> <span class="kw">in</span> topic:</span>
<span id="cb238-47"><a href="#cb238-47" aria-hidden="true" tabindex="-1"></a>        stats[<span class="st">&quot;control_count&quot;</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb238-48"><a href="#cb238-48" aria-hidden="true" tabindex="-1"></a>        icon <span class="op">=</span> <span class="st">&quot;🎮&quot;</span></span>
<span id="cb238-49"><a href="#cb238-49" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;제어&quot;</span></span>
<span id="cb238-50"><a href="#cb238-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb238-51"><a href="#cb238-51" aria-hidden="true" tabindex="-1"></a>        icon <span class="op">=</span> <span class="st">&quot;📄&quot;</span></span>
<span id="cb238-52"><a href="#cb238-52" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;기타&quot;</span></span>
<span id="cb238-53"><a href="#cb238-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-54"><a href="#cb238-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 출력</span></span>
<span id="cb238-55"><a href="#cb238-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>icon<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-56"><a href="#cb238-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;  Topic: </span><span class="sc">{</span>topic<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-57"><a href="#cb238-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-58"><a href="#cb238-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># JSON 파싱 시도</span></span>
<span id="cb238-59"><a href="#cb238-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb238-60"><a href="#cb238-60" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(payload)</span>
<span id="cb238-61"><a href="#cb238-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  Data: </span><span class="sc">{</span>json<span class="sc">.</span>dumps(data, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-62"><a href="#cb238-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb238-63"><a href="#cb238-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  Data: </span><span class="sc">{</span>payload<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-64"><a href="#cb238-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-65"><a href="#cb238-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 통계</span></span>
<span id="cb238-66"><a href="#cb238-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;  통계: 센서 </span><span class="sc">{</span>stats[<span class="st">&#39;sensor_count&#39;</span>]<span class="sc">}</span><span class="ss">개, 제어 </span><span class="sc">{</span>stats[<span class="st">&#39;control_count&#39;</span>]<span class="sc">}</span><span class="ss">개&quot;</span>)</span>
<span id="cb238-67"><a href="#cb238-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb238-68"><a href="#cb238-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-69"><a href="#cb238-69" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb238-70"><a href="#cb238-70" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client()</span>
<span id="cb238-71"><a href="#cb238-71" aria-hidden="true" tabindex="-1"></a>client.tls_set()</span>
<span id="cb238-72"><a href="#cb238-72" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb238-73"><a href="#cb238-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-74"><a href="#cb238-74" aria-hidden="true" tabindex="-1"></a>client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb238-75"><a href="#cb238-75" aria-hidden="true" tabindex="-1"></a>client.on_message <span class="op">=</span> on_message</span>
<span id="cb238-76"><a href="#cb238-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-77"><a href="#cb238-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 실행</span></span>
<span id="cb238-78"><a href="#cb238-78" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb238-79"><a href="#cb238-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;🔍 전체 시스템 모니터링</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb238-80"><a href="#cb238-80" aria-hidden="true" tabindex="-1"></a>    client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb238-81"><a href="#cb238-81" aria-hidden="true" tabindex="-1"></a>    client.loop_forever()</span>
<span id="cb238-82"><a href="#cb238-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-83"><a href="#cb238-83" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb238-84"><a href="#cb238-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n\n</span><span class="ss">📊 최종 통계:&quot;</span>)</span>
<span id="cb238-85"><a href="#cb238-85" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   센서 메시지: </span><span class="sc">{</span>stats[<span class="st">&#39;sensor_count&#39;</span>]<span class="sc">}</span><span class="ss">개&quot;</span>)</span>
<span id="cb238-86"><a href="#cb238-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   제어 메시지: </span><span class="sc">{</span>stats[<span class="st">&#39;control_count&#39;</span>]<span class="sc">}</span><span class="ss">개&quot;</span>)</span>
<span id="cb238-87"><a href="#cb238-87" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">모니터링 종료&quot;</span>)</span>
<span id="cb238-88"><a href="#cb238-88" aria-hidden="true" tabindex="-1"></a>    client.disconnect()</span></code></pre></div>
<hr />
<h2 id="문제-해결-11">🛠️ 문제 해결</h2>
<h3 id="제어-명령이-실행-안-됨">제어 명령이 실행 안 됨</h3>
<p><strong>확인 사항</strong>:</p>
<ol type="1">
<li>Topic 이름 일치 확인</li>
<li>헥사보드가 Subscribe 중인지 확인</li>
<li>JSON 형식 확인</li>
</ol>
<h3 id="너무-자주-제어됨">너무 자주 제어됨</h3>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>CONTROL_INTERVAL <span class="op">=</span> <span class="dv">10</span>  <span class="co"># 10초로 증가</span></span></code></pre></div>
<h3 id="ai-비용이-너무-많이-나옴">AI 비용이 너무 많이 나옴</h3>
<p><strong>해결</strong>:</p>
<ul>
<li><code>gpt-3.5-turbo</code> 사용</li>
<li>제어 간격 늘리기</li>
<li>규칙 기반 우선 사용</li>
</ul>
<hr />
<h2 id="도전-과제-13">🚀 도전 과제</h2>
<h3 id="과제-1-다중-보드-제어">과제 1: 다중 보드 제어</h3>
<p>여러 헥사보드를 동시에 제어하세요.</p>
<h3 id="과제-2-학습-기능">과제 2: 학습 기능</h3>
<p>이전 제어 결과를 기억하여 더 나은 판단을 하세요.</p>
<hr />
<h2 id="핵심-정리-8">📝 핵심 정리</h2>
<h3 id="꼭-기억하세요-8">꼭 기억하세요!</h3>
<ol type="1">
<li><strong>양방향 통신</strong>: Subscribe + Publish</li>
<li><strong>자동 제어</strong>: 센서 → AI → 명령 → 실행</li>
<li><strong>제어 간격</strong>: 너무 자주 제어하지 않기</li>
<li><strong>폴백</strong>: AI 실패 시 규칙 기반</li>
<li><strong>모니터링</strong>: 전체 시스템 상태 확인</li>
</ol>
<hr />
<h2 id="자주-묻는-질문-10">❓ 자주 묻는 질문</h2>
<h3 id="q1.-얼마나-자주-제어해야-하나요">Q1. 얼마나 자주 제어해야
하나요?</h3>
<p><strong>A</strong>: 5-10초마다가 적당합니다. 너무 자주하면 비용과
부하 증가.</p>
<h3 id="q2.-여러-헥사보드를-제어하려면">Q2. 여러 헥사보드를
제어하려면?</h3>
<p><strong>A</strong>: Topic 패턴을 사용하고, board ID로 구분하세요.</p>
<h3 id="q3.-실시간-제어가-필요한가요">Q3. 실시간 제어가 필요한가요?</h3>
<p><strong>A</strong>: 환경 제어는 실시간이 아니어도 됩니다. 10초 정도면
충분합니다.</p>
<hr />
<h2 id="다음-단계-9">🚀 다음 단계</h2>
<p>완전한 AI 자동 제어 시스템을 구축했습니다!</p>
<p><strong>다음 PART에서는</strong>:</p>
<ul>
<li>종합 프로젝트: AI 환경 무드 컨트롤러</li>
<li>실전 시나리오</li>
<li>시스템 통합 및 튜닝</li>
</ul>
<hr />
<p><strong>🎉 Chapter 19 완료!</strong><br />
<strong>🎉 PART 5 완료!</strong></p>
<p>이제 센서 데이터를 AI가 분석하고, 자동으로 헥사보드를 제어하는 완전한
AIoT 시스템이 완성되었습니다!</p>
<h1 id="chapter-20.-프로젝트-개요">Chapter 20. 프로젝트 개요</h1>
<blockquote>
<p><strong>PART 6</strong>: 종합 프로젝트 – AI 환경 무드 컨트롤러</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-19">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>종합 프로젝트의 목표를
이해한다</label></li>
<li><label><input type="checkbox"></input>시스템 구성 요소를
파악한다</label></li>
<li><label><input type="checkbox"></input>프로젝트 구현 계획을
세운다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 20분</p>
<hr />
<h2 id="프로젝트-소개">🎯 프로젝트 소개</h2>
<h3 id="ai-환경-무드-컨트롤러란">AI 환경 무드 컨트롤러란?</h3>
<p><strong>실내 환경을 AI가 자동으로 분석하고 제어하는 스마트
시스템</strong></p>
<pre><code>센서로 환경 감지
    ↓
AI가 상황 판단
    ↓
LED로 상태 표시
    ↓
사용자에게 권장 사항 제공</code></pre>
<p><strong>핵심 기능</strong>:</p>
<ul>
<li>✅ 실시간 환경 모니터링 (온도, 습도, 조도)</li>
<li>✅ AI 기반 환경 분석 및 평가</li>
<li>✅ 자동 LED 색상 제어</li>
<li>✅ 사용자 알림 및 권장 사항</li>
</ul>
<hr />
<h2 id="시스템-구성">🏗️ 시스템 구성</h2>
<h3 id="전체-아키텍처">전체 아키텍처</h3>
<pre><code>┌─────────────────┐
│   헥사보드       │
│  ① 센서 수집     │
│  ② LED 제어      │
└────────┬────────┘
         │ MQTT
         ↓
┌─────────────────┐
│  MQTT Broker    │
│   (HiveMQ)      │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  Python AI      │
│  ③ 데이터 분석   │
│  ④ AI 판단       │
│  ⑤ 명령 생성     │
└─────────────────┘</code></pre>
<h3 id="주요-컴포넌트">주요 컴포넌트</h3>
<p><strong>1. 헥사보드 (Edge Device)</strong></p>
<ul>
<li>DHT11 온습도 센서</li>
<li>조도 센서</li>
<li>5×5 NeoPixel LED</li>
<li>MicroPython</li>
</ul>
<p><strong>2. MQTT Broker</strong></p>
<ul>
<li>HiveMQ Cloud</li>
<li>실시간 메시지 중개</li>
</ul>
<p><strong>3. Python AI 서버</strong></p>
<ul>
<li>OpenAI GPT-4</li>
<li>데이터 분석 및 명령 생성</li>
</ul>
<hr />
<h2 id="무드-시스템-정의">🎨 무드 시스템 정의</h2>
<h3 id="가지-무드-상태">5가지 무드 상태</h3>
<table>
<thead>
<tr>
<th>무드</th>
<th>조건</th>
<th>LED 색상</th>
<th>의미</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>🟢 Perfect</strong></td>
<td>온도 22-26°C, 습도 40-60%</td>
<td>초록색</td>
<td>완벽한 환경</td>
</tr>
<tr>
<td><strong>🟡 Good</strong></td>
<td>온도 20-28°C, 습도 35-65%</td>
<td>노란색</td>
<td>좋은 환경</td>
</tr>
<tr>
<td><strong>🔵 Cold</strong></td>
<td>온도 &lt; 20°C</td>
<td>파란색</td>
<td>추운 환경</td>
</tr>
<tr>
<td><strong>🔴 Hot</strong></td>
<td>온도 &gt; 28°C</td>
<td>빨간색</td>
<td>더운 환경</td>
</tr>
<tr>
<td><strong>🟣 Humid</strong></td>
<td>습도 &gt; 65%</td>
<td>보라색</td>
<td>습한 환경</td>
</tr>
</tbody>
</table>
<h3 id="led-패턴">LED 패턴</h3>
<p><strong>상태별 LED 표현</strong>:</p>
<ul>
<li><strong>Perfect</strong>: 전체 초록색, 부드러운 밝기</li>
<li><strong>Good</strong>: 전체 노란색</li>
<li><strong>Cold</strong>: 파란색 깜빡임</li>
<li><strong>Hot</strong>: 빨간색 깜빡임</li>
<li><strong>Humid</strong>: 보라색 펄스</li>
</ul>
<hr />
<h2 id="프로젝트-요구사항">📋 프로젝트 요구사항</h2>
<h3 id="기능-요구사항">기능 요구사항</h3>
<p><strong>1. 센서 모니터링</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>5초마다 센서 데이터
수집</label></li>
<li><label><input type="checkbox"></input>MQTT로 데이터 전송</label></li>
<li><label><input type="checkbox"></input>센서 오류 처리</label></li>
</ul>
<p><strong>2. AI 분석</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>센서 데이터 해석</label></li>
<li><label><input type="checkbox"></input>환경 상태 평가</label></li>
<li><label><input type="checkbox"></input>권장 조치 생성</label></li>
</ul>
<p><strong>3. 자동 제어</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>무드에 따라 LED 자동
변경</label></li>
<li><label><input type="checkbox"></input>사용자 알림 전송</label></li>
<li><label><input type="checkbox"></input>제어 이력 기록</label></li>
</ul>
<p><strong>4. 사용자 인터페이스</strong></p>
<ul class="task-list">
<li><label><input type="checkbox"></input>현재 상태 표시</label></li>
<li><label><input type="checkbox"></input>권장 사항 출력</label></li>
<li><label><input type="checkbox"></input>수동 제어 가능</label></li>
</ul>
<h3 id="비기능-요구사항">비기능 요구사항</h3>
<ul>
<li><strong>응답 시간</strong>: 센서 데이터 → LED 제어 &lt; 3초</li>
<li><strong>안정성</strong>: 24시간 연속 동작</li>
<li><strong>확장성</strong>: 여러 헥사보드 지원 가능</li>
<li><strong>사용성</strong>: 초보자도 쉽게 설정</li>
</ul>
<hr />
<h2 id="필요한-것-9">🛠️ 필요한 것</h2>
<h3 id="하드웨어">하드웨어</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>DHT11 센서 모듈 ×
1</label></li>
<li><label><input type="checkbox" checked></input>조도 센서 모듈 ×
1</label></li>
<li><label><input type="checkbox" checked></input>3핀 케이블 ×
2</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
</ul>
<h3 id="소프트웨어">소프트웨어</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>MicroPython
1.24</label></li>
<li><label><input type="checkbox" checked></input>Python 3.10+</label></li>
<li><label><input type="checkbox" checked></input>OpenAI API
키</label></li>
<li><label><input type="checkbox" checked></input>HiveMQ Cloud
계정</label></li>
</ul>
<h3 id="라이브러리">라이브러리</h3>
<p><strong>Python</strong>:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install paho-mqtt openai python-dotenv</span></code></pre></div>
<p><strong>MicroPython</strong>:</p>
<ul>
<li><code>umqtt.simple</code></li>
<li><code>neopixel</code></li>
<li><code>dht</code></li>
<li><code>machine</code></li>
</ul>
<hr />
<h2 id="구현-일정">📅 구현 일정</h2>
<h3 id="단계-구현-계획">3단계 구현 계획</h3>
<p><strong>Phase 1: 기본 시스템 (1시간)</strong></p>
<ul>
<li>센서 데이터 수집</li>
<li>MQTT 통신 설정</li>
<li>기본 LED 제어</li>
</ul>
<p><strong>Phase 2: AI 통합 (1시간)</strong></p>
<ul>
<li>OpenAI API 연동</li>
<li>무드 분석 로직</li>
<li>자동 제어 구현</li>
</ul>
<p><strong>Phase 3: 튜닝 및 테스트 (1시간)</strong></p>
<ul>
<li>성능 최적화</li>
<li>에러 처리 강화</li>
<li>다양한 시나리오 테스트</li>
</ul>
<p><strong>총 소요 시간</strong>: 3-4시간</p>
<hr />
<h2 id="학습-목표-19">🎯 학습 목표</h2>
<h3 id="이-프로젝트를-통해-배울-것">이 프로젝트를 통해 배울 것</h3>
<ol type="1">
<li><p><strong>시스템 통합</strong></p>
<ul>
<li>여러 컴포넌트를 하나로 연결</li>
<li>전체 데이터 흐름 이해</li>
</ul></li>
<li><p><strong>실전 AIoT 개발</strong></p>
<ul>
<li>실제 사용 가능한 시스템 구축</li>
<li>문제 해결 능력 향상</li>
</ul></li>
<li><p><strong>AI 활용</strong></p>
<ul>
<li>OpenAI API 실전 활용</li>
<li>프롬프트 최적화</li>
</ul></li>
<li><p><strong>프로젝트 관리</strong></p>
<ul>
<li>단계별 구현</li>
<li>테스트 및 디버깅</li>
</ul></li>
</ol>
<hr />
<h2 id="프로젝트-확장-아이디어">💡 프로젝트 확장 아이디어</h2>
<h3 id="추가할-수-있는-기능">추가할 수 있는 기능</h3>
<p><strong>레벨 1 (쉬움)</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>센서 데이터 CSV 저장</label></li>
<li><label><input type="checkbox"></input>일일 통계 리포트</label></li>
<li><label><input type="checkbox"></input>사용자 선호 온도 설정</label></li>
</ul>
<p><strong>레벨 2 (보통)</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>시간대별 자동 모드 전환</label></li>
<li><label><input type="checkbox"></input>여러 방 동시 모니터링</label></li>
<li><label><input type="checkbox"></input>스마트폰 알림 연동</label></li>
</ul>
<p><strong>레벨 3 (어려움)</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>머신러닝 기반 패턴 학습</label></li>
<li><label><input type="checkbox"></input>에너지 소비 최적화</label></li>
<li><label><input type="checkbox"></input>음성 제어 통합</label></li>
</ul>
<hr />
<h2 id="성공-지표">📊 성공 지표</h2>
<h3 id="프로젝트-완료-기준">프로젝트 완료 기준</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>센서 데이터가 정확하게
수집됨</label></li>
<li><label><input type="checkbox" checked></input>AI가 적절한 무드를
판단함</label></li>
<li><label><input type="checkbox" checked></input>LED가 자동으로
변경됨</label></li>
<li><label><input type="checkbox" checked></input>시스템이 안정적으로
동작함</label></li>
<li><label><input type="checkbox" checked></input>사용자가 쉽게 사용할 수
있음</label></li>
</ul>
<hr />
<h2 id="사전-지식">🎓 사전 지식</h2>
<h3 id="필수-선수-과정">필수 선수 과정</h3>
<p>이 프로젝트를 시작하기 전에 다음을 완료해야 합니다:</p>
<ul>
<li>✅ PART 1-2: 헥사보드 기본 제어</li>
<li>✅ PART 3: 센서 연결</li>
<li>✅ PART 4: MQTT 통신</li>
<li>✅ PART 5: Python AI 서버</li>
</ul>
<p><strong>모든 선수 과정을 완료했다면, 시작할 준비가
되었습니다!</strong></p>
<hr />
<h2 id="다음-단계-10">🚀 다음 단계</h2>
<p>프로젝트 개요를 이해했습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>시스템 아키텍처 상세 설계</li>
<li>데이터 흐름 정의</li>
<li>컴포넌트 간 인터페이스 설계</li>
</ul>
<hr />
<h2 id="체크리스트">📝 체크리스트</h2>
<p>프로젝트 시작 전 확인:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>PART 1-5 완료</label></li>
<li><label><input type="checkbox"></input>하드웨어 준비 완료</label></li>
<li><label><input type="checkbox"></input>Python 환경 설정 완료</label></li>
<li><label><input type="checkbox"></input>OpenAI API 키 발급</label></li>
<li><label><input type="checkbox"></input>HiveMQ Cloud 설정 완료</label></li>
<li><label><input type="checkbox"></input>예제 코드 실행 테스트
완료</label></li>
</ul>
<p><strong>모두 체크되었다면, Chapter 21로 진행하세요!</strong></p>
<hr />
<p><strong>🎉 Chapter 20 완료!</strong><br />
이제 AI 환경 무드 컨트롤러 프로젝트를 시작할 준비가 되었습니다!</p>
<h1 id="chapter-21.-시스템-아키텍처-설계">Chapter 21. 시스템 아키텍처
설계</h1>
<blockquote>
<p><strong>PART 6</strong>: 종합 프로젝트 – AI 환경 무드 컨트롤러</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-20">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>시스템 아키텍처를 설계할 수
있다</label></li>
<li><label><input type="checkbox"></input>데이터 흐름을 정의할 수
있다</label></li>
<li><label><input type="checkbox"></input>컴포넌트 간 인터페이스를 설계할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 30분</p>
<hr />
<h2 id="학습-목표-20">🎯 학습 목표</h2>
<h3 id="핵심-개념-19">핵심 개념</h3>
<ul>
<li><strong>아키텍처</strong>: 시스템 구조와 컴포넌트 관계</li>
<li><strong>데이터 흐름</strong>: 정보가 이동하는 경로</li>
<li><strong>인터페이스</strong>: 컴포넌트 간 통신 방법</li>
</ul>
<hr />
<h2 id="시스템-아키텍처-1">🏗️ 시스템 아키텍처</h2>
<h3 id="계층-구조">3계층 구조</h3>
<pre><code>┌─────────────────────────────────────┐
│      Edge Layer (엣지 계층)          │
│  ┌──────────────────────────────┐   │
│  │     헥사보드 (ESP32)          │   │
│  │  • DHT11 센서                 │   │
│  │  • 조도 센서                  │   │
│  │  • NeoPixel LED              │   │
│  │  • MicroPython                │   │
│  └──────────────────────────────┘   │
└──────────────┬──────────────────────┘
               │ MQTT (TLS)
┌──────────────┴──────────────────────┐
│   Communication Layer (통신 계층)    │
│  ┌──────────────────────────────┐   │
│  │    MQTT Broker (HiveMQ)      │   │
│  │  • Topic 관리                 │   │
│  │  • 메시지 중개                │   │
│  │  • QoS 보장                   │   │
│  └──────────────────────────────┘   │
└──────────────┬──────────────────────┘
               │ MQTT (TLS)
┌──────────────┴──────────────────────┐
│    Intelligence Layer (지능 계층)    │
│  ┌──────────────────────────────┐   │
│  │   Python AI Server            │   │
│  │  • 데이터 수집                │   │
│  │  • AI 분석 (OpenAI)           │   │
│  │  • 명령 생성                  │   │
│  │  • 상태 관리                  │   │
│  └──────────────────────────────┘   │
└─────────────────────────────────────┘</code></pre>
<hr />
<h2 id="데이터-흐름">📡 데이터 흐름</h2>
<h3 id="센서-ai-제어-흐름">센서 → AI → 제어 흐름</h3>
<p><strong>1. 센서 데이터 수집 (5초 주기)</strong></p>
<pre><code>헥사보드 센서
  ├─ DHT11: 온도 25°C, 습도 60%
  ├─ 조도 센서: 800
  └─ 타임스탬프: 1234567890

↓ JSON 변환

{
  &quot;board&quot;: &quot;A&quot;,
  &quot;temperature&quot;: 25,
  &quot;humidity&quot;: 60,
  &quot;light&quot;: 800,
  &quot;timestamp&quot;: 1234567890
}

↓ MQTT Publish

Topic: hexaboard/A/sensor/data</code></pre>
<p><strong>2. AI 분석 (10초 주기)</strong></p>
<pre><code>Python Server
  ├─ 최근 10개 데이터 수집
  ├─ 평균 계산
  ├─ OpenAI API 호출
  └─ 무드 판단

↓ 무드 결정

{
  &quot;mood&quot;: &quot;Perfect&quot;,
  &quot;reason&quot;: &quot;온도와 습도가 이상적&quot;,
  &quot;recommendation&quot;: &quot;현재 상태 유지&quot;
}

↓ LED 명령 생성

{
  &quot;action&quot;: &quot;led_color&quot;,
  &quot;color&quot;: [0, 255, 0],
  &quot;pattern&quot;: &quot;solid&quot;,
  &quot;brightness&quot;: 80
}

↓ MQTT Publish

Topic: hexaboard/A/control/led</code></pre>
<p><strong>3. LED 제어 실행</strong></p>
<pre><code>헥사보드
  ├─ MQTT Subscribe
  ├─ 명령 파싱
  ├─ LED 제어 실행
  └─ 상태 확인 전송

↓ 실행 결과

Topic: hexaboard/A/status
Message: &quot;led_updated&quot;</code></pre>
<hr />
<h2 id="상태-다이어그램">🔄 상태 다이어그램</h2>
<h3 id="무드-전환-로직">무드 전환 로직</h3>
<pre><code>        [Perfect]
         ↙  ↓  ↘
    [Cold] [Good] [Hot]
         ↘  ↓  ↙
        [Humid]</code></pre>
<p><strong>전환 조건</strong>:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">22</span> <span class="op">&lt;=</span> temp <span class="op">&lt;=</span> <span class="dv">26</span> <span class="kw">and</span> <span class="dv">40</span> <span class="op">&lt;=</span> humid <span class="op">&lt;=</span> <span class="dv">60</span>:</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>    mood <span class="op">=</span> <span class="st">&quot;Perfect&quot;</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="dv">20</span> <span class="op">&lt;=</span> temp <span class="op">&lt;=</span> <span class="dv">28</span> <span class="kw">and</span> <span class="dv">35</span> <span class="op">&lt;=</span> humid <span class="op">&lt;=</span> <span class="dv">65</span>:</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>    mood <span class="op">=</span> <span class="st">&quot;Good&quot;</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>    mood <span class="op">=</span> <span class="st">&quot;Cold&quot;</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> temp <span class="op">&gt;</span> <span class="dv">28</span>:</span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>    mood <span class="op">=</span> <span class="st">&quot;Hot&quot;</span></span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> humid <span class="op">&gt;</span> <span class="dv">65</span>:</span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>    mood <span class="op">=</span> <span class="st">&quot;Humid&quot;</span></span></code></pre></div>
<hr />
<h2 id="topic-설계-1">📋 Topic 설계</h2>
<h3 id="mqtt-topic-구조">MQTT Topic 구조</h3>
<p><strong>센서 데이터</strong>:</p>
<pre><code>hexaboard/{board_id}/sensor/data
  → {&quot;temperature&quot;: 25, &quot;humidity&quot;: 60, &quot;light&quot;: 800}</code></pre>
<p><strong>제어 명령</strong>:</p>
<pre><code>hexaboard/{board_id}/control/led
  → {&quot;action&quot;: &quot;led_color&quot;, &quot;color&quot;: [0, 255, 0]}</code></pre>
<p><strong>상태 업데이트</strong>:</p>
<pre><code>hexaboard/{board_id}/status
  → &quot;online&quot; | &quot;offline&quot; | &quot;led_updated&quot;</code></pre>
<p><strong>AI 분석 결과</strong> (선택):</p>
<pre><code>hexaboard/{board_id}/analysis
  → {&quot;mood&quot;: &quot;Perfect&quot;, &quot;reason&quot;: &quot;...&quot;}</code></pre>
<hr />
<h2 id="데이터-모델">🗂️ 데이터 모델</h2>
<h3 id="센서-데이터-모델">센서 데이터 모델</h3>
<div class="sourceCode" id="cb253"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>SensorData <span class="op">=</span> {</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;board&quot;</span>: <span class="bu">str</span>,           <span class="co"># 보드 ID (예: &quot;A&quot;)</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;temperature&quot;</span>: <span class="bu">float</span>,   <span class="co"># 온도 (°C)</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;humidity&quot;</span>: <span class="bu">float</span>,      <span class="co"># 습도 (%)</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;light&quot;</span>: <span class="bu">int</span>,           <span class="co"># 조도 (0-4095)</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;timestamp&quot;</span>: <span class="bu">int</span>        <span class="co"># Unix timestamp</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="무드-분석-모델">무드 분석 모델</h3>
<div class="sourceCode" id="cb254"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>MoodAnalysis <span class="op">=</span> {</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;mood&quot;</span>: <span class="bu">str</span>,            <span class="co"># &quot;Perfect&quot; | &quot;Good&quot; | &quot;Cold&quot; | &quot;Hot&quot; | &quot;Humid&quot;</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;score&quot;</span>: <span class="bu">float</span>,         <span class="co"># 0.0-1.0 (환경 품질 점수)</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;reason&quot;</span>: <span class="bu">str</span>,          <span class="co"># 무드 판단 이유</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;recommendation&quot;</span>: <span class="bu">str</span>,  <span class="co"># 권장 조치</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;timestamp&quot;</span>: <span class="bu">int</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="led-제어-모델">LED 제어 모델</h3>
<div class="sourceCode" id="cb255"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>LEDCommand <span class="op">=</span> {</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;action&quot;</span>: <span class="bu">str</span>,          <span class="co"># &quot;led_color&quot; | &quot;led_pattern&quot; | &quot;led_off&quot;</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;color&quot;</span>: [<span class="bu">int</span>, <span class="bu">int</span>, <span class="bu">int</span>],  <span class="co"># RGB (0-255)</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;pattern&quot;</span>: <span class="bu">str</span>,         <span class="co"># &quot;solid&quot; | &quot;blink&quot; | &quot;pulse&quot;</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;brightness&quot;</span>: <span class="bu">int</span>,      <span class="co"># 0-100 (%)</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;duration&quot;</span>: <span class="bu">int</span>         <span class="co"># 지속 시간 (초, 선택)</span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="컴포넌트-인터페이스">🔌 컴포넌트 인터페이스</h2>
<h3 id="헥사보드-인터페이스">헥사보드 인터페이스</h3>
<p><strong>입력 (Subscribe)</strong>:</p>
<ul>
<li><code>hexaboard/A/control/led</code> - LED 제어 명령</li>
<li><code>hexaboard/A/control/mode</code> - 모드 변경 (선택)</li>
</ul>
<p><strong>출력 (Publish)</strong>:</p>
<ul>
<li><code>hexaboard/A/sensor/data</code> - 센서 데이터 (5초마다)</li>
<li><code>hexaboard/A/status</code> - 상태 정보</li>
</ul>
<p><strong>API (함수)</strong>:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_sensors() <span class="op">-&gt;</span> SensorData</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_led(color: <span class="bu">tuple</span>, pattern: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">bool</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_status() <span class="op">-&gt;</span> <span class="bu">str</span></span></code></pre></div>
<h3 id="python-ai-server-인터페이스">Python AI Server 인터페이스</h3>
<p><strong>입력 (Subscribe)</strong>:</p>
<ul>
<li><code>hexaboard/+/sensor/data</code> - 모든 보드 센서 데이터</li>
</ul>
<p><strong>출력 (Publish)</strong>:</p>
<ul>
<li><code>hexaboard/{id}/control/led</code> - LED 제어 명령</li>
<li><code>hexaboard/{id}/analysis</code> - 분석 결과 (선택)</li>
</ul>
<p><strong>API (함수)</strong>:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_environment(data: SensorData) <span class="op">-&gt;</span> MoodAnalysis</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_command(mood: MoodAnalysis) <span class="op">-&gt;</span> LEDCommand</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> send_command(board_id: <span class="bu">str</span>, cmd: LEDCommand) <span class="op">-&gt;</span> <span class="bu">bool</span></span></code></pre></div>
<hr />
<h2 id="설정-파일-구조">⚙️ 설정 파일 구조</h2>
<h3 id="환경-변수-.env">환경 변수 (.env)</h3>
<div class="sourceCode" id="cb258"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_BROKER</span><span class="op">=</span>abc123.s1.eu.hivemq.cloud</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_PORT</span><span class="op">=</span>8883</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_USER</span><span class="op">=</span>hexaboard</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="va">MQTT_PASSWORD</span><span class="op">=</span>your_password</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenAI 설정</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a><span class="va">OPENAI_API_KEY</span><span class="op">=</span>sk-proj-XXXX</span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 시스템 설정</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a><span class="va">BOARD_ID</span><span class="op">=</span>A</span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a><span class="va">SENSOR_INTERVAL</span><span class="op">=</span>5</span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a><span class="va">CONTROL_INTERVAL</span><span class="op">=</span>10</span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 무드 임계값</span></span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a><span class="va">TEMP_MIN_PERFECT</span><span class="op">=</span>22</span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a><span class="va">TEMP_MAX_PERFECT</span><span class="op">=</span>26</span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a><span class="va">HUMID_MIN_PERFECT</span><span class="op">=</span>40</span>
<span id="cb258-19"><a href="#cb258-19" aria-hidden="true" tabindex="-1"></a><span class="va">HUMID_MAX_PERFECT</span><span class="op">=</span>60</span></code></pre></div>
<h3 id="무드-설정-config.json">무드 설정 (config.json)</h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;moods&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Perfect&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;solid&quot;</span><span class="fu">,</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;brightness&quot;</span><span class="fu">:</span> <span class="dv">80</span><span class="fu">,</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;conditions&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;temp_min&quot;</span><span class="fu">:</span> <span class="dv">22</span><span class="fu">,</span></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;temp_max&quot;</span><span class="fu">:</span> <span class="dv">26</span><span class="fu">,</span></span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;humid_min&quot;</span><span class="fu">:</span> <span class="dv">40</span><span class="fu">,</span></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;humid_max&quot;</span><span class="fu">:</span> <span class="dv">60</span></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Good&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">255</span><span class="ot">,</span> <span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;solid&quot;</span><span class="fu">,</span></span>
<span id="cb259-17"><a href="#cb259-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;brightness&quot;</span><span class="fu">:</span> <span class="dv">70</span></span>
<span id="cb259-18"><a href="#cb259-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb259-19"><a href="#cb259-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Cold&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-20"><a href="#cb259-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">255</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb259-21"><a href="#cb259-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;blink&quot;</span><span class="fu">,</span></span>
<span id="cb259-22"><a href="#cb259-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;brightness&quot;</span><span class="fu">:</span> <span class="dv">60</span></span>
<span id="cb259-23"><a href="#cb259-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb259-24"><a href="#cb259-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Hot&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-25"><a href="#cb259-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">255</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb259-26"><a href="#cb259-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;blink&quot;</span><span class="fu">,</span></span>
<span id="cb259-27"><a href="#cb259-27" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;brightness&quot;</span><span class="fu">:</span> <span class="dv">60</span></span>
<span id="cb259-28"><a href="#cb259-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb259-29"><a href="#cb259-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Humid&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb259-30"><a href="#cb259-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">128</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">255</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb259-31"><a href="#cb259-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;pulse&quot;</span><span class="fu">,</span></span>
<span id="cb259-32"><a href="#cb259-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;brightness&quot;</span><span class="fu">:</span> <span class="dv">70</span></span>
<span id="cb259-33"><a href="#cb259-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb259-34"><a href="#cb259-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb259-35"><a href="#cb259-35" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="에러-처리-전략">🛡️ 에러 처리 전략</h2>
<h3 id="센서-오류">센서 오류</h3>
<div class="sourceCode" id="cb260"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>    sensor.measure()</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> sensor.temperature()</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> <span class="va">None</span>  <span class="co"># 이전 값 사용 또는 기본값</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>    log_error(<span class="st">&quot;Sensor read failed&quot;</span>)</span></code></pre></div>
<h3 id="mqtt-연결-끊김">MQTT 연결 끊김</h3>
<div class="sourceCode" id="cb261"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_disconnect(client, userdata, rc):</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>            client.reconnect()</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">5</span>)  <span class="co"># 5초 후 재시도</span></span></code></pre></div>
<h3 id="ai-api-오류">AI API 오류</h3>
<div class="sourceCode" id="cb262"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>    analysis <span class="op">=</span> call_openai_api(data)</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 규칙 기반 폴백</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>    analysis <span class="op">=</span> rule_based_analysis(data)</span></code></pre></div>
<hr />
<h2 id="성능-요구사항">📊 성능 요구사항</h2>
<h3 id="응답-시간">응답 시간</h3>
<table>
<thead>
<tr>
<th>작업</th>
<th>목표 시간</th>
<th>최대 시간</th>
</tr>
</thead>
<tbody>
<tr>
<td>센서 읽기</td>
<td>0.1초</td>
<td>0.5초</td>
</tr>
<tr>
<td>MQTT 전송</td>
<td>0.2초</td>
<td>1초</td>
</tr>
<tr>
<td>AI 분석</td>
<td>1초</td>
<td>3초</td>
</tr>
<tr>
<td>LED 제어</td>
<td>0.1초</td>
<td>0.3초</td>
</tr>
<tr>
<td><strong>전체 흐름</strong></td>
<td><strong>2초</strong></td>
<td><strong>5초</strong></td>
</tr>
</tbody>
</table>
<h3 id="리소스-사용">리소스 사용</h3>
<ul>
<li><strong>메모리</strong>: 헥사보드 &lt; 50KB, Python &lt; 100MB</li>
<li><strong>네트워크</strong>: &lt; 1KB/초 (평균)</li>
<li><strong>CPU</strong>: 헥사보드 &lt; 20%, Python &lt; 30%</li>
</ul>
<hr />
<h2 id="보안-고려사항">🔐 보안 고려사항</h2>
<h3 id="통신-보안">통신 보안</h3>
<ul>
<li>✅ MQTT over TLS (포트 8883)</li>
<li>✅ Username/Password 인증</li>
<li>✅ API 키 환경 변수 관리</li>
</ul>
<h3 id="데이터-프라이버시">데이터 프라이버시</h3>
<ul>
<li>✅ 개인 정보 미포함</li>
<li>✅ 로컬 처리 우선</li>
<li>✅ 데이터 보관 기간 제한</li>
</ul>
<hr />
<h2 id="핵심-정리-9">📝 핵심 정리</h2>
<h3 id="아키텍처-원칙">아키텍처 원칙</h3>
<ol type="1">
<li><strong>모듈화</strong>: 각 컴포넌트 독립적</li>
<li><strong>확장성</strong>: 새로운 보드 추가 용이</li>
<li><strong>신뢰성</strong>: 에러 처리 및 폴백</li>
<li><strong>효율성</strong>: 리소스 최소화</li>
<li><strong>보안성</strong>: TLS 및 인증</li>
</ol>
<h3 id="데이터-흐름-1">데이터 흐름</h3>
<pre><code>센서(5초) → MQTT → AI 분석(10초) → 명령 생성 → MQTT → LED 제어</code></pre>
<hr />
<h2 id="자주-묻는-질문-11">❓ 자주 묻는 질문</h2>
<h3 id="q1.-왜-10초마다-ai-분석하나요">Q1. 왜 10초마다 AI
분석하나요?</h3>
<p><strong>A</strong>: 비용 절감과 성능 균형. 환경은 빠르게 변하지
않으므로 10초면 충분합니다.</p>
<h3 id="q2.-헥사보드가-오프라인이-되면">Q2. 헥사보드가 오프라인이
되면?</h3>
<p><strong>A</strong>: 마지막 명령 상태 유지. 재연결 시 자동으로 다시
동기화됩니다.</p>
<h3 id="q3.-여러-보드를-동시에-제어할-수-있나요">Q3. 여러 보드를 동시에
제어할 수 있나요?</h3>
<p><strong>A</strong>: 네. Board ID로 구분하여 각각 독립적으로 제어
가능합니다.</p>
<hr />
<h2 id="다음-단계-11">🚀 다음 단계</h2>
<p>시스템 아키텍처 설계가 완료되었습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>실제 코드 구현</li>
<li>단계별 통합</li>
<li>테스트 및 디버깅</li>
</ul>
<hr />
<p><strong>🎉 Chapter 21 완료!</strong><br />
이제 실제 구현을 시작할 준비가 되었습니다!</p>
<h1 id="chapter-22.-단계별-구현-실습">Chapter 22. 단계별 구현 실습</h1>
<blockquote>
<p><strong>PART 6</strong>: 종합 프로젝트 – AI 환경 무드 컨트롤러</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-21">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>헥사보드 센서 수집 코드를
작성한다</label></li>
<li><label><input type="checkbox"></input>Python AI 서버를
구현한다</label></li>
<li><label><input type="checkbox"></input>전체 시스템을 통합하고
테스트한다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 90분</p>
<hr />
<h2 id="학습-목표-21">🎯 학습 목표</h2>
<h3 id="구현-단계">구현 단계</h3>
<ol type="1">
<li><strong>Phase 1</strong>: 헥사보드 센서 + MQTT (30분)</li>
<li><strong>Phase 2</strong>: Python AI 서버 (30분)</li>
<li><strong>Phase 3</strong>: 통합 및 테스트 (30분)</li>
</ol>
<hr />
<h2 id="phase-1-헥사보드-구현">💻 Phase 1: 헥사보드 구현</h2>
<h3 id="step-1-센서-수집-및-전송">Step 1: 센서 수집 및 전송</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: mood_controller_hexaboard.py</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 헥사보드 - AI 무드 컨트롤러</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> network</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> umqtt.simple <span class="im">import</span> MQTTClient</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neopixel</span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dht</span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ujson</span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Wi-Fi 설정</span></span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>WIFI_SSID <span class="op">=</span> <span class="st">&quot;Your_WiFi_Name&quot;</span></span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a>WIFI_PASSWORD <span class="op">=</span> <span class="st">&quot;Your_Password&quot;</span></span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> <span class="st">&quot;abc123.s1.eu.hivemq.cloud&quot;</span></span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="dv">8883</span></span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span></span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span></span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a>BOARD_ID <span class="op">=</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic</span></span>
<span id="cb264-24"><a href="#cb264-24" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="ss">f&quot;hexaboard/</span><span class="sc">{</span>BOARD_ID<span class="sc">}</span><span class="ss">/sensor/data&quot;</span></span>
<span id="cb264-25"><a href="#cb264-25" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="ss">f&quot;hexaboard/</span><span class="sc">{</span>BOARD_ID<span class="sc">}</span><span class="ss">/control/led&quot;</span></span>
<span id="cb264-26"><a href="#cb264-26" aria-hidden="true" tabindex="-1"></a>TOPIC_STATUS <span class="op">=</span> <span class="ss">f&quot;hexaboard/</span><span class="sc">{</span>BOARD_ID<span class="sc">}</span><span class="ss">/status&quot;</span></span>
<span id="cb264-27"><a href="#cb264-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-28"><a href="#cb264-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 하드웨어</span></span>
<span id="cb264-29"><a href="#cb264-29" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> neopixel.NeoPixel(Pin(<span class="dv">23</span>), <span class="dv">25</span>)</span>
<span id="cb264-30"><a href="#cb264-30" aria-hidden="true" tabindex="-1"></a>sensor_temp <span class="op">=</span> dht.DHT11(Pin(<span class="dv">32</span>))</span>
<span id="cb264-31"><a href="#cb264-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-32"><a href="#cb264-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_wifi():</span>
<span id="cb264-33"><a href="#cb264-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Wi-Fi 연결&quot;&quot;&quot;</span></span>
<span id="cb264-34"><a href="#cb264-34" aria-hidden="true" tabindex="-1"></a>    wlan <span class="op">=</span> network.WLAN(network.STA_IF)</span>
<span id="cb264-35"><a href="#cb264-35" aria-hidden="true" tabindex="-1"></a>    wlan.active(<span class="va">True</span>)</span>
<span id="cb264-36"><a href="#cb264-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-37"><a href="#cb264-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> wlan.isconnected():</span>
<span id="cb264-38"><a href="#cb264-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[Hexaboard] Wi-Fi 연결 중...&quot;</span>)</span>
<span id="cb264-39"><a href="#cb264-39" aria-hidden="true" tabindex="-1"></a>        wlan.<span class="ex">connect</span>(WIFI_SSID, WIFI_PASSWORD)</span>
<span id="cb264-40"><a href="#cb264-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-41"><a href="#cb264-41" aria-hidden="true" tabindex="-1"></a>        timeout <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb264-42"><a href="#cb264-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> wlan.isconnected() <span class="kw">and</span> timeout <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb264-43"><a href="#cb264-43" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span>
<span id="cb264-44"><a href="#cb264-44" aria-hidden="true" tabindex="-1"></a>            timeout <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb264-45"><a href="#cb264-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-46"><a href="#cb264-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wlan.isconnected():</span>
<span id="cb264-47"><a href="#cb264-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] ✅ Wi-Fi 연결: </span><span class="sc">{</span>wlan<span class="sc">.</span>ifconfig()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-48"><a href="#cb264-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb264-49"><a href="#cb264-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb264-50"><a href="#cb264-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-51"><a href="#cb264-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_control_message(topic, msg):</span>
<span id="cb264-52"><a href="#cb264-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;LED 제어 명령 수신&quot;&quot;&quot;</span></span>
<span id="cb264-53"><a href="#cb264-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] 📥 제어 명령: </span><span class="sc">{</span>msg<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-54"><a href="#cb264-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-55"><a href="#cb264-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb264-56"><a href="#cb264-56" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> ujson.loads(msg)</span>
<span id="cb264-57"><a href="#cb264-57" aria-hidden="true" tabindex="-1"></a>        action <span class="op">=</span> cmd.get(<span class="st">&quot;action&quot;</span>)</span>
<span id="cb264-58"><a href="#cb264-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-59"><a href="#cb264-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> action <span class="op">==</span> <span class="st">&quot;led_color&quot;</span>:</span>
<span id="cb264-60"><a href="#cb264-60" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> cmd.get(<span class="st">&quot;color&quot;</span>, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb264-61"><a href="#cb264-61" aria-hidden="true" tabindex="-1"></a>            pattern <span class="op">=</span> cmd.get(<span class="st">&quot;pattern&quot;</span>, <span class="st">&quot;solid&quot;</span>)</span>
<span id="cb264-62"><a href="#cb264-62" aria-hidden="true" tabindex="-1"></a>            brightness <span class="op">=</span> cmd.get(<span class="st">&quot;brightness&quot;</span>, <span class="dv">100</span>)</span>
<span id="cb264-63"><a href="#cb264-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-64"><a href="#cb264-64" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 밝기 조정</span></span>
<span id="cb264-65"><a href="#cb264-65" aria-hidden="true" tabindex="-1"></a>            adjusted_color <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">int</span>(c <span class="op">*</span> brightness <span class="op">/</span> <span class="dv">100</span>) <span class="cf">for</span> c <span class="kw">in</span> color)</span>
<span id="cb264-66"><a href="#cb264-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-67"><a href="#cb264-67" aria-hidden="true" tabindex="-1"></a>            <span class="co"># LED 제어</span></span>
<span id="cb264-68"><a href="#cb264-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pattern <span class="op">==</span> <span class="st">&quot;solid&quot;</span>:</span>
<span id="cb264-69"><a href="#cb264-69" aria-hidden="true" tabindex="-1"></a>                set_led_solid(adjusted_color)</span>
<span id="cb264-70"><a href="#cb264-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> pattern <span class="op">==</span> <span class="st">&quot;blink&quot;</span>:</span>
<span id="cb264-71"><a href="#cb264-71" aria-hidden="true" tabindex="-1"></a>                set_led_blink(adjusted_color)</span>
<span id="cb264-72"><a href="#cb264-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> pattern <span class="op">==</span> <span class="st">&quot;pulse&quot;</span>:</span>
<span id="cb264-73"><a href="#cb264-73" aria-hidden="true" tabindex="-1"></a>                set_led_pulse(adjusted_color)</span>
<span id="cb264-74"><a href="#cb264-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-75"><a href="#cb264-75" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] 💡 LED: </span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-76"><a href="#cb264-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-77"><a href="#cb264-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> action <span class="op">==</span> <span class="st">&quot;led_off&quot;</span>:</span>
<span id="cb264-78"><a href="#cb264-78" aria-hidden="true" tabindex="-1"></a>            set_led_solid((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb264-79"><a href="#cb264-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;[Hexaboard] 💡 LED OFF&quot;</span>)</span>
<span id="cb264-80"><a href="#cb264-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-81"><a href="#cb264-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb264-82"><a href="#cb264-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] ❌ 제어 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-83"><a href="#cb264-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-84"><a href="#cb264-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_led_solid(color):</span>
<span id="cb264-85"><a href="#cb264-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;LED 단색&quot;&quot;&quot;</span></span>
<span id="cb264-86"><a href="#cb264-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb264-87"><a href="#cb264-87" aria-hidden="true" tabindex="-1"></a>        np[i] <span class="op">=</span> color</span>
<span id="cb264-88"><a href="#cb264-88" aria-hidden="true" tabindex="-1"></a>    np.write()</span>
<span id="cb264-89"><a href="#cb264-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-90"><a href="#cb264-90" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_led_blink(color):</span>
<span id="cb264-91"><a href="#cb264-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;LED 깜빡임 (비동기)&quot;&quot;&quot;</span></span>
<span id="cb264-92"><a href="#cb264-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 간단 구현: 3번 깜빡임</span></span>
<span id="cb264-93"><a href="#cb264-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb264-94"><a href="#cb264-94" aria-hidden="true" tabindex="-1"></a>        set_led_solid(color)</span>
<span id="cb264-95"><a href="#cb264-95" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.2</span>)</span>
<span id="cb264-96"><a href="#cb264-96" aria-hidden="true" tabindex="-1"></a>        set_led_solid((<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb264-97"><a href="#cb264-97" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.2</span>)</span>
<span id="cb264-98"><a href="#cb264-98" aria-hidden="true" tabindex="-1"></a>    set_led_solid(color)</span>
<span id="cb264-99"><a href="#cb264-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-100"><a href="#cb264-100" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_led_pulse(color):</span>
<span id="cb264-101"><a href="#cb264-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;LED 펄스 (간단 버전)&quot;&quot;&quot;</span></span>
<span id="cb264-102"><a href="#cb264-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 밝기 변화</span></span>
<span id="cb264-103"><a href="#cb264-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> brightness <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">30</span>, <span class="dv">101</span>, <span class="dv">10</span>):</span>
<span id="cb264-104"><a href="#cb264-104" aria-hidden="true" tabindex="-1"></a>        adjusted <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">int</span>(c <span class="op">*</span> brightness <span class="op">/</span> <span class="dv">100</span>) <span class="cf">for</span> c <span class="kw">in</span> color)</span>
<span id="cb264-105"><a href="#cb264-105" aria-hidden="true" tabindex="-1"></a>        set_led_solid(adjusted)</span>
<span id="cb264-106"><a href="#cb264-106" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.05</span>)</span>
<span id="cb264-107"><a href="#cb264-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-108"><a href="#cb264-108" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_mqtt():</span>
<span id="cb264-109"><a href="#cb264-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;MQTT 연결&quot;&quot;&quot;</span></span>
<span id="cb264-110"><a href="#cb264-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb264-111"><a href="#cb264-111" aria-hidden="true" tabindex="-1"></a>        client <span class="op">=</span> MQTTClient(</span>
<span id="cb264-112"><a href="#cb264-112" aria-hidden="true" tabindex="-1"></a>            client_id<span class="op">=</span><span class="ss">f&quot;hexaboard_</span><span class="sc">{</span>BOARD_ID<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb264-113"><a href="#cb264-113" aria-hidden="true" tabindex="-1"></a>            server<span class="op">=</span>MQTT_BROKER,</span>
<span id="cb264-114"><a href="#cb264-114" aria-hidden="true" tabindex="-1"></a>            port<span class="op">=</span>MQTT_PORT,</span>
<span id="cb264-115"><a href="#cb264-115" aria-hidden="true" tabindex="-1"></a>            user<span class="op">=</span>MQTT_USER,</span>
<span id="cb264-116"><a href="#cb264-116" aria-hidden="true" tabindex="-1"></a>            password<span class="op">=</span>MQTT_PASSWORD,</span>
<span id="cb264-117"><a href="#cb264-117" aria-hidden="true" tabindex="-1"></a>            ssl<span class="op">=</span><span class="va">True</span></span>
<span id="cb264-118"><a href="#cb264-118" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb264-119"><a href="#cb264-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-120"><a href="#cb264-120" aria-hidden="true" tabindex="-1"></a>        client.set_callback(on_control_message)</span>
<span id="cb264-121"><a href="#cb264-121" aria-hidden="true" tabindex="-1"></a>        client.<span class="ex">connect</span>()</span>
<span id="cb264-122"><a href="#cb264-122" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_CONTROL)</span>
<span id="cb264-123"><a href="#cb264-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-124"><a href="#cb264-124" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 온라인 상태 전송</span></span>
<span id="cb264-125"><a href="#cb264-125" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_STATUS, <span class="st">&quot;online&quot;</span>)</span>
<span id="cb264-126"><a href="#cb264-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-127"><a href="#cb264-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;[Hexaboard] ✅ MQTT 연결&quot;</span>)</span>
<span id="cb264-128"><a href="#cb264-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] 📬 구독: </span><span class="sc">{</span>TOPIC_CONTROL<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-129"><a href="#cb264-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-130"><a href="#cb264-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> client</span>
<span id="cb264-131"><a href="#cb264-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-132"><a href="#cb264-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb264-133"><a href="#cb264-133" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] ❌ MQTT 연결 실패: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-134"><a href="#cb264-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb264-135"><a href="#cb264-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-136"><a href="#cb264-136" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_and_publish_sensors(client):</span>
<span id="cb264-137"><a href="#cb264-137" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 읽고 전송&quot;&quot;&quot;</span></span>
<span id="cb264-138"><a href="#cb264-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb264-139"><a href="#cb264-139" aria-hidden="true" tabindex="-1"></a>        sensor_temp.measure()</span>
<span id="cb264-140"><a href="#cb264-140" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> sensor_temp.temperature()</span>
<span id="cb264-141"><a href="#cb264-141" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> sensor_temp.humidity()</span>
<span id="cb264-142"><a href="#cb264-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-143"><a href="#cb264-143" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 조도 센서 (ADC) - 선택사항</span></span>
<span id="cb264-144"><a href="#cb264-144" aria-hidden="true" tabindex="-1"></a>        <span class="co"># light_sensor = ADC(Pin(33))</span></span>
<span id="cb264-145"><a href="#cb264-145" aria-hidden="true" tabindex="-1"></a>        <span class="co"># light = light_sensor.read()</span></span>
<span id="cb264-146"><a href="#cb264-146" aria-hidden="true" tabindex="-1"></a>        light <span class="op">=</span> <span class="dv">800</span>  <span class="co"># 가상 값</span></span>
<span id="cb264-147"><a href="#cb264-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-148"><a href="#cb264-148" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> {</span>
<span id="cb264-149"><a href="#cb264-149" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;board&quot;</span>: BOARD_ID,</span>
<span id="cb264-150"><a href="#cb264-150" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;temperature&quot;</span>: temp,</span>
<span id="cb264-151"><a href="#cb264-151" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;humidity&quot;</span>: humid,</span>
<span id="cb264-152"><a href="#cb264-152" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;light&quot;</span>: light,</span>
<span id="cb264-153"><a href="#cb264-153" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;timestamp&quot;</span>: time.time()</span>
<span id="cb264-154"><a href="#cb264-154" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb264-155"><a href="#cb264-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-156"><a href="#cb264-156" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> ujson.dumps(data)</span>
<span id="cb264-157"><a href="#cb264-157" aria-hidden="true" tabindex="-1"></a>        client.publish(TOPIC_SENSOR, message)</span>
<span id="cb264-158"><a href="#cb264-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-159"><a href="#cb264-159" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] 📤 센서: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb264-160"><a href="#cb264-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-161"><a href="#cb264-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb264-162"><a href="#cb264-162" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[Hexaboard] ❌ 센서 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb264-163"><a href="#cb264-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-164"><a href="#cb264-164" aria-hidden="true" tabindex="-1"></a><span class="co"># 메인 실행</span></span>
<span id="cb264-165"><a href="#cb264-165" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connect_wifi():</span>
<span id="cb264-166"><a href="#cb264-166" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> connect_mqtt()</span>
<span id="cb264-167"><a href="#cb264-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-168"><a href="#cb264-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> client:</span>
<span id="cb264-169"><a href="#cb264-169" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">[Hexaboard] 🚀 무드 컨트롤러 시작</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb264-170"><a href="#cb264-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-171"><a href="#cb264-171" aria-hidden="true" tabindex="-1"></a>        last_sensor_time <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb264-172"><a href="#cb264-172" aria-hidden="true" tabindex="-1"></a>        SENSOR_INTERVAL <span class="op">=</span> <span class="dv">5</span>  <span class="co"># 5초</span></span>
<span id="cb264-173"><a href="#cb264-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-174"><a href="#cb264-174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb264-175"><a href="#cb264-175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb264-176"><a href="#cb264-176" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 제어 명령 확인</span></span>
<span id="cb264-177"><a href="#cb264-177" aria-hidden="true" tabindex="-1"></a>                client.check_msg()</span>
<span id="cb264-178"><a href="#cb264-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-179"><a href="#cb264-179" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 5초마다 센서 데이터 전송</span></span>
<span id="cb264-180"><a href="#cb264-180" aria-hidden="true" tabindex="-1"></a>                current_time <span class="op">=</span> time.time()</span>
<span id="cb264-181"><a href="#cb264-181" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> current_time <span class="op">-</span> last_sensor_time <span class="op">&gt;=</span> SENSOR_INTERVAL:</span>
<span id="cb264-182"><a href="#cb264-182" aria-hidden="true" tabindex="-1"></a>                    read_and_publish_sensors(client)</span>
<span id="cb264-183"><a href="#cb264-183" aria-hidden="true" tabindex="-1"></a>                    last_sensor_time <span class="op">=</span> current_time</span>
<span id="cb264-184"><a href="#cb264-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-185"><a href="#cb264-185" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb264-186"><a href="#cb264-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-187"><a href="#cb264-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb264-188"><a href="#cb264-188" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">[Hexaboard] 종료&quot;</span>)</span>
<span id="cb264-189"><a href="#cb264-189" aria-hidden="true" tabindex="-1"></a>            client.publish(TOPIC_STATUS, <span class="st">&quot;offline&quot;</span>)</span>
<span id="cb264-190"><a href="#cb264-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-191"><a href="#cb264-191" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb264-192"><a href="#cb264-192" aria-hidden="true" tabindex="-1"></a>            client.disconnect()</span></code></pre></div>
<p><strong>실행</strong>: Thonny IDE에서 헥사보드에 업로드 및 실행</p>
<hr />
<h2 id="phase-2-python-ai-서버-구현">💻 Phase 2: Python AI 서버
구현</h2>
<h3 id="step-2-무드-컨트롤러-서버">Step 2: 무드 컨트롤러 서버</h3>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파일명: mood_controller_server.py</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Python AI 서버 - 무드 컨트롤러</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb265-12"><a href="#cb265-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-13"><a href="#cb265-13" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb265-14"><a href="#cb265-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-15"><a href="#cb265-15" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 설정</span></span>
<span id="cb265-16"><a href="#cb265-16" aria-hidden="true" tabindex="-1"></a>MQTT_BROKER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_BROKER&quot;</span>)</span>
<span id="cb265-17"><a href="#cb265-17" aria-hidden="true" tabindex="-1"></a>MQTT_PORT <span class="op">=</span> <span class="bu">int</span>(os.getenv(<span class="st">&quot;MQTT_PORT&quot;</span>, <span class="dv">8883</span>))</span>
<span id="cb265-18"><a href="#cb265-18" aria-hidden="true" tabindex="-1"></a>MQTT_USER <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_USER&quot;</span>)</span>
<span id="cb265-19"><a href="#cb265-19" aria-hidden="true" tabindex="-1"></a>MQTT_PASSWORD <span class="op">=</span> os.getenv(<span class="st">&quot;MQTT_PASSWORD&quot;</span>)</span>
<span id="cb265-20"><a href="#cb265-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-21"><a href="#cb265-21" aria-hidden="true" tabindex="-1"></a><span class="co"># OpenAI 클라이언트</span></span>
<span id="cb265-22"><a href="#cb265-22" aria-hidden="true" tabindex="-1"></a>openai_client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb265-23"><a href="#cb265-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-24"><a href="#cb265-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic</span></span>
<span id="cb265-25"><a href="#cb265-25" aria-hidden="true" tabindex="-1"></a>TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span></span>
<span id="cb265-26"><a href="#cb265-26" aria-hidden="true" tabindex="-1"></a>TOPIC_CONTROL <span class="op">=</span> <span class="st">&quot;hexaboard/</span><span class="sc">{board}</span><span class="st">/control/led&quot;</span></span>
<span id="cb265-27"><a href="#cb265-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-28"><a href="#cb265-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 버퍼 (보드별)</span></span>
<span id="cb265-29"><a href="#cb265-29" aria-hidden="true" tabindex="-1"></a>sensor_buffers <span class="op">=</span> {}</span>
<span id="cb265-30"><a href="#cb265-30" aria-hidden="true" tabindex="-1"></a>last_control_time <span class="op">=</span> {}</span>
<span id="cb265-31"><a href="#cb265-31" aria-hidden="true" tabindex="-1"></a>CONTROL_INTERVAL <span class="op">=</span> <span class="dv">10</span>  <span class="co"># 10초</span></span>
<span id="cb265-32"><a href="#cb265-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-33"><a href="#cb265-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 무드 설정</span></span>
<span id="cb265-34"><a href="#cb265-34" aria-hidden="true" tabindex="-1"></a>MOOD_CONFIG <span class="op">=</span> {</span>
<span id="cb265-35"><a href="#cb265-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Perfect&quot;</span>: {</span>
<span id="cb265-36"><a href="#cb265-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;color&quot;</span>: [<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>],</span>
<span id="cb265-37"><a href="#cb265-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;pattern&quot;</span>: <span class="st">&quot;solid&quot;</span>,</span>
<span id="cb265-38"><a href="#cb265-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;brightness&quot;</span>: <span class="dv">80</span></span>
<span id="cb265-39"><a href="#cb265-39" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb265-40"><a href="#cb265-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Good&quot;</span>: {</span>
<span id="cb265-41"><a href="#cb265-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;color&quot;</span>: [<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">0</span>],</span>
<span id="cb265-42"><a href="#cb265-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;pattern&quot;</span>: <span class="st">&quot;solid&quot;</span>,</span>
<span id="cb265-43"><a href="#cb265-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;brightness&quot;</span>: <span class="dv">70</span></span>
<span id="cb265-44"><a href="#cb265-44" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb265-45"><a href="#cb265-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Cold&quot;</span>: {</span>
<span id="cb265-46"><a href="#cb265-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;color&quot;</span>: [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>],</span>
<span id="cb265-47"><a href="#cb265-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;pattern&quot;</span>: <span class="st">&quot;blink&quot;</span>,</span>
<span id="cb265-48"><a href="#cb265-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;brightness&quot;</span>: <span class="dv">60</span></span>
<span id="cb265-49"><a href="#cb265-49" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb265-50"><a href="#cb265-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Hot&quot;</span>: {</span>
<span id="cb265-51"><a href="#cb265-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;color&quot;</span>: [<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb265-52"><a href="#cb265-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;pattern&quot;</span>: <span class="st">&quot;blink&quot;</span>,</span>
<span id="cb265-53"><a href="#cb265-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;brightness&quot;</span>: <span class="dv">60</span></span>
<span id="cb265-54"><a href="#cb265-54" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb265-55"><a href="#cb265-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Humid&quot;</span>: {</span>
<span id="cb265-56"><a href="#cb265-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;color&quot;</span>: [<span class="dv">128</span>, <span class="dv">0</span>, <span class="dv">255</span>],</span>
<span id="cb265-57"><a href="#cb265-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;pattern&quot;</span>: <span class="st">&quot;pulse&quot;</span>,</span>
<span id="cb265-58"><a href="#cb265-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;brightness&quot;</span>: <span class="dv">70</span></span>
<span id="cb265-59"><a href="#cb265-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb265-60"><a href="#cb265-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb265-61"><a href="#cb265-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-62"><a href="#cb265-62" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MoodController:</span>
<span id="cb265-63"><a href="#cb265-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;무드 컨트롤러&quot;&quot;&quot;</span></span>
<span id="cb265-64"><a href="#cb265-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-65"><a href="#cb265-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, mqtt_client):</span>
<span id="cb265-66"><a href="#cb265-66" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mqtt_client <span class="op">=</span> mqtt_client</span>
<span id="cb265-67"><a href="#cb265-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-68"><a href="#cb265-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_mood_rule_based(<span class="va">self</span>, temp, humid):</span>
<span id="cb265-69"><a href="#cb265-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;규칙 기반 무드 판단&quot;&quot;&quot;</span></span>
<span id="cb265-70"><a href="#cb265-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="dv">22</span> <span class="op">&lt;=</span> temp <span class="op">&lt;=</span> <span class="dv">26</span> <span class="kw">and</span> <span class="dv">40</span> <span class="op">&lt;=</span> humid <span class="op">&lt;=</span> <span class="dv">60</span>:</span>
<span id="cb265-71"><a href="#cb265-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Perfect&quot;</span></span>
<span id="cb265-72"><a href="#cb265-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="dv">20</span> <span class="op">&lt;=</span> temp <span class="op">&lt;=</span> <span class="dv">28</span> <span class="kw">and</span> <span class="dv">35</span> <span class="op">&lt;=</span> humid <span class="op">&lt;=</span> <span class="dv">65</span>:</span>
<span id="cb265-73"><a href="#cb265-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Good&quot;</span></span>
<span id="cb265-74"><a href="#cb265-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb265-75"><a href="#cb265-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Cold&quot;</span></span>
<span id="cb265-76"><a href="#cb265-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> temp <span class="op">&gt;</span> <span class="dv">28</span>:</span>
<span id="cb265-77"><a href="#cb265-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Hot&quot;</span></span>
<span id="cb265-78"><a href="#cb265-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> humid <span class="op">&gt;</span> <span class="dv">65</span>:</span>
<span id="cb265-79"><a href="#cb265-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Humid&quot;</span></span>
<span id="cb265-80"><a href="#cb265-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb265-81"><a href="#cb265-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Good&quot;</span></span>
<span id="cb265-82"><a href="#cb265-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-83"><a href="#cb265-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_mood_with_ai(<span class="va">self</span>, temp, humid):</span>
<span id="cb265-84"><a href="#cb265-84" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;AI 기반 무드 판단&quot;&quot;&quot;</span></span>
<span id="cb265-85"><a href="#cb265-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb265-86"><a href="#cb265-86" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb265-87"><a href="#cb265-87" aria-hidden="true" tabindex="-1"></a><span class="ss">환경 데이터:</span></span>
<span id="cb265-88"><a href="#cb265-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb265-89"><a href="#cb265-89" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb265-90"><a href="#cb265-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-91"><a href="#cb265-91" aria-hidden="true" tabindex="-1"></a><span class="ss">다음 5가지 무드 중 하나를 선택하세요:</span></span>
<span id="cb265-92"><a href="#cb265-92" aria-hidden="true" tabindex="-1"></a><span class="ss">- Perfect: 완벽한 환경 (22-26°C, 40-60%)</span></span>
<span id="cb265-93"><a href="#cb265-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- Good: 좋은 환경</span></span>
<span id="cb265-94"><a href="#cb265-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- Cold: 추운 환경 (&lt; 20°C)</span></span>
<span id="cb265-95"><a href="#cb265-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- Hot: 더운 환경 (&gt; 28°C)</span></span>
<span id="cb265-96"><a href="#cb265-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- Humid: 습한 환경 (&gt; 65%)</span></span>
<span id="cb265-97"><a href="#cb265-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-98"><a href="#cb265-98" aria-hidden="true" tabindex="-1"></a><span class="ss">JSON 형식으로 응답:</span></span>
<span id="cb265-99"><a href="#cb265-99" aria-hidden="true" tabindex="-1"></a><span class="ch">{{</span><span class="ss">&quot;mood&quot;: &quot;무드&quot;, &quot;reason&quot;: &quot;이유 (한 문장)&quot;</span><span class="ch">}}</span></span>
<span id="cb265-100"><a href="#cb265-100" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb265-101"><a href="#cb265-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-102"><a href="#cb265-102" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb265-103"><a href="#cb265-103" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,</span>
<span id="cb265-104"><a href="#cb265-104" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[</span>
<span id="cb265-105"><a href="#cb265-105" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;환경 분석 전문가. JSON만 출력.&quot;</span>},</span>
<span id="cb265-106"><a href="#cb265-106" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt}</span>
<span id="cb265-107"><a href="#cb265-107" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb265-108"><a href="#cb265-108" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb265-109"><a href="#cb265-109" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb265-110"><a href="#cb265-110" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb265-111"><a href="#cb265-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-112"><a href="#cb265-112" aria-hidden="true" tabindex="-1"></a>            result_str <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb265-113"><a href="#cb265-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&quot;```&quot;</span> <span class="kw">in</span> result_str:</span>
<span id="cb265-114"><a href="#cb265-114" aria-hidden="true" tabindex="-1"></a>                result_str <span class="op">=</span> result_str.split(<span class="st">&quot;```&quot;</span>)[<span class="dv">1</span>].replace(<span class="st">&quot;json&quot;</span>, <span class="st">&quot;&quot;</span>).strip()</span>
<span id="cb265-115"><a href="#cb265-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-116"><a href="#cb265-116" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> json.loads(result_str)</span>
<span id="cb265-117"><a href="#cb265-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result.get(<span class="st">&quot;mood&quot;</span>, <span class="st">&quot;Good&quot;</span>), result.get(<span class="st">&quot;reason&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb265-118"><a href="#cb265-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-119"><a href="#cb265-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb265-120"><a href="#cb265-120" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   AI 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">, 규칙 기반 사용&quot;</span>)</span>
<span id="cb265-121"><a href="#cb265-121" aria-hidden="true" tabindex="-1"></a>            mood <span class="op">=</span> <span class="va">self</span>.analyze_mood_rule_based(temp, humid)</span>
<span id="cb265-122"><a href="#cb265-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> mood, <span class="st">&quot;규칙 기반 판단&quot;</span></span>
<span id="cb265-123"><a href="#cb265-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-124"><a href="#cb265-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_led_command(<span class="va">self</span>, mood):</span>
<span id="cb265-125"><a href="#cb265-125" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;무드에 따른 LED 명령 생성&quot;&quot;&quot;</span></span>
<span id="cb265-126"><a href="#cb265-126" aria-hidden="true" tabindex="-1"></a>        config <span class="op">=</span> MOOD_CONFIG.get(mood, MOOD_CONFIG[<span class="st">&quot;Good&quot;</span>])</span>
<span id="cb265-127"><a href="#cb265-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-128"><a href="#cb265-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb265-129"><a href="#cb265-129" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action&quot;</span>: <span class="st">&quot;led_color&quot;</span>,</span>
<span id="cb265-130"><a href="#cb265-130" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;color&quot;</span>: config[<span class="st">&quot;color&quot;</span>],</span>
<span id="cb265-131"><a href="#cb265-131" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;pattern&quot;</span>: config[<span class="st">&quot;pattern&quot;</span>],</span>
<span id="cb265-132"><a href="#cb265-132" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;brightness&quot;</span>: config[<span class="st">&quot;brightness&quot;</span>]</span>
<span id="cb265-133"><a href="#cb265-133" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb265-134"><a href="#cb265-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-135"><a href="#cb265-135" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> control_board(<span class="va">self</span>, board_id, temp, humid):</span>
<span id="cb265-136"><a href="#cb265-136" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;보드 제어&quot;&quot;&quot;</span></span>
<span id="cb265-137"><a href="#cb265-137" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> last_control_time</span>
<span id="cb265-138"><a href="#cb265-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-139"><a href="#cb265-139" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 제어 간격 확인</span></span>
<span id="cb265-140"><a href="#cb265-140" aria-hidden="true" tabindex="-1"></a>        current_time <span class="op">=</span> time.time()</span>
<span id="cb265-141"><a href="#cb265-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> board_id <span class="kw">in</span> last_control_time:</span>
<span id="cb265-142"><a href="#cb265-142" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> current_time <span class="op">-</span> last_control_time[board_id] <span class="op">&lt;</span> CONTROL_INTERVAL:</span>
<span id="cb265-143"><a href="#cb265-143" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb265-144"><a href="#cb265-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-145"><a href="#cb265-145" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb265-146"><a href="#cb265-146" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;🤖 무드 분석 (보드 </span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb265-147"><a href="#cb265-147" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb265-148"><a href="#cb265-148" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📊 환경: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb265-149"><a href="#cb265-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-150"><a href="#cb265-150" aria-hidden="true" tabindex="-1"></a>        <span class="co"># AI 분석</span></span>
<span id="cb265-151"><a href="#cb265-151" aria-hidden="true" tabindex="-1"></a>        mood, reason <span class="op">=</span> <span class="va">self</span>.analyze_mood_with_ai(temp, humid)</span>
<span id="cb265-152"><a href="#cb265-152" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;💡 무드: </span><span class="sc">{</span>mood<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb265-153"><a href="#cb265-153" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📝 이유: </span><span class="sc">{</span>reason<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb265-154"><a href="#cb265-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-155"><a href="#cb265-155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># LED 명령 생성</span></span>
<span id="cb265-156"><a href="#cb265-156" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> <span class="va">self</span>.generate_led_command(mood)</span>
<span id="cb265-157"><a href="#cb265-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-158"><a href="#cb265-158" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 전송</span></span>
<span id="cb265-159"><a href="#cb265-159" aria-hidden="true" tabindex="-1"></a>        topic <span class="op">=</span> TOPIC_CONTROL.<span class="bu">format</span>(board<span class="op">=</span>board_id)</span>
<span id="cb265-160"><a href="#cb265-160" aria-hidden="true" tabindex="-1"></a>        message <span class="op">=</span> json.dumps(cmd)</span>
<span id="cb265-161"><a href="#cb265-161" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mqtt_client.publish(topic, message)</span>
<span id="cb265-162"><a href="#cb265-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-163"><a href="#cb265-163" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📤 제어: </span><span class="sc">{</span>cmd[<span class="st">&#39;color&#39;</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>cmd[<span class="st">&#39;pattern&#39;</span>]<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb265-164"><a href="#cb265-164" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="st">&#39;=&#39;</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb265-165"><a href="#cb265-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-166"><a href="#cb265-166" aria-hidden="true" tabindex="-1"></a>        last_control_time[board_id] <span class="op">=</span> current_time</span>
<span id="cb265-167"><a href="#cb265-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-168"><a href="#cb265-168" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 콜백</span></span>
<span id="cb265-169"><a href="#cb265-169" aria-hidden="true" tabindex="-1"></a>mood_controller <span class="op">=</span> <span class="va">None</span></span>
<span id="cb265-170"><a href="#cb265-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-171"><a href="#cb265-171" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_connect(client, userdata, flags, rc):</span>
<span id="cb265-172"><a href="#cb265-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;연결 성공&quot;&quot;&quot;</span></span>
<span id="cb265-173"><a href="#cb265-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb265-174"><a href="#cb265-174" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)</span>
<span id="cb265-175"><a href="#cb265-175" aria-hidden="true" tabindex="-1"></a>        client.subscribe(TOPIC_SENSOR)</span>
<span id="cb265-176"><a href="#cb265-176" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;📬 구독: </span><span class="sc">{</span>TOPIC_SENSOR<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb265-177"><a href="#cb265-177" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;⏰ 제어 간격: </span><span class="sc">{</span>CONTROL_INTERVAL<span class="sc">}</span><span class="ss">초</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb265-178"><a href="#cb265-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-179"><a href="#cb265-179" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_message(client, userdata, msg):</span>
<span id="cb265-180"><a href="#cb265-180" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;센서 데이터 수신&quot;&quot;&quot;</span></span>
<span id="cb265-181"><a href="#cb265-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb265-182"><a href="#cb265-182" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(msg.payload.decode())</span>
<span id="cb265-183"><a href="#cb265-183" aria-hidden="true" tabindex="-1"></a>        board_id <span class="op">=</span> data.get(<span class="st">&quot;board&quot;</span>, <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb265-184"><a href="#cb265-184" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> data.get(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb265-185"><a href="#cb265-185" aria-hidden="true" tabindex="-1"></a>        humid <span class="op">=</span> data.get(<span class="st">&quot;humidity&quot;</span>)</span>
<span id="cb265-186"><a href="#cb265-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-187"><a href="#cb265-187" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 데이터 버퍼에 저장</span></span>
<span id="cb265-188"><a href="#cb265-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> board_id <span class="kw">not</span> <span class="kw">in</span> sensor_buffers:</span>
<span id="cb265-189"><a href="#cb265-189" aria-hidden="true" tabindex="-1"></a>            sensor_buffers[board_id] <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb265-190"><a href="#cb265-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-191"><a href="#cb265-191" aria-hidden="true" tabindex="-1"></a>        sensor_buffers[board_id].append({</span>
<span id="cb265-192"><a href="#cb265-192" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;temp&quot;</span>: temp,</span>
<span id="cb265-193"><a href="#cb265-193" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;humid&quot;</span>: humid,</span>
<span id="cb265-194"><a href="#cb265-194" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;time&quot;</span>: datetime.now()</span>
<span id="cb265-195"><a href="#cb265-195" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb265-196"><a href="#cb265-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-197"><a href="#cb265-197" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 로그</span></span>
<span id="cb265-198"><a href="#cb265-198" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%H:%M:%S&quot;</span>)</span>
<span id="cb265-199"><a href="#cb265-199" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;[</span><span class="sc">{</span>time_str<span class="sc">}</span><span class="ss">] 📥 보드 </span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb265-200"><a href="#cb265-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-201"><a href="#cb265-201" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 무드 분석 및 제어</span></span>
<span id="cb265-202"><a href="#cb265-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mood_controller:</span>
<span id="cb265-203"><a href="#cb265-203" aria-hidden="true" tabindex="-1"></a>            mood_controller.control_board(board_id, temp, humid)</span>
<span id="cb265-204"><a href="#cb265-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-205"><a href="#cb265-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb265-206"><a href="#cb265-206" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;❌ 오류: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb265-207"><a href="#cb265-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-208"><a href="#cb265-208" aria-hidden="true" tabindex="-1"></a><span class="co"># MQTT 클라이언트</span></span>
<span id="cb265-209"><a href="#cb265-209" aria-hidden="true" tabindex="-1"></a>mqtt_client <span class="op">=</span> mqtt.Client()</span>
<span id="cb265-210"><a href="#cb265-210" aria-hidden="true" tabindex="-1"></a>mqtt_client.tls_set()</span>
<span id="cb265-211"><a href="#cb265-211" aria-hidden="true" tabindex="-1"></a>mqtt_client.username_pw_set(MQTT_USER, MQTT_PASSWORD)</span>
<span id="cb265-212"><a href="#cb265-212" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_connect <span class="op">=</span> on_connect</span>
<span id="cb265-213"><a href="#cb265-213" aria-hidden="true" tabindex="-1"></a>mqtt_client.on_message <span class="op">=</span> on_message</span>
<span id="cb265-214"><a href="#cb265-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-215"><a href="#cb265-215" aria-hidden="true" tabindex="-1"></a><span class="co"># 무드 컨트롤러 초기화</span></span>
<span id="cb265-216"><a href="#cb265-216" aria-hidden="true" tabindex="-1"></a>mood_controller <span class="op">=</span> MoodController(mqtt_client)</span>
<span id="cb265-217"><a href="#cb265-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-218"><a href="#cb265-218" aria-hidden="true" tabindex="-1"></a><span class="co"># 실행</span></span>
<span id="cb265-219"><a href="#cb265-219" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb265-220"><a href="#cb265-220" aria-hidden="true" tabindex="-1"></a>    mqtt_client.<span class="ex">connect</span>(MQTT_BROKER, MQTT_PORT, <span class="dv">60</span>)</span>
<span id="cb265-221"><a href="#cb265-221" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;🚀 AI 무드 컨트롤러 시작...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb265-222"><a href="#cb265-222" aria-hidden="true" tabindex="-1"></a>    mqtt_client.loop_forever()</span>
<span id="cb265-223"><a href="#cb265-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-224"><a href="#cb265-224" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb265-225"><a href="#cb265-225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">🛑 서버 종료&quot;</span>)</span>
<span id="cb265-226"><a href="#cb265-226" aria-hidden="true" tabindex="-1"></a>    mqtt_client.disconnect()</span></code></pre></div>
<p><strong>실행</strong>:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> mood_controller_server.py</span></code></pre></div>
<hr />
<h2 id="phase-3-통합-및-테스트">🧪 Phase 3: 통합 및 테스트</h2>
<h3 id="step-3-전체-시스템-테스트">Step 3: 전체 시스템 테스트</h3>
<p><strong>테스트 시나리오</strong>:</p>
<h4 id="시나리오-1-perfect-무드">시나리오 1: Perfect 무드</h4>
<pre><code>조건: 온도 24°C, 습도 50%
예상 결과: 초록색 LED (solid)</code></pre>
<h4 id="시나리오-2-hot-무드">시나리오 2: Hot 무드</h4>
<pre><code>조건: 온도 30°C, 습도 70%
예상 결과: 빨간색 LED (blink)</code></pre>
<h4 id="시나리오-3-cold-무드">시나리오 3: Cold 무드</h4>
<pre><code>조건: 온도 18°C, 습도 35%
예상 결과: 파란색 LED (blink)</code></pre>
<h3 id="테스트-실행">테스트 실행</h3>
<p><strong>1. 헥사보드 시작</strong>:</p>
<pre><code>[Hexaboard] ✅ Wi-Fi 연결
[Hexaboard] ✅ MQTT 연결
[Hexaboard] 🚀 무드 컨트롤러 시작
[Hexaboard] 📤 센서: 24°C, 50%</code></pre>
<p><strong>2. Python 서버 시작</strong>:</p>
<pre><code>✅ MQTT 연결 성공!
📬 구독: hexaboard/+/sensor/data
🚀 AI 무드 컨트롤러 시작...

[10:30:15] 📥 보드 A: 24°C, 50%

============================================================
🤖 무드 분석 (보드 A)
============================================================
📊 환경: 24°C, 50%
💡 무드: Perfect
📝 이유: 온도와 습도가 이상적인 범위에 있습니다
📤 제어: [0, 255, 0] (solid)
============================================================</code></pre>
<p><strong>3. 헥사보드 LED 변경</strong>:</p>
<pre><code>[Hexaboard] 📥 제어 명령: {&quot;action&quot;:&quot;led_color&quot;,&quot;color&quot;:[0,255,0],&quot;pattern&quot;:&quot;solid&quot;,&quot;brightness&quot;:80}
[Hexaboard] 💡 LED: [0, 255, 0], solid</code></pre>
<hr />
<h2 id="디버깅-가이드">🐛 디버깅 가이드</h2>
<h3 id="문제-1-센서-데이터가-안-보임">문제 1: 센서 데이터가 안 보임</h3>
<p><strong>증상</strong>:</p>
<pre><code>Python 서버에 데이터가 안 옴</code></pre>
<p><strong>확인 사항</strong>:</p>
<ol type="1">
<li>헥사보드 Wi-Fi 연결 확인</li>
<li>MQTT Broker 주소 확인</li>
<li>Topic 이름 일치 확인</li>
</ol>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 헥사보드에서 수동 테스트</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>client.publish(<span class="st">&quot;test/topic&quot;</span>, <span class="st">&quot;hello&quot;</span>)</span></code></pre></div>
<h3 id="문제-2-led가-안-바뀜">문제 2: LED가 안 바뀜</h3>
<p><strong>증상</strong>:</p>
<pre><code>명령은 전송되지만 LED 변화 없음</code></pre>
<p><strong>확인 사항</strong>:</p>
<ol type="1">
<li>헥사보드가 제어 Topic 구독 중인지 확인</li>
<li>JSON 형식 확인</li>
<li>NeoPixel 핀 번호 확인 (GPIO 23)</li>
</ol>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LED 수동 테스트</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>set_led_solid((<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>))  <span class="co"># 빨간색</span></span></code></pre></div>
<h3 id="문제-3-ai가-너무-자주-호출됨">문제 3: AI가 너무 자주 호출됨</h3>
<p><strong>증상</strong>:</p>
<pre><code>OpenAI API 비용 많이 발생</code></pre>
<p><strong>해결</strong>:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CONTROL_INTERVAL 증가</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>CONTROL_INTERVAL <span class="op">=</span> <span class="dv">30</span>  <span class="co"># 30초로 변경</span></span></code></pre></div>
<hr />
<h2 id="핵심-정리-10">📝 핵심 정리</h2>
<h3 id="구현-체크리스트">구현 체크리스트</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드: 센서 수집 +
MQTT 전송</label></li>
<li><label><input type="checkbox" checked></input>헥사보드: LED 제어
수신</label></li>
<li><label><input type="checkbox" checked></input>Python: MQTT 데이터
수신</label></li>
<li><label><input type="checkbox" checked></input>Python: AI 무드
분석</label></li>
<li><label><input type="checkbox" checked></input>Python: LED 명령
전송</label></li>
<li><label><input type="checkbox" checked></input>전체: 통합 테스트
완료</label></li>
</ul>
<h3 id="파일-구조">파일 구조</h3>
<pre><code>project/
├── mood_controller_hexaboard.py    # 헥사보드 코드
├── mood_controller_server.py       # Python 서버
├── .env                            # 환경 변수
└── config.json                     # 무드 설정 (선택)</code></pre>
<hr />
<h2 id="자주-묻는-질문-12">❓ 자주 묻는 질문</h2>
<h3 id="q1.-헥사보드-코드를-자동-시작하려면">Q1. 헥사보드 코드를 자동
시작하려면?</h3>
<p><strong>A</strong>: Thonny에서 파일을 <code>main.py</code>로 저장하면
부팅 시 자동 실행됩니다.</p>
<h3 id="q2.-python-서버를-백그라운드로-실행하려면">Q2. Python 서버를
백그라운드로 실행하려면?</h3>
<p><strong>A</strong>:
<code>nohup python mood_controller_server.py &amp;</code>
(Linux/Mac)</p>
<h3 id="q3.-무드-임계값을-변경하려면">Q3. 무드 임계값을 변경하려면?</h3>
<p><strong>A</strong>: <code>MOOD_CONFIG</code>나
<code>config.json</code>에서 조건 수정</p>
<hr />
<h2 id="다음-단계-12">🚀 다음 단계</h2>
<p>기본 시스템 구현이 완료되었습니다!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>AI 프롬프트 튜닝</li>
<li>성능 최적화</li>
<li>고급 기능 추가</li>
</ul>
<hr />
<p><strong>🎉 Chapter 22 완료!</strong><br />
완전한 AI 무드 컨트롤러가 동작합니다!</p>
<h1 id="chapter-23.-ai-실험과-튜닝">Chapter 23. AI 실험과 튜닝</h1>
<blockquote>
<p><strong>PART 6</strong>: 종합 프로젝트 – AI 환경 무드 컨트롤러</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-22">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>AI 프롬프트를 최적화할 수
있다</label></li>
<li><label><input type="checkbox"></input>시스템 성능을 개선할 수
있다</label></li>
<li><label><input type="checkbox"></input>고급 기능을 추가할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 50분</p>
<hr />
<h2 id="학습-목표-22">🎯 학습 목표</h2>
<h3 id="핵심-개념-20">핵심 개념</h3>
<ul>
<li><strong>프롬프트 엔지니어링</strong>: AI 응답 품질 향상</li>
<li><strong>성능 최적화</strong>: 응답 시간 및 비용 절감</li>
<li><strong>기능 확장</strong>: 새로운 기능 추가</li>
</ul>
<hr />
<h2 id="프롬프트-최적화">🔧 프롬프트 최적화</h2>
<h3 id="기본-프롬프트-개선-전">기본 프롬프트 (개선 전)</h3>
<div class="sourceCode" id="cb280"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="ss">온도 </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C, 습도 </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="ss">무드를 판단하세요.</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span></code></pre></div>
<p><strong>문제점</strong>:</p>
<ul>
<li>불명확한 지시</li>
<li>출력 형식 불일치</li>
<li>맥락 부족</li>
</ul>
<h3 id="개선된-프롬프트-v1">개선된 프롬프트 v1</h3>
<div class="sourceCode" id="cb281"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="ss">당신은 실내 환경 분석 전문가입니다.</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="ss">## 현재 환경</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a><span class="ss">## 무드 기준</span></span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- Perfect: 22-26°C, 40-60% (완벽한 환경)</span></span>
<span id="cb281-10"><a href="#cb281-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- Good: 20-28°C, 35-65% (좋은 환경)</span></span>
<span id="cb281-11"><a href="#cb281-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- Cold: &lt; 20°C (추운 환경)</span></span>
<span id="cb281-12"><a href="#cb281-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- Hot: &gt; 28°C (더운 환경)</span></span>
<span id="cb281-13"><a href="#cb281-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- Humid: &gt; 65% (습한 환경)</span></span>
<span id="cb281-14"><a href="#cb281-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-15"><a href="#cb281-15" aria-hidden="true" tabindex="-1"></a><span class="ss">## 요청</span></span>
<span id="cb281-16"><a href="#cb281-16" aria-hidden="true" tabindex="-1"></a><span class="ss">위 기준에 따라 현재 환경의 무드를 판단하고, 간단한 이유를 설명하세요.</span></span>
<span id="cb281-17"><a href="#cb281-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-18"><a href="#cb281-18" aria-hidden="true" tabindex="-1"></a><span class="ss">## 출력 형식 (JSON만)</span></span>
<span id="cb281-19"><a href="#cb281-19" aria-hidden="true" tabindex="-1"></a><span class="ch">{{</span><span class="ss">&quot;mood&quot;: &quot;무드&quot;, &quot;reason&quot;: &quot;이유&quot;</span><span class="ch">}}</span></span>
<span id="cb281-20"><a href="#cb281-20" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span></code></pre></div>
<p><strong>개선 사항</strong>:</p>
<ul>
<li>역할 명확화</li>
<li>기준 제시</li>
<li>출력 형식 지정</li>
</ul>
<h3 id="최적화된-프롬프트-v2">최적화된 프롬프트 v2</h3>
<div class="sourceCode" id="cb282"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_analysis_prompt(temp, humid, history<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;최적화된 프롬프트 생성&quot;&quot;&quot;</span></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;당신은 실내 환경 AI 분석가입니다.</span></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="ss"># 현재 센서 데이터</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a><span class="ss">- 온도: </span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">°C</span></span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a><span class="ss">- 습도: </span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">%</span></span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-11"><a href="#cb282-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 히스토리 추가 (선택)</span></span>
<span id="cb282-12"><a href="#cb282-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> history:</span>
<span id="cb282-13"><a href="#cb282-13" aria-hidden="true" tabindex="-1"></a>        avg_temp <span class="op">=</span> <span class="bu">sum</span>(h[<span class="st">&#39;temp&#39;</span>] <span class="cf">for</span> h <span class="kw">in</span> history) <span class="op">/</span> <span class="bu">len</span>(history)</span>
<span id="cb282-14"><a href="#cb282-14" aria-hidden="true" tabindex="-1"></a>        avg_humid <span class="op">=</span> <span class="bu">sum</span>(h[<span class="st">&#39;humid&#39;</span>] <span class="cf">for</span> h <span class="kw">in</span> history) <span class="op">/</span> <span class="bu">len</span>(history)</span>
<span id="cb282-15"><a href="#cb282-15" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb282-16"><a href="#cb282-16" aria-hidden="true" tabindex="-1"></a><span class="ss"># 최근 평균 (10개)</span></span>
<span id="cb282-17"><a href="#cb282-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- 평균 온도: </span><span class="sc">{</span>avg_temp<span class="sc">:.1f}</span><span class="ss">°C</span></span>
<span id="cb282-18"><a href="#cb282-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- 평균 습도: </span><span class="sc">{</span>avg_humid<span class="sc">:.1f}</span><span class="ss">%</span></span>
<span id="cb282-19"><a href="#cb282-19" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb282-20"><a href="#cb282-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-21"><a href="#cb282-21" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb282-22"><a href="#cb282-22" aria-hidden="true" tabindex="-1"></a><span class="st"># 무드 판단 기준</span></span>
<span id="cb282-23"><a href="#cb282-23" aria-hidden="true" tabindex="-1"></a><span class="st">| 무드 | 온도 | 습도 | 설명 |</span></span>
<span id="cb282-24"><a href="#cb282-24" aria-hidden="true" tabindex="-1"></a><span class="st">|------|------|------|------|</span></span>
<span id="cb282-25"><a href="#cb282-25" aria-hidden="true" tabindex="-1"></a><span class="st">| Perfect | 22-26°C | 40-60% | 이상적 환경 |</span></span>
<span id="cb282-26"><a href="#cb282-26" aria-hidden="true" tabindex="-1"></a><span class="st">| Good | 20-28°C | 35-65% | 쾌적한 환경 |</span></span>
<span id="cb282-27"><a href="#cb282-27" aria-hidden="true" tabindex="-1"></a><span class="st">| Cold | &lt; 20°C | 임의 | 추운 환경 |</span></span>
<span id="cb282-28"><a href="#cb282-28" aria-hidden="true" tabindex="-1"></a><span class="st">| Hot | &gt; 28°C | 임의 | 더운 환경 |</span></span>
<span id="cb282-29"><a href="#cb282-29" aria-hidden="true" tabindex="-1"></a><span class="st">| Humid | 임의 | &gt; 65% | 습한 환경 |</span></span>
<span id="cb282-30"><a href="#cb282-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-31"><a href="#cb282-31" aria-hidden="true" tabindex="-1"></a><span class="st"># 지시사항</span></span>
<span id="cb282-32"><a href="#cb282-32" aria-hidden="true" tabindex="-1"></a><span class="st">1. 위 기준에 따라 무드를 정확히 판단하세요</span></span>
<span id="cb282-33"><a href="#cb282-33" aria-hidden="true" tabindex="-1"></a><span class="st">2. 이유는 한 문장으로 간결하게</span></span>
<span id="cb282-34"><a href="#cb282-34" aria-hidden="true" tabindex="-1"></a><span class="st">3. JSON 형식만 출력 (다른 텍스트 없이)</span></span>
<span id="cb282-35"><a href="#cb282-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-36"><a href="#cb282-36" aria-hidden="true" tabindex="-1"></a><span class="st"># 출력</span></span>
<span id="cb282-37"><a href="#cb282-37" aria-hidden="true" tabindex="-1"></a><span class="st">{&quot;mood&quot;: &quot;무드&quot;, &quot;reason&quot;: &quot;이유&quot;, &quot;recommendation&quot;: &quot;권장사항&quot;}</span></span>
<span id="cb282-38"><a href="#cb282-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb282-39"><a href="#cb282-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-40"><a href="#cb282-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prompt</span></code></pre></div>
<p><strong>추가 개선</strong>:</p>
<ul>
<li>히스토리 데이터 활용</li>
<li>표 형식으로 명확화</li>
<li>권장사항 추가</li>
</ul>
<hr />
<h2 id="성능-최적화">⚡ 성능 최적화</h2>
<h3 id="모델-선택">1. 모델 선택</h3>
<p><strong>GPT-4 vs GPT-3.5-turbo</strong>:</p>
<table>
<thead>
<tr>
<th>항목</th>
<th>GPT-4</th>
<th>GPT-3.5-turbo</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>정확도</strong></td>
<td>높음</td>
<td>보통</td>
</tr>
<tr>
<td><strong>속도</strong></td>
<td>느림 (2-3초)</td>
<td>빠름 (1초)</td>
</tr>
<tr>
<td><strong>비용</strong></td>
<td>비쌈 ($0.03/1K)</td>
<td>저렴 ($0.001/1K)</td>
</tr>
<tr>
<td><strong>추천</strong></td>
<td>복잡한 분석</td>
<td>단순한 판단</td>
</tr>
</tbody>
</table>
<p><strong>우리 프로젝트</strong>:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GPT-3.5-turbo 사용 (충분히 정확하고 빠름)</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span></span></code></pre></div>
<h3 id="토큰-최적화">2. 토큰 최적화</h3>
<div class="sourceCode" id="cb284"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 개선 전</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>max_tokens<span class="op">=</span><span class="dv">500</span>  <span class="co"># 불필요하게 많음</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 개선 후</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>max_tokens<span class="op">=</span><span class="dv">100</span>  <span class="co"># 충분하고 저렴</span></span></code></pre></div>
<h3 id="캐싱-전략">3. 캐싱 전략</h3>
<div class="sourceCode" id="cb285"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 같은 데이터는 재분석 안 함</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>last_analysis <span class="op">=</span> {}</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_with_cache(board_id, temp, humid):</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>    cache_key <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>temp<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>humid<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cache_key <span class="kw">in</span> last_analysis:</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 10초 이내면 캐시 사용</span></span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> time.time() <span class="op">-</span> last_analysis[cache_key][<span class="st">&#39;time&#39;</span>] <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> last_analysis[cache_key][<span class="st">&#39;result&#39;</span>]</span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AI 분석</span></span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> call_openai_api(temp, humid)</span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 캐시 저장</span></span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a>    last_analysis[cache_key] <span class="op">=</span> {</span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;result&#39;</span>: result,</span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;time&#39;</span>: time.time()</span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre></div>
<h3 id="규칙-기반-우선">4. 규칙 기반 우선</h3>
<div class="sourceCode" id="cb286"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> smart_analyze(temp, humid, use_ai<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;지능형 분석 (규칙 + AI)&quot;&quot;&quot;</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 명확한 경우는 규칙 기반 (빠르고 무료)</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> temp <span class="op">&lt;</span> <span class="dv">18</span> <span class="kw">or</span> temp <span class="op">&gt;</span> <span class="dv">32</span> <span class="kw">or</span> humid <span class="op">&gt;</span> <span class="dv">75</span>:</span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rule_based_analysis(temp, humid)</span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-8"><a href="#cb286-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 애매한 경우만 AI 사용</span></span>
<span id="cb286-9"><a href="#cb286-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> use_ai:</span>
<span id="cb286-10"><a href="#cb286-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ai_based_analysis(temp, humid)</span>
<span id="cb286-11"><a href="#cb286-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb286-12"><a href="#cb286-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rule_based_analysis(temp, humid)</span></code></pre></div>
<hr />
<h2 id="데이터-활용-고급">📊 데이터 활용 고급</h2>
<h3 id="통계-기반-분석">1. 통계 기반 분석</h3>
<div class="sourceCode" id="cb287"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_with_statistics(board_id):</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;통계 기반 분석&quot;&quot;&quot;</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board_id <span class="kw">not</span> <span class="kw">in</span> sensor_buffers:</span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> sensor_buffers[board_id]</span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 통계 계산</span></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>    temps <span class="op">=</span> [d[<span class="st">&#39;temp&#39;</span>] <span class="cf">for</span> d <span class="kw">in</span> data]</span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a>    humids <span class="op">=</span> [d[<span class="st">&#39;humid&#39;</span>] <span class="cf">for</span> d <span class="kw">in</span> data]</span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {</span>
<span id="cb287-14"><a href="#cb287-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;temp_avg&#39;</span>: <span class="bu">sum</span>(temps) <span class="op">/</span> <span class="bu">len</span>(temps),</span>
<span id="cb287-15"><a href="#cb287-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;temp_min&#39;</span>: <span class="bu">min</span>(temps),</span>
<span id="cb287-16"><a href="#cb287-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;temp_max&#39;</span>: <span class="bu">max</span>(temps),</span>
<span id="cb287-17"><a href="#cb287-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;temp_std&#39;</span>: statistics.stdev(temps) <span class="cf">if</span> <span class="bu">len</span>(temps) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb287-18"><a href="#cb287-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;humid_avg&#39;</span>: <span class="bu">sum</span>(humids) <span class="op">/</span> <span class="bu">len</span>(humids),</span>
<span id="cb287-19"><a href="#cb287-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;humid_min&#39;</span>: <span class="bu">min</span>(humids),</span>
<span id="cb287-20"><a href="#cb287-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;humid_max&#39;</span>: <span class="bu">max</span>(humids)</span>
<span id="cb287-21"><a href="#cb287-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb287-22"><a href="#cb287-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-23"><a href="#cb287-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 변화 추세</span></span>
<span id="cb287-24"><a href="#cb287-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(temps) <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb287-25"><a href="#cb287-25" aria-hidden="true" tabindex="-1"></a>        recent_avg <span class="op">=</span> <span class="bu">sum</span>(temps[<span class="op">-</span><span class="dv">5</span>:]) <span class="op">/</span> <span class="dv">5</span></span>
<span id="cb287-26"><a href="#cb287-26" aria-hidden="true" tabindex="-1"></a>        old_avg <span class="op">=</span> <span class="bu">sum</span>(temps[:<span class="dv">5</span>]) <span class="op">/</span> <span class="dv">5</span></span>
<span id="cb287-27"><a href="#cb287-27" aria-hidden="true" tabindex="-1"></a>        stats[<span class="st">&#39;temp_trend&#39;</span>] <span class="op">=</span> recent_avg <span class="op">-</span> old_avg</span>
<span id="cb287-28"><a href="#cb287-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-29"><a href="#cb287-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span></code></pre></div>
<h3 id="트렌드-감지">2. 트렌드 감지</h3>
<div class="sourceCode" id="cb288"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_trend(board_id):</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;환경 트렌드 감지&quot;&quot;&quot;</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> analyze_with_statistics(board_id)</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> stats:</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 온도 상승 중</span></span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> stats.get(<span class="st">&#39;temp_trend&#39;</span>, <span class="dv">0</span>) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;trend&#39;</span>: <span class="st">&#39;heating&#39;</span>,</span>
<span id="cb288-13"><a href="#cb288-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;message&#39;</span>: <span class="st">&#39;온도가 상승 중입니다. 환기를 고려하세요.&#39;</span></span>
<span id="cb288-14"><a href="#cb288-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb288-15"><a href="#cb288-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-16"><a href="#cb288-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 온도 하강 중</span></span>
<span id="cb288-17"><a href="#cb288-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> stats.get(<span class="st">&#39;temp_trend&#39;</span>, <span class="dv">0</span>) <span class="op">&lt;</span> <span class="op">-</span><span class="dv">2</span>:</span>
<span id="cb288-18"><a href="#cb288-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb288-19"><a href="#cb288-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;trend&#39;</span>: <span class="st">&#39;cooling&#39;</span>,</span>
<span id="cb288-20"><a href="#cb288-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;message&#39;</span>: <span class="st">&#39;온도가 하강 중입니다. 난방을 고려하세요.&#39;</span></span>
<span id="cb288-21"><a href="#cb288-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb288-22"><a href="#cb288-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-23"><a href="#cb288-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 안정</span></span>
<span id="cb288-24"><a href="#cb288-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb288-25"><a href="#cb288-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb288-26"><a href="#cb288-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;trend&#39;</span>: <span class="st">&#39;stable&#39;</span>,</span>
<span id="cb288-27"><a href="#cb288-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;message&#39;</span>: <span class="st">&#39;환경이 안정적입니다.&#39;</span></span>
<span id="cb288-28"><a href="#cb288-28" aria-hidden="true" tabindex="-1"></a>        }</span></code></pre></div>
<hr />
<h2 id="고급-led-패턴">🎨 고급 LED 패턴</h2>
<h3 id="부드러운-전환">1. 부드러운 전환</h3>
<div class="sourceCode" id="cb289"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_led_smooth_transition(from_color, to_color, steps<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;부드러운 색상 전환&quot;&quot;&quot;</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(steps):</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 중간 색상 계산</span></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>        progress <span class="op">=</span> i <span class="op">/</span> steps</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> <span class="bu">int</span>(from_color[<span class="dv">0</span>] <span class="op">+</span> (to_color[<span class="dv">0</span>] <span class="op">-</span> from_color[<span class="dv">0</span>]) <span class="op">*</span> progress)</span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> <span class="bu">int</span>(from_color[<span class="dv">1</span>] <span class="op">+</span> (to_color[<span class="dv">1</span>] <span class="op">-</span> from_color[<span class="dv">1</span>]) <span class="op">*</span> progress)</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="bu">int</span>(from_color[<span class="dv">2</span>] <span class="op">+</span> (to_color[<span class="dv">2</span>] <span class="op">-</span> from_color[<span class="dv">2</span>]) <span class="op">*</span> progress)</span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># LED 설정</span></span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a>            np[j] <span class="op">=</span> (r, g, b)</span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a>        np.write()</span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.05</span>)</span></code></pre></div>
<h3 id="그라데이션">2. 그라데이션</h3>
<div class="sourceCode" id="cb290"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_led_gradient(color1, color2):</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;세로 그라데이션&quot;&quot;&quot;</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>        progress <span class="op">=</span> row <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> <span class="bu">int</span>(color1[<span class="dv">0</span>] <span class="op">+</span> (color2[<span class="dv">0</span>] <span class="op">-</span> color1[<span class="dv">0</span>]) <span class="op">*</span> progress)</span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> <span class="bu">int</span>(color1[<span class="dv">1</span>] <span class="op">+</span> (color2[<span class="dv">1</span>] <span class="op">-</span> color1[<span class="dv">1</span>]) <span class="op">*</span> progress)</span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="bu">int</span>(color1[<span class="dv">2</span>] <span class="op">+</span> (color2[<span class="dv">2</span>] <span class="op">-</span> color1[<span class="dv">2</span>]) <span class="op">*</span> progress)</span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 해당 행의 LED 설정</span></span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> row <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> col</span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a>            np[idx] <span class="op">=</span> (r, g, b)</span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a>    np.write()</span></code></pre></div>
<h3 id="무드별-애니메이션">3. 무드별 애니메이션</h3>
<div class="sourceCode" id="cb291"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate_mood(mood):</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;무드별 애니메이션&quot;&quot;&quot;</span></span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mood <span class="op">==</span> <span class="st">&quot;Perfect&quot;</span>:</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 초록색 펄스</span></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> brightness <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>, <span class="dv">101</span>, <span class="dv">10</span>):</span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> (<span class="dv">0</span>, <span class="bu">int</span>(<span class="dv">255</span> <span class="op">*</span> brightness <span class="op">/</span> <span class="dv">100</span>), <span class="dv">0</span>)</span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a>            set_led_solid(color)</span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb291-10"><a href="#cb291-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-11"><a href="#cb291-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mood <span class="op">==</span> <span class="st">&quot;Hot&quot;</span>:</span>
<span id="cb291-12"><a href="#cb291-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 빨간색 깜빡임</span></span>
<span id="cb291-13"><a href="#cb291-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb291-14"><a href="#cb291-14" aria-hidden="true" tabindex="-1"></a>            set_led_solid((<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb291-15"><a href="#cb291-15" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.2</span>)</span>
<span id="cb291-16"><a href="#cb291-16" aria-hidden="true" tabindex="-1"></a>            set_led_solid((<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb291-17"><a href="#cb291-17" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.2</span>)</span>
<span id="cb291-18"><a href="#cb291-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-19"><a href="#cb291-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mood <span class="op">==</span> <span class="st">&quot;Cold&quot;</span>:</span>
<span id="cb291-20"><a href="#cb291-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 파란색 웨이브</span></span>
<span id="cb291-21"><a href="#cb291-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> offset <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb291-22"><a href="#cb291-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</span>
<span id="cb291-23"><a href="#cb291-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (i <span class="op">+</span> offset) <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb291-24"><a href="#cb291-24" aria-hidden="true" tabindex="-1"></a>                    np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)</span>
<span id="cb291-25"><a href="#cb291-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb291-26"><a href="#cb291-26" aria-hidden="true" tabindex="-1"></a>                    np[i] <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb291-27"><a href="#cb291-27" aria-hidden="true" tabindex="-1"></a>            np.write()</span>
<span id="cb291-28"><a href="#cb291-28" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.1</span>)</span></code></pre></div>
<hr />
<h2 id="추가-기능-구현">🚀 추가 기능 구현</h2>
<h3 id="알림-시스템">1. 알림 시스템</h3>
<div class="sourceCode" id="cb292"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NotificationSystem:</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;알림 시스템&quot;&quot;&quot;</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.last_notification <span class="op">=</span> {}</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.NOTIFICATION_INTERVAL <span class="op">=</span> <span class="dv">300</span>  <span class="co"># 5분</span></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> should_notify(<span class="va">self</span>, board_id, condition):</span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;알림 필요 여부&quot;&quot;&quot;</span></span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>condition<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb292-12"><a href="#cb292-12" aria-hidden="true" tabindex="-1"></a>        current_time <span class="op">=</span> time.time()</span>
<span id="cb292-13"><a href="#cb292-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-14"><a href="#cb292-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.last_notification:</span>
<span id="cb292-15"><a href="#cb292-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.last_notification[key] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb292-16"><a href="#cb292-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-17"><a href="#cb292-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5분 이상 지났으면 알림</span></span>
<span id="cb292-18"><a href="#cb292-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_time <span class="op">-</span> <span class="va">self</span>.last_notification[key] <span class="op">&gt;</span> <span class="va">self</span>.NOTIFICATION_INTERVAL:</span>
<span id="cb292-19"><a href="#cb292-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.last_notification[key] <span class="op">=</span> current_time</span>
<span id="cb292-20"><a href="#cb292-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb292-21"><a href="#cb292-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-22"><a href="#cb292-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb292-23"><a href="#cb292-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-24"><a href="#cb292-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> send_notification(<span class="va">self</span>, board_id, message):</span>
<span id="cb292-25"><a href="#cb292-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;알림 전송&quot;&quot;&quot;</span></span>
<span id="cb292-26"><a href="#cb292-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔔 [알림] 보드 </span><span class="sc">{</span>board_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>message<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb292-27"><a href="#cb292-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-28"><a href="#cb292-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 실제로는 이메일, Slack, 카카오톡 등으로 전송 가능</span></span></code></pre></div>
<h3 id="데이터-로깅">2. 데이터 로깅</h3>
<div class="sourceCode" id="cb293"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataLogger:</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;데이터 로거&quot;&quot;&quot;</span></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filename<span class="op">=</span><span class="st">&quot;sensor_log.csv&quot;</span>):</span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.filename <span class="op">=</span> filename</span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.init_csv()</span>
<span id="cb293-10"><a href="#cb293-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-11"><a href="#cb293-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> init_csv(<span class="va">self</span>):</span>
<span id="cb293-12"><a href="#cb293-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;CSV 파일 초기화&quot;&quot;&quot;</span></span>
<span id="cb293-13"><a href="#cb293-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.filename, <span class="st">&#39;w&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb293-14"><a href="#cb293-14" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.writer(f)</span>
<span id="cb293-15"><a href="#cb293-15" aria-hidden="true" tabindex="-1"></a>            writer.writerow([</span>
<span id="cb293-16"><a href="#cb293-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;Timestamp&#39;</span>, <span class="st">&#39;Board&#39;</span>, <span class="st">&#39;Temperature&#39;</span>, <span class="st">&#39;Humidity&#39;</span>,</span>
<span id="cb293-17"><a href="#cb293-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;Light&#39;</span>, <span class="st">&#39;Mood&#39;</span>, <span class="st">&#39;Action&#39;</span></span>
<span id="cb293-18"><a href="#cb293-18" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb293-19"><a href="#cb293-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-20"><a href="#cb293-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> log(<span class="va">self</span>, board_id, temp, humid, light, mood, action):</span>
<span id="cb293-21"><a href="#cb293-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;데이터 로그&quot;&quot;&quot;</span></span>
<span id="cb293-22"><a href="#cb293-22" aria-hidden="true" tabindex="-1"></a>        timestamp <span class="op">=</span> datetime.now().strftime(<span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&quot;</span>)</span>
<span id="cb293-23"><a href="#cb293-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-24"><a href="#cb293-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.filename, <span class="st">&#39;a&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb293-25"><a href="#cb293-25" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.writer(f)</span>
<span id="cb293-26"><a href="#cb293-26" aria-hidden="true" tabindex="-1"></a>            writer.writerow([</span>
<span id="cb293-27"><a href="#cb293-27" aria-hidden="true" tabindex="-1"></a>                timestamp, board_id, temp, humid, light, mood, action</span>
<span id="cb293-28"><a href="#cb293-28" aria-hidden="true" tabindex="-1"></a>            ])</span></code></pre></div>
<h3 id="웹-api-선택">3. 웹 API (선택)</h3>
<div class="sourceCode" id="cb294"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask, jsonify</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/status/&lt;board_id&gt;&#39;</span>)</span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_status(board_id):</span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;보드 상태 API&quot;&quot;&quot;</span></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board_id <span class="kw">in</span> sensor_buffers:</span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a>        latest <span class="op">=</span> sensor_buffers[board_id][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({</span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;board&#39;</span>: board_id,</span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;temperature&#39;</span>: latest[<span class="st">&#39;temp&#39;</span>],</span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;humidity&#39;</span>: latest[<span class="st">&#39;humid&#39;</span>],</span>
<span id="cb294-15"><a href="#cb294-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;mood&#39;</span>: latest.get(<span class="st">&#39;mood&#39;</span>, <span class="st">&#39;Unknown&#39;</span>),</span>
<span id="cb294-16"><a href="#cb294-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;timestamp&#39;</span>: latest[<span class="st">&#39;time&#39;</span>].isoformat()</span>
<span id="cb294-17"><a href="#cb294-17" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb294-18"><a href="#cb294-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb294-19"><a href="#cb294-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Board not found&#39;</span>}), <span class="dv">404</span></span>
<span id="cb294-20"><a href="#cb294-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-21"><a href="#cb294-21" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/history/&lt;board_id&gt;&#39;</span>)</span>
<span id="cb294-22"><a href="#cb294-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_history(board_id):</span>
<span id="cb294-23"><a href="#cb294-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;히스토리 API&quot;&quot;&quot;</span></span>
<span id="cb294-24"><a href="#cb294-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-25"><a href="#cb294-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board_id <span class="kw">in</span> sensor_buffers:</span>
<span id="cb294-26"><a href="#cb294-26" aria-hidden="true" tabindex="-1"></a>        history <span class="op">=</span> <span class="bu">list</span>(sensor_buffers[board_id])</span>
<span id="cb294-27"><a href="#cb294-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({</span>
<span id="cb294-28"><a href="#cb294-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;board&#39;</span>: board_id,</span>
<span id="cb294-29"><a href="#cb294-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;count&#39;</span>: <span class="bu">len</span>(history),</span>
<span id="cb294-30"><a href="#cb294-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;data&#39;</span>: history</span>
<span id="cb294-31"><a href="#cb294-31" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb294-32"><a href="#cb294-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb294-33"><a href="#cb294-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Board not found&#39;</span>}), <span class="dv">404</span></span>
<span id="cb294-34"><a href="#cb294-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-35"><a href="#cb294-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Flask 서버 실행 (백그라운드)</span></span>
<span id="cb294-36"><a href="#cb294-36" aria-hidden="true" tabindex="-1"></a><span class="co"># app.run(host=&#39;0.0.0.0&#39;, port=5000)</span></span></code></pre></div>
<hr />
<h2 id="실험-및-ab-테스트">📊 실험 및 A/B 테스트</h2>
<h3 id="실험-1-모델-비교">실험 1: 모델 비교</h3>
<div class="sourceCode" id="cb295"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_models(temp, humid):</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;GPT-4 vs GPT-3.5 비교&quot;&quot;&quot;</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> time</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GPT-4</span></span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.time()</span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a>    result_gpt4 <span class="op">=</span> call_openai(<span class="st">&quot;gpt-4&quot;</span>, temp, humid)</span>
<span id="cb295-9"><a href="#cb295-9" aria-hidden="true" tabindex="-1"></a>    time_gpt4 <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb295-10"><a href="#cb295-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-11"><a href="#cb295-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GPT-3.5</span></span>
<span id="cb295-12"><a href="#cb295-12" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.time()</span>
<span id="cb295-13"><a href="#cb295-13" aria-hidden="true" tabindex="-1"></a>    result_gpt35 <span class="op">=</span> call_openai(<span class="st">&quot;gpt-3.5-turbo&quot;</span>, temp, humid)</span>
<span id="cb295-14"><a href="#cb295-14" aria-hidden="true" tabindex="-1"></a>    time_gpt35 <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb295-15"><a href="#cb295-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-16"><a href="#cb295-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;GPT-4: </span><span class="sc">{</span>result_gpt4[<span class="st">&#39;mood&#39;</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>time_gpt4<span class="sc">:.2f}</span><span class="ss">s)&quot;</span>)</span>
<span id="cb295-17"><a href="#cb295-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;GPT-3.5: </span><span class="sc">{</span>result_gpt35[<span class="st">&#39;mood&#39;</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>time_gpt35<span class="sc">:.2f}</span><span class="ss">s)&quot;</span>)</span></code></pre></div>
<h3 id="실험-2-프롬프트-ab-테스트">실험 2: 프롬프트 A/B 테스트</h3>
<div class="sourceCode" id="cb296"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_prompts(temp, humid):</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;다양한 프롬프트 테스트&quot;&quot;&quot;</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>    prompts <span class="op">=</span> {</span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;basic&quot;</span>: <span class="st">&quot;온도 </span><span class="sc">{temp}</span><span class="st">°C, 습도 </span><span class="sc">{humid}</span><span class="st">%. 무드는?&quot;</span>,</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;detailed&quot;</span>: build_analysis_prompt(temp, humid, <span class="va">None</span>),</span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;with_history&quot;</span>: build_analysis_prompt(temp, humid, history)</span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-10"><a href="#cb296-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, prompt <span class="kw">in</span> prompts.items():</span>
<span id="cb296-11"><a href="#cb296-11" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> call_openai_with_prompt(prompt)</span>
<span id="cb296-12"><a href="#cb296-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>result[<span class="st">&#39;mood&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<hr />
<h2 id="핵심-정리-11">📝 핵심 정리</h2>
<h3 id="최적화-체크리스트">최적화 체크리스트</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>GPT-3.5-turbo 사용 (비용
절감)</label></li>
<li><label><input type="checkbox" checked></input>max_tokens
최소화</label></li>
<li><label><input type="checkbox" checked></input>캐싱 적용</label></li>
<li><label><input type="checkbox" checked></input>규칙 기반
우선</label></li>
<li><label><input type="checkbox" checked></input>명확한
프롬프트</label></li>
<li><label><input type="checkbox" checked></input>데이터 로깅</label></li>
<li><label><input type="checkbox" checked></input>에러 처리
강화</label></li>
</ul>
<h3 id="성능-개선-결과">성능 개선 결과</h3>
<table>
<thead>
<tr>
<th>항목</th>
<th>개선 전</th>
<th>개선 후</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>응답 시간</strong></td>
<td>3초</td>
<td>1초</td>
</tr>
<tr>
<td><strong>API 비용</strong></td>
<td>$0.03/회</td>
<td>$0.001/회</td>
</tr>
<tr>
<td><strong>정확도</strong></td>
<td>95%</td>
<td>93%</td>
</tr>
<tr>
<td><strong>캐시 히트율</strong></td>
<td>0%</td>
<td>60%</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="자주-묻는-질문-13">❓ 자주 묻는 질문</h2>
<h3 id="q1.-ai-없이도-동작하나요">Q1. AI 없이도 동작하나요?</h3>
<p><strong>A</strong>: 네. 규칙 기반 폴백이 있어 AI 없이도 기본 기능
동작합니다.</p>
<h3 id="q2.-비용을-더-줄이려면">Q2. 비용을 더 줄이려면?</h3>
<p><strong>A</strong>: 제어 간격 늘리기 (10초 → 30초), 규칙 기반 우선
사용</p>
<h3 id="q3.-정확도를-높이려면">Q3. 정확도를 높이려면?</h3>
<p><strong>A</strong>: GPT-4 사용, 프롬프트 상세화, 히스토리 데이터
활용</p>
<hr />
<h2 id="다음-단계-13">🚀 다음 단계</h2>
<p>AI 무드 컨트롤러를 완성했습니다!</p>
<p><strong>추가로 시도해볼 것</strong>:</p>
<ul>
<li>여러 방 동시 모니터링</li>
<li>스마트폰 앱 연동</li>
<li>음성 제어 추가</li>
<li>에너지 절약 모드</li>
</ul>
<p><strong>다음 PART에서는</strong>:</p>
<ul>
<li>웹 대시보드 구축</li>
<li>실시간 모니터링</li>
<li>원격 제어</li>
</ul>
<hr />
<p><strong>🎉 Chapter 23 완료!</strong><br />
<strong>🎉 PART 6 완료!</strong></p>
<p>AI 무드 컨트롤러가 완전히 최적화되고 확장되었습니다!</p>
<h1 id="chapter-24.-웹에서-센서-상태-모니터링하기">Chapter 24. 웹에서
센서 상태 모니터링하기</h1>
<blockquote>
<p><strong>PART 7</strong>: 웹 기반 AI 제어 대시보드</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-23">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>HTML로 웹 페이지를 만들 수
있다</label></li>
<li><label><input type="checkbox"></input>MQTT.js로 브라우저에서 센서 데이터를
받을 수 있다</label></li>
<li><label><input type="checkbox"></input>실시간으로 데이터를 화면에 표시할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-23">🎯 학습 목표</h2>
<h3 id="웹-대시보드란">웹 대시보드란?</h3>
<p><strong>브라우저에서 헥사보드 센서를 실시간으로 모니터링하는 웹
페이지</strong></p>
<pre><code>헥사보드 센서 → MQTT Broker → 웹 브라우저 (MQTT.js)</code></pre>
<p><strong>장점</strong>:</p>
<ul>
<li>✅ 어디서나 접속 가능 (스마트폰, 태블릿, PC)</li>
<li>✅ 서버 불필요 (HTML 파일만으로 동작)</li>
<li>✅ 실시간 업데이트</li>
<li>✅ 직관적인 UI</li>
</ul>
<hr />
<h2 id="필요한-것-10">🛠️ 필요한 것</h2>
<h3 id="소프트웨어-1">소프트웨어</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>웹 브라우저 (Chrome,
Safari, Firefox)</label></li>
<li><label><input type="checkbox" checked></input>텍스트 에디터 (VS Code
추천)</label></li>
<li><label><input type="checkbox" checked></input>MQTT.js 라이브러리 (CDN
사용)</label></li>
</ul>
<h3 id="사전-지식-1">사전 지식</h3>
<ul>
<li>HTML 기초 (태그, 구조)</li>
<li>JavaScript 기초 (변수, 함수)</li>
<li>MQTT 개념 (PART 4)</li>
</ul>
<hr />
<h2 id="실습-1-기본-웹-페이지-만들기">💻 실습 1: 기본 웹 페이지
만들기</h2>
<h3 id="step-1-html-기본-구조-tailwind-css">Step 1: HTML 기본 구조
(Tailwind CSS)</h3>
<p><strong>Tailwind CSS 사용의 장점</strong>:</p>
<ul>
<li>✅ CDN으로 간단하게 추가</li>
<li>✅ Utility-First 클래스로 빠른 개발</li>
<li>✅ 반응형 디자인 쉬움</li>
<li>✅ 별도 CSS 파일 불필요</li>
</ul>
<p><strong>코드</strong>:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;ko&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;UTF-8&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>헥사보드 센서 모니터<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Tailwind CSS CDN --&gt;</span></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://cdn.tailwindcss.com&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a>      tailwind<span class="op">.</span><span class="at">config</span> <span class="op">=</span> {</span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">theme</span><span class="op">:</span> {</span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">extend</span><span class="op">:</span> {</span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">colors</span><span class="op">:</span> {</span>
<span id="cb298-14"><a href="#cb298-14" aria-hidden="true" tabindex="-1"></a>              <span class="dt">primary</span><span class="op">:</span> <span class="st">&quot;#667eea&quot;</span><span class="op">,</span></span>
<span id="cb298-15"><a href="#cb298-15" aria-hidden="true" tabindex="-1"></a>              <span class="dt">secondary</span><span class="op">:</span> <span class="st">&quot;#764ba2&quot;</span><span class="op">,</span></span>
<span id="cb298-16"><a href="#cb298-16" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb298-17"><a href="#cb298-17" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb298-18"><a href="#cb298-18" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb298-19"><a href="#cb298-19" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb298-20"><a href="#cb298-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb298-21"><a href="#cb298-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb298-22"><a href="#cb298-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">body</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;bg-gradient-to-br from-primary to-secondary min-h-screen p-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-23"><a href="#cb298-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;max-w-4xl mx-auto&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-24"><a href="#cb298-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">&lt;!-- 헤더 --&gt;</span></span>
<span id="cb298-25"><a href="#cb298-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-center text-white mb-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-26"><a href="#cb298-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">h1</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-4xl md:text-5xl font-bold mb-4&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-27"><a href="#cb298-27" aria-hidden="true" tabindex="-1"></a>          🎛️ 헥사보드 센서 모니터</span>
<span id="cb298-28"><a href="#cb298-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb298-29"><a href="#cb298-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">div</span></span>
<span id="cb298-30"><a href="#cb298-30" aria-hidden="true" tabindex="-1"></a><span class="ot">          id</span><span class="op">=</span><span class="st">&quot;status&quot;</span></span>
<span id="cb298-31"><a href="#cb298-31" aria-hidden="true" tabindex="-1"></a><span class="ot">          class</span><span class="op">=</span><span class="st">&quot;inline-block px-4 py-2 rounded-full text-sm font-bold bg-red-500 text-white&quot;</span></span>
<span id="cb298-32"><a href="#cb298-32" aria-hidden="true" tabindex="-1"></a><span class="ot">        </span><span class="dt">&gt;</span></span>
<span id="cb298-33"><a href="#cb298-33" aria-hidden="true" tabindex="-1"></a>          연결 대기 중...</span>
<span id="cb298-34"><a href="#cb298-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-35"><a href="#cb298-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-36"><a href="#cb298-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-37"><a href="#cb298-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">&lt;!-- 센서 데이터 카드 --&gt;</span></span>
<span id="cb298-38"><a href="#cb298-38" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;bg-white rounded-2xl shadow-2xl p-8 mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-39"><a href="#cb298-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-2xl font-bold text-gray-800 mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-40"><a href="#cb298-40" aria-hidden="true" tabindex="-1"></a>          📊 실시간 센서 데이터</span>
<span id="cb298-41"><a href="#cb298-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb298-42"><a href="#cb298-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;grid grid-cols-1 md:grid-cols-3 gap-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-43"><a href="#cb298-43" aria-hidden="true" tabindex="-1"></a>          <span class="co">&lt;!-- 온도 --&gt;</span></span>
<span id="cb298-44"><a href="#cb298-44" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">div</span></span>
<span id="cb298-45"><a href="#cb298-45" aria-hidden="true" tabindex="-1"></a><span class="ot">            class</span><span class="op">=</span><span class="st">&quot;bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 text-center&quot;</span></span>
<span id="cb298-46"><a href="#cb298-46" aria-hidden="true" tabindex="-1"></a><span class="ot">          </span><span class="dt">&gt;</span></span>
<span id="cb298-47"><a href="#cb298-47" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-5xl mb-3&quot;</span><span class="dt">&gt;</span>🌡️<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-48"><a href="#cb298-48" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-sm text-gray-600 mb-2&quot;</span><span class="dt">&gt;</span>온도<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-49"><a href="#cb298-49" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-3xl font-bold text-gray-800&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-50"><a href="#cb298-50" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;temp&quot;</span><span class="dt">&gt;</span>--<span class="dt">&lt;/</span><span class="kw">span</span></span>
<span id="cb298-51"><a href="#cb298-51" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-lg text-gray-500&quot;</span><span class="dt">&gt;</span>°C<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb298-52"><a href="#cb298-52" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-53"><a href="#cb298-53" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-54"><a href="#cb298-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-55"><a href="#cb298-55" aria-hidden="true" tabindex="-1"></a>          <span class="co">&lt;!-- 습도 --&gt;</span></span>
<span id="cb298-56"><a href="#cb298-56" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">div</span></span>
<span id="cb298-57"><a href="#cb298-57" aria-hidden="true" tabindex="-1"></a><span class="ot">            class</span><span class="op">=</span><span class="st">&quot;bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-xl p-6 text-center&quot;</span></span>
<span id="cb298-58"><a href="#cb298-58" aria-hidden="true" tabindex="-1"></a><span class="ot">          </span><span class="dt">&gt;</span></span>
<span id="cb298-59"><a href="#cb298-59" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-5xl mb-3&quot;</span><span class="dt">&gt;</span>💧<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-60"><a href="#cb298-60" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-sm text-gray-600 mb-2&quot;</span><span class="dt">&gt;</span>습도<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-61"><a href="#cb298-61" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-3xl font-bold text-gray-800&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-62"><a href="#cb298-62" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;humid&quot;</span><span class="dt">&gt;</span>--<span class="dt">&lt;/</span><span class="kw">span</span></span>
<span id="cb298-63"><a href="#cb298-63" aria-hidden="true" tabindex="-1"></a>              <span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-lg text-gray-500&quot;</span><span class="dt">&gt;</span>%<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb298-64"><a href="#cb298-64" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-65"><a href="#cb298-65" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-66"><a href="#cb298-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-67"><a href="#cb298-67" aria-hidden="true" tabindex="-1"></a>          <span class="co">&lt;!-- 조도 --&gt;</span></span>
<span id="cb298-68"><a href="#cb298-68" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">div</span></span>
<span id="cb298-69"><a href="#cb298-69" aria-hidden="true" tabindex="-1"></a><span class="ot">            class</span><span class="op">=</span><span class="st">&quot;bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-6 text-center&quot;</span></span>
<span id="cb298-70"><a href="#cb298-70" aria-hidden="true" tabindex="-1"></a><span class="ot">          </span><span class="dt">&gt;</span></span>
<span id="cb298-71"><a href="#cb298-71" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-5xl mb-3&quot;</span><span class="dt">&gt;</span>💡<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-72"><a href="#cb298-72" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-sm text-gray-600 mb-2&quot;</span><span class="dt">&gt;</span>조도<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-73"><a href="#cb298-73" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-3xl font-bold text-gray-800&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;light&quot;</span><span class="dt">&gt;</span>--<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-74"><a href="#cb298-74" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-75"><a href="#cb298-75" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-76"><a href="#cb298-76" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-77"><a href="#cb298-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-78"><a href="#cb298-78" aria-hidden="true" tabindex="-1"></a>      <span class="co">&lt;!-- 로그 카드 --&gt;</span></span>
<span id="cb298-79"><a href="#cb298-79" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;bg-white rounded-2xl shadow-2xl p-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-80"><a href="#cb298-80" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-2xl font-bold text-gray-800 mb-4&quot;</span><span class="dt">&gt;</span>📝 데이터 로그<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb298-81"><a href="#cb298-81" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">div</span></span>
<span id="cb298-82"><a href="#cb298-82" aria-hidden="true" tabindex="-1"></a><span class="ot">          id</span><span class="op">=</span><span class="st">&quot;log&quot;</span></span>
<span id="cb298-83"><a href="#cb298-83" aria-hidden="true" tabindex="-1"></a><span class="ot">          class</span><span class="op">=</span><span class="st">&quot;bg-gray-50 rounded-lg p-4 max-h-64 overflow-y-auto font-mono text-sm space-y-2&quot;</span></span>
<span id="cb298-84"><a href="#cb298-84" aria-hidden="true" tabindex="-1"></a><span class="ot">        </span><span class="dt">&gt;</span></span>
<span id="cb298-85"><a href="#cb298-85" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;border-b border-gray-200 pb-2&quot;</span><span class="dt">&gt;</span></span>
<span id="cb298-86"><a href="#cb298-86" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-gray-400&quot;</span><span class="dt">&gt;</span>--:--:--<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb298-87"><a href="#cb298-87" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;ml-3&quot;</span><span class="dt">&gt;</span>연결 대기 중...<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb298-88"><a href="#cb298-88" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-89"><a href="#cb298-89" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-90"><a href="#cb298-90" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-91"><a href="#cb298-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb298-92"><a href="#cb298-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-93"><a href="#cb298-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- 다음 단계에서 JavaScript 추가 --&gt;</span></span>
<span id="cb298-94"><a href="#cb298-94" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb298-95"><a href="#cb298-95" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Tailwind CSS 주요 클래스 설명</strong>:</p>
<table>
<thead>
<tr>
<th>클래스</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bg-gradient-to-br</code></td>
<td>대각선 그라디언트 배경</td>
</tr>
<tr>
<td><code>from-primary to-secondary</code></td>
<td>커스텀 색상 (보라색)</td>
</tr>
<tr>
<td><code>rounded-2xl</code></td>
<td>둥근 모서리 (큰 크기)</td>
</tr>
<tr>
<td><code>shadow-2xl</code></td>
<td>큰 그림자 효과</td>
</tr>
<tr>
<td><code>grid grid-cols-3</code></td>
<td>3열 그리드 레이아웃</td>
</tr>
<tr>
<td><code>md:grid-cols-3</code></td>
<td>중간 화면 이상에서 3열</td>
</tr>
<tr>
<td><code>gap-6</code></td>
<td>그리드 간격</td>
</tr>
</tbody>
</table>
<p><strong>파일명</strong>: <code>hexaboard_monitor.html</code></p>
<p><strong>실행</strong>: 웹 브라우저에서 파일 열기</p>
<hr />
<h2 id="실습-2-mqtt-연결하기">💻 실습 2: MQTT 연결하기</h2>
<h3 id="step-2-mqtt.js-추가">Step 2: MQTT.js 추가</h3>
<p><strong>HTML에 추가</strong> (<code>&lt;/body&gt;</code> 앞에):</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- MQTT.js 라이브러리 --&gt;</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/mqtt/dist/mqtt.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// MQTT 설정</span></span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> MQTT_BROKER <span class="op">=</span> <span class="st">&quot;wss://abc123.s1.eu.hivemq.cloud:8884/mqtt&quot;</span><span class="op">;</span></span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> MQTT_USER <span class="op">=</span> <span class="st">&quot;hexaboard&quot;</span><span class="op">;</span></span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span><span class="op">;</span></span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> TOPIC_SENSOR <span class="op">=</span> <span class="st">&quot;hexaboard/+/sensor/data&quot;</span><span class="op">;</span></span>
<span id="cb299-10"><a href="#cb299-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-11"><a href="#cb299-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// MQTT 클라이언트</span></span>
<span id="cb299-12"><a href="#cb299-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> client <span class="op">=</span> mqtt<span class="op">.</span><span class="fu">connect</span>(MQTT_BROKER<span class="op">,</span> {</span>
<span id="cb299-13"><a href="#cb299-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">username</span><span class="op">:</span> MQTT_USER<span class="op">,</span></span>
<span id="cb299-14"><a href="#cb299-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">password</span><span class="op">:</span> MQTT_PASSWORD<span class="op">,</span></span>
<span id="cb299-15"><a href="#cb299-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clientId</span><span class="op">:</span> <span class="st">&quot;web_monitor_&quot;</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">.</span><span class="fu">toString</span>(<span class="dv">16</span>)<span class="op">.</span><span class="fu">substr</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">,</span></span>
<span id="cb299-16"><a href="#cb299-16" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb299-17"><a href="#cb299-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-18"><a href="#cb299-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 연결 성공</span></span>
<span id="cb299-19"><a href="#cb299-19" aria-hidden="true" tabindex="-1"></a>  client<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;connect&quot;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb299-20"><a href="#cb299-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;✅ MQTT 연결 성공!&quot;</span>)<span class="op">;</span></span>
<span id="cb299-21"><a href="#cb299-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateStatus</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb299-22"><a href="#cb299-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLog</span>(<span class="st">&quot;MQTT Broker에 연결되었습니다.&quot;</span>)<span class="op">;</span></span>
<span id="cb299-23"><a href="#cb299-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-24"><a href="#cb299-24" aria-hidden="true" tabindex="-1"></a>    client<span class="op">.</span><span class="fu">subscribe</span>(TOPIC_SENSOR<span class="op">,</span> <span class="kw">function</span> (err) {</span>
<span id="cb299-25"><a href="#cb299-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>err) {</span>
<span id="cb299-26"><a href="#cb299-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addLog</span>(<span class="vs">`구독 시작: </span><span class="sc">${</span>TOPIC_SENSOR<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb299-27"><a href="#cb299-27" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb299-28"><a href="#cb299-28" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb299-29"><a href="#cb299-29" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb299-30"><a href="#cb299-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-31"><a href="#cb299-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 메시지 수신</span></span>
<span id="cb299-32"><a href="#cb299-32" aria-hidden="true" tabindex="-1"></a>  client<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;message&quot;</span><span class="op">,</span> <span class="kw">function</span> (topic<span class="op">,</span> message) {</span>
<span id="cb299-33"><a href="#cb299-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb299-34"><a href="#cb299-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(message<span class="op">.</span><span class="fu">toString</span>())<span class="op">;</span></span>
<span id="cb299-35"><a href="#cb299-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateSensorData</span>(data)<span class="op">;</span></span>
<span id="cb299-36"><a href="#cb299-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">addLog</span>(<span class="vs">`센서 데이터: </span><span class="sc">${</span>data<span class="op">.</span><span class="at">temperature</span><span class="sc">}</span><span class="vs">°C, </span><span class="sc">${</span>data<span class="op">.</span><span class="at">humidity</span><span class="sc">}</span><span class="vs">%`</span>)<span class="op">;</span></span>
<span id="cb299-37"><a href="#cb299-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb299-38"><a href="#cb299-38" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;파싱 오류:&quot;</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb299-39"><a href="#cb299-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb299-40"><a href="#cb299-40" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb299-41"><a href="#cb299-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-42"><a href="#cb299-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 연결 끊김</span></span>
<span id="cb299-43"><a href="#cb299-43" aria-hidden="true" tabindex="-1"></a>  client<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;close&quot;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb299-44"><a href="#cb299-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;❌ MQTT 연결 끊김&quot;</span>)<span class="op">;</span></span>
<span id="cb299-45"><a href="#cb299-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateStatus</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb299-46"><a href="#cb299-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLog</span>(<span class="st">&quot;연결이 끊어졌습니다.&quot;</span>)<span class="op">;</span></span>
<span id="cb299-47"><a href="#cb299-47" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb299-48"><a href="#cb299-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-49"><a href="#cb299-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">// UI 업데이트</span></span>
<span id="cb299-50"><a href="#cb299-50" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateStatus</span>(connected) {</span>
<span id="cb299-51"><a href="#cb299-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> statusEl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;status&quot;</span>)<span class="op">;</span></span>
<span id="cb299-52"><a href="#cb299-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (connected) {</span>
<span id="cb299-53"><a href="#cb299-53" aria-hidden="true" tabindex="-1"></a>      statusEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&quot;연결됨&quot;</span><span class="op">;</span></span>
<span id="cb299-54"><a href="#cb299-54" aria-hidden="true" tabindex="-1"></a>      statusEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb299-55"><a href="#cb299-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;inline-block px-4 py-2 rounded-full text-sm font-bold bg-green-400 text-green-900&quot;</span><span class="op">;</span></span>
<span id="cb299-56"><a href="#cb299-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb299-57"><a href="#cb299-57" aria-hidden="true" tabindex="-1"></a>      statusEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&quot;연결 끊김&quot;</span><span class="op">;</span></span>
<span id="cb299-58"><a href="#cb299-58" aria-hidden="true" tabindex="-1"></a>      statusEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb299-59"><a href="#cb299-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;inline-block px-4 py-2 rounded-full text-sm font-bold bg-red-500 text-white&quot;</span><span class="op">;</span></span>
<span id="cb299-60"><a href="#cb299-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb299-61"><a href="#cb299-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb299-62"><a href="#cb299-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-63"><a href="#cb299-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateSensorData</span>(data) {</span>
<span id="cb299-64"><a href="#cb299-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;temp&quot;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> data<span class="op">.</span><span class="at">temperature</span><span class="op">;</span></span>
<span id="cb299-65"><a href="#cb299-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;humid&quot;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> data<span class="op">.</span><span class="at">humidity</span><span class="op">;</span></span>
<span id="cb299-66"><a href="#cb299-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;light&quot;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> data<span class="op">.</span><span class="at">light</span> <span class="op">||</span> <span class="st">&quot;--&quot;</span><span class="op">;</span></span>
<span id="cb299-67"><a href="#cb299-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb299-68"><a href="#cb299-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-69"><a href="#cb299-69" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">addLog</span>(message) {</span>
<span id="cb299-70"><a href="#cb299-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> logEl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;log&quot;</span>)<span class="op">;</span></span>
<span id="cb299-71"><a href="#cb299-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> time <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toLocaleTimeString</span>(<span class="st">&quot;ko-KR&quot;</span>)<span class="op">;</span></span>
<span id="cb299-72"><a href="#cb299-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-73"><a href="#cb299-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> logItem <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&quot;div&quot;</span>)<span class="op">;</span></span>
<span id="cb299-74"><a href="#cb299-74" aria-hidden="true" tabindex="-1"></a>    logItem<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&quot;border-b border-gray-200 pb-2&quot;</span><span class="op">;</span></span>
<span id="cb299-75"><a href="#cb299-75" aria-hidden="true" tabindex="-1"></a>    logItem<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;span class=&quot;text-gray-400&quot;&gt;</span><span class="sc">${</span>time<span class="sc">}</span><span class="vs">&lt;/span&gt;&lt;span class=&quot;ml-3&quot;&gt;</span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb299-76"><a href="#cb299-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-77"><a href="#cb299-77" aria-hidden="true" tabindex="-1"></a>    logEl<span class="op">.</span><span class="fu">insertBefore</span>(logItem<span class="op">,</span> logEl<span class="op">.</span><span class="at">firstChild</span>)<span class="op">;</span></span>
<span id="cb299-78"><a href="#cb299-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-79"><a href="#cb299-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (logEl<span class="op">.</span><span class="at">children</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">20</span>) {</span>
<span id="cb299-80"><a href="#cb299-80" aria-hidden="true" tabindex="-1"></a>      logEl<span class="op">.</span><span class="fu">removeChild</span>(logEl<span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span></span>
<span id="cb299-81"><a href="#cb299-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb299-82"><a href="#cb299-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb299-83"><a href="#cb299-83" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Tailwind CSS 클래스 적용</strong>:</p>
<ul>
<li><strong>연결 상태</strong>: <code>bg-green-400 text-green-900</code>
(연결됨), <code>bg-red-500 text-white</code> (끊김)</li>
<li><strong>로그 아이템</strong>:
<code>border-b border-gray-200 pb-2</code> (하단 테두리)</li>
<li><strong>시간</strong>: <code>text-gray-400</code> (회색 텍스트)</li>
</ul>
<p><strong>설정 수정</strong>:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 본인의 HiveMQ Cloud 정보로 변경</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MQTT_BROKER <span class="op">=</span> <span class="st">&quot;wss://YOUR_BROKER.s1.eu.hivemq.cloud:8884/mqtt&quot;</span><span class="op">;</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MQTT_USER <span class="op">=</span> <span class="st">&quot;your_username&quot;</span><span class="op">;</span></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MQTT_PASSWORD <span class="op">=</span> <span class="st">&quot;your_password&quot;</span><span class="op">;</span></span></code></pre></div>
<p><strong>⚠️ 중요</strong>: HiveMQ Cloud에서 WebSocket 포트는
<strong>8884</strong>입니다!</p>
<hr />
<h2 id="실습-3-완성된-대시보드-tailwind-css">💻 실습 3: 완성된 대시보드
(Tailwind CSS)</h2>
<h3 id="전체-코드">전체 코드</h3>
<p><strong>파일명</strong>:
<code>hexaboard_monitor_tailwind.html</code></p>
<p>이제 Tailwind CSS를 사용한 완전한 버전입니다. 파일은
<code>code/web/ch24_monitor_tailwind.html</code>에서 확인할 수
있습니다.</p>
<p><strong>실행 방법</strong>:</p>
<ol type="1">
<li>파일을 저장</li>
<li>웹 브라우저에서 열기</li>
<li>MQTT 설정 (본인의 HiveMQ Cloud 정보로 변경)</li>
<li>헥사보드가 센서 데이터를 보내면 자동으로 업데이트됨</li>
</ol>
<p><strong>화면 구성</strong>:</p>
<ul>
<li>📊 <strong>헤더</strong>: 타이틀 + 연결 상태</li>
<li>🎨 <strong>센서 카드</strong>: 3개의 센서 데이터 (온도, 습도,
조도)</li>
<li>📝 <strong>로그 카드</strong>: 최근 20개의 이벤트 로그</li>
</ul>
<p><strong>반응형 디자인</strong>:</p>
<ul>
<li><strong>모바일</strong>: 1열 레이아웃</li>
<li><strong>태블릿 이상</strong>: 3열 그리드 레이아웃</li>
</ul>
<hr />
<h2 id="hivemq-cloud-websocket-설정">🔧 HiveMQ Cloud WebSocket 설정</h2>
<h3 id="hivemq-cloud에서-websocket-활성화">HiveMQ Cloud에서 WebSocket
활성화</h3>
<ol type="1">
<li><strong>HiveMQ Cloud 대시보드 접속</strong></li>
<li><strong>Cluster 선택</strong></li>
<li><strong>Overview → WebSocket</strong> 확인
<ul>
<li>WebSocket 포트: <strong>8884</strong></li>
<li>URL 형식:
<code>wss://your-cluster.s1.eu.hivemq.cloud:8884/mqtt</code></li>
</ul></li>
</ol>
<p><strong>중요</strong>: 일반 MQTT 포트(8883)와 WebSocket 포트(8884)는
다릅니다!</p>
<hr />
<h2 id="핵심-정리-12">📝 핵심 정리</h2>
<h3 id="주요-개념-1">주요 개념</h3>
<ol type="1">
<li><strong>WebSocket (wss://)</strong>: 브라우저와 MQTT Broker 간
실시간 통신</li>
<li><strong>MQTT.js</strong>: 브라우저에서 MQTT 사용 가능한 JavaScript
라이브러리</li>
<li><strong>실시간 UI</strong>: 센서 데이터 수신 시 자동 화면
업데이트</li>
</ol>
<h3 id="코드-구조">코드 구조</h3>
<div class="sourceCode" id="cb301"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. MQTT 연결</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> client <span class="op">=</span> mqtt<span class="op">.</span><span class="fu">connect</span>(BROKER<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. 연결 성공 시</span></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>client<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;connect&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>  client<span class="op">.</span><span class="fu">subscribe</span>(TOPIC)<span class="op">;</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. 메시지 수신 시</span></span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>client<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;message&quot;</span><span class="op">,</span> (topic<span class="op">,</span> message) <span class="kw">=&gt;</span> {</span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(message)<span class="op">;</span></span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateUI</span>(data)<span class="op">;</span></span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="tailwind-css-주요-클래스">Tailwind CSS 주요 클래스</h3>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 57%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr>
<th>용도</th>
<th>클래스</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>배경</strong></td>
<td><code>bg-gradient-to-br from-primary to-secondary</code></td>
<td>그라디언트 배경</td>
</tr>
<tr>
<td><strong>카드</strong></td>
<td><code>bg-white rounded-2xl shadow-2xl</code></td>
<td>흰색 둥근 카드 + 그림자</td>
</tr>
<tr>
<td><strong>그리드</strong></td>
<td><code>grid grid-cols-1 md:grid-cols-3 gap-6</code></td>
<td>반응형 3열 그리드</td>
</tr>
<tr>
<td><strong>상태</strong></td>
<td><code>bg-green-400 text-green-900</code></td>
<td>연결 상태 (초록)</td>
</tr>
<tr>
<td><strong>로그</strong></td>
<td><code>border-b border-gray-200 pb-2</code></td>
<td>하단 테두리</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="자주-묻는-질문-14">❓ 자주 묻는 질문</h2>
<h3 id="q1.-연결이-안-됩니다">Q1. 연결이 안 됩니다!</h3>
<p><strong>A</strong>:</p>
<ul>
<li>WebSocket 포트 확인 (8884)</li>
<li>HiveMQ Cloud 인증 정보 확인</li>
<li>브라우저 콘솔에서 에러 확인 (F12)</li>
</ul>
<h3 id="q2.-스마트폰에서도-됩니까">Q2. 스마트폰에서도 됩니까?</h3>
<p><strong>A</strong>: 네! 같은 HTML 파일을 스마트폰 브라우저에서 열면
됩니다.</p>
<h3 id="q3.-서버가-필요한가요">Q3. 서버가 필요한가요?</h3>
<p><strong>A</strong>: 아니요. HTML 파일만으로 동작합니다
(서버리스).</p>
<hr />
<h2 id="다음-단계-14">🚀 다음 단계</h2>
<p>웹에서 센서 데이터 모니터링 완성!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>브라우저에서 LED 제어</li>
<li>양방향 통신 (Subscribe + Publish)</li>
<li>제어 버튼 추가</li>
</ul>
<hr />
<p><strong>🎉 Chapter 24 완료!</strong><br />
실시간 웹 센서 모니터가 완성되었습니다!</p>
<h1 id="chapter-25.-웹에서-헥사보드-수동-제어-tailwind-css">Chapter 25.
웹에서 헥사보드 수동 제어 (Tailwind CSS)</h1>
<blockquote>
<p><strong>PART 7</strong>: 웹 기반 AI 제어 대시보드</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-24">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>웹에서 MQTT로 제어 명령을 보낼 수
있다</label></li>
<li><label><input type="checkbox"></input>Tailwind CSS로 색상 선택기를 만들 수
있다</label></li>
<li><label><input type="checkbox"></input>양방향 통신을 구현할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 40분</p>
<hr />
<h2 id="학습-목표-24">🎯 학습 목표</h2>
<h3 id="웹-제어란">웹 제어란?</h3>
<p><strong>브라우저에서 버튼과 컨트롤러로 헥사보드를 직접
제어</strong></p>
<pre><code>웹 브라우저 → MQTT Publish → 헥사보드 → LED 제어</code></pre>
<p><strong>제어 기능</strong>:</p>
<ul>
<li>✅ LED 색상 변경</li>
<li>✅ 밝기 조절</li>
<li>✅ 패턴 선택 (solid, blink, pulse)</li>
<li>✅ LED 켜기/끄기</li>
</ul>
<hr />
<h2 id="실습-1-tailwind-css로-제어-ui-만들기">💻 실습 1: Tailwind CSS로
제어 UI 만들기</h2>
<h3 id="step-1-색상-선택-버튼">Step 1: 색상 선택 버튼</h3>
<p><strong>Tailwind CSS 색상 버튼</strong>:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 색상 프리셋 --&gt;</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span>색상 선택<span class="dt">&lt;/</span><span class="kw">label</span></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&gt;</span></span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;flex flex-wrap gap-3&quot;</span><span class="dt">&gt;</span></span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-8"><a href="#cb303-8" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(255, 0, 0)&quot;</span></span>
<span id="cb303-9"><a href="#cb303-9" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-red-500&quot;</span></span>
<span id="cb303-10"><a href="#cb303-10" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-11"><a href="#cb303-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-12"><a href="#cb303-12" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(0, 255, 0)&quot;</span></span>
<span id="cb303-13"><a href="#cb303-13" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-green-500&quot;</span></span>
<span id="cb303-14"><a href="#cb303-14" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-15"><a href="#cb303-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-16"><a href="#cb303-16" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(0, 0, 255)&quot;</span></span>
<span id="cb303-17"><a href="#cb303-17" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-blue-500&quot;</span></span>
<span id="cb303-18"><a href="#cb303-18" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-19"><a href="#cb303-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-20"><a href="#cb303-20" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(255, 255, 0)&quot;</span></span>
<span id="cb303-21"><a href="#cb303-21" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-yellow-400&quot;</span></span>
<span id="cb303-22"><a href="#cb303-22" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-23"><a href="#cb303-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-24"><a href="#cb303-24" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(255, 0, 255)&quot;</span></span>
<span id="cb303-25"><a href="#cb303-25" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-purple-500&quot;</span></span>
<span id="cb303-26"><a href="#cb303-26" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-27"><a href="#cb303-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-28"><a href="#cb303-28" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(0, 255, 255)&quot;</span></span>
<span id="cb303-29"><a href="#cb303-29" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-cyan-400&quot;</span></span>
<span id="cb303-30"><a href="#cb303-30" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-31"><a href="#cb303-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb303-32"><a href="#cb303-32" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setColor(255, 255, 255)&quot;</span></span>
<span id="cb303-33"><a href="#cb303-33" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-14 h-14 rounded-xl border-4 border-gray-300 hover:border-gray-500 hover:scale-110 transition-all bg-white&quot;</span></span>
<span id="cb303-34"><a href="#cb303-34" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb303-35"><a href="#cb303-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb303-36"><a href="#cb303-36" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Tailwind 클래스 설명</strong>:</p>
<ul>
<li><code>w-14 h-14</code>: 56px × 56px 크기</li>
<li><code>rounded-xl</code>: 둥근 모서리</li>
<li><code>hover:scale-110</code>: 호버 시 크기 확대</li>
<li><code>transition-all</code>: 부드러운 애니메이션</li>
</ul>
<h3 id="step-2-커스텀-색상-밝기-조절">Step 2: 커스텀 색상 &amp; 밝기
조절</h3>
<div class="sourceCode" id="cb304"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 커스텀 색상 --&gt;</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span>커스텀 색상<span class="dt">&lt;/</span><span class="kw">label</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&gt;</span></span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;flex gap-3&quot;</span><span class="dt">&gt;</span></span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span></span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a><span class="ot">      type</span><span class="op">=</span><span class="st">&quot;color&quot;</span></span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a><span class="ot">      id</span><span class="op">=</span><span class="st">&quot;colorPicker&quot;</span></span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a><span class="ot">      value</span><span class="op">=</span><span class="st">&quot;#00ff00&quot;</span></span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;w-20 h-10 rounded-lg cursor-pointer&quot;</span></span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">/&gt;</span></span>
<span id="cb304-13"><a href="#cb304-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb304-14"><a href="#cb304-14" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setCustomColor()&quot;</span></span>
<span id="cb304-15"><a href="#cb304-15" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;px-6 py-2 bg-primary hover:bg-opacity-90 text-white font-semibold rounded-lg transition-all hover:-translate-y-0.5&quot;</span></span>
<span id="cb304-16"><a href="#cb304-16" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span></span>
<span id="cb304-17"><a href="#cb304-17" aria-hidden="true" tabindex="-1"></a>      적용</span>
<span id="cb304-18"><a href="#cb304-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb304-19"><a href="#cb304-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb304-20"><a href="#cb304-20" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb304-21"><a href="#cb304-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-22"><a href="#cb304-22" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 밝기 조절 --&gt;</span></span>
<span id="cb304-23"><a href="#cb304-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb304-24"><a href="#cb304-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span><span class="dt">&gt;</span></span>
<span id="cb304-25"><a href="#cb304-25" aria-hidden="true" tabindex="-1"></a>    밝기: <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;brightnessValue&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-primary&quot;</span><span class="dt">&gt;</span>80<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>%</span>
<span id="cb304-26"><a href="#cb304-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb304-27"><a href="#cb304-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">input</span></span>
<span id="cb304-28"><a href="#cb304-28" aria-hidden="true" tabindex="-1"></a><span class="ot">    type</span><span class="op">=</span><span class="st">&quot;range&quot;</span></span>
<span id="cb304-29"><a href="#cb304-29" aria-hidden="true" tabindex="-1"></a><span class="ot">    id</span><span class="op">=</span><span class="st">&quot;brightness&quot;</span></span>
<span id="cb304-30"><a href="#cb304-30" aria-hidden="true" tabindex="-1"></a><span class="ot">    min</span><span class="op">=</span><span class="st">&quot;10&quot;</span></span>
<span id="cb304-31"><a href="#cb304-31" aria-hidden="true" tabindex="-1"></a><span class="ot">    max</span><span class="op">=</span><span class="st">&quot;100&quot;</span></span>
<span id="cb304-32"><a href="#cb304-32" aria-hidden="true" tabindex="-1"></a><span class="ot">    value</span><span class="op">=</span><span class="st">&quot;80&quot;</span></span>
<span id="cb304-33"><a href="#cb304-33" aria-hidden="true" tabindex="-1"></a><span class="ot">    oninput</span><span class="op">=</span><span class="st">&quot;updateBrightness(this.value)&quot;</span></span>
<span id="cb304-34"><a href="#cb304-34" aria-hidden="true" tabindex="-1"></a><span class="ot">    class</span><span class="op">=</span><span class="st">&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary&quot;</span></span>
<span id="cb304-35"><a href="#cb304-35" aria-hidden="true" tabindex="-1"></a><span class="ot">  </span><span class="dt">/&gt;</span></span>
<span id="cb304-36"><a href="#cb304-36" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb304-37"><a href="#cb304-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-38"><a href="#cb304-38" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 패턴 선택 --&gt;</span></span>
<span id="cb304-39"><a href="#cb304-39" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb304-40"><a href="#cb304-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span><span class="dt">&gt;</span>패턴<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb304-41"><a href="#cb304-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;flex gap-3&quot;</span><span class="dt">&gt;</span></span>
<span id="cb304-42"><a href="#cb304-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb304-43"><a href="#cb304-43" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setPattern(&#39;solid&#39;)&quot;</span></span>
<span id="cb304-44"><a href="#cb304-44" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 font-semibold rounded-lg transition-all&quot;</span></span>
<span id="cb304-45"><a href="#cb304-45" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span></span>
<span id="cb304-46"><a href="#cb304-46" aria-hidden="true" tabindex="-1"></a>      🔆 단색</span>
<span id="cb304-47"><a href="#cb304-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb304-48"><a href="#cb304-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb304-49"><a href="#cb304-49" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setPattern(&#39;blink&#39;)&quot;</span></span>
<span id="cb304-50"><a href="#cb304-50" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 font-semibold rounded-lg transition-all&quot;</span></span>
<span id="cb304-51"><a href="#cb304-51" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span></span>
<span id="cb304-52"><a href="#cb304-52" aria-hidden="true" tabindex="-1"></a>      💫 깜빡임</span>
<span id="cb304-53"><a href="#cb304-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb304-54"><a href="#cb304-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb304-55"><a href="#cb304-55" aria-hidden="true" tabindex="-1"></a><span class="ot">      onclick</span><span class="op">=</span><span class="st">&quot;setPattern(&#39;pulse&#39;)&quot;</span></span>
<span id="cb304-56"><a href="#cb304-56" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 font-semibold rounded-lg transition-all&quot;</span></span>
<span id="cb304-57"><a href="#cb304-57" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span></span>
<span id="cb304-58"><a href="#cb304-58" aria-hidden="true" tabindex="-1"></a>      🌊 펄스</span>
<span id="cb304-59"><a href="#cb304-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb304-60"><a href="#cb304-60" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb304-61"><a href="#cb304-61" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb304-62"><a href="#cb304-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-63"><a href="#cb304-63" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- LED 끄기 --&gt;</span></span>
<span id="cb304-64"><a href="#cb304-64" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb304-65"><a href="#cb304-65" aria-hidden="true" tabindex="-1"></a><span class="ot">  onclick</span><span class="op">=</span><span class="st">&quot;turnOffLED()&quot;</span></span>
<span id="cb304-66"><a href="#cb304-66" aria-hidden="true" tabindex="-1"></a><span class="ot">  class</span><span class="op">=</span><span class="st">&quot;w-full px-6 py-4 bg-red-500 hover:bg-red-600 text-white font-bold text-lg rounded-lg transition-all&quot;</span></span>
<span id="cb304-67"><a href="#cb304-67" aria-hidden="true" tabindex="-1"></a><span class="dt">&gt;</span></span>
<span id="cb304-68"><a href="#cb304-68" aria-hidden="true" tabindex="-1"></a>  ❌ LED 끄기</span>
<span id="cb304-69"><a href="#cb304-69" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span></code></pre></div>
<hr />
<h2 id="실습-2-javascript-제어-로직">💻 실습 2: JavaScript 제어
로직</h2>
<h3 id="제어-함수-구현">제어 함수 구현</h3>
<div class="sourceCode" id="cb305"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 현재 LED 상태</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> currentColor <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> currentBrightness <span class="op">=</span> <span class="dv">80</span><span class="op">;</span></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> currentPattern <span class="op">=</span> <span class="st">&quot;solid&quot;</span><span class="op">;</span></span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> BOARD_ID <span class="op">=</span> <span class="st">&quot;A&quot;</span><span class="op">;</span></span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a><span class="co">// LED 제어 명령 전송</span></span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sendLEDCommand</span>(color<span class="op">,</span> pattern<span class="op">,</span> brightness) {</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> command <span class="op">=</span> {</span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">action</span><span class="op">:</span> <span class="st">&quot;led_color&quot;</span><span class="op">,</span></span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> color<span class="op">,</span></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pattern</span><span class="op">:</span> pattern<span class="op">,</span></span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">brightness</span><span class="op">:</span> brightness<span class="op">,</span></span>
<span id="cb305-14"><a href="#cb305-14" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb305-15"><a href="#cb305-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-16"><a href="#cb305-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topic <span class="op">=</span> <span class="vs">`hexaboard/</span><span class="sc">${</span>BOARD_ID<span class="sc">}</span><span class="vs">/control/led`</span><span class="op">;</span></span>
<span id="cb305-17"><a href="#cb305-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> message <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(command)<span class="op">;</span></span>
<span id="cb305-18"><a href="#cb305-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-19"><a href="#cb305-19" aria-hidden="true" tabindex="-1"></a>  client<span class="op">.</span><span class="fu">publish</span>(topic<span class="op">,</span> message<span class="op">,</span> <span class="kw">function</span> (err) {</span>
<span id="cb305-20"><a href="#cb305-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>err) {</span>
<span id="cb305-21"><a href="#cb305-21" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;✅ 제어 명령 전송:&quot;</span><span class="op">,</span> command)<span class="op">;</span></span>
<span id="cb305-22"><a href="#cb305-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">addLog</span>(<span class="vs">`LED: RGB(</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">) </span><span class="sc">${</span>pattern<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>brightness<span class="sc">}</span><span class="vs">%`</span>)<span class="op">;</span></span>
<span id="cb305-23"><a href="#cb305-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb305-24"><a href="#cb305-24" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb305-25"><a href="#cb305-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-26"><a href="#cb305-26" aria-hidden="true" tabindex="-1"></a>  currentColor <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb305-27"><a href="#cb305-27" aria-hidden="true" tabindex="-1"></a>  currentPattern <span class="op">=</span> pattern<span class="op">;</span></span>
<span id="cb305-28"><a href="#cb305-28" aria-hidden="true" tabindex="-1"></a>  currentBrightness <span class="op">=</span> brightness<span class="op">;</span></span>
<span id="cb305-29"><a href="#cb305-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-30"><a href="#cb305-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-31"><a href="#cb305-31" aria-hidden="true" tabindex="-1"></a><span class="co">// 색상 설정</span></span>
<span id="cb305-32"><a href="#cb305-32" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setColor</span>(r<span class="op">,</span> g<span class="op">,</span> b) {</span>
<span id="cb305-33"><a href="#cb305-33" aria-hidden="true" tabindex="-1"></a>  currentColor <span class="op">=</span> [r<span class="op">,</span> g<span class="op">,</span> b]<span class="op">;</span></span>
<span id="cb305-34"><a href="#cb305-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sendLEDCommand</span>(currentColor<span class="op">,</span> currentPattern<span class="op">,</span> currentBrightness)<span class="op">;</span></span>
<span id="cb305-35"><a href="#cb305-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-36"><a href="#cb305-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-37"><a href="#cb305-37" aria-hidden="true" tabindex="-1"></a><span class="co">// 커스텀 색상</span></span>
<span id="cb305-38"><a href="#cb305-38" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setCustomColor</span>() {</span>
<span id="cb305-39"><a href="#cb305-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hex <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;colorPicker&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb305-40"><a href="#cb305-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r <span class="op">=</span> <span class="pp">parseInt</span>(hex<span class="op">.</span><span class="fu">substr</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb305-41"><a href="#cb305-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> g <span class="op">=</span> <span class="pp">parseInt</span>(hex<span class="op">.</span><span class="fu">substr</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb305-42"><a href="#cb305-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> b <span class="op">=</span> <span class="pp">parseInt</span>(hex<span class="op">.</span><span class="fu">substr</span>(<span class="dv">5</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb305-43"><a href="#cb305-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setColor</span>(r<span class="op">,</span> g<span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb305-44"><a href="#cb305-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-45"><a href="#cb305-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-46"><a href="#cb305-46" aria-hidden="true" tabindex="-1"></a><span class="co">// 밝기 업데이트</span></span>
<span id="cb305-47"><a href="#cb305-47" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateBrightness</span>(value) {</span>
<span id="cb305-48"><a href="#cb305-48" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;brightnessValue&quot;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb305-49"><a href="#cb305-49" aria-hidden="true" tabindex="-1"></a>  currentBrightness <span class="op">=</span> <span class="pp">parseInt</span>(value)<span class="op">;</span></span>
<span id="cb305-50"><a href="#cb305-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-51"><a href="#cb305-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-52"><a href="#cb305-52" aria-hidden="true" tabindex="-1"></a><span class="co">// 밝기 슬라이더 변경 완료 시</span></span>
<span id="cb305-53"><a href="#cb305-53" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;brightness&quot;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb305-54"><a href="#cb305-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sendLEDCommand</span>(currentColor<span class="op">,</span> currentPattern<span class="op">,</span> currentBrightness)<span class="op">;</span></span>
<span id="cb305-55"><a href="#cb305-55" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb305-56"><a href="#cb305-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-57"><a href="#cb305-57" aria-hidden="true" tabindex="-1"></a><span class="co">// 패턴 설정</span></span>
<span id="cb305-58"><a href="#cb305-58" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setPattern</span>(pattern) {</span>
<span id="cb305-59"><a href="#cb305-59" aria-hidden="true" tabindex="-1"></a>  currentPattern <span class="op">=</span> pattern<span class="op">;</span></span>
<span id="cb305-60"><a href="#cb305-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sendLEDCommand</span>(currentColor<span class="op">,</span> currentPattern<span class="op">,</span> currentBrightness)<span class="op">;</span></span>
<span id="cb305-61"><a href="#cb305-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-62"><a href="#cb305-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-63"><a href="#cb305-63" aria-hidden="true" tabindex="-1"></a><span class="co">// LED 끄기</span></span>
<span id="cb305-64"><a href="#cb305-64" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">turnOffLED</span>() {</span>
<span id="cb305-65"><a href="#cb305-65" aria-hidden="true" tabindex="-1"></a>  client<span class="op">.</span><span class="fu">publish</span>(</span>
<span id="cb305-66"><a href="#cb305-66" aria-hidden="true" tabindex="-1"></a>    <span class="vs">`hexaboard/</span><span class="sc">${</span>BOARD_ID<span class="sc">}</span><span class="vs">/control/led`</span><span class="op">,</span></span>
<span id="cb305-67"><a href="#cb305-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ <span class="dt">action</span><span class="op">:</span> <span class="st">&quot;led_off&quot;</span> })</span>
<span id="cb305-68"><a href="#cb305-68" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb305-69"><a href="#cb305-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLog</span>(<span class="st">&quot;LED OFF&quot;</span>)<span class="op">;</span></span>
<span id="cb305-70"><a href="#cb305-70" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="실습-3-완성된-제어-대시보드">💻 실습 3: 완성된 제어
대시보드</h2>
<h3 id="전체-코드-1">전체 코드</h3>
<p>완전한 코드는 <code>code/web/ch25_control_tailwind.html</code>에서
확인할 수 있습니다.</p>
<p><strong>주요 구성</strong>:</p>
<ol type="1">
<li><p><strong>센서 모니터</strong> (왼쪽)</p>
<ul>
<li>온도, 습도, 조도 실시간 표시</li>
<li>Chapter 24 코드 재사용</li>
</ul></li>
<li><p><strong>LED 제어 패널</strong> (오른쪽)</p>
<ul>
<li>색상 프리셋 버튼 7개</li>
<li>커스텀 색상 선택기</li>
<li>밝기 슬라이더</li>
<li>패턴 버튼 3개</li>
<li>LED 끄기 버튼</li>
</ul></li>
<li><p><strong>로그</strong> (하단)</p>
<ul>
<li>센서 데이터 + 제어 명령 로그</li>
</ul></li>
</ol>
<hr />
<h2 id="핵심-정리-13">📝 핵심 정리</h2>
<h3 id="양방향-통신">양방향 통신</h3>
<pre><code>웹 브라우저 ⇄ MQTT Broker ⇄ 헥사보드

Subscribe: 센서 데이터 수신
Publish: 제어 명령 전송</code></pre>
<h3 id="tailwind-css-제어-컴포넌트">Tailwind CSS 제어 컴포넌트</h3>
<table>
<thead>
<tr>
<th>컴포넌트</th>
<th>주요 클래스</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>색상 버튼</strong></td>
<td><code>w-14 h-14 rounded-xl hover:scale-110</code></td>
</tr>
<tr>
<td><strong>슬라이더</strong></td>
<td><code>w-full h-2 rounded-lg accent-primary</code></td>
</tr>
<tr>
<td><strong>패턴 버튼</strong></td>
<td><code>flex-1 bg-gray-100 hover:bg-gray-200</code></td>
</tr>
<tr>
<td><strong>주요 버튼</strong></td>
<td><code>bg-primary hover:bg-opacity-90</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="자주-묻는-질문-15">❓ 자주 묻는 질문</h2>
<h3 id="q1.-명령이-전송되는지-확인하려면">Q1. 명령이 전송되는지
확인하려면?</h3>
<p><strong>A</strong>: 브라우저 콘솔(F12)에서 “제어 명령 전송” 메시지
확인</p>
<h3 id="q2.-tailwind-css-없이도-작동하나요">Q2. Tailwind CSS 없이도
작동하나요?</h3>
<p><strong>A</strong>: 네. 기능은 동일하며 Tailwind는 스타일링만
담당합니다.</p>
<h3 id="q3.-모바일에서도-작동하나요">Q3. 모바일에서도 작동하나요?</h3>
<p><strong>A</strong>: 네! Tailwind의 반응형 클래스로 모바일에서도
최적화됩니다.</p>
<hr />
<h2 id="다음-단계-15">🚀 다음 단계</h2>
<p>웹에서 헥사보드 제어 완성!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>자연어 입력으로 제어</li>
<li>OpenAI API 통합</li>
<li>완전한 AI 대시보드</li>
</ul>
<hr />
<p><strong>🎉 Chapter 25 완료!</strong><br />
Tailwind CSS로 양방향 웹 제어 대시보드가 완성되었습니다!</p>
<h1 id="chapter-26.-웹에서-자연어-기반-ai-제어-tailwind-css">Chapter 26.
웹에서 자연어 기반 AI 제어 (Tailwind CSS)</h1>
<blockquote>
<p><strong>PART 7</strong>: 웹 기반 AI 제어 대시보드</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-25">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>자연어로 헥사보드를 제어할 수
있다</label></li>
<li><label><input type="checkbox"></input>Tailwind CSS로 AI 인터페이스를 만들
수 있다</label></li>
<li><label><input type="checkbox"></input>완전한 AIoT 대시보드를 완성할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 50분</p>
<hr />
<h2 id="학습-목표-25">🎯 학습 목표</h2>
<h3 id="ai-제어란">AI 제어란?</h3>
<p><strong>사용자가 자연어로 입력하면 AI가 명령으로 변환하여 헥사보드를
제어</strong></p>
<pre><code>사용자: &quot;LED를 빨간색으로 바꿔줘&quot;
    ↓
OpenAI API 분석
    ↓
명령: {action: &quot;led_color&quot;, color: [255, 0, 0]}
    ↓
헥사보드 제어</code></pre>
<hr />
<h2 id="중요-api-키-보안">⚠️ 중요: API 키 보안</h2>
<p><strong>⚠️ 주의</strong>: HTML에 API 키를 직접 넣으면 누구나 볼 수
있습니다!</p>
<p><strong>권장 방법</strong>: Python 백엔드 서버 사용 (Chapter 26에서
제공)</p>
<hr />
<h2 id="실습-1-ai-제어-ui-tailwind-css">💻 실습 1: AI 제어 UI (Tailwind
CSS)</h2>
<h3 id="step-1-ai-입력-인터페이스">Step 1: AI 입력 인터페이스</h3>
<div class="sourceCode" id="cb308"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;lg:col-span-2 bg-white rounded-2xl shadow-2xl p-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;text-2xl font-bold text-gray-800 mb-6&quot;</span><span class="dt">&gt;</span>🤖 AI 자연어 제어<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- 명령 입력 --&gt;</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span>명령 입력<span class="dt">&lt;/</span><span class="kw">label</span></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&gt;</span></span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;flex gap-3&quot;</span><span class="dt">&gt;</span></span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span></span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a><span class="ot">        type</span><span class="op">=</span><span class="st">&quot;text&quot;</span></span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="ot">        id</span><span class="op">=</span><span class="st">&quot;aiCommand&quot;</span></span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a><span class="ot">        placeholder</span><span class="op">=</span><span class="st">&quot;예: LED를 파란색으로 바꿔줘&quot;</span></span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true" tabindex="-1"></a><span class="ot">        onkeypress</span><span class="op">=</span><span class="st">&quot;if(event.key===&#39;Enter&#39;) sendAICommand()&quot;</span></span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-primary&quot;</span></span>
<span id="cb308-16"><a href="#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">/&gt;</span></span>
<span id="cb308-17"><a href="#cb308-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb308-18"><a href="#cb308-18" aria-hidden="true" tabindex="-1"></a><span class="ot">        onclick</span><span class="op">=</span><span class="st">&quot;sendAICommand()&quot;</span></span>
<span id="cb308-19"><a href="#cb308-19" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;px-8 py-3 bg-primary hover:bg-opacity-90 text-white font-bold rounded-lg transition-all hover:-translate-y-0.5 whitespace-nowrap&quot;</span></span>
<span id="cb308-20"><a href="#cb308-20" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span></span>
<span id="cb308-21"><a href="#cb308-21" aria-hidden="true" tabindex="-1"></a>        ✨ 실행</span>
<span id="cb308-22"><a href="#cb308-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb308-23"><a href="#cb308-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb308-24"><a href="#cb308-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb308-25"><a href="#cb308-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-26"><a href="#cb308-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- 예시 명령 --&gt;</span></span>
<span id="cb308-27"><a href="#cb308-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-6&quot;</span><span class="dt">&gt;</span></span>
<span id="cb308-28"><a href="#cb308-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span></span>
<span id="cb308-29"><a href="#cb308-29" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span>예시 명령<span class="dt">&lt;/</span><span class="kw">label</span></span>
<span id="cb308-30"><a href="#cb308-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&gt;</span></span>
<span id="cb308-31"><a href="#cb308-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;flex flex-wrap gap-2&quot;</span><span class="dt">&gt;</span></span>
<span id="cb308-32"><a href="#cb308-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb308-33"><a href="#cb308-33" aria-hidden="true" tabindex="-1"></a><span class="ot">        onclick</span><span class="op">=</span><span class="st">&quot;setAIExample(&#39;LED를 빨간색으로 바꿔줘&#39;)&quot;</span></span>
<span id="cb308-34"><a href="#cb308-34" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all&quot;</span></span>
<span id="cb308-35"><a href="#cb308-35" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span></span>
<span id="cb308-36"><a href="#cb308-36" aria-hidden="true" tabindex="-1"></a>        빨간색</span>
<span id="cb308-37"><a href="#cb308-37" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb308-38"><a href="#cb308-38" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb308-39"><a href="#cb308-39" aria-hidden="true" tabindex="-1"></a><span class="ot">        onclick</span><span class="op">=</span><span class="st">&quot;setAIExample(&#39;LED를 초록색으로 켜줘&#39;)&quot;</span></span>
<span id="cb308-40"><a href="#cb308-40" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all&quot;</span></span>
<span id="cb308-41"><a href="#cb308-41" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span></span>
<span id="cb308-42"><a href="#cb308-42" aria-hidden="true" tabindex="-1"></a>        초록색</span>
<span id="cb308-43"><a href="#cb308-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb308-44"><a href="#cb308-44" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb308-45"><a href="#cb308-45" aria-hidden="true" tabindex="-1"></a><span class="ot">        onclick</span><span class="op">=</span><span class="st">&quot;setAIExample(&#39;LED를 깜빡이게 해줘&#39;)&quot;</span></span>
<span id="cb308-46"><a href="#cb308-46" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all&quot;</span></span>
<span id="cb308-47"><a href="#cb308-47" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span></span>
<span id="cb308-48"><a href="#cb308-48" aria-hidden="true" tabindex="-1"></a>        깜빡임</span>
<span id="cb308-49"><a href="#cb308-49" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb308-50"><a href="#cb308-50" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb308-51"><a href="#cb308-51" aria-hidden="true" tabindex="-1"></a><span class="ot">        onclick</span><span class="op">=</span><span class="st">&quot;setAIExample(&#39;밝기를 50%로 낮춰줘&#39;)&quot;</span></span>
<span id="cb308-52"><a href="#cb308-52" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all&quot;</span></span>
<span id="cb308-53"><a href="#cb308-53" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span></span>
<span id="cb308-54"><a href="#cb308-54" aria-hidden="true" tabindex="-1"></a>        밝기 50%</span>
<span id="cb308-55"><a href="#cb308-55" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb308-56"><a href="#cb308-56" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">button</span></span>
<span id="cb308-57"><a href="#cb308-57" aria-hidden="true" tabindex="-1"></a><span class="ot">        onclick</span><span class="op">=</span><span class="st">&quot;setAIExample(&#39;LED를 꺼줘&#39;)&quot;</span></span>
<span id="cb308-58"><a href="#cb308-58" aria-hidden="true" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all&quot;</span></span>
<span id="cb308-59"><a href="#cb308-59" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span></span>
<span id="cb308-60"><a href="#cb308-60" aria-hidden="true" tabindex="-1"></a>        끄기</span>
<span id="cb308-61"><a href="#cb308-61" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb308-62"><a href="#cb308-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb308-63"><a href="#cb308-63" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb308-64"><a href="#cb308-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-65"><a href="#cb308-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- AI 응답 --&gt;</span></span>
<span id="cb308-66"><a href="#cb308-66" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;mb-4&quot;</span><span class="dt">&gt;</span></span>
<span id="cb308-67"><a href="#cb308-67" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;block text-sm font-semibold text-gray-700 mb-3&quot;</span></span>
<span id="cb308-68"><a href="#cb308-68" aria-hidden="true" tabindex="-1"></a><span class="ot">      </span><span class="dt">&gt;</span>AI 응답<span class="dt">&lt;/</span><span class="kw">label</span></span>
<span id="cb308-69"><a href="#cb308-69" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&gt;</span></span>
<span id="cb308-70"><a href="#cb308-70" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span></span>
<span id="cb308-71"><a href="#cb308-71" aria-hidden="true" tabindex="-1"></a><span class="ot">      id</span><span class="op">=</span><span class="st">&quot;aiResponse&quot;</span></span>
<span id="cb308-72"><a href="#cb308-72" aria-hidden="true" tabindex="-1"></a><span class="ot">      class</span><span class="op">=</span><span class="st">&quot;bg-gray-50 border-l-4 border-primary rounded-lg p-4 text-sm leading-relaxed text-gray-700&quot;</span></span>
<span id="cb308-73"><a href="#cb308-73" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;</span></span>
<span id="cb308-74"><a href="#cb308-74" aria-hidden="true" tabindex="-1"></a>      명령을 입력하고 실행 버튼을 눌러주세요.</span>
<span id="cb308-75"><a href="#cb308-75" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb308-76"><a href="#cb308-76" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb308-77"><a href="#cb308-77" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Tailwind 상태별 스타일</strong>:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 로딩 중</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 성공</span></span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;bg-green-50 border-l-4 border-green-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a><span class="co">// 오류</span></span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;bg-red-50 border-l-4 border-red-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="실습-2-openai-api-통합">💻 실습 2: OpenAI API 통합</h2>
<h3 id="ai-명령-처리-함수">AI 명령 처리 함수</h3>
<div class="sourceCode" id="cb310"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OpenAI API 호출</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">sendAICommand</span>() {</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputEl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;aiCommand&quot;</span>)<span class="op">;</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> userCommand <span class="op">=</span> inputEl<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>userCommand) {</span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alert</span>(<span class="st">&quot;명령을 입력해주세요!&quot;</span>)<span class="op">;</span></span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb310-10"><a href="#cb310-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-11"><a href="#cb310-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> responseEl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;aiResponse&quot;</span>)<span class="op">;</span></span>
<span id="cb310-12"><a href="#cb310-12" aria-hidden="true" tabindex="-1"></a>  responseEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&quot;🤔 AI가 명령을 분석 중...&quot;</span><span class="op">;</span></span>
<span id="cb310-13"><a href="#cb310-13" aria-hidden="true" tabindex="-1"></a>  responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb310-14"><a href="#cb310-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span>
<span id="cb310-15"><a href="#cb310-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-16"><a href="#cb310-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLog</span>(<span class="vs">`AI 명령: </span><span class="sc">${</span>userCommand<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb310-17"><a href="#cb310-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-18"><a href="#cb310-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb310-19"><a href="#cb310-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ledCommand <span class="op">=</span> <span class="cf">await</span> <span class="fu">analyzeLEDCommand</span>(userCommand)<span class="op">;</span></span>
<span id="cb310-20"><a href="#cb310-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-21"><a href="#cb310-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ledCommand) {</span>
<span id="cb310-22"><a href="#cb310-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sendLEDCommandFromAI</span>(ledCommand)<span class="op">;</span></span>
<span id="cb310-23"><a href="#cb310-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-24"><a href="#cb310-24" aria-hidden="true" tabindex="-1"></a>      responseEl<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb310-25"><a href="#cb310-25" aria-hidden="true" tabindex="-1"></a><span class="vs">                ✅ &lt;strong&gt;명령 이해:&lt;/strong&gt; </span><span class="sc">${</span>ledCommand<span class="op">.</span><span class="at">description</span><span class="sc">}</span><span class="vs">&lt;br&gt;</span></span>
<span id="cb310-26"><a href="#cb310-26" aria-hidden="true" tabindex="-1"></a><span class="vs">                📤 &lt;strong&gt;실행:&lt;/strong&gt; </span><span class="sc">${</span>ledCommand<span class="op">.</span><span class="at">action</span><span class="sc">}</span></span>
<span id="cb310-27"><a href="#cb310-27" aria-hidden="true" tabindex="-1"></a><span class="vs">            `</span><span class="op">;</span></span>
<span id="cb310-28"><a href="#cb310-28" aria-hidden="true" tabindex="-1"></a>      responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb310-29"><a href="#cb310-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;bg-green-50 border-l-4 border-green-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span>
<span id="cb310-30"><a href="#cb310-30" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb310-31"><a href="#cb310-31" aria-hidden="true" tabindex="-1"></a>      responseEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&quot;❌ 명령을 이해하지 못했습니다.&quot;</span><span class="op">;</span></span>
<span id="cb310-32"><a href="#cb310-32" aria-hidden="true" tabindex="-1"></a>      responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb310-33"><a href="#cb310-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;bg-red-50 border-l-4 border-red-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span>
<span id="cb310-34"><a href="#cb310-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb310-35"><a href="#cb310-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb310-36"><a href="#cb310-36" aria-hidden="true" tabindex="-1"></a>    responseEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&quot;❌ AI 처리 중 오류: &quot;</span> <span class="op">+</span> error<span class="op">.</span><span class="at">message</span><span class="op">;</span></span>
<span id="cb310-37"><a href="#cb310-37" aria-hidden="true" tabindex="-1"></a>    responseEl<span class="op">.</span><span class="at">className</span> <span class="op">=</span></span>
<span id="cb310-38"><a href="#cb310-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;bg-red-50 border-l-4 border-red-400 rounded-lg p-4 text-sm leading-relaxed&quot;</span><span class="op">;</span></span>
<span id="cb310-39"><a href="#cb310-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb310-40"><a href="#cb310-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-41"><a href="#cb310-41" aria-hidden="true" tabindex="-1"></a>  inputEl<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb310-42"><a href="#cb310-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb310-43"><a href="#cb310-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-44"><a href="#cb310-44" aria-hidden="true" tabindex="-1"></a><span class="co">// OpenAI API로 명령 분석</span></span>
<span id="cb310-45"><a href="#cb310-45" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">analyzeLEDCommand</span>(userCommand) {</span>
<span id="cb310-46"><a href="#cb310-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prompt <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb310-47"><a href="#cb310-47" aria-hidden="true" tabindex="-1"></a><span class="vs">다음 사용자 명령을 LED 제어 명령으로 변환하세요.</span></span>
<span id="cb310-48"><a href="#cb310-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-49"><a href="#cb310-49" aria-hidden="true" tabindex="-1"></a><span class="vs">사용자 명령: &quot;</span><span class="sc">${</span>userCommand<span class="sc">}</span><span class="vs">&quot;</span></span>
<span id="cb310-50"><a href="#cb310-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-51"><a href="#cb310-51" aria-hidden="true" tabindex="-1"></a><span class="vs">LED 옵션:</span></span>
<span id="cb310-52"><a href="#cb310-52" aria-hidden="true" tabindex="-1"></a><span class="vs">- 색상: red(255,0,0), green(0,255,0), blue(0,0,255), yellow(255,255,0), purple(255,0,255), cyan(0,255,255), white(255,255,255)</span></span>
<span id="cb310-53"><a href="#cb310-53" aria-hidden="true" tabindex="-1"></a><span class="vs">- 패턴: solid(단색), blink(깜빡임), pulse(펄스)</span></span>
<span id="cb310-54"><a href="#cb310-54" aria-hidden="true" tabindex="-1"></a><span class="vs">- 밝기: 10-100%</span></span>
<span id="cb310-55"><a href="#cb310-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-56"><a href="#cb310-56" aria-hidden="true" tabindex="-1"></a><span class="vs">JSON만 출력:</span></span>
<span id="cb310-57"><a href="#cb310-57" aria-hidden="true" tabindex="-1"></a><span class="vs">{&quot;action&quot;: &quot;led_color&quot;, &quot;color&quot;: [R,G,B], &quot;pattern&quot;: &quot;solid&quot;, &quot;brightness&quot;: 80, &quot;description&quot;: &quot;설명&quot;}</span></span>
<span id="cb310-58"><a href="#cb310-58" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb310-59"><a href="#cb310-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-60"><a href="#cb310-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb310-61"><a href="#cb310-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 백엔드 서버 사용 (권장)</span></span>
<span id="cb310-62"><a href="#cb310-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&quot;http://localhost:5000/api/analyze-command&quot;</span><span class="op">,</span> {</span>
<span id="cb310-63"><a href="#cb310-63" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;POST&quot;</span><span class="op">,</span></span>
<span id="cb310-64"><a href="#cb310-64" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;application/json&quot;</span> }<span class="op">,</span></span>
<span id="cb310-65"><a href="#cb310-65" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ <span class="dt">command</span><span class="op">:</span> userCommand })<span class="op">,</span></span>
<span id="cb310-66"><a href="#cb310-66" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb310-67"><a href="#cb310-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-68"><a href="#cb310-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&quot;서버 오류&quot;</span>)<span class="op">;</span></span>
<span id="cb310-69"><a href="#cb310-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb310-70"><a href="#cb310-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb310-71"><a href="#cb310-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;AI 오류:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb310-72"><a href="#cb310-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> error<span class="op">;</span></span>
<span id="cb310-73"><a href="#cb310-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb310-74"><a href="#cb310-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb310-75"><a href="#cb310-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-76"><a href="#cb310-76" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sendLEDCommandFromAI</span>(aiCommand) {</span>
<span id="cb310-77"><a href="#cb310-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (aiCommand<span class="op">.</span><span class="at">action</span> <span class="op">===</span> <span class="st">&quot;led_off&quot;</span>) {</span>
<span id="cb310-78"><a href="#cb310-78" aria-hidden="true" tabindex="-1"></a>    client<span class="op">.</span><span class="fu">publish</span>(TOPIC_CONTROL<span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ <span class="dt">action</span><span class="op">:</span> <span class="st">&quot;led_off&quot;</span> }))<span class="op">;</span></span>
<span id="cb310-79"><a href="#cb310-79" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb310-80"><a href="#cb310-80" aria-hidden="true" tabindex="-1"></a>    client<span class="op">.</span><span class="fu">publish</span>(TOPIC_CONTROL<span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(aiCommand))<span class="op">;</span></span>
<span id="cb310-81"><a href="#cb310-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb310-82"><a href="#cb310-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb310-83"><a href="#cb310-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-84"><a href="#cb310-84" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setAIExample</span>(example) {</span>
<span id="cb310-85"><a href="#cb310-85" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;aiCommand&quot;</span>)<span class="op">.</span><span class="at">value</span> <span class="op">=</span> example<span class="op">;</span></span>
<span id="cb310-86"><a href="#cb310-86" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="실습-3-python-백엔드-서버">💻 실습 3: Python 백엔드 서버</h2>
<h3 id="flask-서버-권장">Flask 서버 (권장)</h3>
<p><strong>파일명</strong>: <code>ai_server.py</code> (이미
<code>code/python/ch26_ai_server.py</code>에 있음)</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask, request, jsonify</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_cors <span class="im">import</span> CORS</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>CORS(app)</span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-9"><a href="#cb311-9" aria-hidden="true" tabindex="-1"></a>openai_client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb311-10"><a href="#cb311-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-11"><a href="#cb311-11" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/analyze-command&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;POST&#39;</span>])</span>
<span id="cb311-12"><a href="#cb311-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_command():</span>
<span id="cb311-13"><a href="#cb311-13" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> request.json</span>
<span id="cb311-14"><a href="#cb311-14" aria-hidden="true" tabindex="-1"></a>    user_command <span class="op">=</span> data.get(<span class="st">&#39;command&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb311-15"><a href="#cb311-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-16"><a href="#cb311-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user_command:</span>
<span id="cb311-17"><a href="#cb311-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;No command&#39;</span>}), <span class="dv">400</span></span>
<span id="cb311-18"><a href="#cb311-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-19"><a href="#cb311-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb311-20"><a href="#cb311-20" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb311-21"><a href="#cb311-21" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,</span>
<span id="cb311-22"><a href="#cb311-22" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb311-23"><a href="#cb311-23" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;LED 제어 명령 변환 전문가. JSON만 출력.&quot;</span>},</span>
<span id="cb311-24"><a href="#cb311-24" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;명령: </span><span class="sc">{</span>user_command<span class="sc">}</span><span class="ss">&quot;</span>}</span>
<span id="cb311-25"><a href="#cb311-25" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb311-26"><a href="#cb311-26" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb311-27"><a href="#cb311-27" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb311-28"><a href="#cb311-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb311-29"><a href="#cb311-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-30"><a href="#cb311-30" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb311-31"><a href="#cb311-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;```&#39;</span> <span class="kw">in</span> content:</span>
<span id="cb311-32"><a href="#cb311-32" aria-hidden="true" tabindex="-1"></a>            content <span class="op">=</span> content.split(<span class="st">&#39;```&#39;</span>)[<span class="dv">1</span>].replace(<span class="st">&#39;json&#39;</span>, <span class="st">&#39;&#39;</span>).strip()</span>
<span id="cb311-33"><a href="#cb311-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-34"><a href="#cb311-34" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> json</span>
<span id="cb311-35"><a href="#cb311-35" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> json.loads(content)</span>
<span id="cb311-36"><a href="#cb311-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify(command)</span>
<span id="cb311-37"><a href="#cb311-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-38"><a href="#cb311-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb311-39"><a href="#cb311-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="bu">str</span>(e)}), <span class="dv">500</span></span>
<span id="cb311-40"><a href="#cb311-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-41"><a href="#cb311-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb311-42"><a href="#cb311-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;🚀 AI 서버 시작...&quot;</span>)</span>
<span id="cb311-43"><a href="#cb311-43" aria-hidden="true" tabindex="-1"></a>    app.run(host<span class="op">=</span><span class="st">&#39;0.0.0.0&#39;</span>, port<span class="op">=</span><span class="dv">5000</span>)</span></code></pre></div>
<p><strong>실행</strong>:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 환경 변수 설정</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">OPENAI_API_KEY</span><span class="op">=</span><span class="st">&quot;sk-proj-YOUR_KEY&quot;</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 서버 실행</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> ai_server.py</span></code></pre></div>
<hr />
<h2 id="핵심-정리-14">📝 핵심 정리</h2>
<h3 id="ai-제어-흐름">AI 제어 흐름</h3>
<pre><code>1. 사용자 입력 (자연어)
   ↓
2. Python 서버로 전송
   ↓
3. OpenAI API 분석
   ↓
4. JSON 명령 생성
   ↓
5. MQTT Publish
   ↓
6. 헥사보드 실행</code></pre>
<h3 id="tailwind-css-ai-컴포넌트">Tailwind CSS AI 컴포넌트</h3>
<table>
<thead>
<tr>
<th>컴포넌트</th>
<th>클래스</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>입력창</strong></td>
<td><code>flex-1 px-4 py-3 border-2 focus:border-primary</code></td>
</tr>
<tr>
<td><strong>실행 버튼</strong></td>
<td><code>bg-primary hover:-translate-y-0.5</code></td>
</tr>
<tr>
<td><strong>예시 버튼</strong></td>
<td><code>bg-gray-100 hover:bg-gray-200</code></td>
</tr>
<tr>
<td><strong>응답 (로딩)</strong></td>
<td><code>bg-yellow-50 border-l-4 border-yellow-400</code></td>
</tr>
<tr>
<td><strong>응답 (성공)</strong></td>
<td><code>bg-green-50 border-l-4 border-green-400</code></td>
</tr>
<tr>
<td><strong>응답 (오류)</strong></td>
<td><code>bg-red-50 border-l-4 border-red-400</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="part-7-완료">🎉 PART 7 완료!</h2>
<h3 id="완성한-것들">완성한 것들</h3>
<ul>
<li>✅ 웹 센서 모니터링 (Tailwind CSS)</li>
<li>✅ 웹 수동 제어 (Tailwind CSS)</li>
<li>✅ 웹 AI 제어 (Tailwind CSS)</li>
<li>✅ Python 백엔드 서버</li>
</ul>
<h3 id="최종-대시보드-기능">최종 대시보드 기능</h3>
<ol type="1">
<li><strong>실시간 센서 모니터링</strong></li>
<li><strong>수동 LED 제어</strong> (색상, 밝기, 패턴)</li>
<li><strong>AI 자연어 제어</strong> (GPT 기반)</li>
<li><strong>양방향 통신</strong> (MQTT)</li>
<li><strong>반응형 UI</strong> (Tailwind CSS)</li>
<li><strong>안전한 API</strong> (Python 백엔드)</li>
</ol>
<hr />
<h2 id="다음-단계-16">🚀 다음 단계</h2>
<p>완전한 AIoT 웹 대시보드 완성!</p>
<p><strong>PART 8에서는</strong>:</p>
<ul>
<li>교육 커리큘럼 설계</li>
<li>미션 기반 실습</li>
<li>확장 아이디어</li>
</ul>
<hr />
<p><strong>🎉 Chapter 26 완료!</strong><br />
<strong>🎉 PART 7 완료!</strong></p>
<p>Tailwind CSS로 완전한 AIoT 웹 대시보드가 완성되었습니다!</p>
<h1 id="chapter-27.-교육-커리큘럼-설계-가이드">Chapter 27. 교육 커리큘럼
설계 가이드</h1>
<blockquote>
<p><strong>PART 8</strong>: 수업 설계와 확장 아이디어</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-26">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>효과적인 AIoT 교육 커리큘럼을 설계할
수 있다</label></li>
<li><label><input type="checkbox"></input>학습자 수준별 교육 계획을 세울 수
있다</label></li>
<li><label><input type="checkbox"></input>수업 운영 팁을 이해할 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 20분</p>
<hr />
<h2 id="학습-목표-26">🎯 학습 목표</h2>
<h3 id="aiot-교육의-핵심">AIoT 교육의 핵심</h3>
<p><strong>실습 중심 + 프로젝트 기반 학습으로 실전 능력
향상</strong></p>
<pre><code>이론 (20%) + 실습 (50%) + 프로젝트 (30%) = 완성도 높은 학습</code></pre>
<hr />
<h2 id="커리큘럼-구조">📋 커리큘럼 구조</h2>
<h3 id="기본-20시간-코스-전체">기본 20시간 코스 (전체)</h3>
<table>
<thead>
<tr>
<th>주차</th>
<th>PART</th>
<th>주제</th>
<th>시간</th>
<th>난이도</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1주</strong></td>
<td>PART 1-2</td>
<td>기초 &amp; 기본 제어</td>
<td>4시간</td>
<td>⭐</td>
</tr>
<tr>
<td><strong>2주</strong></td>
<td>PART 3</td>
<td>센서 &amp; 데이터</td>
<td>3시간</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>3주</strong></td>
<td>PART 4</td>
<td>MQTT 통신</td>
<td>3.5시간</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>4주</strong></td>
<td>PART 5</td>
<td>Python AI</td>
<td>4시간</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>5주</strong></td>
<td>PART 6</td>
<td>종합 프로젝트</td>
<td>3.5시간</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>6주</strong></td>
<td>PART 7</td>
<td>웹 대시보드</td>
<td>1.5시간</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>7주</strong></td>
<td>PART 8</td>
<td>최종 프로젝트</td>
<td>0.5시간</td>
<td>⭐</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="수준별-커리큘럼">👥 수준별 커리큘럼</h2>
<h3 id="초급-코스-10시간">1. 초급 코스 (10시간)</h3>
<p><strong>대상</strong>: 프로그래밍 경험 없음, 중고등학생</p>
<p><strong>목표</strong>: 헥사보드로 센서 제어 및 MQTT 기초</p>
<p><strong>커리큘럼</strong>:</p>
<table>
<thead>
<tr>
<th>회차</th>
<th>내용</th>
<th>시간</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1회</strong></td>
<td>헥사보드 소개 + 첫 프로그램</td>
<td>1.5시간</td>
</tr>
<tr>
<td><strong>2회</strong></td>
<td>버튼과 LED 제어</td>
<td>2시간</td>
</tr>
<tr>
<td><strong>3회</strong></td>
<td>온습도 센서 연결</td>
<td>1.5시간</td>
</tr>
<tr>
<td><strong>4회</strong></td>
<td>MQTT 기초 (데이터 보내기)</td>
<td>2시간</td>
</tr>
<tr>
<td><strong>5회</strong></td>
<td>간단한 환경 모니터 만들기</td>
<td>3시간</td>
</tr>
</tbody>
</table>
<p><strong>제외 항목</strong>:</p>
<ul>
<li>Python AI 서버</li>
<li>웹 대시보드</li>
<li>고급 프로젝트</li>
</ul>
<h3 id="중급-코스-15시간">2. 중급 코스 (15시간)</h3>
<p><strong>대상</strong>: 기본 프로그래밍 경험, 대학생/일반인</p>
<p><strong>목표</strong>: AIoT 시스템 구축 및 Python 활용</p>
<p><strong>커리큘럼</strong>:</p>
<table>
<thead>
<tr>
<th>회차</th>
<th>내용</th>
<th>시간</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1-2회</strong></td>
<td>헥사보드 기초 + 센서</td>
<td>4시간</td>
</tr>
<tr>
<td><strong>3-4회</strong></td>
<td>MQTT 통신 구축</td>
<td>4시간</td>
</tr>
<tr>
<td><strong>5-6회</strong></td>
<td>Python AI 서버</td>
<td>4시간</td>
</tr>
<tr>
<td><strong>7회</strong></td>
<td>웹 모니터링 기초</td>
<td>2시간</td>
</tr>
<tr>
<td><strong>8회</strong></td>
<td>미니 프로젝트 발표</td>
<td>1시간</td>
</tr>
</tbody>
</table>
<h3 id="고급-코스-20시간">3. 고급 코스 (20시간)</h3>
<p><strong>대상</strong>: 개발 경험자, 교육자, 전문가</p>
<p><strong>목표</strong>: 완전한 AIoT 시스템 + 확장 가능</p>
<p><strong>커리큘럼</strong>: 전체 PART 1~8 + 심화 프로젝트</p>
<hr />
<h2 id="수업-운영-전략">📅 수업 운영 전략</h2>
<h3 id="수업-구조-2시간-기준">수업 구조 (2시간 기준)</h3>
<pre><code>10분: 지난 시간 복습
20분: 이론 및 개념 설명
60분: 실습 (따라하기)
20분: 도전 과제 (응용)
10분: 질의응답 및 다음 예고</code></pre>
<h3 id="효과적인-티칭-팁">효과적인 티칭 팁</h3>
<p><strong>1. 실습 중심</strong></p>
<ul>
<li>✅ 모든 개념을 즉시 코드로 실습</li>
<li>✅ 작은 성공 경험 누적 (LED 켜기 → 센서 읽기 → …)</li>
<li>✅ 오류도 학습의 일부 (디버깅 경험)</li>
</ul>
<p><strong>2. 페어 프로그래밍</strong></p>
<ul>
<li>2명이 1조로 협력</li>
<li>역할 교대 (드라이버 ↔︎ 네비게이터)</li>
<li>서로 가르치며 학습</li>
</ul>
<p><strong>3. 프로젝트 기반</strong></p>
<ul>
<li>실습마다 작은 목표 설정</li>
<li>최종 프로젝트로 통합</li>
<li>발표 및 공유 시간</li>
</ul>
<p><strong>4. 문제 해결 중심</strong></p>
<ul>
<li>“왜 안 될까?” 질문 유도</li>
<li>스스로 해결 방법 찾기</li>
<li>구글링 및 문서 읽기 연습</li>
</ul>
<hr />
<h2 id="수업-준비물">🛠️ 수업 준비물</h2>
<h3 id="하드웨어-학생-1인당">하드웨어 (학생 1인당)</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>헥사보드 × 1</label></li>
<li><label><input type="checkbox" checked></input>DHT11 센서 모듈 ×
1</label></li>
<li><label><input type="checkbox" checked></input>조도 센서 모듈 ×
1</label></li>
<li><label><input type="checkbox" checked></input>3핀 케이블 ×
2</label></li>
<li><label><input type="checkbox" checked></input>USB 케이블 ×
1</label></li>
</ul>
<h3 id="소프트웨어-2">소프트웨어</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>Thonny IDE
(MicroPython)</label></li>
<li><label><input type="checkbox" checked></input>Python 3.10+ (AI
서버용)</label></li>
<li><label><input type="checkbox" checked></input>웹 브라우저
(대시보드용)</label></li>
<li><label><input type="checkbox" checked></input>HiveMQ Cloud 계정
(무료)</label></li>
<li><label><input type="checkbox" checked></input>OpenAI API 키
(선택)</label></li>
</ul>
<h3 id="기타-준비물">기타 준비물</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked></input>와이파이
환경</label></li>
<li><label><input type="checkbox" checked></input>프로젝터 / 화면
공유</label></li>
<li><label><input type="checkbox" checked></input>예제 코드 USB 또는
공유</label></li>
<li><label><input type="checkbox" checked></input>문제 해결
가이드</label></li>
</ul>
<hr />
<h2 id="수업별-상세-계획">📖 수업별 상세 계획</h2>
<h3 id="week-1-헥사보드-시작하기">Week 1: 헥사보드 시작하기</h3>
<p><strong>목표</strong>: 헥사보드 제어 기초</p>
<p><strong>주요 활동</strong>:</p>
<ol type="1">
<li>헥사보드 소개 및 연결</li>
<li>Thonny 설치 및 설정</li>
<li>LED 깜빡이기 (Hello World)</li>
<li>버튼으로 LED 제어</li>
</ol>
<p><strong>도전 과제</strong>:</p>
<ul>
<li>버튼으로 색상 변경 게임 만들기</li>
</ul>
<h3 id="week-2-센서-데이터-다루기">Week 2: 센서 데이터 다루기</h3>
<p><strong>목표</strong>: 센서 값 읽고 처리하기</p>
<p><strong>주요 활동</strong>:</p>
<ol type="1">
<li>DHT11 온습도 센서 연결</li>
<li>센서 데이터 읽기</li>
<li>LED로 온도 시각화</li>
<li>데이터 저장 및 통계</li>
</ol>
<p><strong>도전 과제</strong>:</p>
<ul>
<li>온도 경보 시스템 만들기</li>
</ul>
<h3 id="week-3-mqtt로-연결하기">Week 3: MQTT로 연결하기</h3>
<p><strong>목표</strong>: IoT 통신 기초</p>
<p><strong>주요 활동</strong>:</p>
<ol type="1">
<li>MQTT 개념 이해</li>
<li>HiveMQ Cloud 설정</li>
<li>센서 데이터 전송</li>
<li>여러 보드 연동</li>
</ol>
<p><strong>도전 과제</strong>:</p>
<ul>
<li>친구 보드와 데이터 주고받기</li>
</ul>
<h3 id="week-4-ai-통합하기">Week 4: AI 통합하기</h3>
<p><strong>목표</strong>: AI로 데이터 분석</p>
<p><strong>주요 활동</strong>:</p>
<ol type="1">
<li>Python 서버 만들기</li>
<li>OpenAI API 연동</li>
<li>센서 데이터 AI 분석</li>
<li>자동 제어 구현</li>
</ol>
<p><strong>도전 과제</strong>:</p>
<ul>
<li>AI 추천 시스템 만들기</li>
</ul>
<h3 id="week-5-종합-프로젝트">Week 5: 종합 프로젝트</h3>
<p><strong>목표</strong>: 완전한 시스템 구축</p>
<p><strong>주요 활동</strong>:</p>
<ol type="1">
<li>프로젝트 기획</li>
<li>시스템 통합</li>
<li>테스트 및 디버깅</li>
<li>최종 발표 준비</li>
</ol>
<hr />
<h2 id="평가-방법">🎓 평가 방법</h2>
<h3 id="평가-기준">평가 기준</h3>
<table>
<thead>
<tr>
<th>항목</th>
<th>비율</th>
<th>평가 방법</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>출석 및 참여</strong></td>
<td>20%</td>
<td>수업 참여도</td>
</tr>
<tr>
<td><strong>실습 과제</strong></td>
<td>30%</td>
<td>주차별 도전 과제</td>
</tr>
<tr>
<td><strong>최종 프로젝트</strong></td>
<td>40%</td>
<td>완성도 + 창의성</td>
</tr>
<tr>
<td><strong>발표</strong></td>
<td>10%</td>
<td>프레젠테이션</td>
</tr>
</tbody>
</table>
<h3 id="실습-과제-체크리스트">실습 과제 체크리스트</h3>
<p><strong>기본 (필수)</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>코드가 정상 작동함</label></li>
<li><label><input type="checkbox"></input>주요 기능 구현</label></li>
<li><label><input type="checkbox"></input>기본 오류 처리</label></li>
</ul>
<p><strong>중급</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>코드 주석 작성</label></li>
<li><label><input type="checkbox"></input>추가 기능 구현</label></li>
<li><label><input type="checkbox"></input>사용자 친화적</label></li>
</ul>
<p><strong>고급</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>창의적 확장</label></li>
<li><label><input type="checkbox"></input>최적화</label></li>
<li><label><input type="checkbox"></input>문서화</label></li>
</ul>
<hr />
<h2 id="교육자를-위한-팁">💡 교육자를 위한 팁</h2>
<h3 id="자주-발생하는-문제와-해결">자주 발생하는 문제와 해결</h3>
<p><strong>1. Wi-Fi 연결 안 됨</strong></p>
<ul>
<li>미리 Wi-Fi 정보 공유</li>
<li>핫스팟 백업 준비</li>
<li>연결 테스트 시간 확보</li>
</ul>
<p><strong>2. 코드 오류</strong></p>
<ul>
<li>일반적인 오류 목록 준비</li>
<li>페어로 서로 확인하게 함</li>
<li>“5분 법칙” (5분 혼자 시도 후 질문)</li>
</ul>
<p><strong>3. 진도 차이</strong></p>
<ul>
<li>빠른 학생: 도전 과제 제공</li>
<li>느린 학생: 페어 매칭</li>
<li>핵심만 완성해도 성공!</li>
</ul>
<h3 id="온라인-수업-팁">온라인 수업 팁</h3>
<ul>
<li>🎥 <strong>화면 공유</strong>: 코드 실시간 작성</li>
<li>💬 <strong>채팅 활용</strong>: 질문 및 코드 공유</li>
<li>📹 <strong>녹화</strong>: 복습 자료 제공</li>
<li>🖥️ <strong>브레이크아웃 룸</strong>: 팀 활동</li>
</ul>
<hr />
<h2 id="추가-학습-자료">📚 추가 학습 자료</h2>
<h3 id="추천-순서">추천 순서</h3>
<ol type="1">
<li><p><strong>공식 문서</strong></p>
<ul>
<li>MicroPython 문서</li>
<li>MQTT.org</li>
<li>OpenAI API 문서</li>
</ul></li>
<li><p><strong>온라인 리소스</strong></p>
<ul>
<li>YouTube 튜토리얼</li>
<li>GitHub 예제</li>
<li>커뮤니티 포럼</li>
</ul></li>
<li><p><strong>프로젝트 아이디어</strong></p>
<ul>
<li>Hackster.io</li>
<li>Instructables</li>
<li>Medium 블로그</li>
</ul></li>
</ol>
<hr />
<h2 id="학습-성과-목표">🎯 학습 성과 목표</h2>
<h3 id="코스-완료-후-학생은">코스 완료 후 학생은…</h3>
<p><strong>기술적 역량</strong>:</p>
<ul>
<li>✅ MicroPython으로 하드웨어 제어</li>
<li>✅ 센서 데이터 수집 및 처리</li>
<li>✅ MQTT로 IoT 통신 구현</li>
<li>✅ Python으로 AI 서버 구축</li>
<li>✅ 웹 대시보드 제작</li>
</ul>
<p><strong>문제 해결 능력</strong>:</p>
<ul>
<li>✅ 오류 디버깅</li>
<li>✅ 문서 읽고 활용</li>
<li>✅ 구글링으로 해결책 찾기</li>
</ul>
<p><strong>프로젝트 능력</strong>:</p>
<ul>
<li>✅ 요구사항 분석</li>
<li>✅ 시스템 설계</li>
<li>✅ 단계별 구현</li>
<li>✅ 테스트 및 개선</li>
</ul>
<hr />
<h2 id="핵심-정리-15">📝 핵심 정리</h2>
<h3 id="성공적인-aiot-교육의-원칙">성공적인 AIoT 교육의 원칙</h3>
<ol type="1">
<li><strong>실습 중심</strong>: 이론 &lt; 코딩</li>
<li><strong>작은 성공</strong>: 단계적 성취감</li>
<li><strong>프로젝트 기반</strong>: 실제 문제 해결</li>
<li><strong>협력 학습</strong>: 페어/팀 활동</li>
<li><strong>재미</strong>: 게임화, 경쟁, 발표</li>
</ol>
<h3 id="교육자-마인드셋">교육자 마인드셋</h3>
<ul>
<li>“완벽보다 완성”</li>
<li>“오류는 학습의 기회”</li>
<li>“질문을 환영”</li>
<li>“창의성 격려”</li>
</ul>
<hr />
<h2 id="자주-묻는-질문-16">❓ 자주 묻는 질문</h2>
<h3 id="q1.-비전공자도-가능한가요">Q1. 비전공자도 가능한가요?</h3>
<p><strong>A</strong>: 네! 기초부터 단계별로 진행하므로 누구나
가능합니다.</p>
<h3 id="q2.-온라인으로도-진행-가능한가요">Q2. 온라인으로도 진행
가능한가요?</h3>
<p><strong>A</strong>: 가능합니다. 하드웨어 키트를 미리 배송하고 화면
공유로 진행하세요.</p>
<h3 id="q3.-몇-명이-적정한가요">Q3. 몇 명이 적정한가요?</h3>
<p><strong>A</strong>: 오프라인 10-15명, 온라인 20-25명이
적정합니다.</p>
<hr />
<h2 id="다음-단계-17">🚀 다음 단계</h2>
<p>교육 커리큘럼 설계 완료!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>미션 기반 실습 과제</li>
<li>평가 기준 및 루브릭</li>
<li>프로젝트 아이디어</li>
</ul>
<hr />
<p><strong>🎉 Chapter 27 완료!</strong><br />
효과적인 AIoT 교육을 위한 가이드가 준비되었습니다!</p>
<h1 id="chapter-28.-미션-기반-실습-및-평가-설계">Chapter 28. 미션 기반
실습 및 평가 설계</h1>
<blockquote>
<p><strong>PART 8</strong>: 수업 설계와 확장 아이디어</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-27">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>미션 기반 학습의 효과를 이해할 수
있다</label></li>
<li><label><input type="checkbox"></input>단계별 실습 미션을 설계할 수
있다</label></li>
<li><label><input type="checkbox"></input>효과적인 평가 기준을 만들 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 20분</p>
<hr />
<h2 id="학습-목표-27">🎯 학습 목표</h2>
<h3 id="미션-기반-학습이란">미션 기반 학습이란?</h3>
<p><strong>게임처럼 단계별 미션을 수행하며 자연스럽게 학습</strong></p>
<pre><code>미션 제시 → 도전 → 성공 → 보상(피드백) → 다음 미션</code></pre>
<p><strong>장점</strong>:</p>
<ul>
<li>✅ 명확한 목표</li>
<li>✅ 자기주도 학습</li>
<li>✅ 성취감</li>
<li>✅ 재미</li>
</ul>
<hr />
<h2 id="레벨별-미션-설계">🎮 레벨별 미션 설계</h2>
<h3 id="level-1-헥사보드-마스터-기초">Level 1: 헥사보드 마스터
(기초)</h3>
<h4 id="mission-1-1-led-깜빡이기">Mission 1-1: LED 깜빡이기</h4>
<p><strong>목표</strong>: 첫 프로그램 실행</p>
<p><strong>미션</strong>:</p>
<pre><code>1. LED를 1초 간격으로 빨간색으로 깜빡이게 하세요
2. 버튼을 누르면 멈추게 하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li><code>time.sleep(1)</code> 사용</li>
<li>버튼 상태 확인</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>LED 깜빡임</label></li>
<li><label><input type="checkbox"></input>버튼으로 정지</label></li>
<li><label><input type="checkbox"></input>코드에 주석</label></li>
</ul>
<p><strong>예상 시간</strong>: 15분</p>
<hr />
<h4 id="mission-1-2-색상-순환">Mission 1-2: 색상 순환</h4>
<p><strong>목표</strong>: 반복문과 색상 제어</p>
<p><strong>미션</strong>:</p>
<pre><code>버튼을 누를 때마다 LED 색상이 변경되게 하세요
빨강 → 초록 → 파랑 → 빨강 (순환)</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>상태 변수 사용</li>
<li>리스트로 색상 관리</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>색상 순환</label></li>
<li><label><input type="checkbox"></input>버튼 한 번 누르면 한 번만
변경</label></li>
<li><label><input type="checkbox"></input>순환 구조</label></li>
</ul>
<p><strong>예상 시간</strong>: 20분</p>
<hr />
<h4 id="mission-1-3-반응속도-게임">Mission 1-3: 반응속도 게임</h4>
<p><strong>목표</strong>: 타이밍과 입력 처리</p>
<p><strong>미션</strong>:</p>
<pre><code>1. LED가 무작위 시간 후 초록색으로 켜짐
2. 사용자가 버튼을 누름
3. 반응 시간을 시리얼로 출력</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li><code>time.ticks_ms()</code> 사용</li>
<li><code>random.randint()</code> 사용</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>무작위 대기</label></li>
<li><label><input type="checkbox"></input>반응 시간 측정</label></li>
<li><label><input type="checkbox"></input>결과 출력</label></li>
</ul>
<p><strong>예상 시간</strong>: 25분</p>
<hr />
<h3 id="level-2-센서-전문가-중급">Level 2: 센서 전문가 (중급)</h3>
<h4 id="mission-2-1-환경-모니터">Mission 2-1: 환경 모니터</h4>
<p><strong>목표</strong>: 센서 데이터 수집</p>
<p><strong>미션</strong>:</p>
<pre><code>온도, 습도를 1분마다 측정하여 리스트에 저장하고
평균값을 계산하여 출력하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>리스트에 <code>append()</code></li>
<li><code>sum()</code> / <code>len()</code> 사용</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>센서 데이터 수집</label></li>
<li><label><input type="checkbox"></input>리스트 저장</label></li>
<li><label><input type="checkbox"></input>평균 계산</label></li>
</ul>
<p><strong>예상 시간</strong>: 30분</p>
<hr />
<h4 id="mission-2-2-온도-경보-시스템">Mission 2-2: 온도 경보 시스템</h4>
<p><strong>목표</strong>: 조건문과 시각화</p>
<p><strong>미션</strong>:</p>
<pre><code>온도가 25도 이상이면 빨간색 LED
20~25도는 초록색
20도 미만은 파란색으로 표시</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li><code>if-elif-else</code> 사용</li>
<li>LED 색상 매핑</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>온도 범위별 색상</label></li>
<li><label><input type="checkbox"></input>실시간 업데이트</label></li>
<li><label><input type="checkbox"></input>부드러운 색상 전환</label></li>
</ul>
<p><strong>예상 시간</strong>: 30분</p>
<hr />
<h4 id="mission-2-3-데이터-로거">Mission 2-3: 데이터 로거</h4>
<p><strong>목표</strong>: 데이터 저장 및 분석</p>
<p><strong>미션</strong>:</p>
<pre><code>10분간 온도, 습도를 10초마다 측정하여
최대/최소/평균값을 출력하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li><code>max()</code>, <code>min()</code> 함수</li>
<li>타임스탬프 기록</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>주기적 측정</label></li>
<li><label><input type="checkbox"></input>통계 계산</label></li>
<li><label><input type="checkbox"></input>타임스탬프</label></li>
</ul>
<p><strong>예상 시간</strong>: 35분</p>
<hr />
<h3 id="level-3-iot-통신-마스터-고급">Level 3: IoT 통신 마스터
(고급)</h3>
<h4 id="mission-3-1-mqtt-데이터-송신">Mission 3-1: MQTT 데이터 송신</h4>
<p><strong>목표</strong>: 기본 MQTT 통신</p>
<p><strong>미션</strong>:</p>
<pre><code>센서 데이터를 JSON 형식으로
MQTT 브로커에 30초마다 전송하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li><code>ujson.dumps()</code> 사용</li>
<li>Topic: <code>hexaboard/YOUR_ID/data</code></li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>Wi-Fi 연결</label></li>
<li><label><input type="checkbox"></input>MQTT 연결</label></li>
<li><label><input type="checkbox"></input>JSON 전송</label></li>
</ul>
<p><strong>예상 시간</strong>: 40분</p>
<hr />
<h4 id="mission-3-2-양방향-통신">Mission 3-2: 양방향 통신</h4>
<p><strong>목표</strong>: Subscribe &amp; Publish</p>
<p><strong>미션</strong>:</p>
<pre><code>1. 센서 데이터를 전송
2. 제어 명령을 구독
3. 명령에 따라 LED 제어</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>2개의 Topic 사용</li>
<li>콜백 함수 구현</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>데이터 송신</label></li>
<li><label><input type="checkbox"></input>명령 수신</label></li>
<li><label><input type="checkbox"></input>LED 제어</label></li>
</ul>
<p><strong>예상 시간</strong>: 45분</p>
<hr />
<h4 id="mission-3-3-멀티-보드-통신">Mission 3-3: 멀티 보드 통신</h4>
<p><strong>목표</strong>: 보드 간 통신</p>
<p><strong>미션</strong>:</p>
<pre><code>2개의 헥사보드를 준비하여
Board A의 버튼을 누르면
Board B의 LED가 켜지게 하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>서로 다른 Client ID</li>
<li>공통 Topic 사용</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>2개 보드 연결</label></li>
<li><label><input type="checkbox"></input>버튼 → LED 연동</label></li>
<li><label><input type="checkbox"></input>양방향 가능</label></li>
</ul>
<p><strong>예상 시간</strong>: 50분</p>
<hr />
<h3 id="level-4-ai-통합-전문가-심화">Level 4: AI 통합 전문가 (심화)</h3>
<h4 id="mission-4-1-python-데이터-수집">Mission 4-1: Python 데이터
수집</h4>
<p><strong>목표</strong>: Python MQTT 클라이언트</p>
<p><strong>미션</strong>:</p>
<pre><code>Python으로 MQTT 데이터를 수신하여
CSV 파일에 저장하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li><code>paho-mqtt</code> 라이브러리</li>
<li><code>csv.writer()</code> 사용</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>MQTT 구독</label></li>
<li><label><input type="checkbox"></input>CSV 저장</label></li>
<li><label><input type="checkbox"></input>타임스탬프 포함</label></li>
</ul>
<p><strong>예상 시간</strong>: 40분</p>
<hr />
<h4 id="mission-4-2-ai-데이터-분석">Mission 4-2: AI 데이터 분석</h4>
<p><strong>목표</strong>: OpenAI API 통합</p>
<p><strong>미션</strong>:</p>
<pre><code>수집된 센서 데이터를 OpenAI로 분석하여
환경 상태와 추천사항을 출력하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>프롬프트 설계</li>
<li>JSON 응답 처리</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>데이터 요약</label></li>
<li><label><input type="checkbox"></input>AI 분석</label></li>
<li><label><input type="checkbox"></input>추천 출력</label></li>
</ul>
<p><strong>예상 시간</strong>: 45분</p>
<hr />
<h4 id="mission-4-3-자동-제어-시스템">Mission 4-3: 자동 제어 시스템</h4>
<p><strong>목표</strong>: 완전 자동화</p>
<p><strong>미션</strong>:</p>
<pre><code>AI가 센서 데이터를 분석하여
자동으로 LED 색상과 패턴을 제어하세요</code></pre>
<p><strong>힌트</strong>:</p>
<ul>
<li>양방향 통신</li>
<li>AI → 명령 생성</li>
</ul>
<p><strong>체크리스트</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>자동 분석</label></li>
<li><label><input type="checkbox"></input>명령 생성</label></li>
<li><label><input type="checkbox"></input>헥사보드 제어</label></li>
</ul>
<p><strong>예상 시간</strong>: 60분</p>
<hr />
<h2 id="평가-루브릭">📊 평가 루브릭</h2>
<h3 id="실습-미션-평가-기준">실습 미션 평가 기준</h3>
<h4 id="기능-구현-50점">기능 구현 (50점)</h4>
<table>
<thead>
<tr>
<th>점수</th>
<th>기준</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>50</strong></td>
<td>모든 기능 완벽 구현 + 추가 기능</td>
</tr>
<tr>
<td><strong>40</strong></td>
<td>모든 필수 기능 구현</td>
</tr>
<tr>
<td><strong>30</strong></td>
<td>주요 기능 대부분 구현</td>
</tr>
<tr>
<td><strong>20</strong></td>
<td>일부 기능만 구현</td>
</tr>
<tr>
<td><strong>10</strong></td>
<td>시도했으나 미완성</td>
</tr>
</tbody>
</table>
<h4 id="코드-품질-30점">코드 품질 (30점)</h4>
<table>
<thead>
<tr>
<th>점수</th>
<th>기준</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>30</strong></td>
<td>주석 충분 + 변수명 명확 + 구조화</td>
</tr>
<tr>
<td><strong>20</strong></td>
<td>주석 있음 + 가독성 양호</td>
</tr>
<tr>
<td><strong>10</strong></td>
<td>최소한의 주석 + 작동함</td>
</tr>
</tbody>
</table>
<h4 id="문제-해결-20점">문제 해결 (20점)</h4>
<table>
<thead>
<tr>
<th>점수</th>
<th>기준</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>20</strong></td>
<td>독립적 해결 + 창의적 접근</td>
</tr>
<tr>
<td><strong>15</strong></td>
<td>약간의 도움으로 해결</td>
</tr>
<tr>
<td><strong>10</strong></td>
<td>많은 도움 필요</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="프로젝트-평가-기준">🏆 프로젝트 평가 기준</h2>
<h3 id="최종-프로젝트-루브릭-100점">최종 프로젝트 루브릭 (100점)</h3>
<h4 id="완성도-40점">1. 완성도 (40점)</h4>
<ul>
<li><strong>40점</strong>: 모든 기능 완벽 구현 + 안정적</li>
<li><strong>30점</strong>: 주요 기능 모두 작동</li>
<li><strong>20점</strong>: 핵심 기능 작동</li>
<li><strong>10점</strong>: 일부만 작동</li>
</ul>
<h4 id="창의성-30점">2. 창의성 (30점)</h4>
<ul>
<li><strong>30점</strong>: 독창적 아이디어 + 차별화</li>
<li><strong>20점</strong>: 기본 기능에 응용 추가</li>
<li><strong>10점</strong>: 예제 기반 구현</li>
</ul>
<h4 id="기술-구현-20점">3. 기술 구현 (20점)</h4>
<ul>
<li><strong>20점</strong>: 고급 기술 활용 (AI, 웹 등)</li>
<li><strong>15점</strong>: 중급 기술 (MQTT, 센서)</li>
<li><strong>10점</strong>: 기본 기능</li>
</ul>
<h4 id="발표-10점">4. 발표 (10점)</h4>
<ul>
<li><strong>10점</strong>: 명확한 설명 + 데모 완벽</li>
<li><strong>7점</strong>: 설명 양호 + 데모 성공</li>
<li><strong>5점</strong>: 기본 발표</li>
</ul>
<hr />
<h2 id="도전-프로젝트-아이디어">🎯 도전 프로젝트 아이디어</h2>
<h3 id="테마별-프로젝트">테마별 프로젝트</h3>
<h4 id="스마트-홈">🏠 스마트 홈</h4>
<p><strong>1. 환경 자동 조절기</strong></p>
<ul>
<li>온습도에 따라 LED 색상 자동 변경</li>
<li>불쾌지수 계산 및 알림</li>
<li>AI 기반 최적 환경 추천</li>
</ul>
<p><strong>2. 에너지 모니터</strong></p>
<ul>
<li>조도 센서로 낮/밤 감지</li>
<li>자동 조명 제어</li>
<li>에너지 절약 통계</li>
</ul>
<h4 id="게임-엔터테인먼트">🎮 게임 &amp; 엔터테인먼트</h4>
<p><strong>3. 반응속도 대결</strong></p>
<ul>
<li>2인용 반응속도 게임</li>
<li>LED 색상 맞추기</li>
<li>점수 집계 및 순위</li>
</ul>
<p><strong>4. 음악 비주얼라이저</strong></p>
<ul>
<li>버튼으로 리듬 입력</li>
<li>LED 패턴 생성</li>
<li>MQTT로 여러 보드 동기화</li>
</ul>
<h4 id="교육-실험">📚 교육 &amp; 실험</h4>
<p><strong>5. 과학 실험 도구</strong></p>
<ul>
<li>온도 변화 실험</li>
<li>데이터 자동 기록</li>
<li>그래프 생성 (Python)</li>
</ul>
<p><strong>6. AI 챗봇 제어</strong></p>
<ul>
<li>자연어로 LED 제어</li>
<li>센서 데이터 질문 응답</li>
<li>웹 인터페이스</li>
</ul>
<h4 id="환경-농업">🌱 환경 &amp; 농업</h4>
<p><strong>7. 스마트 화분</strong></p>
<ul>
<li>토양 습도 모니터링 (조도 센서 활용)</li>
<li>물주기 알림</li>
<li>성장 기록</li>
</ul>
<p><strong>8. 공기질 모니터</strong></p>
<ul>
<li>온습도 + 조도 복합 분석</li>
<li>환기 알림</li>
<li>일별/주별 통계</li>
</ul>
<hr />
<h2 id="실습-시트-템플릿">📝 실습 시트 템플릿</h2>
<h3 id="미션-수행-기록지">미션 수행 기록지</h3>
<p><strong>이름</strong>:
<strong>**</strong>___<strong>**</strong><br />
<strong>미션</strong>: <strong>**</strong>___<strong>**</strong><br />
<strong>날짜</strong>: <strong>**</strong>___<strong>**</strong></p>
<h4 id="계획">계획</h4>
<p><strong>목표</strong>:</p>
<p><strong>필요한 것</strong>:</p>
<ul class="task-list">
<li><label><input type="checkbox"></input>하드웨어:
<strong>___</strong></label></li>
<li><label><input type="checkbox"></input>라이브러리:
<strong>___</strong></label></li>
<li><label><input type="checkbox"></input>지식:
<strong>___</strong></label></li>
</ul>
<p><strong>예상 소요 시간</strong>: <strong>___</strong></p>
<h4 id="실행">실행</h4>
<p><strong>시작 시간</strong>: <strong>___</strong><br />
<strong>종료 시간</strong>: <strong>___</strong><br />
<strong>실제 소요 시간</strong>: <strong>___</strong></p>
<p><strong>어려웠던 점</strong>:</p>
<p><strong>해결 방법</strong>:</p>
<h4 id="결과">결과</h4>
<p><strong>성공 여부</strong>: ⭕ / ❌</p>
<p><strong>작동 스크린샷</strong>:</p>
<p><strong>코드 링크</strong>: <strong>___</strong></p>
<h4 id="회고">회고</h4>
<p><strong>배운 점</strong>:</p>
<p><strong>개선할 점</strong>:</p>
<p><strong>다음 단계</strong>:</p>
<hr />
<h2 id="교육자-가이드">💡 교육자 가이드</h2>
<h3 id="미션-운영-팁">미션 운영 팁</h3>
<p><strong>1. 미션 전</strong></p>
<ul>
<li>미션 목표 명확히 설명</li>
<li>필수/선택 구분</li>
<li>예상 시간 안내</li>
</ul>
<p><strong>2. 미션 중</strong></p>
<ul>
<li>중간 체크포인트 설정</li>
<li>힌트는 단계적으로 제공</li>
<li>학생끼리 토론 유도</li>
</ul>
<p><strong>3. 미션 후</strong></p>
<ul>
<li>다양한 해결법 공유</li>
<li>베스트 코드 시연</li>
<li>실패 사례도 학습 자료</li>
</ul>
<h3 id="차별화-전략">차별화 전략</h3>
<p><strong>빠른 학생</strong>:</p>
<ul>
<li>추가 도전 과제</li>
<li>친구 도와주기</li>
<li>고급 기능 탐구</li>
</ul>
<p><strong>느린 학생</strong>:</p>
<ul>
<li>페어 프로그래밍</li>
<li>더 많은 힌트</li>
<li>핵심만 완성</li>
</ul>
<hr />
<h2 id="자주-묻는-질문-17">❓ 자주 묻는 질문</h2>
<h3 id="q1.-미션을-못-완수하면-어떡하나요">Q1. 미션을 못 완수하면
어떡하나요?</h3>
<p><strong>A</strong>: 부분 점수를 주고, 핵심 개념을 이해했는지
확인하세요.</p>
<h3 id="q2.-답을-복사하는-학생은">Q2. 답을 복사하는 학생은?</h3>
<p><strong>A</strong>: 구두 질문으로 이해도 확인, 페어 코드 리뷰
진행</p>
<h3 id="q3.-평가-기준이-너무-엄격하지-않나요">Q3. 평가 기준이 너무
엄격하지 않나요?</h3>
<p><strong>A</strong>: 초급은 완성도, 고급은 창의성에 더 많은 점수
부여</p>
<hr />
<h2 id="다음-단계-18">🚀 다음 단계</h2>
<p>미션 기반 학습 설계 완료!</p>
<p><strong>다음 챕터에서는</strong>:</p>
<ul>
<li>확장 아이디어</li>
<li>후속 프로젝트 방향</li>
<li>커뮤니티 및 자료</li>
</ul>
<hr />
<p><strong>🎉 Chapter 28 완료!</strong><br />
게임처럼 재미있는 AIoT 학습이 시작됩니다!</p>
<h1 id="chapter-29.-확장-아이디어-및-후속-프로젝트-방향">Chapter 29.
확장 아이디어 및 후속 프로젝트 방향</h1>
<blockquote>
<p><strong>PART 8</strong>: 수업 설계와 확장 아이디어</p>
</blockquote>
<hr />
<h2 id="이-챕터에서-배울-내용-28">📚 이 챕터에서 배울 내용</h2>
<ul class="task-list">
<li><label><input type="checkbox"></input>헥사보드를 확장하는 다양한 방법을
이해할 수 있다</label></li>
<li><label><input type="checkbox"></input>고급 프로젝트 아이디어를 얻을 수
있다</label></li>
<li><label><input type="checkbox"></input>AIoT 학습을 계속 이어갈 수
있다</label></li>
</ul>
<p><strong>예상 소요 시간</strong>: 15분</p>
<hr />
<h2 id="확장의-방향">🎯 확장의 방향</h2>
<h3 id="가지-확장-축">3가지 확장 축</h3>
<pre><code>1. 하드웨어 확장: 더 많은 센서/액츄에이터
2. 소프트웨어 확장: 더 복잡한 AI/데이터
3. 시스템 확장: 더 큰 네트워크</code></pre>
<hr />
<h2 id="하드웨어-확장">🔧 하드웨어 확장</h2>
<h3 id="추가-가능한-센서">추가 가능한 센서</h3>
<h4 id="환경-센서">환경 센서</h4>
<p><strong>1. BME280 (온습도 + 기압)</strong></p>
<div class="sourceCode" id="cb330"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bme280 <span class="im">import</span> BME280</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> I2C, Pin</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>i2c <span class="op">=</span> I2C(<span class="dv">0</span>, scl<span class="op">=</span>Pin(<span class="dv">22</span>), sda<span class="op">=</span>Pin(<span class="dv">21</span>))</span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>bme <span class="op">=</span> BME280(i2c<span class="op">=</span>i2c)</span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>temp, pressure, humidity <span class="op">=</span> bme.read_compensated_data()</span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;기압: </span><span class="sc">{</span>pressure<span class="op">/</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss"> hPa&quot;</span>)</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>날씨 예측</li>
<li>고도 측정</li>
<li>기압 변화 감지</li>
</ul>
<p><strong>2. MQ-2 (가스 센서)</strong></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> ADC, Pin</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>gas <span class="op">=</span> ADC(Pin(<span class="dv">34</span>))</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>gas.atten(ADC.ATTN_11DB)</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> gas.read()</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;가스 농도: </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>공기질 모니터</li>
<li>가스 누출 감지</li>
<li>환기 알림</li>
</ul>
<p><strong>3. PIR 센서 (움직임 감지)</strong></p>
<div class="sourceCode" id="cb332"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>pir <span class="op">=</span> Pin(<span class="dv">27</span>, Pin.IN)</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pir.value():</span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;움직임 감지!&quot;</span>)</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>자동 조명</li>
<li>보안 시스템</li>
<li>에너지 절약</li>
</ul>
<h4 id="출력-장치">출력 장치</h4>
<p><strong>4. OLED 디스플레이 (128x64)</strong></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> I2C, Pin</span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ssd1306 <span class="im">import</span> SSD1306_I2C</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>i2c <span class="op">=</span> I2C(<span class="dv">0</span>, scl<span class="op">=</span>Pin(<span class="dv">22</span>), sda<span class="op">=</span>Pin(<span class="dv">21</span>))</span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>oled <span class="op">=</span> SSD1306_I2C(<span class="dv">128</span>, <span class="dv">64</span>, i2c)</span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>oled.text(<span class="st">&quot;HexaBoard&quot;</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a>oled.text(<span class="st">&quot;Temp: 25C&quot;</span>, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a>oled.show()</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>센서 데이터 표시</li>
<li>상태 메시지</li>
<li>그래프 출력</li>
</ul>
<p><strong>5. 서보 모터</strong></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin, PWM</span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>servo <span class="op">=</span> PWM(Pin(<span class="dv">26</span>), freq<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_angle(angle):</span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>    duty <span class="op">=</span> <span class="bu">int</span>((angle <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="dv">102</span> <span class="op">+</span> <span class="dv">26</span>)</span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a>    servo.duty(duty)</span>
<span id="cb334-8"><a href="#cb334-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-9"><a href="#cb334-9" aria-hidden="true" tabindex="-1"></a>set_angle(<span class="dv">90</span>)  <span class="co"># 90도</span></span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>자동 창문 개폐</li>
<li>로봇 팔</li>
<li>방향 지시</li>
</ul>
<p><strong>6. 릴레이 모듈</strong></p>
<div class="sourceCode" id="cb335"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> machine <span class="im">import</span> Pin</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>relay <span class="op">=</span> Pin(<span class="dv">25</span>, Pin.OUT)</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>relay.value(<span class="dv">1</span>)  <span class="co"># ON</span></span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>relay.value(<span class="dv">0</span>)  <span class="co"># OFF</span></span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>가전제품 제어</li>
<li>전등 ON/OFF</li>
<li>고전력 장치 제어</li>
</ul>
<hr />
<h2 id="소프트웨어-확장">💻 소프트웨어 확장</h2>
<h3 id="고급-ai-기능">고급 AI 기능</h3>
<h4 id="시계열-데이터-예측">1. 시계열 데이터 예측</h4>
<div class="sourceCode" id="cb336"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 온도 데이터 수집 (시간, 온도)</span></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [(<span class="dv">0</span>, <span class="dv">20</span>), (<span class="dv">1</span>, <span class="dv">21</span>), (<span class="dv">2</span>, <span class="dv">22</span>), (<span class="dv">3</span>, <span class="dv">23</span>)]</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array([d[<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> data]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array([d[<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> data])</span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression()</span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a>model.fit(X, y)</span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 다음 시간 예측</span></span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a>next_temp <span class="op">=</span> model.predict([[<span class="dv">4</span>]])</span>
<span id="cb336-14"><a href="#cb336-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;예측 온도: </span><span class="sc">{</span>next_temp[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss">°C&quot;</span>)</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>온도 트렌드 예측</li>
<li>에너지 사용량 예측</li>
<li>이상 탐지</li>
</ul>
<h4 id="이미지-인식-esp32-cam">2. 이미지 인식 (ESP32-CAM)</h4>
<div class="sourceCode" id="cb337"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ESP32-CAM 사용 시</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> camera</span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>camera.init()</span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> camera.capture()</span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 이미지를 AI 서버로 전송</span></span>
<span id="cb337-8"><a href="#cb337-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urequests</span>
<span id="cb337-9"><a href="#cb337-9" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> urequests.post(<span class="st">&#39;http://server/classify&#39;</span>, data<span class="op">=</span>img)</span>
<span id="cb337-10"><a href="#cb337-10" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> response.json()</span>
<span id="cb337-11"><a href="#cb337-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-12"><a href="#cb337-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;인식 결과: </span><span class="sc">{</span>result[<span class="st">&#39;label&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>얼굴 인식 출입</li>
<li>물체 감지</li>
<li>QR 코드 스캔</li>
</ul>
<h4 id="음성-명령-마이크-추가">3. 음성 명령 (마이크 추가)</h4>
<div class="sourceCode" id="cb338"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python 서버에서 음성 인식</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> speech_recognition <span class="im">as</span> sr</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> sr.Recognizer()</span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> sr.Microphone() <span class="im">as</span> source:</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>    audio <span class="op">=</span> r.listen(source)</span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>    command <span class="op">=</span> r.recognize_google(audio, language<span class="op">=</span><span class="st">&#39;ko-KR&#39;</span>)</span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;명령: </span><span class="sc">{</span>command<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AI로 명령 처리</span></span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>“불 켜줘” 음성 제어</li>
<li>스마트 홈 어시스턴트</li>
<li>핸즈프리 제어</li>
</ul>
<h4 id="고급-데이터-분석">4. 고급 데이터 분석</h4>
<div class="sourceCode" id="cb339"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CSV 데이터 로드</span></span>
<span id="cb339-5"><a href="#cb339-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;sensor_data.csv&#39;</span>)</span>
<span id="cb339-6"><a href="#cb339-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-7"><a href="#cb339-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 일별 평균</span></span>
<span id="cb339-8"><a href="#cb339-8" aria-hidden="true" tabindex="-1"></a>daily_avg <span class="op">=</span> df.groupby(<span class="st">&#39;date&#39;</span>)[<span class="st">&#39;temperature&#39;</span>].mean()</span>
<span id="cb339-9"><a href="#cb339-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-10"><a href="#cb339-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 그래프</span></span>
<span id="cb339-11"><a href="#cb339-11" aria-hidden="true" tabindex="-1"></a>plt.plot(daily_avg)</span>
<span id="cb339-12"><a href="#cb339-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;일별 평균 온도&#39;</span>)</span>
<span id="cb339-13"><a href="#cb339-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;날짜&#39;</span>)</span>
<span id="cb339-14"><a href="#cb339-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;온도 (°C)&#39;</span>)</span>
<span id="cb339-15"><a href="#cb339-15" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;temperature_trend.png&#39;</span>)</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>장기 트렌드 분석</li>
<li>통계 리포트 생성</li>
<li>시각화 대시보드</li>
</ul>
<hr />
<h2 id="시스템-확장-1">🌐 시스템 확장</h2>
<h3 id="멀티-보드-네트워크">1. 멀티 보드 네트워크</h3>
<p><strong>시나리오</strong>: 집 전체를 모니터링</p>
<pre><code>거실 보드: 온습도
침실 보드: 온습도 + 움직임
주방 보드: 가스 + 온도</code></pre>
<p><strong>중앙 서버</strong>:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 보드 데이터 수집</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>boards <span class="op">=</span> {</span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;living&#39;</span>: {<span class="st">&#39;temp&#39;</span>: <span class="dv">25</span>, <span class="st">&#39;humid&#39;</span>: <span class="dv">60</span>},</span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;bedroom&#39;</span>: {<span class="st">&#39;temp&#39;</span>: <span class="dv">23</span>, <span class="st">&#39;humid&#39;</span>: <span class="dv">55</span>, <span class="st">&#39;motion&#39;</span>: <span class="va">False</span>},</span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;kitchen&#39;</span>: {<span class="st">&#39;temp&#39;</span>: <span class="dv">27</span>, <span class="st">&#39;gas&#39;</span>: <span class="dv">100</span>}</span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-8"><a href="#cb341-8" aria-hidden="true" tabindex="-1"></a><span class="co"># AI로 통합 분석</span></span>
<span id="cb341-9"><a href="#cb341-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_home():</span>
<span id="cb341-10"><a href="#cb341-10" aria-hidden="true" tabindex="-1"></a>    avg_temp <span class="op">=</span> <span class="bu">sum</span>(b.get(<span class="st">&#39;temp&#39;</span>, <span class="dv">0</span>) <span class="cf">for</span> b <span class="kw">in</span> boards.values()) <span class="op">/</span> <span class="bu">len</span>(boards)</span>
<span id="cb341-11"><a href="#cb341-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-12"><a href="#cb341-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> boards[<span class="st">&#39;kitchen&#39;</span>][<span class="st">&#39;gas&#39;</span>] <span class="op">&gt;</span> <span class="dv">500</span>:</span>
<span id="cb341-13"><a href="#cb341-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;⚠️ 주방 가스 경보!&quot;</span></span>
<span id="cb341-14"><a href="#cb341-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-15"><a href="#cb341-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&quot;🏠 평균 온도: </span><span class="sc">{</span>avg_temp<span class="sc">:.1f}</span><span class="ss">°C&quot;</span></span></code></pre></div>
<h3 id="클라우드-통합">2. 클라우드 통합</h3>
<p><strong>AWS IoT Core</strong>:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> AWSIoTPythonSDK.MQTTLib <span class="im">import</span> AWSIoTMQTTClient</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> AWSIoTMQTTClient(<span class="st">&quot;hexaboard&quot;</span>)</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>client.configureEndpoint(<span class="st">&quot;xxx.iot.us-east-1.amazonaws.com&quot;</span>, <span class="dv">8883</span>)</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>client.configureCredentials(<span class="st">&quot;root-CA.crt&quot;</span>, <span class="st">&quot;private.pem.key&quot;</span>, <span class="st">&quot;certificate.pem.crt&quot;</span>)</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>client.<span class="ex">connect</span>()</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>client.publish(<span class="st">&quot;hexaboard/data&quot;</span>, payload, <span class="dv">1</span>)</span></code></pre></div>
<p><strong>Azure IoT Hub</strong>:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> azure.iot.device <span class="im">import</span> IoTHubDeviceClient</span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>connection_string <span class="op">=</span> <span class="st">&quot;HostName=xxx.azure-devices.net;...&quot;</span></span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> IoTHubDeviceClient.create_from_connection_string(connection_string)</span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a>client.send_message({<span class="st">&quot;temperature&quot;</span>: <span class="dv">25</span>})</span></code></pre></div>
<p><strong>응용</strong>:</p>
<ul>
<li>전 세계 어디서나 접근</li>
<li>빅데이터 분석</li>
<li>머신러닝 학습</li>
</ul>
<h3 id="데이터베이스-연동">3. 데이터베이스 연동</h3>
<p><strong>SQLite (로컬)</strong>:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">&#39;sensor_data.db&#39;</span>)</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">&#39;&#39;&#39;</span></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a><span class="st">CREATE TABLE IF NOT EXISTS sensors (</span></span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a><span class="st">    timestamp DATETIME,</span></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a><span class="st">    temperature REAL,</span></span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a><span class="st">    humidity REAL</span></span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;&#39;</span>)</span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">&#39;INSERT INTO sensors VALUES (?, ?, ?)&#39;</span>,</span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a>               (datetime.now(), <span class="fl">25.5</span>, <span class="fl">60.0</span>))</span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a>conn.commit()</span></code></pre></div>
<p><strong>MongoDB (클라우드)</strong>:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo <span class="im">import</span> MongoClient</span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> MongoClient(<span class="st">&quot;mongodb+srv://user:pass@cluster.mongodb.net/&quot;</span>)</span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client.hexaboard</span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a>db.sensors.insert_one({</span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;timestamp&#39;</span>: datetime.now(),</span>
<span id="cb345-8"><a href="#cb345-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;temperature&#39;</span>: <span class="fl">25.5</span>,</span>
<span id="cb345-9"><a href="#cb345-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;humidity&#39;</span>: <span class="fl">60.0</span></span>
<span id="cb345-10"><a href="#cb345-10" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<hr />
<h2 id="학습-경로-추천">🎓 학습 경로 추천</h2>
<h3 id="초급-중급">초급 → 중급</h3>
<p><strong>마스터한 것</strong>:</p>
<ul>
<li>✅ MicroPython 기초</li>
<li>✅ 센서 제어</li>
<li>✅ MQTT 통신</li>
</ul>
<p><strong>다음 학습</strong>:</p>
<ol type="1">
<li><p><strong>Python 백엔드 심화</strong></p>
<ul>
<li>Flask/FastAPI</li>
<li>데이터베이스 (SQL)</li>
<li>RESTful API</li>
</ul></li>
<li><p><strong>웹 프론트엔드</strong></p>
<ul>
<li>React/Vue.js</li>
<li>실시간 차트 (Chart.js)</li>
<li>반응형 디자인</li>
</ul></li>
<li><p><strong>네트워크 보안</strong></p>
<ul>
<li>TLS/SSL 인증서</li>
<li>OAuth 인증</li>
<li>데이터 암호화</li>
</ul></li>
</ol>
<h3 id="중급-고급">중급 → 고급</h3>
<p><strong>마스터한 것</strong>:</p>
<ul>
<li>✅ AI API 통합</li>
<li>✅ 웹 대시보드</li>
<li>✅ 데이터 분석</li>
</ul>
<p><strong>다음 학습</strong>:</p>
<ol type="1">
<li><p><strong>머신러닝</strong></p>
<ul>
<li>TensorFlow Lite (온디바이스)</li>
<li>시계열 예측 (LSTM)</li>
<li>이상 탐지 (Autoencoder)</li>
</ul></li>
<li><p><strong>엣지 컴퓨팅</strong></p>
<ul>
<li>Edge AI</li>
<li>로컬 추론</li>
<li>모델 최적화</li>
</ul></li>
<li><p><strong>대규모 IoT</strong></p>
<ul>
<li>Kubernetes</li>
<li>메시지 큐 (RabbitMQ)</li>
<li>시계열 DB (InfluxDB)</li>
</ul></li>
</ol>
<hr />
<h2 id="프로젝트-아이디어">🚀 프로젝트 아이디어</h2>
<h3 id="레벨-1-개인-프로젝트">레벨 1: 개인 프로젝트</h3>
<p><strong>1. 나만의 날씨 스테이션</strong></p>
<ul>
<li>온습도 + 기압 센서</li>
<li>OLED 디스플레이</li>
<li>예보 API 연동</li>
</ul>
<p><strong>2. 스마트 화분</strong></p>
<ul>
<li>토양 습도 센서</li>
<li>자동 물주기 (펌프)</li>
<li>성장 일지 웹앱</li>
</ul>
<p><strong>3. 수면 트래커</strong></p>
<ul>
<li>움직임 센서 (PIR)</li>
<li>온습도 모니터</li>
<li>수면 품질 AI 분석</li>
</ul>
<h3 id="레벨-2-팀-프로젝트">레벨 2: 팀 프로젝트</h3>
<p><strong>4. 교실 환경 모니터</strong></p>
<ul>
<li>여러 교실에 보드 설치</li>
<li>중앙 대시보드</li>
<li>자동 환기 알림</li>
</ul>
<p><strong>5. 스마트 오피스</strong></p>
<ul>
<li>책상별 온도/조도</li>
<li>에너지 절약 시스템</li>
<li>재실 감지 자동 조명</li>
</ul>
<p><strong>6. IoT 보안 시스템</strong></p>
<ul>
<li>문 센서 (자석)</li>
<li>움직임 감지</li>
<li>스마트폰 알림</li>
</ul>
<h3 id="레벨-3-공모전경진대회">레벨 3: 공모전/경진대회</h3>
<p><strong>7. 스마트 시티 미니어처</strong></p>
<ul>
<li>신호등 제어 (서보)</li>
<li>주차 감지 (초음파)</li>
<li>가로등 자동 조절</li>
</ul>
<p><strong>8. 재난 감지 네트워크</strong></p>
<ul>
<li>화재 감지 (온도 + 가스)</li>
<li>홍수 감지 (수위 센서)</li>
<li>긴급 알림 시스템</li>
</ul>
<p><strong>9. 친환경 에너지 모니터</strong></p>
<ul>
<li>태양광 패널 + 전력 센서</li>
<li>발전량 vs 소비량</li>
<li>최적화 AI 추천</li>
</ul>
<hr />
<h2 id="학습-자료">📚 학습 자료</h2>
<h3 id="추천-온라인-코스">추천 온라인 코스</h3>
<p><strong>무료</strong>:</p>
<ul>
<li><a href="https://docs.micropython.org/">MicroPython 공식
문서</a></li>
<li><a href="https://mqtt.org/">MQTT.org 튜토리얼</a></li>
<li><a href="https://github.com/openai/openai-cookbook">OpenAI
Cookbook</a></li>
</ul>
<p><strong>유료</strong>:</p>
<ul>
<li>Udemy: “Complete IoT &amp; Machine Learning”</li>
<li>Coursera: “Introduction to the Internet of Things”</li>
<li>edX: “IoT Systems and Industrial Applications”</li>
</ul>
<h3 id="추천-도서">추천 도서</h3>
<ol type="1">
<li><strong>“Internet of Things with Python”</strong> - Gaston C.
Hillar</li>
<li><strong>“MicroPython Projects”</strong> - Jacob Beningo</li>
<li><strong>“Practical Machine Learning for IoT”</strong> - Alasdair
Allan</li>
</ol>
<h3 id="커뮤니티">커뮤니티</h3>
<ul>
<li><strong>MicroPython Forum</strong>: forum.micropython.org</li>
<li><strong>Reddit</strong>: r/esp32, r/IoT, r/MicroPython</li>
<li><strong>Discord</strong>: MicroPython, IoT Developers</li>
<li><strong>GitHub</strong>: Awesome MicroPython</li>
</ul>
<hr />
<h2 id="유용한-도구">🛠️ 유용한 도구</h2>
<h3 id="개발-도구">개발 도구</h3>
<p><strong>1. Fritzing</strong> (회로도 작성)</p>
<ul>
<li>회로 설계 및 시각화</li>
<li>PCB 디자인</li>
<li>문서화</li>
</ul>
<p><strong>2. Thonny</strong> (MicroPython IDE)</p>
<ul>
<li>초보자 친화적</li>
<li>디버거 내장</li>
<li>파일 관리</li>
</ul>
<p><strong>3. Postman</strong> (API 테스트)</p>
<ul>
<li>REST API 테스트</li>
<li>MQTT 테스트</li>
<li>자동화 스크립트</li>
</ul>
<h3 id="모니터링-도구">모니터링 도구</h3>
<p><strong>4. MQTT Explorer</strong></p>
<ul>
<li>MQTT 메시지 실시간 확인</li>
<li>Topic 구조 시각화</li>
<li>디버깅</li>
</ul>
<p><strong>5. Grafana</strong> (데이터 시각화)</p>
<ul>
<li>실시간 대시보드</li>
<li>알림 설정</li>
<li>다양한 데이터 소스 연동</li>
</ul>
<p><strong>6. Node-RED</strong> (플로우 프로그래밍)</p>
<ul>
<li>비주얼 프로그래밍</li>
<li>IoT 프로토타이핑</li>
<li>쉬운 통합</li>
</ul>
<hr />
<h2 id="공모전-경진대회">🏆 공모전 &amp; 경진대회</h2>
<h3 id="국내-대회">국내 대회</h3>
<p><strong>1. 메이커 페어 서울</strong></p>
<ul>
<li>창의적 메이킹 프로젝트</li>
<li>부스 운영</li>
<li>네트워킹</li>
</ul>
<p><strong>2. IoT 아이디어 경진대회</strong></p>
<ul>
<li>혁신적 IoT 솔루션</li>
<li>프로토타입 시연</li>
<li>상금 + 투자 기회</li>
</ul>
<p><strong>3. 공개SW 개발자대회</strong></p>
<ul>
<li>오픈소스 프로젝트</li>
<li>사회 문제 해결</li>
<li>정부 지원</li>
</ul>
<h3 id="국제-대회">국제 대회</h3>
<p><strong>4. Hackaday Prize</strong></p>
<ul>
<li>글로벌 하드웨어 해커톤</li>
<li>다양한 주제</li>
<li>상금 + 멘토링</li>
</ul>
<p><strong>5. Microsoft IoT Challenge</strong></p>
<ul>
<li>Azure 기반 IoT</li>
<li>클라우드 통합</li>
<li>글로벌 네트워킹</li>
</ul>
<hr />
<h2 id="창업-아이디어">💡 창업 아이디어</h2>
<h3 id="b2c-소비자">B2C (소비자)</h3>
<p><strong>1. 스마트 홈 키트</strong></p>
<ul>
<li>헥사보드 기반 DIY 키트</li>
<li>모바일 앱 제공</li>
<li>구독 서비스 (센서 추가)</li>
</ul>
<p><strong>2. 교육용 제품</strong></p>
<ul>
<li>학교/학원용 교육 키트</li>
<li>온라인 강의 패키지</li>
<li>교사 가이드 제공</li>
</ul>
<h3 id="b2b-기업">B2B (기업)</h3>
<p><strong>3. 환경 모니터링 서비스</strong></p>
<ul>
<li>사무실/공장 환경 측정</li>
<li>클라우드 대시보드</li>
<li>컨설팅 서비스</li>
</ul>
<p><strong>4. 농업 IoT 솔루션</strong></p>
<ul>
<li>스마트 팜 센서 네트워크</li>
<li>AI 기반 재배 조언</li>
<li>수확량 예측</li>
</ul>
<hr />
<h2 id="핵심-정리-16">📝 핵심 정리</h2>
<h3 id="확장의-3단계">확장의 3단계</h3>
<ol type="1">
<li><strong>하드웨어</strong>: 센서/액츄에이터 추가</li>
<li><strong>소프트웨어</strong>: AI/데이터 분석 고도화</li>
<li><strong>시스템</strong>: 네트워크/클라우드 확장</li>
</ol>
<h3 id="학습-계속하기">학습 계속하기</h3>
<ul>
<li>✅ 공식 문서 읽기</li>
<li>✅ 오픈소스 프로젝트 참여</li>
<li>✅ 커뮤니티 활동</li>
<li>✅ 공모전 도전</li>
<li>✅ 포트폴리오 구축</li>
</ul>
<hr />
<h2 id="마무리">🎉 마무리</h2>
<h3 id="여러분은-이제">여러분은 이제…</h3>
<p><strong>할 수 있는 것</strong>:</p>
<ul>
<li>✅ ESP32로 IoT 장치 만들기</li>
<li>✅ 센서 데이터 수집 및 분석</li>
<li>✅ MQTT로 통신하기</li>
<li>✅ AI로 제어하기</li>
<li>✅ 웹 대시보드 구축하기</li>
</ul>
<p><strong>앞으로 할 수 있는 것</strong>:</p>
<ul>
<li>🚀 더 복잡한 프로젝트</li>
<li>🚀 창의적 아이디어 구현</li>
<li>🚀 공모전 수상</li>
<li>🚀 포트폴리오 완성</li>
<li>🚀 취업/창업</li>
</ul>
<hr />
<h2 id="당부의-말">🌟 당부의 말</h2>
<blockquote>
<p>“작은 LED 하나를 켜는 것부터 시작했지만,<br />
이제 여러분은 완전한 AIoT 시스템을 만들 수 있습니다.<br />
계속 도전하고, 실패하고, 배우세요.<br />
가장 중요한 것은 멈추지 않는 것입니다!”</p>
</blockquote>
<hr />
<p><strong>🎉 Chapter 29 완료!</strong><br />
<strong>🎉 PART 8 완료!</strong><br />
<strong>🎉 “HexaBoard AI Sensor Lab” eBook 전체 완료!</strong></p>
<p><strong>감사합니다! 즐거운 메이킹 되세요! 🎊🚀</strong></p>
<hr />
<div style="page-break-after: always;">

</div>
<h1 id="맺음말">🎉 맺음말</h1>
<h2 id="여러분-축하합니다">여러분, 축하합니다!</h2>
<p>29개 챕터의 긴 여정을 완주하셨습니다! 처음 LED 하나를 켜는 것부터
시작하여, 이제 여러분은:</p>
<h3 id="할-수-있게-된-것">할 수 있게 된 것</h3>
<ul>
<li>✅ ESP32로 IoT 장치 만들기</li>
<li>✅ 센서 데이터 수집 및 분석</li>
<li>✅ MQTT로 통신하기</li>
<li>✅ AI로 제어하기</li>
<li>✅ 웹 대시보드 구축하기</li>
</ul>
<h3 id="앞으로-할-수-있는-것">앞으로 할 수 있는 것</h3>
<ul>
<li>🚀 더 복잡한 프로젝트 도전</li>
<li>🚀 창의적 아이디어 구현</li>
<li>🚀 공모전 참여</li>
<li>🚀 포트폴리오 완성</li>
<li>🚀 취업/창업 준비</li>
</ul>
<hr />
<h2 id="당부의-말-1">당부의 말</h2>
<blockquote>
<p>“작은 LED 하나를 켜는 것부터 시작했지만,<br />
이제 여러분은 완전한 AIoT 시스템을 만들 수 있습니다.<br />
계속 도전하고, 실패하고, 배우세요.<br />
가장 중요한 것은 멈추지 않는 것입니다!”</p>
</blockquote>
<hr />
<h2 id="다음-단계-19">다음 단계</h2>
<h3 id="계속-학습하기">계속 학습하기</h3>
<ol type="1">
<li><strong>공식 문서 읽기</strong>: MicroPython, OpenAI, MQTT 공식
문서</li>
<li><strong>오픈소스 참여</strong>: GitHub에서 프로젝트 기여</li>
<li><strong>커뮤니티 활동</strong>: 포럼, Discord에서 질문하고
답변하기</li>
<li><strong>공모전 도전</strong>: Hackaday, 메이커 페어, IoT
경진대회</li>
<li><strong>포트폴리오 구축</strong>: 나만의 프로젝트로 실력 증명</li>
</ol>
<h3 id="추천-프로젝트-아이디어">추천 프로젝트 아이디어</h3>
<p><strong>개인 프로젝트</strong>:</p>
<ul>
<li>나만의 날씨 스테이션</li>
<li>스마트 화분</li>
<li>수면 트래커</li>
</ul>
<p><strong>팀 프로젝트</strong>:</p>
<ul>
<li>교실 환경 모니터</li>
<li>스마트 오피스</li>
<li>IoT 보안 시스템</li>
</ul>
<p><strong>공모전/경진대회</strong>:</p>
<ul>
<li>스마트 시티 미니어처</li>
<li>재난 감지 네트워크</li>
<li>친환경 에너지 모니터</li>
</ul>
<hr />
<h2 id="감사의-글">감사의 글</h2>
<p>이 책이 완성되기까지 많은 분들의 도움이 있었습니다:</p>
<ul>
<li><strong>MicroPython 커뮤니티</strong>: 훌륭한 오픈소스
프레임워크</li>
<li><strong>OpenAI</strong>: 혁신적인 AI 기술</li>
<li><strong>MQTT 커뮤니티</strong>: 안정적인 IoT 프로토콜</li>
<li><strong>모든 독자분들</strong>: 이 책을 선택해주셔서 감사합니다</li>
</ul>
<hr />
<h2 id="계속-연결되어-있기">계속 연결되어 있기</h2>
<ul>
<li><strong>GitHub</strong>: github.com/your-repo/eBook_AIoT</li>
<li><strong>이메일</strong>: support@example.com</li>
<li><strong>커뮤니티</strong>: Discord (향후 개설)</li>
</ul>
<hr />
<h2 id="마지막-메시지">마지막 메시지</h2>
<p>여러분은 이제 AIoT 시스템을 만들 수 있는 능력을 갖추었습니다.</p>
<p>이 책에서 배운 것은 시작일 뿐입니다.</p>
<p>더 멋진 프로젝트를 만들고, 세상을 바꾸는 혁신을 이루어내세요!</p>
<p><strong>감사합니다! 즐거운 메이킹 되세요! 🎊🚀</strong></p>
<hr />
<p><strong>📘 헥사보드 AI 센서랩</strong><br />
<strong>OpenAI와 함께하는 스마트 환경 실험실</strong></p>
<p><strong>저자</strong>: MakeItNow Team<br />
<strong>버전</strong>: v1.0<br />
<strong>발행일</strong>: 2025년 1월</p>
<p>Copyright © 2025 MakeItNow Team<br />
All rights reserved.</p>
<hr />
</body>
</html>

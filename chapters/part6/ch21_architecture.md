# Chapter 21. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„

> **PART 6**: ì¢…í•© í”„ë¡œì íŠ¸ â€“ AI í™˜ê²½ ë¬´ë“œ ì»¨íŠ¸ë¡¤ëŸ¬

---

## ğŸ“š ì´ ì±•í„°ì—ì„œ ë°°ìš¸ ë‚´ìš©

- [ ] ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤
- [ ] ë°ì´í„° íë¦„ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤
- [ ] ì»´í¬ë„ŒíŠ¸ ê°„ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 30ë¶„

---

## ğŸ¯ í•™ìŠµ ëª©í‘œ

### í•µì‹¬ ê°œë…

- **ì•„í‚¤í…ì²˜**: ì‹œìŠ¤í…œ êµ¬ì¡°ì™€ ì»´í¬ë„ŒíŠ¸ ê´€ê³„
- **ë°ì´í„° íë¦„**: ì •ë³´ê°€ ì´ë™í•˜ëŠ” ê²½ë¡œ
- **ì¸í„°í˜ì´ìŠ¤**: ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹  ë°©ë²•

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 3ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Edge Layer (ì—£ì§€ ê³„ì¸µ)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     í—¥ì‚¬ë³´ë“œ (ESP32)          â”‚   â”‚
â”‚  â”‚  â€¢ DHT11 ì„¼ì„œ                 â”‚   â”‚
â”‚  â”‚  â€¢ ì¡°ë„ ì„¼ì„œ                  â”‚   â”‚
â”‚  â”‚  â€¢ NeoPixel LED              â”‚   â”‚
â”‚  â”‚  â€¢ MicroPython                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ MQTT (TLS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Communication Layer (í†µì‹  ê³„ì¸µ)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    MQTT Broker (HiveMQ)      â”‚   â”‚
â”‚  â”‚  â€¢ Topic ê´€ë¦¬                 â”‚   â”‚
â”‚  â”‚  â€¢ ë©”ì‹œì§€ ì¤‘ê°œ                â”‚   â”‚
â”‚  â”‚  â€¢ QoS ë³´ì¥                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ MQTT (TLS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Intelligence Layer (ì§€ëŠ¥ ê³„ì¸µ)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Python AI Server            â”‚   â”‚
â”‚  â”‚  â€¢ ë°ì´í„° ìˆ˜ì§‘                â”‚   â”‚
â”‚  â”‚  â€¢ AI ë¶„ì„ (OpenAI)           â”‚   â”‚
â”‚  â”‚  â€¢ ëª…ë ¹ ìƒì„±                  â”‚   â”‚
â”‚  â”‚  â€¢ ìƒíƒœ ê´€ë¦¬                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ ë°ì´í„° íë¦„

### ì„¼ì„œ â†’ AI â†’ ì œì–´ íë¦„

**1. ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ (5ì´ˆ ì£¼ê¸°)**

```
í—¥ì‚¬ë³´ë“œ ì„¼ì„œ
  â”œâ”€ DHT11: ì˜¨ë„ 25Â°C, ìŠµë„ 60%
  â”œâ”€ ì¡°ë„ ì„¼ì„œ: 800
  â””â”€ íƒ€ì„ìŠ¤íƒ¬í”„: 1234567890

â†“ JSON ë³€í™˜

{
  "board": "A",
  "temperature": 25,
  "humidity": 60,
  "light": 800,
  "timestamp": 1234567890
}

â†“ MQTT Publish

Topic: hexaboard/A/sensor/data
```

**2. AI ë¶„ì„ (10ì´ˆ ì£¼ê¸°)**

```
Python Server
  â”œâ”€ ìµœê·¼ 10ê°œ ë°ì´í„° ìˆ˜ì§‘
  â”œâ”€ í‰ê·  ê³„ì‚°
  â”œâ”€ OpenAI API í˜¸ì¶œ
  â””â”€ ë¬´ë“œ íŒë‹¨

â†“ ë¬´ë“œ ê²°ì •

{
  "mood": "Perfect",
  "reason": "ì˜¨ë„ì™€ ìŠµë„ê°€ ì´ìƒì ",
  "recommendation": "í˜„ì¬ ìƒíƒœ ìœ ì§€"
}

â†“ LED ëª…ë ¹ ìƒì„±

{
  "action": "led_color",
  "color": [0, 255, 0],
  "pattern": "solid",
  "brightness": 80
}

â†“ MQTT Publish

Topic: hexaboard/A/control/led
```

**3. LED ì œì–´ ì‹¤í–‰**

```
í—¥ì‚¬ë³´ë“œ
  â”œâ”€ MQTT Subscribe
  â”œâ”€ ëª…ë ¹ íŒŒì‹±
  â”œâ”€ LED ì œì–´ ì‹¤í–‰
  â””â”€ ìƒíƒœ í™•ì¸ ì „ì†¡

â†“ ì‹¤í–‰ ê²°ê³¼

Topic: hexaboard/A/status
Message: "led_updated"
```

---

## ğŸ”„ ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨

### ë¬´ë“œ ì „í™˜ ë¡œì§

```
        [Perfect]
         â†™  â†“  â†˜
    [Cold] [Good] [Hot]
         â†˜  â†“  â†™
        [Humid]
```

**ì „í™˜ ì¡°ê±´**:

```python
if 22 <= temp <= 26 and 40 <= humid <= 60:
    mood = "Perfect"
elif 20 <= temp <= 28 and 35 <= humid <= 65:
    mood = "Good"
elif temp < 20:
    mood = "Cold"
elif temp > 28:
    mood = "Hot"
elif humid > 65:
    mood = "Humid"
```

---

## ğŸ“‹ Topic ì„¤ê³„

### MQTT Topic êµ¬ì¡°

**ì„¼ì„œ ë°ì´í„°**:
```
hexaboard/{board_id}/sensor/data
  â†’ {"temperature": 25, "humidity": 60, "light": 800}
```

**ì œì–´ ëª…ë ¹**:
```
hexaboard/{board_id}/control/led
  â†’ {"action": "led_color", "color": [0, 255, 0]}
```

**ìƒíƒœ ì—…ë°ì´íŠ¸**:
```
hexaboard/{board_id}/status
  â†’ "online" | "offline" | "led_updated"
```

**AI ë¶„ì„ ê²°ê³¼** (ì„ íƒ):
```
hexaboard/{board_id}/analysis
  â†’ {"mood": "Perfect", "reason": "..."}
```

---

## ğŸ—‚ï¸ ë°ì´í„° ëª¨ë¸

### ì„¼ì„œ ë°ì´í„° ëª¨ë¸

```python
SensorData = {
    "board": str,           # ë³´ë“œ ID (ì˜ˆ: "A")
    "temperature": float,   # ì˜¨ë„ (Â°C)
    "humidity": float,      # ìŠµë„ (%)
    "light": int,           # ì¡°ë„ (0-4095)
    "timestamp": int        # Unix timestamp
}
```

### ë¬´ë“œ ë¶„ì„ ëª¨ë¸

```python
MoodAnalysis = {
    "mood": str,            # "Perfect" | "Good" | "Cold" | "Hot" | "Humid"
    "score": float,         # 0.0-1.0 (í™˜ê²½ í’ˆì§ˆ ì ìˆ˜)
    "reason": str,          # ë¬´ë“œ íŒë‹¨ ì´ìœ 
    "recommendation": str,  # ê¶Œì¥ ì¡°ì¹˜
    "timestamp": int
}
```

### LED ì œì–´ ëª¨ë¸

```python
LEDCommand = {
    "action": str,          # "led_color" | "led_pattern" | "led_off"
    "color": [int, int, int],  # RGB (0-255)
    "pattern": str,         # "solid" | "blink" | "pulse"
    "brightness": int,      # 0-100 (%)
    "duration": int         # ì§€ì† ì‹œê°„ (ì´ˆ, ì„ íƒ)
}
```

---

## ğŸ”Œ ì»´í¬ë„ŒíŠ¸ ì¸í„°í˜ì´ìŠ¤

### í—¥ì‚¬ë³´ë“œ ì¸í„°í˜ì´ìŠ¤

**ì…ë ¥ (Subscribe)**:
- `hexaboard/A/control/led` - LED ì œì–´ ëª…ë ¹
- `hexaboard/A/control/mode` - ëª¨ë“œ ë³€ê²½ (ì„ íƒ)

**ì¶œë ¥ (Publish)**:
- `hexaboard/A/sensor/data` - ì„¼ì„œ ë°ì´í„° (5ì´ˆë§ˆë‹¤)
- `hexaboard/A/status` - ìƒíƒœ ì •ë³´

**API (í•¨ìˆ˜)**:
```python
def read_sensors() -> SensorData
def set_led(color: tuple, pattern: str) -> bool
def get_status() -> str
```

### Python AI Server ì¸í„°í˜ì´ìŠ¤

**ì…ë ¥ (Subscribe)**:
- `hexaboard/+/sensor/data` - ëª¨ë“  ë³´ë“œ ì„¼ì„œ ë°ì´í„°

**ì¶œë ¥ (Publish)**:
- `hexaboard/{id}/control/led` - LED ì œì–´ ëª…ë ¹
- `hexaboard/{id}/analysis` - ë¶„ì„ ê²°ê³¼ (ì„ íƒ)

**API (í•¨ìˆ˜)**:
```python
def analyze_environment(data: SensorData) -> MoodAnalysis
def generate_command(mood: MoodAnalysis) -> LEDCommand
def send_command(board_id: str, cmd: LEDCommand) -> bool
```

---

## âš™ï¸ ì„¤ì • íŒŒì¼ êµ¬ì¡°

### í™˜ê²½ ë³€ìˆ˜ (.env)

```bash
# MQTT ì„¤ì •
MQTT_BROKER=abc123.s1.eu.hivemq.cloud
MQTT_PORT=8883
MQTT_USER=hexaboard
MQTT_PASSWORD=your_password

# OpenAI ì„¤ì •
OPENAI_API_KEY=sk-proj-XXXX

# ì‹œìŠ¤í…œ ì„¤ì •
BOARD_ID=A
SENSOR_INTERVAL=5
CONTROL_INTERVAL=10

# ë¬´ë“œ ì„ê³„ê°’
TEMP_MIN_PERFECT=22
TEMP_MAX_PERFECT=26
HUMID_MIN_PERFECT=40
HUMID_MAX_PERFECT=60
```

### ë¬´ë“œ ì„¤ì • (config.json)

```json
{
  "moods": {
    "Perfect": {
      "color": [0, 255, 0],
      "pattern": "solid",
      "brightness": 80,
      "conditions": {
        "temp_min": 22,
        "temp_max": 26,
        "humid_min": 40,
        "humid_max": 60
      }
    },
    "Good": {
      "color": [255, 255, 0],
      "pattern": "solid",
      "brightness": 70
    },
    "Cold": {
      "color": [0, 0, 255],
      "pattern": "blink",
      "brightness": 60
    },
    "Hot": {
      "color": [255, 0, 0],
      "pattern": "blink",
      "brightness": 60
    },
    "Humid": {
      "color": [128, 0, 255],
      "pattern": "pulse",
      "brightness": 70
    }
  }
}
```

---

## ğŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### ì„¼ì„œ ì˜¤ë¥˜

```python
try:
    sensor.measure()
    temp = sensor.temperature()
except:
    temp = None  # ì´ì „ ê°’ ì‚¬ìš© ë˜ëŠ” ê¸°ë³¸ê°’
    log_error("Sensor read failed")
```

### MQTT ì—°ê²° ëŠê¹€

```python
def on_disconnect(client, userdata, rc):
    while True:
        try:
            client.reconnect()
            break
        except:
            time.sleep(5)  # 5ì´ˆ í›„ ì¬ì‹œë„
```

### AI API ì˜¤ë¥˜

```python
try:
    analysis = call_openai_api(data)
except:
    # ê·œì¹™ ê¸°ë°˜ í´ë°±
    analysis = rule_based_analysis(data)
```

---

## ğŸ“Š ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­

### ì‘ë‹µ ì‹œê°„

| ì‘ì—… | ëª©í‘œ ì‹œê°„ | ìµœëŒ€ ì‹œê°„ |
|------|-----------|-----------|
| ì„¼ì„œ ì½ê¸° | 0.1ì´ˆ | 0.5ì´ˆ |
| MQTT ì „ì†¡ | 0.2ì´ˆ | 1ì´ˆ |
| AI ë¶„ì„ | 1ì´ˆ | 3ì´ˆ |
| LED ì œì–´ | 0.1ì´ˆ | 0.3ì´ˆ |
| **ì „ì²´ íë¦„** | **2ì´ˆ** | **5ì´ˆ** |

### ë¦¬ì†ŒìŠ¤ ì‚¬ìš©

- **ë©”ëª¨ë¦¬**: í—¥ì‚¬ë³´ë“œ < 50KB, Python < 100MB
- **ë„¤íŠ¸ì›Œí¬**: < 1KB/ì´ˆ (í‰ê· )
- **CPU**: í—¥ì‚¬ë³´ë“œ < 20%, Python < 30%

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### í†µì‹  ë³´ì•ˆ

- âœ… MQTT over TLS (í¬íŠ¸ 8883)
- âœ… Username/Password ì¸ì¦
- âœ… API í‚¤ í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

### ë°ì´í„° í”„ë¼ì´ë²„ì‹œ

- âœ… ê°œì¸ ì •ë³´ ë¯¸í¬í•¨
- âœ… ë¡œì»¬ ì²˜ë¦¬ ìš°ì„ 
- âœ… ë°ì´í„° ë³´ê´€ ê¸°ê°„ ì œí•œ

---

## ğŸ“ í•µì‹¬ ì •ë¦¬

### ì•„í‚¤í…ì²˜ ì›ì¹™

1. **ëª¨ë“ˆí™”**: ê° ì»´í¬ë„ŒíŠ¸ ë…ë¦½ì 
2. **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë³´ë“œ ì¶”ê°€ ìš©ì´
3. **ì‹ ë¢°ì„±**: ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°±
4. **íš¨ìœ¨ì„±**: ë¦¬ì†ŒìŠ¤ ìµœì†Œí™”
5. **ë³´ì•ˆì„±**: TLS ë° ì¸ì¦

### ë°ì´í„° íë¦„

```
ì„¼ì„œ(5ì´ˆ) â†’ MQTT â†’ AI ë¶„ì„(10ì´ˆ) â†’ ëª…ë ¹ ìƒì„± â†’ MQTT â†’ LED ì œì–´
```

---

## â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

### Q1. ì™œ 10ì´ˆë§ˆë‹¤ AI ë¶„ì„í•˜ë‚˜ìš”?
**A**: ë¹„ìš© ì ˆê°ê³¼ ì„±ëŠ¥ ê· í˜•. í™˜ê²½ì€ ë¹ ë¥´ê²Œ ë³€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ 10ì´ˆë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.

### Q2. í—¥ì‚¬ë³´ë“œê°€ ì˜¤í”„ë¼ì¸ì´ ë˜ë©´?
**A**: ë§ˆì§€ë§‰ ëª…ë ¹ ìƒíƒœ ìœ ì§€. ì¬ì—°ê²° ì‹œ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë™ê¸°í™”ë©ë‹ˆë‹¤.

### Q3. ì—¬ëŸ¬ ë³´ë“œë¥¼ ë™ì‹œì— ì œì–´í•  ìˆ˜ ìˆë‚˜ìš”?
**A**: ë„¤. Board IDë¡œ êµ¬ë¶„í•˜ì—¬ ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

**ë‹¤ìŒ ì±•í„°ì—ì„œëŠ”**:
- ì‹¤ì œ ì½”ë“œ êµ¬í˜„
- ë‹¨ê³„ë³„ í†µí•©
- í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…

---

**ğŸ‰ Chapter 21 ì™„ë£Œ!**  
ì´ì œ ì‹¤ì œ êµ¬í˜„ì„ ì‹œì‘í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!

